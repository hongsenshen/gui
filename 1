import sys
from PySide6.QtWidgets import QApplication, QMainWindow, QWidget, QVBoxLayout, QHBoxLayout, QPushButton, QLabel
from PySide6.QtCore import Qt, QPoint
from PySide6.QtGui import QCursor

class CustomTitleBar(QWidget):
    def __init__(self, parent):
        super().__init__(parent)
        self.parent = parent
        self.setFixedHeight(32)
        self.start = None
        self.pressed = False

        layout = QHBoxLayout(self)
        layout.setContentsMargins(0, 0, 0, 0)
        layout.setSpacing(0)

        self.title = QLabel("Custom Window")
        self.title.setStyleSheet("padding: 5px;")
        layout.addWidget(self.title)
        layout.addStretch()

        self.min_button = QPushButton("-")
        self.max_button = QPushButton("â–¡")
        self.close_button = QPushButton("Ã—")
        for btn in (self.min_button, self.max_button, self.close_button):
            btn.setFixedSize(46, 32)
            btn.setStyleSheet("""
                QPushButton { border: none; background: transparent; font-size: 16px; }
                QPushButton:hover { background: rgba(0, 0, 0, 10%); }
                QPushButton:pressed { background: rgba(0, 0, 0, 20%); }
            """)
        self.close_button.setStyleSheet("""
            QPushButton { border: none; background: transparent; font-size: 16px; }
            QPushButton:hover { background: rgb(232, 17, 35); color: white; }
            QPushButton:pressed { background: rgb(190, 0, 0); color: white; }
        """)
        self.min_button.clicked.connect(self.parent.showMinimized)
        self.max_button.clicked.connect(self.toggle_maximize)
        self.close_button.clicked.connect(self.parent.close)
        layout.addWidget(self.min_button)
        layout.addWidget(self.max_button)
        layout.addWidget(self.close_button)

    def toggle_maximize(self):
        if self.parent.isMaximized():
            self.parent.showNormal()
            self.max_button.setText("â–¡")
        else:
            self.parent.showMaximized()
            self.max_button.setText("?")

    def mousePressEvent(self, event):
        if event.button() == Qt.LeftButton and event.pos().y() < self.height():
            self.pressed = True
            self.start = event.globalPosition().toPoint()
        else:
            event.ignore()

    def mouseMoveEvent(self, event):
        if self.pressed and not self.parent.isMaximized():
            delta = event.globalPosition().toPoint() - self.start
            self.parent.move(self.parent.x() + delta.x(), self.parent.y() + delta.y())
            self.start = event.globalPosition().toPoint()
        else:
            event.ignore()

    def mouseReleaseEvent(self, event):
        self.pressed = False

    def mouseDoubleClickEvent(self, event):
        self.toggle_maximize()

class MainWindow(QMainWindow):
    def __init__(self):
        super().__init__()
        self.setWindowFlags(Qt.FramelessWindowHint)
        self.setAttribute(Qt.WA_TranslucentBackground)

        self.container = QWidget()
        self.setCentralWidget(self.container)
        layout = QVBoxLayout(self.container)
        layout.setContentsMargins(1, 1, 1, 1)
        layout.setSpacing(0)

        self.title_bar = CustomTitleBar(self)
        layout.addWidget(self.title_bar)

        content = QWidget()
        content.setStyleSheet("background: white;")
        layout.addWidget(content)

        self.container.setStyleSheet("""
            QWidget { background: rgb(240, 240, 240); border: 1px solid rgb(120, 120, 120); }
        """)
        self.resize(800, 600)
        self.old_pos = None
        self.resize_edge = None

    def get_resize_edge(self, pos):
        margin = 15
        rect = self.rect()
        left = pos.x() <= margin
        right = pos.x() >= rect.width() - margin
        top = pos.y() <= margin
        bottom = pos.y() >= rect.height() - margin

        if left and top:
            return "top-left"
        elif right and top:
            return "top-right"
        elif left and bottom:
            return "bottom-left"
        elif right and bottom:
            return "bottom-right"
        elif left:
            return "left"
        elif right:
            return "right"
        elif top:
            return "top"
        elif bottom:
            return "bottom"
        return None

    def mousePressEvent(self, event):
        if event.button() == Qt.LeftButton and not self.isMaximized():
            self.old_pos = event.globalPosition().toPoint()
            self.resize_edge = self.get_resize_edge(event.position().toPoint())

    def mouseMoveEvent(self, event):
        if self.isMaximized():
            return

        local_pos = event.position().toPoint()
        edge = self.get_resize_edge(local_pos)

        if edge == "top-left" or edge == "bottom-right":
            self.setCursor(Qt.SizeFDiagCursor)
        elif edge == "top-right" or edge == "bottom-left":
            self.setCursor(Qt.SizeBDiagCursor)
        elif edge == "left" or edge == "right":
            self.setCursor(Qt.SizeHorCursor)
        elif edge == "top" or edge == "bottom":
            self.setCursor(Qt.SizeVerCursor)
        else:
            self.unsetCursor()

        if self.old_pos and self.resize_edge and event.buttons() & Qt.LeftButton:
            pos = event.globalPosition().toPoint()
            delta = pos - self.old_pos
            geo = self.geometry()
            min_width, min_height = 200, 200

            if "left" in self.resize_edge:
                new_width = max(min_width, geo.width() - delta.x())
                geo.setX(geo.right() - new_width)
                geo.setWidth(new_width)
            elif "right" in self.resize_edge:
                new_width = max(min_width, geo.width() + delta.x())
                geo.setWidth(new_width)

            if "top" in self.resize_edge:
                new_height = max(min_height, geo.height() - delta.y())
                geo.setY(geo.bottom() - new_height)
                geo.setHeight(new_height)
            elif "bottom" in self.resize_edge:
                new_height = max(min_height, geo.height() + delta.y())
                geo.setHeight(new_height)

            self.setGeometry(geo)
            self.old_pos = pos

    def mouseReleaseEvent(self, event):
        self.old_pos = None
        self.resize_edge = None
        self.unsetCursor()

if __name__ == '__main__':
    app = QApplication(sys.argv)
    window = MainWindow()
    window.show()
    sys.exit(app.exec())









import sys
from PySide6.QtWidgets import QApplication, QMainWindow, QWidget, QVBoxLayout, QHBoxLayout, QPushButton, QLabel
from PySide6.QtCore import Qt, QPoint
from PySide6.QtGui import QCursor, QMouseEvent

class CustomTitleBar(QWidget):
    def __init__(self, parent):
        super().__init__(parent)
        self.parent = parent
        self.setFixedHeight(32)
        self.start = None
        self.pressed = False

        layout = QHBoxLayout(self)
        layout.setContentsMargins(0, 0, 0, 0)
        layout.setSpacing(0)

        self.title = QLabel("Custom Window")
        self.title.setStyleSheet("padding: 5px;")
        layout.addWidget(self.title)
        layout.addStretch()

        self.min_button = QPushButton("-")
        self.max_button = QPushButton("â–¡")
        self.close_button = QPushButton("Ã—")

        for btn in (self.min_button, self.max_button, self.close_button):
            btn.setFixedSize(46, 32)
            btn.setStyleSheet("""
                QPushButton {
                    border: none;
                    background: transparent;
                    font-size: 16px;
                }
                QPushButton:hover {
                    background: rgba(0, 0, 0, 10%);
                }
                QPushButton:pressed {
                    background: rgba(0, 0, 0, 20%);
                }
            """)

        self.close_button.setStyleSheet("""
            QPushButton {
                border: none;
                background: transparent;
            }
            QPushButton:hover {
                background: rgb(232, 17, 35);
                color: white;
            }
            QPushButton:pressed {
                background: rgb(190, 0, 0);
                color: white;
            }
        """)

        self.min_button.clicked.connect(self.parent.showMinimized)
        self.max_button.clicked.connect(self.toggle_maximize)
        self.close_button.clicked.connect(self.parent.close)

        layout.addWidget(self.min_button)
        layout.addWidget(self.max_button)
        layout.addWidget(self.close_button)

    def toggle_maximize(self):
        if self.parent.isMaximized():
            self.parent.showNormal()
            self.max_button.setText("â–¡")
        else:
            self.parent.showMaximized()
            self.max_button.setText("?")

    def mousePressEvent(self, event):
        if event.button() == Qt.LeftButton:
            self.pressed = True
            self.start = event.globalPosition().toPoint()

    def mouseMoveEvent(self, event):
        if self.pressed and not self.parent.isMaximized():
            delta = event.globalPosition().toPoint() - self.start
            self.parent.move(self.parent.x() + delta.x(), self.parent.y() + delta.y())
            self.start = event.globalPosition().toPoint()
        else:
            event.ignore()  # å…è®¸äº‹ä»¶ä¼ é€’åˆ°çˆ¶çª—å£

    def mouseReleaseEvent(self, event):
        self.pressed = False

    def mouseDoubleClickEvent(self, event):
        self.toggle_maximize()

class MainWindow(QMainWindow):
    def __init__(self):
        super().__init__()
        self.setWindowFlags(Qt.FramelessWindowHint)
        self.setAttribute(Qt.WA_TranslucentBackground)
        self.setMouseTracking(True)  # å¯ç”¨é¼ æ ‡è·Ÿè¸ª

        self.container = QWidget()
        self.setCentralWidget(self.container)
        layout = QVBoxLayout(self.container)
        layout.setContentsMargins(1, 1, 1, 1)
        layout.setSpacing(0)

        self.title_bar = CustomTitleBar(self)
        layout.addWidget(self.title_bar)

        content = QWidget()
        content.setStyleSheet("background: white;")
        content.setAttribute(Qt.WA_TransparentForMouseEvents, True)  # å†…å®¹åŒºåŸŸä¸æ‹¦æˆªäº‹ä»¶
        layout.addWidget(content)

        self.container.setStyleSheet("""
            QWidget {
                background: rgb(240, 240, 240);
                border: 1px solid rgb(120, 120, 120);
            }
        """)

        self.resize(800, 600)
        self.old_pos = None
        self.resize_edge = None

    def get_resize_edge(self, pos):
        margin = 5
        rect = self.rect()
        left = pos.x() <= margin
        right = pos.x() >= rect.width() - margin
        top = pos.y() <= margin
        bottom = pos.y() >= rect.height() - margin

        if left and top:
            return "top-left"
        elif right and top:
            return "top-right"
        elif left and bottom:
            return "bottom-left"
        elif right and bottom:
            return "bottom-right"
        elif left:
            return "left"
        elif right:
            return "right"
        elif top:
            return "top"
        elif bottom:
            return "bottom"
        return None

    def mousePressEvent(self, event):
        if event.button() == Qt.LeftButton and not self.isMaximized():
            self.old_pos = event.globalPosition().toPoint()
            # å°†å…¨å±€åæ ‡è½¬æ¢ä¸ºçª—å£å†…çš„åæ ‡
            local_pos = self.mapFromGlobal(self.old_pos)
            self.resize_edge = self.get_resize_edge(local_pos)

    def mouseMoveEvent(self, event):
        if self.isMaximized():
            return

        # ä½¿ç”¨æ­£ç¡®çš„åæ ‡è½¬æ¢
        global_pos = event.globalPosition().toPoint()
        local_pos = self.mapFromGlobal(global_pos)
        edge = self.get_resize_edge(local_pos)

        # æ›´æ–°å…‰æ ‡æ ·å¼
        if edge in ["top-left", "bottom-right"]:
            self.setCursor(Qt.SizeFDiagCursor)
        elif edge in ["top-right", "bottom-left"]:
            self.setCursor(Qt.SizeBDiagCursor)
        elif edge in ["left", "right"]:
            self.setCursor(Qt.SizeHorCursor)
        elif edge in ["top", "bottom"]:
            self.setCursor(Qt.SizeVerCursor)
        else:
            self.unsetCursor()

        # å¤„ç†æ‹‰ä¼¸
        if self.old_pos and self.resize_edge and event.buttons() & Qt.LeftButton:
            delta = global_pos - self.old_pos
            geo = self.geometry()
            min_width, min_height = 200, 200

            if "left" in self.resize_edge:
                new_width = max(min_width, geo.width() - delta.x())
                geo.setLeft(geo.right() - new_width)
            elif "right" in self.resize_edge:
                new_width = max(min_width, geo.width() + delta.x())
                geo.setWidth(new_width)

            if "top" in self.resize_edge:
                new_height = max(min_height, geo.height() - delta.y())
                geo.setTop(geo.bottom() - new_height)
            elif "bottom" in self.resize_edge:
                new_height = max(min_height, geo.height() + delta.y())
                geo.setHeight(new_height)

            self.setGeometry(geo)
            self.old_pos = global_pos

    def mouseReleaseEvent(self, event):
        self.old_pos = None
        self.resize_edge = None
        self.unsetCursor()

if __name__ == '__main__':
    app = QApplication(sys.argv)
    window = MainWindow()
    window.show()
    sys.exit(app.exec())














import sys
from PySide6.QtWidgets import QApplication, QMainWindow, QWidget, QVBoxLayout, QHBoxLayout, QPushButton, QLabel
from PySide6.QtCore import Qt, QPoint
from PySide6.QtGui import QCursor

class CustomTitleBar(QWidget):
    def __init__(self, parent):
        super().__init__(parent)
        self.parent = parent
        self.setFixedHeight(32)
        self.start = None
        self.pressed = False
        
        # å¸ƒå±€
        layout = QHBoxLayout(self)
        layout.setContentsMargins(0, 0, 0, 0)
        layout.setSpacing(0)
        
        # æ ‡é¢˜
        self.title = QLabel("Custom Window")
        self.title.setStyleSheet("padding: 5px;")
        layout.addWidget(self.title)
        layout.addStretch()
        
        # æŒ‰é’®ï¼ˆä½¿ç”¨ç®€å•å­—ç¬¦é¿å…ä¹±ç ï¼‰
        self.min_button = QPushButton("-")
        self.max_button = QPushButton("â–¡")
        self.close_button = QPushButton("Ã—")
        
        for btn in (self.min_button, self.max_button, self.close_button):
            btn.setFixedSize(46, 32)
            btn.setStyleSheet("""
                QPushButton {
                    border: none;
                    background: transparent;
                    font-size: 16px;
                }
                QPushButton:hover {
                    background: rgba(0, 0, 0, 10%);
                }
                QPushButton:pressed {
                    background: rgba(0, 0, 0, 20%);
                }
            """)
            
        self.close_button.setStyleSheet("""
            QPushButton {
                border: none;
                background: transparent;
                font-size: 16px;
            }
            QPushButton:hover {
                background: rgb(232, 17, 35);
                color: white;
            }
            QPushButton:pressed {
                background: rgb(190, 0, 0);
                color: white;
            }
        """)
        
        self.min_button.clicked.connect(self.parent.showMinimized)
        self.max_button.clicked.connect(self.toggle_maximize)
        self.close_button.clicked.connect(self.parent.close)
        
        layout.addWidget(self.min_button)
        layout.addWidget(self.max_button)
        layout.addWidget(self.close_button)
        
    def toggle_maximize(self):
        if self.parent.isMaximized():
            self.parent.showNormal()
            self.max_button.setText("â–¡")
        else:
            self.parent.showMaximized()
            self.max_button.setText("?")
            
    def mousePressEvent(self, event):
        if event.button() == Qt.LeftButton:
            self.pressed = True
            self.start = event.globalPosition().toPoint()
            
    def mouseMoveEvent(self, event):
        if self.pressed and not self.parent.isMaximized():
            delta = event.globalPosition().toPoint() - self.start
            self.parent.move(self.parent.x() + delta.x(), self.parent.y() + delta.y())
            self.start = event.globalPosition().toPoint()
            
    def mouseReleaseEvent(self, event):
        self.pressed = False
        
    def mouseDoubleClickEvent(self, event):
        self.toggle_maximize()

class MainWindow(QMainWindow):
    def __init__(self):
        super().__init__()
        self.setWindowFlags(Qt.FramelessWindowHint)
        self.setAttribute(Qt.WA_TranslucentBackground)
        
        # ä¸»å®¹å™¨
        self.container = QWidget()
        self.setCentralWidget(self.container)
        layout = QVBoxLayout(self.container)
        layout.setContentsMargins(1, 1, 1, 1)
        layout.setSpacing(0)
        
        # æ ‡é¢˜æ 
        self.title_bar = CustomTitleBar(self)
        layout.addWidget(self.title_bar)
        
        # å†…å®¹åŒºåŸŸ
        content = QWidget()
        content.setStyleSheet("background: white;")
        layout.addWidget(content)
        
        # çª—å£æ ·å¼
        self.container.setStyleSheet("""
            QWidget {
                background: rgb(240, 240, 240);
                border: 1px solid rgb(120, 120, 120);
            }
        """)
        
        self.resize(800, 600)
        self.old_pos = None
        self.resize_edge = None
        
    def get_resize_edge(self, pos):
        margin = 5
        rect = self.rect()
        
        left = pos.x() <= margin
        right = pos.x() >= rect.width() - margin
        top = pos.y() <= margin
        bottom = pos.y() >= rect.height() - margin
        
        if left and top:
            return "top-left"
        elif right and top:
            return "top-right"
        elif left and bottom:
            return "bottom-left"
        elif right and bottom:
            return "bottom-right"
        elif left:
            return "left"
        elif right:
            return "right"
        elif top:
            return "top"
        elif bottom:
            return "bottom"
        return None
        
    def mousePressEvent(self, event):
        if event.button() == Qt.LeftButton and not self.isMaximized():
            self.old_pos = event.globalPosition().toPoint()
            self.resize_edge = self.get_resize_edge(event.position().toPoint())
            
    def mouseMoveEvent(self, event):
        if self.isMaximized():
            return
            
        local_pos = event.position().toPoint()
        edge = self.get_resize_edge(local_pos)
        
        # æ›´æ–°é¼ æ ‡æ ·å¼
        if edge == "top-left" or edge == "bottom-right":
            self.setCursor(Qt.SizeFDiagCursor)
        elif edge == "top-right" or edge == "bottom-left":
            self.setCursor(Qt.SizeBDiagCursor)
        elif edge == "left" or edge == "right":
            self.setCursor(Qt.SizeHorCursor)
        elif edge == "top" or edge == "bottom":
            self.setCursor(Qt.SizeVerCursor)
        else:
            self.unsetCursor()
            
        # å¤„ç†æ‹‰ä¼¸
        if self.old_pos and self.resize_edge and event.buttons() & Qt.LeftButton:
            pos = event.globalPosition().toPoint()
            delta = pos - self.old_pos
            geo = self.geometry()
            min_width, min_height = 200, 200
            
            if "left" in self.resize_edge:
                new_width = max(min_width, geo.width() - delta.x())
                geo.setX(geo.right() - new_width)
            elif "right" in self.resize_edge:
                new_width = max(min_width, geo.width() + delta.x())
                geo.setWidth(new_width)
                
            if "top" in self.resize_edge:
                new_height = max(min_height, geo.height() - delta.y())
                geo.setY(geo.bottom() - new_height)
            elif "bottom" in self.resize_edge:
                new_height = max(min_height, geo.height() + delta.y())
                geo.setHeight(new_height)
                
            self.setGeometry(geo)
            self.old_pos = pos
            
    def mouseReleaseEvent(self, event):
        self.old_pos = None
        self.resize_edge = None
        self.unsetCursor()

if __name__ == '__main__':
    app = QApplication(sys.argv)
    window = MainWindow()
    window.show()
    sys.exit(app.exec())













import sys
from PySide6.QtWidgets import QApplication, QMainWindow, QWidget, QVBoxLayout, QHBoxLayout, QPushButton, QLabel
from PySide6.QtCore import Qt, QPoint
from PySide6.QtGui import QCursor

class CustomTitleBar(QWidget):
    def __init__(self, parent):
        super().__init__(parent)
        self.parent = parent
        self.setFixedHeight(32)
        self.start = None
        self.pressed = False
        
        # å¸ƒå±€
        layout = QHBoxLayout(self)
        layout.setContentsMargins(0, 0, 0, 0)
        layout.setSpacing(0)
        
        # æ ‡é¢˜
        self.title = QLabel("Custom Window")
        self.title.setStyleSheet("padding: 5px;")
        layout.addWidget(self.title)
        layout.addStretch()
        
        # æŒ‰é’®
        self.min_button = QPushButton("?")
        self.max_button = QPushButton("?")
        self.close_button = QPushButton("?")
        
        for btn in (self.min_button, self.max_button, self.close_button):
            btn.setFixedSize(46, 32)
            btn.setStyleSheet("""
                QPushButton {
                    border: none;
                    background: transparent;
                }
                QPushButton:hover {
                    background: rgba(0, 0, 0, 10%);
                }
                QPushButton:pressed {
                    background: rgba(0, 0, 0, 20%);
                }
            """)
            
        self.close_button.setStyleSheet("""
            QPushButton {
                border: none;
                background: transparent;
            }
            QPushButton:hover {
                background: rgb(232, 17, 35);
                color: white;
            }
            QPushButton:pressed {
                background: rgb(190, 0, 0);
                color: white;
            }
        """)
        
        self.min_button.clicked.connect(self.parent.showMinimized)
        self.max_button.clicked.connect(self.toggle_maximize)
        self.close_button.clicked.connect(self.parent.close)
        
        layout.addWidget(self.min_button)
        layout.addWidget(self.max_button)
        layout.addWidget(self.close_button)
        
    def toggle_maximize(self):
        if self.parent.isMaximized():
            self.parent.showNormal()
            self.max_button.setText("?")
        else:
            self.parent.showMaximized()
            self.max_button.setText("?")
            
    def mousePressEvent(self, event):
        if event.button() == Qt.LeftButton:
            self.pressed = True
            self.start = event.globalPosition().toPoint()
            
    def mouseMoveEvent(self, event):
        if self.pressed:
            delta = event.globalPosition().toPoint() - self.start
            self.parent.move(self.parent.x() + delta.x(), self.parent.y() + delta.y())
            self.start = event.globalPosition().toPoint()
            
    def mouseReleaseEvent(self, event):
        self.pressed = False
        
    def mouseDoubleClickEvent(self, event):
        self.toggle_maximize()

class MainWindow(QMainWindow):
    def __init__(self):
        super().__init__()
        self.setWindowFlags(Qt.FramelessWindowHint)
        self.setAttribute(Qt.WA_TranslucentBackground)
        
        # ä¸»å®¹å™¨
        self.container = QWidget()
        self.setCentralWidget(self.container)
        layout = QVBoxLayout(self.container)
        layout.setContentsMargins(1, 1, 1, 1)
        layout.setSpacing(0)
        
        # æ ‡é¢˜æ 
        self.title_bar = CustomTitleBar(self)
        layout.addWidget(self.title_bar)
        
        # å†…å®¹åŒºåŸŸ
        content = QWidget()
        content.setStyleSheet("background: white;")
        layout.addWidget(content)
        
        # çª—å£æ ·å¼
        self.container.setStyleSheet("""
            QWidget {
                background: rgb(240, 240, 240);
                border: 1px solid rgb(120, 120, 120);
            }
        """)
        
        self.resize(800, 600)
        self.old_pos = None
        self.resize_edge = None
        
    def update_cursor(self, pos):
        edge = self.get_resize_edge(pos)
        if edge == "top-left" or edge == "bottom-right":
            self.setCursor(Qt.SizeFDiagCursor)
        elif edge == "top-right" or edge == "bottom-left":
            self.setCursor(Qt.SizeBDiagCursor)
        elif edge == "left" or edge == "right":
            self.setCursor(Qt.SizeHorCursor)
        elif edge == "top" or edge == "bottom":
            self.setCursor(Qt.SizeVerCursor)
        else:
            self.unsetCursor()
            
    def get_resize_edge(self, pos):
        margin = 5
        rect = self.rect()
        
        left = pos.x() <= margin
        right = pos.x() >= rect.width() - margin
        top = pos.y() <= margin
        bottom = pos.y() >= rect.height() - margin
        
        if left and top:
            return "top-left"
        elif right and top:
            return "top-right"
        elif left and bottom:
            return "bottom-left"
        elif right and bottom:
            return "bottom-right"
        elif left:
            return "left"
        elif right:
            return "right"
        elif top:
            return "top"
        elif bottom:
            return "bottom"
        return None
        
    def mousePressEvent(self, event):
        if event.button() == Qt.LeftButton and not self.isMaximized():
            self.old_pos = event.globalPosition().toPoint()
            self.resize_edge = self.get_resize_edge(event.position().toPoint())
            if self.resize_edge:  # å¦‚æœåœ¨è¾¹ç¼˜ï¼Œé˜»æ­¢æ ‡é¢˜æ æ‹–åŠ¨
                self.title_bar.pressed = False
                
    def mouseMoveEvent(self, event):
        if self.isMaximized():
            return
            
        pos = event.globalPosition().toPoint()
        local_pos = event.position().toPoint()
        
        # æ›´æ–°é¼ æ ‡æ ·å¼
        self.update_cursor(local_pos)
        
        # å¤„ç†æ‹‰ä¼¸
        if self.old_pos and self.resize_edge and event.buttons() & Qt.LeftButton:
            delta = pos - self.old_pos
            geo = self.geometry()
            min_width, min_height = 200, 200  # è®¾ç½®æœ€å°å°ºå¯¸
            
            if "left" in self.resize_edge:
                new_width = max(min_width, geo.width() - delta.x())
                geo.setLeft(geo.right() - new_width)
            elif "right" in self.resize_edge:
                new_width = max(min_width, geo.width() + delta.x())
                geo.setRight(geo.left() + new_width)
                
            if "top" in self.resize_edge:
                new_height = max(min_height, geo.height() - delta.y())
                geo.setTop(geo.bottom() - new_height)
            elif "bottom" in self.resize_edge:
                new_height = max(min_height, geo.height() + delta.y())
                geo.setBottom(geo.top() + new_height)
                
            self.setGeometry(geo)
            self.old_pos = pos
            
    def mouseReleaseEvent(self, event):
        self.old_pos = None
        self.resize_edge = None
        self.unsetCursor()

if __name__ == '__main__':
    app = QApplication(sys.argv)
    window = MainWindow()
    window.show()
    sys.exit(app.exec())














import sys
from PySide6.QtWidgets import QApplication, QMainWindow, QWidget, QVBoxLayout, QHBoxLayout, QPushButton, QLabel
from PySide6.QtCore import Qt, QRect, QSize
from PySide6.QtGui import QIcon, QCursor

class CustomTitleBar(QWidget):
    def __init__(self, parent):
        super().__init__(parent)
        self.parent = parent
        self.setFixedHeight(32)
        self.start = None
        self.pressed = False
        
        # å¸ƒå±€
        layout = QHBoxLayout(self)
        layout.setContentsMargins(0, 0, 0, 0)
        layout.setSpacing(0)
        
        # çª—å£å›¾æ ‡ï¼ˆå¯é€‰ï¼‰
        self.icon_label = QLabel()
        self.icon_label.setFixedWidth(32)
        layout.addWidget(self.icon_label)
        
        # æ ‡é¢˜
        self.title = QLabel("Custom Window")
        self.title.setStyleSheet("padding: 5px;")
        layout.addWidget(self.title)
        layout.addStretch()
        
        # æŒ‰é’®
        self.min_button = QPushButton("ğŸ—•")
        self.max_button = QPushButton("ğŸ—–")
        self.close_button = QPushButton("ğŸ—™")
        
        for btn in (self.min_button, self.max_button, self.close_button):
            btn.setFixedSize(46, 32)
            btn.setStyleSheet("""
                QPushButton {
                    border: none;
                    background: transparent;
                }
                QPushButton:hover {
                    background: rgba(0, 0, 0, 10%);
                }
                QPushButton:pressed {
                    background: rgba(0, 0, 0, 20%);
                }
            """)
            
        self.close_button.setStyleSheet("""
            QPushButton {
                border: none;
                background: transparent;
            }
            QPushButton:hover {
                background: rgb(232, 17, 35);
                color: white;
            }
            QPushButton:pressed {
                background: rgb(190, 0, 0);
                color: white;
            }
        """)
        
        self.min_button.clicked.connect(self.parent.showMinimized)
        self.max_button.clicked.connect(self.toggle_maximize)
        self.close_button.clicked.connect(self.parent.close)
        
        layout.addWidget(self.min_button)
        layout.addWidget(self.max_button)
        layout.addWidget(self.close_button)
        
    def toggle_maximize(self):
        if self.parent.isMaximized():
            self.parent.showNormal()
            self.max_button.setText("ğŸ—–")
        else:
            self.parent.showMaximized()
            self.max_button.setText("ğŸ——")
            
    def mousePressEvent(self, event):
        if event.button() == Qt.LeftButton:
            self.pressed = True
            self.start = event.globalPosition().toPoint()
            
    def mouseMoveEvent(self, event):
        if self.pressed:
            delta = event.globalPosition().toPoint() - self.start
            self.parent.move(self.parent.x() + delta.x(), self.parent.y() + delta.y())
            self.start = event.globalPosition().toPoint()
            
    def mouseReleaseEvent(self, event):
        self.pressed = False
        
    def mouseDoubleClickEvent(self, event):
        self.toggle_maximize()

class MainWindow(QMainWindow):
    def __init__(self):
        super().__init__()
        self.setWindowFlags(Qt.FramelessWindowHint)
        self.setAttribute(Qt.WA_TranslucentBackground)
        
        # ä¸»å®¹å™¨
        self.container = QWidget()
        self.setCentralWidget(self.container)
        layout = QVBoxLayout(self.container)
        layout.setContentsMargins(1, 1, 1, 1)
        layout.setSpacing(0)
        
        # æ ‡é¢˜æ 
        self.title_bar = CustomTitleBar(self)
        layout.addWidget(self.title_bar)
        
        # å†…å®¹åŒºåŸŸ
        content = QWidget()
        content.setStyleSheet("background: white;")
        layout.addWidget(content)
        
        # çª—å£æ ·å¼
        self.container.setStyleSheet("""
            QWidget {
                background: rgb(240, 240, 240);
                border: 1px solid rgb(120, 120, 120);
            }
        """)
        
        self.resize(800, 600)
        self.old_pos = None
        self.resize_direction = None
        
    def mousePressEvent(self, event):
        self.old_pos = event.globalPosition().toPoint()
        self.resize_direction = self.get_resize_direction(event.position().toPoint())
        
    def mouseMoveEvent(self, event):
        if self.isMaximized():
            return
            
        pos = event.globalPosition().toPoint()
        if not self.old_pos:
            return
            
        delta = pos - self.old_pos
        
        if self.resize_direction:
            self.handle_resize(delta)
        elif event.buttons() & Qt.LeftButton and event.position().toPoint().y() < 32:
            # å·²ç»è¢«æ ‡é¢˜æ å¤„ç†
            return
            
        self.old_pos = pos
        
        # æ›´æ–°é¼ æ ‡æ ·å¼
        direction = self.get_resize_direction(event.position().toPoint())
        if direction == "top-left" or direction == "bottom-right":
            self.setCursor(Qt.SizeFDiagCursor)
        elif direction == "top-right" or direction == "bottom-left":
            self.setCursor(Qt.SizeBDiagCursor)
        elif direction == "left" or direction == "right":
            self.setCursor(Qt.SizeHorCursor)
        elif direction == "top" or direction == "bottom":
            self.setCursor(Qt.SizeVerCursor)
        else:
            self.unsetCursor()
            
    def mouseReleaseEvent(self, event):
        self.old_pos = None
        self.resize_direction = None
        
    def get_resize_direction(self, pos):
        margin = 5
        rect = self.rect()
        
        left = pos.x() < margin
        right = pos.x() > rect.width() - margin
        top = pos.y() < margin
        bottom = pos.y() > rect.height() - margin
        
        if left and top:
            return "top-left"
        elif right and top:
            return "top-right"
        elif left and bottom:
            return "bottom-left"
        elif right and bottom:
            return "bottom-right"
        elif left:
            return "left"
        elif right:
            return "right"
        elif top:
            return "top"
        elif bottom:
            return "bottom"
        return None
        
    def handle_resize(self, delta):
        geo = self.geometry()
        min_size = self.minimumSize()
        
        if "left" in self.resize_direction:
            new_width = max(min_size.width(), geo.width() - delta.x())
            geo.setLeft(geo.right() - new_width)
        elif "right" in self.resize_direction:
            new_width = max(min_size.width(), geo.width() + delta.x())
            geo.setRight(geo.left() + new_width)
            
        if "top" in self.resize_direction:
            new_height = max(min_size.height(), geo.height() - delta.y())
            geo.setTop(geo.bottom() - new_height)
        elif "bottom" in self.resize_direction:
            new_height = max(min_size.height(), geo.height() + delta.y())
            geo.setBottom(geo.top() + new_height)
            
        self.setGeometry(geo)

if __name__ == '__main__':
    app = QApplication(sys.argv)
    window = MainWindow()
    window.show()
    sys.exit(app.exec())








åœ¨å½“å‰è®¾è®¡ä¸­ï¼Œtoken çš„çº¿ç¨‹å®‰å…¨æ€§ä»¥åŠè¿‡æœŸåè‡ªåŠ¨é‡æ–°éªŒè¯çš„é—®é¢˜ç¡®å®éœ€è¦è¿›ä¸€æ­¥ä¼˜åŒ–ã€‚ä»¥ä¸‹æˆ‘ä¼šåˆ†æå½“å‰ token å­˜å‚¨çš„çº¿ç¨‹å®‰å…¨æ€§é—®é¢˜ï¼Œå¹¶æä¾›æ”¹è¿›æ–¹æ¡ˆï¼ŒåŒæ—¶å®ç° token è¿‡æœŸåè‡ªåŠ¨è§¦å‘é‡æ–°éªŒè¯çš„æœºåˆ¶ã€‚
1. Token çº¿ç¨‹å®‰å…¨æ€§åˆ†æ
å½“å‰é—®é¢˜
å¤šçº¿ç¨‹è®¿é—®ï¼šAppState ä¸­çš„ self.token å¯èƒ½è¢«å¤šä¸ªçº¿ç¨‹åŒæ—¶è®¿é—®ï¼ˆä¾‹å¦‚ HTTP æœåŠ¡å™¨çº¿ç¨‹å†™å…¥ï¼ŒGUI çº¿ç¨‹è¯»å–ï¼‰ï¼Œæ²¡æœ‰åŠ é”æœºåˆ¶ï¼Œå¯èƒ½å¯¼è‡´æ•°æ®ç«äº‰ã€‚
åŠ å¯†æ“ä½œï¼šcryptography.fernet çš„åŠ å¯†/è§£å¯†æ“ä½œæœ¬èº«æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œä½† self.token çš„èµ‹å€¼å’Œæ–‡ä»¶è¯»å†™æ“ä½œä¸æ˜¯ã€‚
è§£å†³æ–¹æ¡ˆï¼šæ·»åŠ çº¿ç¨‹åŒæ­¥
ä½¿ç”¨ threading.Lock ä¿æŠ¤ self.token çš„è¯»å†™æ“ä½œï¼Œç¡®ä¿çº¿ç¨‹å®‰å…¨ã€‚
å¯¹æ–‡ä»¶æ“ä½œï¼ˆä¿å­˜å’ŒåŠ è½½ tokenï¼‰ä¹ŸåŠ é”ï¼Œé¿å…å¹¶å‘è¯»å†™å†²çªã€‚
2. Token è¿‡æœŸåè‡ªåŠ¨è§¦å‘é‡æ–°éªŒè¯
éœ€æ±‚åˆ†æ
è¿‡æœŸæ£€æŸ¥ï¼šéœ€è¦åœ¨è·å– token æ—¶æ£€æŸ¥å…¶æœ‰æ•ˆæ€§ï¼ˆå‡è®¾ token æ˜¯ JWTï¼Œå¯ä»¥è§£æè¿‡æœŸæ—¶é—´ï¼‰ã€‚
è‡ªåŠ¨è§¦å‘ï¼šå¦‚æœ token è¿‡æœŸï¼Œè‡ªåŠ¨è·³è½¬åˆ°ç™»å½•é¡µé¢æˆ–åˆ·æ–° tokenï¼ˆå–å†³äºç¬¬ä¸‰æ–¹å¹³å°æ”¯æŒï¼‰ã€‚
è§£å†³æ–¹æ¡ˆ
å­˜å‚¨è¿‡æœŸæ—¶é—´ï¼šå°† token çš„è¿‡æœŸæ—¶é—´ä¿å­˜åˆ° AppStateï¼Œæ¯æ¬¡è·å– token æ—¶éªŒè¯ã€‚
ä¿¡å·æœºåˆ¶ï¼šå¦‚æœ token è¿‡æœŸï¼Œå‘å‡ºä¿¡å·è§¦å‘é‡æ–°ç™»å½•æˆ–åˆ·æ–°ã€‚
å®šæ—¶æ£€æŸ¥ï¼šå¯é€‰åœ°æ·»åŠ å®šæ—¶å™¨ï¼Œå®šæœŸæ£€æŸ¥ token çŠ¶æ€ã€‚
æ”¹è¿›åçš„ä»£ç 
1. app_state.py - çº¿ç¨‹å®‰å…¨å’Œè¿‡æœŸéªŒè¯
python
from PySide6.QtCore import QObject, Signal
from cryptography.fernet import Fernet
import json
import os
import threading
import jwt  # ç”¨äºè§£æ JWT tokenï¼ˆå‡è®¾ token æ˜¯ JWT æ ¼å¼ï¼‰
from datetime import datetime

class AppState(QObject):
    token_received = Signal(str)      # ä¿¡å·ï¼štoken å·²æ¥æ”¶
    switch_to_main = Signal()         # ä¿¡å·ï¼šåˆ‡æ¢åˆ°ä¸»é¡µé¢
    token_expired = Signal()          # ä¿¡å·ï¼štoken å·²è¿‡æœŸ

    def __init__(self):
        super().__init__()
        self.key = self._load_or_generate_key()
        self.cipher = Fernet(self.key)
        self.token = None
        self.expires_at = None  # token è¿‡æœŸæ—¶é—´
        self.token_file = "token.enc"
        self.lock = threading.Lock()  # çº¿ç¨‹é”

        # å°è¯•åŠ è½½å·²æœ‰ token
        self._load_token()

    def _load_or_generate_key(self):
        key_file = "secret.key"
        if os.path.exists(key_file):
            with open(key_file, "rb") as f:
                return f.read()
        else:
            key = Fernet.generate_key()
            with open(key_file, "wb") as f:
                f.write(key)
            return key

    def set_token(self, token):
        """è®¾ç½®å¹¶åŠ å¯†å­˜å‚¨ token"""
        with self.lock:
            self.token = token
            self._parse_expires_at(token)  # è§£æè¿‡æœŸæ—¶é—´
            self._save_token()
            self.token_received.emit(token)

    def get_token(self):
        """è·å– token å¹¶æ£€æŸ¥æœ‰æ•ˆæ€§"""
        with self.lock:
            if self.token and self._is_token_valid():
                return self.token
            elif self.token:  # token å·²è¿‡æœŸ
                self.token_expired.emit()
                return None
            return None

    def _parse_expires_at(self, token):
        """è§£æ token çš„è¿‡æœŸæ—¶é—´ï¼ˆå‡è®¾æ˜¯ JWTï¼‰"""
        try:
            decoded = jwt.decode(token, options={"verify_signature": False})  # ä¸éªŒè¯ç­¾åï¼Œä»…è§£æ
            self.expires_at = datetime.fromtimestamp(decoded.get("exp", 0))
        except Exception as e:
            print(f"Failed to parse token expiration: {e}")
            self.expires_at = None

    def _is_token_valid(self):
        """æ£€æŸ¥ token æ˜¯å¦æœ‰æ•ˆ"""
        if not self.expires_at:
            return True  # å¦‚æœæ²¡æœ‰è¿‡æœŸæ—¶é—´ï¼Œé»˜è®¤æœ‰æ•ˆ
        return datetime.now() < self.expires_at

    def _save_token(self):
        """åŠ å¯†å¹¶ä¿å­˜ token åˆ°æ–‡ä»¶"""
        with self.lock:
            if self.token:
                data = {
                    "token": self.cipher.encrypt(self.token.encode()).decode(),
                    "expires_at": self.expires_at.timestamp() if self.expires_at else 0
                }
                with open(self.token_file, "w") as f:
                    json.dump(data, f)

    def _load_token(self):
        """ä»æ–‡ä»¶åŠ è½½å¹¶è§£å¯† token"""
        with self.lock:
            if os.path.exists(self.token_file):
                with open(self.token_file, "r") as f:
                    data = json.load(f)
                try:
                    self.token = self.cipher.decrypt(data["token"].encode()).decode()
                    exp_ts = data.get("expires_at", 0)
                    self.expires_at = datetime.fromtimestamp(exp_ts) if exp_ts else None
                    if not self._is_token_valid():
                        self.token = None
                        self.expires_at = None
                        self.token_expired.emit()
                except Exception as e:
                    print(f"Failed to decrypt token: {e}")
                    self.token = None

    def clear_token(self):
        """æ¸…é™¤ token"""
        with self.lock:
            self.token = None
            self.expires_at = None
            if os.path.exists(self.token_file):
                os.remove(self.token_file)
2. ä¿®æ”¹ app.py - å¤„ç† token è¿‡æœŸ
python
import sys
from PySide6.QtWidgets import QApplication
from app_state import AppState
from login_window import LoginWindow
from main_window import MainWindow
from settings_window import SettingsWindow
from server_thread import ServerThread

class App(QApplication):
    def __init__(self, args):
        super().__init__(args)
        self.app_state = AppState()
        self.server_thread = ServerThread(self.app_state)
        self.server_thread.start()
        self.login_window = LoginWindow(self.app_state)
        self.main_window = MainWindow(self.app_state)
        self.settings_window = SettingsWindow(self.app_state)

        # æ ¹æ® token çŠ¶æ€å†³å®šåˆå§‹é¡µé¢
        if self.app_state.get_token():
            self.main_window.show_and_focus()
        else:
            self.login_window.show()
        self.main_window.hide()
        self.settings_window.hide()

        self.app_state.switch_to_main.connect(self.switch_to_main)
        self.app_state.token_received.connect(self.on_token_received)
        self.app_state.token_expired.connect(self.on_token_expired)

    def on_token_received(self, token):
        print(f"App received token: {token}")
        self.app_state.switch_to_main.emit()

    def switch_to_main(self):
        self.login_window.hide()
        self.main_window.show_and_focus()

    def on_token_expired(self):
        print("Token has expired, redirecting to login...")
        self.main_window.hide()
        self.settings_window.hide()
        self.login_window.show()
3. ä¿®æ”¹ main_window.py - æ£€æŸ¥ token æœ‰æ•ˆæ€§
python
from PySide6.QtWidgets import QMainWindow, QWidget, QHBoxLayout, QListWidget, QTableWidget, QTableWidgetItem

class MainWindow(QMainWindow):
    def __init__(self, app_state):
        super().__init__()
        self.app_state = app_state
        self.setWindowTitle("Main Interface")
        self.setGeometry(100, 100, 800, 600)

        main_widget = QWidget()
        main_layout = QHBoxLayout()
        self.sidebar = QListWidget()
        self.sidebar.addItems(["Home", "Settings", "Profile"])
        self.sidebar.setFixedWidth(200)
        self.table = QTableWidget()
        self.table.setRowCount(5)
        self.table.setColumnCount(3)
        self.table.setHorizontalHeaderLabels(["ID", "Name", "Value"])
        for row in range(5):
            for col in range(3):
                self.table.setItem(row, col, QTableWidgetItem(f"Cell {row+1}-{col+1}"))
        main_layout.addWidget(self.sidebar)
        main_layout.addWidget(self.table)
        main_widget.setLayout(main_layout)
        self.setCentralWidget(main_widget)

        self.app_state.token_received.connect(self.on_token_received)
        self.app_state.token_expired.connect(self.on_token_expired)

        if self.app_state.get_token():
            self.on_token_received(self.app_state.get_token())

    def on_token_received(self, token):
        print(f"MainWindow received token: {token}")

    def on_token_expired(self):
        print("MainWindow: Token expired")

    def show_and_focus(self):
        self.show()
        self.activateWindow()
        self.raise_()
ä¼˜åŒ–è¯´æ˜
çº¿ç¨‹å®‰å…¨æ€§
åŠ é”ï¼šself.lock ä¿æŠ¤æ‰€æœ‰å¯¹ self.token å’Œæ–‡ä»¶çš„æ“ä½œï¼Œç¡®ä¿çº¿ç¨‹å®‰å…¨ã€‚
ä¸€è‡´æ€§ï¼šå³ä½¿ HTTP æœåŠ¡å™¨çº¿ç¨‹å’Œ GUI çº¿ç¨‹åŒæ—¶è®¿é—®ï¼Œæ•°æ®ä¹Ÿä¸ä¼šæŸåã€‚
Token è¿‡æœŸå¤„ç†
è¿‡æœŸæ—¶é—´è§£æï¼šå‡è®¾ token æ˜¯ JWT æ ¼å¼ï¼Œä½¿ç”¨ jwt åº“è§£æ exp å­—æ®µã€‚
è‡ªåŠ¨è§¦å‘ï¼š
get_token() æ¯æ¬¡è°ƒç”¨æ—¶æ£€æŸ¥æœ‰æ•ˆæ€§ï¼Œè‹¥è¿‡æœŸåˆ™å‘å‡º token_expired ä¿¡å·ã€‚
App ç›‘å¬ token_expiredï¼Œè‡ªåŠ¨åˆ‡æ¢åˆ°ç™»å½•çª—å£ã€‚
æŒä¹…åŒ–ï¼šå°† token å’Œè¿‡æœŸæ—¶é—´ä¸€èµ·ä¿å­˜åˆ°æ–‡ä»¶ï¼Œå¯åŠ¨æ—¶éªŒè¯ã€‚
è¿è¡Œæ­¥éª¤
å®‰è£…ä¾èµ–ï¼š
bash
pip install cryptography pyjwt
æµ‹è¯•ï¼š
è¿è¡Œç¨‹åºï¼Œç™»å½•è·å– tokenï¼ˆå‡è®¾ JWT æ ¼å¼ï¼Œä¾‹å¦‚ eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIxMjM0NTY3ODkwIiwiZXhwIjoxNjAwMDAwMDAwfQ.SflKxwRJSMeKKF2QT4fwpMeJf36POk6yJV_adQssw5cï¼‰ã€‚
token ä¿å­˜åï¼Œå…³é—­ç¨‹åºå†é‡å¯ï¼Œè‹¥æœªè¿‡æœŸï¼Œç›´æ¥è¿›å…¥ä¸»é¡µé¢ã€‚
æ‰‹åŠ¨ä¿®æ”¹ token æ–‡ä»¶ä¸­çš„ expires_at ä¸ºè¿‡å»æ—¶é—´ï¼Œé‡å¯åä¼šè·³è½¬åˆ°ç™»å½•é¡µé¢ã€‚
è¿›ä¸€æ­¥ä¼˜åŒ–
åˆ·æ–° tokenï¼š
å¦‚æœç¬¬ä¸‰æ–¹æ”¯æŒåˆ·æ–° tokenï¼Œå¯åœ¨ get_token() ä¸­æ·»åŠ åˆ·æ–°é€»è¾‘ï¼š
python
def refresh_token(self):
    # è°ƒç”¨ç¬¬ä¸‰æ–¹ API åˆ·æ–° token
    new_token = "new_token_from_api"
    self.set_token(new_token)
    return new_token
å®šæ—¶æ£€æŸ¥ï¼š
æ·»åŠ  QTimer å®šæœŸæ£€æŸ¥ tokenï¼š
python
from PySide6.QtCore import QTimer
self.timer = QTimer()
self.timer.timeout.connect(self.check_token_validity)
self.timer.start(60000)  # æ¯åˆ†é’Ÿæ£€æŸ¥ä¸€æ¬¡
é”™è¯¯å¤„ç†ï¼š
å¯¹ JWT è§£æå¤±è´¥æˆ–æ–‡ä»¶æŸåçš„æƒ…å†µæ·»åŠ æ›´å¥å£®çš„å¼‚å¸¸å¤„ç†ã€‚
æ³¨æ„äº‹é¡¹
JWT ç­¾åï¼šå½“å‰æœªéªŒè¯ç­¾åï¼Œå®é™…åº”ç”¨ä¸­åº”æä¾›å¯†é’¥éªŒè¯ã€‚
æ€§èƒ½ï¼šé¢‘ç¹è°ƒç”¨ get_token() å¯èƒ½å½±å“æ€§èƒ½ï¼Œå¯ç¼“å­˜æœ‰æ•ˆ tokenã€‚
å¦‚æœéœ€è¦å®ç°åˆ·æ–° token æˆ–å…¶ä»–å…·ä½“åŠŸèƒ½ï¼Œè¯·å‘Šè¯‰æˆ‘ï¼Œæˆ‘å¯ä»¥è¿›ä¸€æ­¥è°ƒæ•´ï¼æœ‰ä»€ä¹ˆé—®é¢˜å—ï¼Ÿ







import sys
import threading
import webbrowser
import http.server
import socketserver
import urllib.request
import urllib.error
import json
import time
from PySide6.QtWidgets import QApplication
from PySide6.QtWebSockets import QWebSocketServer, QWebSocket
from PySide6.QtCore import QObject, Slot
from PySide6.QtNetwork import QHostAddress

# ç¬¬ä¸‰æ–¹ Web URLï¼ˆæ›¿æ¢ä¸ºå®é™…çš„ç™»å½•é¡µé¢ URLï¼‰
THIRD_PARTY_URL = "https://example.com/login"  # ç¤ºä¾‹ URLï¼Œæ›¿æ¢ä¸ºå®é™…åœ°å€

# è¯»å– qwebchannel.js
try:
    with open("qwebchannel.js", "r", encoding="utf-8") as f:
        QWEBCHANNEL_JS = f.read()
except FileNotFoundError:
    print("Error: qwebchannel.js not found in project directory. Please provide it.")
    sys.exit(1)

# æ³¨å…¥çš„å®¢æˆ·ç«¯è„šæœ¬
CLIENT_SCRIPT = """
<script type="text/javascript">
    window.onload = function() {
        var socket = new WebSocket("ws://localhost:12345");
        socket.onopen = function() {
            console.log("WebSocket connected");
            new QWebChannel(socket, function(channel) {
                console.log("QWebChannel initialized");
                var backend = channel.objects.backend;
                window.external = {
                    intoProgram: function(message) {
                        console.log("Calling intoProgram with:", message);
                        backend.intoProgram(message, function(result) {
                            console.log("Received from PySide6:", result);
                        });
                    }
                };
                // æ¨¡æ‹Ÿç™»å½•åå›è°ƒï¼ˆæ›¿æ¢ä¸ºå®é™…é€»è¾‘ï¼‰
                setTimeout(() => {
                    window.external.intoProgram("Token: abc123xyz");
                }, 5000);
            });
        };
        socket.onerror = function(error) {
            console.error("WebSocket error:", error);
        };
        socket.onclose = function() {
            console.log("WebSocket closed");
        };
    };
</script>
"""

class Backend(QObject):
    @Slot(str, result=str)
    def intoProgram(self, message):
        print(f"Received callback from Web: {message}")
        if "token" in message.lower():
            print(f"Detected token: {message}")
        return f"Python processed: {message}"

class WebSocketServer(QObject):
    def __init__(self):
        super().__init__()
        self.server = QWebSocketServer("MyServer", QWebSocketServer.NonSecureMode, self)
        self.server.newConnection.connect(self.on_new_connection)
        self.clients = []
        self.backend = Backend()

        if self.server.listen(QHostAddress.Any, 12345):
            print("WebSocket server listening on port 12345")
        else:
            print("Failed to start WebSocket server")

    def on_new_connection(self):
        client = self.server.nextPendingConnection()
        client.textMessageReceived.connect(self.on_message_received)
        client.disconnected.connect(lambda: self.clients.remove(client))
        self.clients.append(client)
        client.sendTextMessage(json.dumps({
            "type": 0,
            "payload": {"backend": {}}
        }))
        print("New client connected")

    def on_message_received(self, message):
        try:
            data = json.loads(message)
            if data.get("type") == 1:
                method = data.get("property")
                args = data.get("args", [])
                if method == "intoProgram" and args:
                    result = self.backend.intoProgram(args[0])
                    for client in self.clients:
                        client.sendTextMessage(json.dumps({
                            "type": 3,
                            "id": data.get("id"),
                            "data": result
                        }))
        except json.JSONDecodeError:
            print(f"Invalid message received: {message}")

class ProxyHandler(http.server.SimpleHTTPRequestHandler):
    def do_GET(self):
        # æ„é€ å®Œæ•´çš„ç¬¬ä¸‰æ–¹ URL
        request_path = self.path[1:] if self.path.startswith('/') else self.path
        target_url = f"{THIRD_PARTY_URL.rstrip('/')}/{request_path}" if request_path else THIRD_PARTY_URL
        print(f"Proxying request to: {target_url}")

        try:
            req = urllib.request.Request(target_url, headers={"User-Agent": "Mozilla/5.0"})
            with urllib.request.urlopen(req, timeout=10) as response:
                content_type = response.getheader("Content-Type", "text/html")
                content = response.read()

                # åªå¯¹ HTML å†…å®¹æ³¨å…¥è„šæœ¬
                if "text/html" in content_type.lower():
                    html_content = content.decode('utf-8', errors='ignore')
                    modified_html = html_content
                    if "</head>" in modified_html.lower():
                        modified_html = modified_html.replace("</head>", f"<script>{QWEBCHANNEL_JS}</script></head>", 1)
                    else:
                        modified_html += f"<script>{QWEBCHANNEL_JS}</script>"
                    if "</body>" in modified_html.lower():
                        modified_html = modified_html.replace("</body>", CLIENT_SCRIPT + "</body>", 1)
                    else:
                        modified_html += CLIENT_SCRIPT
                    content = modified_html.encode('utf-8')
                    print(f"Injected scripts into HTML from {target_url}")
                else:
                    print(f"Forwarding non-HTML resource: {target_url}")

                self.send_response(response.status)
                self.send_header("Content-type", content_type)
                for header, value in response.getheaders():
                    if header.lower() not in ("content-type", "transfer-encoding", "content-encoding"):
                        self.send_header(header, value)
                self.end_headers()
                self.wfile.write(content)

        except urllib.error.URLError as e:
            self.send_response(500)
            self.end_headers()
            self.wfile.write(f"Error loading {target_url}: {str(e)}".encode('utf-8'))
            print(f"Failed to load {target_url}: {str(e)}")
        except Exception as e:
            self.send_response(500)
            self.end_headers()
            self.wfile.write(f"Unexpected error: {str(e)}".encode('utf-8'))
            print(f"Unexpected error for {target_url}: {str(e)}")

def start_http_server():
    PORT = 8000
    try:
        with socketserver.TCPServer(("", PORT), ProxyHandler) as httpd:
            print(f"HTTP proxy server started at http://localhost:{PORT}")
            httpd.serve_forever()
    except OSError as e:
        print(f"Failed to start HTTP server on port {PORT}: {str(e)}")
        sys.exit(1)

if __name__ == "__main__":
    app = QApplication(sys.argv)
    
    ws_server = WebSocketServer()
    
    http_thread = threading.Thread(target=start_http_server, daemon=True)
    http_thread.start()
    
    time.sleep(1)  # ç­‰å¾… HTTP æœåŠ¡å™¨å¯åŠ¨
    
    proxy_url = "http://localhost:8000"
    webbrowser.open(proxy_url)
    print(f"Opened proxy URL: {proxy_url}")
    print(f"Proxying third-party URL: {THIRD_PARTY_URL}")
    print("User can now log in. Token will be captured automatically.")
    
    sys.exit(app.exec())









import sys
import threading
import webbrowser
import http.server
import socketserver
import urllib.request
import urllib.error
import json
import time
from PySide6.QtWidgets import QApplication
from PySide6.QtWebSockets import QWebSocketServer, QWebSocket
from PySide6.QtCore import QObject, Slot
from PySide6.QtNetwork import QHostAddress

# ç¬¬ä¸‰æ–¹ Web URLï¼ˆæ›¿æ¢ä¸ºå®é™…çš„ç™»å½•é¡µé¢ URLï¼‰
THIRD_PARTY_URL = "https://example.com/login"  # ç¤ºä¾‹ URLï¼Œæ›¿æ¢ä¸ºå®é™…åœ°å€

# è¯»å– qwebchannel.js
try:
    with open("qwebchannel.js", "r", encoding="utf-8") as f:
        QWEBCHANNEL_JS = f.read()
except FileNotFoundError:
    print("Error: qwebchannel.js not found in project directory. Please provide it.")
    sys.exit(1)

# æ³¨å…¥çš„å®¢æˆ·ç«¯è„šæœ¬
CLIENT_SCRIPT = """
<script type="text/javascript">
    window.onload = function() {
        var socket = new WebSocket("ws://localhost:12345");
        socket.onopen = function() {
            console.log("WebSocket connected");
            new QWebChannel(socket, function(channel) {
                console.log("QWebChannel initialized");
                var backend = channel.objects.backend;
                window.external = {
                    intoProgram: function(message) {
                        console.log("Calling intoProgram with:", message);
                        backend.intoProgram(message, function(result) {
                            console.log("Received from PySide6:", result);
                        });
                    }
                };
                // æ¨¡æ‹Ÿç™»å½•åå›è°ƒï¼ˆæ›¿æ¢ä¸ºå®é™…é€»è¾‘ï¼‰
                setTimeout(() => {
                    window.external.intoProgram("Token: abc123xyz");
                }, 5000);
            });
        };
        socket.onerror = function(error) {
            console.error("WebSocket error:", error);
        };
        socket.onclose = function() {
            console.log("WebSocket closed");
        };
    };
</script>
"""

class Backend(QObject):
    @Slot(str, result=str)
    def intoProgram(self, message):
        print(f"Received callback from Web: {message}")
        if "token" in message.lower():
            print(f"Detected token: {message}")
        return f"Python processed: {message}"

class WebSocketServer(QObject):
    def __init__(self):
        super().__init__()
        self.server = QWebSocketServer("MyServer", QWebSocketServer.NonSecureMode, self)
        self.server.newConnection.connect(self.on_new_connection)
        self.clients = []
        self.backend = Backend()

        if self.server.listen(QHostAddress.Any, 12345):
            print("WebSocket server listening on port 12345")
        else:
            print("Failed to start WebSocket server")

    def on_new_connection(self):
        client = self.server.nextPendingConnection()
        client.textMessageReceived.connect(self.on_message_received)
        client.disconnected.connect(lambda: self.clients.remove(client))
        self.clients.append(client)
        client.sendTextMessage(json.dumps({
            "type": 0,
            "payload": {"backend": {}}
        }))
        print("New client connected")

    def on_message_received(self, message):
        try:
            data = json.loads(message)
            if data.get("type") == 1:
                method = data.get("property")
                args = data.get("args", [])
                if method == "intoProgram" and args:
                    result = self.backend.intoProgram(args[0])
                    for client in self.clients:
                        client.sendTextMessage(json.dumps({
                            "type": 3,
                            "id": data.get("id"),
                            "data": result
                        }))
        except json.JSONDecodeError:
            print(f"Invalid message received: {message}")

class ProxyHandler(http.server.SimpleHTTPRequestHandler):
    def do_GET(self):
        print(f"Received request for: {self.path}")
        try:
            req = urllib.request.Request(THIRD_PARTY_URL, headers={"User-Agent": "Mozilla/5.0"})
            with urllib.request.urlopen(req, timeout=10) as response:
                print(f"Successfully loaded {THIRD_PARTY_URL}")
                html_content = response.read().decode('utf-8')
                modified_html = html_content
                if "</head>" in modified_html.lower():
                    modified_html = modified_html.replace("</head>", f"<script>{QWEBCHANNEL_JS}</script></head>", 1)
                else:
                    modified_html += f"<script>{QWEBCHANNEL_JS}</script>"
                if "</body>" in modified_html.lower():
                    modified_html = modified_html.replace("</body>", CLIENT_SCRIPT + "</body>", 1)
                else:
                    modified_html += CLIENT_SCRIPT

                self.send_response(200)
                self.send_header("Content-type", "text/html")
                self.end_headers()
                self.wfile.write(modified_html.encode('utf-8'))
                print("Response sent to browser")
        except urllib.error.URLError as e:
            self.send_response(500)
            self.end_headers()
            self.wfile.write(f"Error loading {THIRD_PARTY_URL}: {str(e)}".encode('utf-8'))
            print(f"Failed to load {THIRD_PARTY_URL}: {str(e)}")
        except Exception as e:
            self.send_response(500)
            self.end_headers()
            self.wfile.write(f"Unexpected error: {str(e)}".encode('utf-8'))
            print(f"Unexpected error: {str(e)}")

def start_http_server():
    PORT = 8000
    try:
        with socketserver.TCPServer(("", PORT), ProxyHandler) as httpd:
            print(f"HTTP proxy server started at http://localhost:{PORT}")
            httpd.serve_forever()
    except OSError as e:
        print(f"Failed to start HTTP server on port {PORT}: {str(e)}")
        sys.exit(1)

if __name__ == "__main__":
    app = QApplication(sys.argv)
    
    ws_server = WebSocketServer()
    
    http_thread = threading.Thread(target=start_http_server, daemon=True)
    http_thread.start()
    
    # ç­‰å¾… HTTP æœåŠ¡å™¨å¯åŠ¨
    time.sleep(1)
    
    proxy_url = "http://localhost:8000"
    webbrowser.open(proxy_url)
    print(f"Opened proxy URL: {proxy_url}")
    print(f"Proxying third-party URL: {THIRD_PARTY_URL}")
    print("User can now log in. Token will be captured automatically.")
    
    sys.exit(app.exec())









import sys
import threading
import webbrowser
import http.server
import socketserver
import urllib.request
import json
from PySide6.QtWidgets import QApplication
from PySide6.QtWebSockets import QWebSocketServer, QWebSocket
from PySide6.QtCore import QObject, Slot
from PySide6.QtNetwork import QHostAddress

# ç¬¬ä¸‰æ–¹ Web URLï¼ˆæ›¿æ¢ä¸ºå®é™…çš„ç™»å½•é¡µé¢ URLï¼‰
THIRD_PARTY_URL = "https://example.com/login"  # ç¤ºä¾‹ URLï¼Œæ›¿æ¢ä¸ºå®é™…åœ°å€

# å‡è®¾ qwebchannel.js å·²æ”¾å…¥é¡¹ç›®ç›®å½•ï¼Œè¯»å–å…¶å†…å®¹
try:
    with open("qwebchannel.js", "r", encoding="utf-8") as f:
        QWEBCHANNEL_JS = f.read()
except FileNotFoundError:
    print("Error: qwebchannel.js not found in project directory. Please provide it.")
    sys.exit(1)

# æ³¨å…¥çš„å®¢æˆ·ç«¯è„šæœ¬
CLIENT_SCRIPT = """
<script type="text/javascript">
    window.onload = function() {
        var socket = new WebSocket("ws://localhost:12345");
        socket.onopen = function() {
            console.log("WebSocket connected");
            new QWebChannel(socket, function(channel) {
                console.log("QWebChannel initialized");
                var backend = channel.objects.backend;
                window.external = {
                    intoProgram: function(message) {
                        console.log("Calling intoProgram with:", message);
                        backend.intoProgram(message, function(result) {
                            console.log("Received from PySide6:", result);
                        });
                    }
                };
                // æ¨¡æ‹Ÿç™»å½•åå›è°ƒï¼ˆæ›¿æ¢ä¸ºå®é™…é€»è¾‘ï¼‰
                setTimeout(() => {
                    window.external.intoProgram("Token: abc123xyz");
                }, 5000);
            });
        };
        socket.onerror = function(error) {
            console.error("WebSocket error:", error);
        };
        socket.onclose = function() {
            console.log("WebSocket closed");
        };
    };
</script>
"""

class Backend(QObject):
    @Slot(str, result=str)
    def intoProgram(self, message):
        print(f"Received callback from Web: {message}")
        if "token" in message.lower():
            print(f"Detected token: {message}")
        return f"Python processed: {message}"

class WebSocketServer(QObject):
    def __init__(self):
        super().__init__()
        self.server = QWebSocketServer("MyServer", QWebSocketServer.NonSecureMode, self)
        self.server.newConnection.connect(self.on_new_connection)
        self.clients = []
        self.backend = Backend()

        if self.server.listen(QHostAddress.Any, 12345):
            print("WebSocket server listening on port 12345")
        else:
            print("Failed to start server")

    def on_new_connection(self):
        client = self.server.nextPendingConnection()
        client.textMessageReceived.connect(self.on_message_received)
        client.disconnected.connect(lambda: self.clients.remove(client))
        self.clients.append(client)
        # å‘é€åˆå§‹åŒ–æ¶ˆæ¯ï¼Œæ¨¡æ‹Ÿ QWebChannel çš„å¯¹è±¡æ³¨å†Œ
        client.sendTextMessage(json.dumps({
            "type": 0,  # QWebChannel çš„åˆå§‹åŒ–æ¶ˆæ¯ç±»å‹
            "payload": {"backend": {}}
        }))
        print("New client connected")

    def on_message_received(self, message):
        try:
            data = json.loads(message)
            if data.get("type") == 1:  # QWebChannel çš„æ–¹æ³•è°ƒç”¨
                method = data.get("property")
                args = data.get("args", [])
                if method == "intoProgram" and args:
                    result = self.backend.intoProgram(args[0])
                    for client in self.clients:
                        client.sendTextMessage(json.dumps({
                            "type": 3,  # QWebChannel çš„å“åº”ç±»å‹
                            "id": data.get("id"),
                            "data": result
                        }))
        except json.JSONDecodeError:
            print(f"Invalid message received: {message}")

# HTTP ä»£ç†æœåŠ¡å™¨å¤„ç†ç±»
class ProxyHandler(http.server.SimpleHTTPRequestHandler):
    def do_GET(self):
        try:
            req = urllib.request.Request(THIRD_PARTY_URL, headers={"User-Agent": "Mozilla/5.0"})
            with urllib.request.urlopen(req) as response:
                html_content = response.read().decode('utf-8')
                modified_html = html_content
                if "</head>" in modified_html.lower():
                    modified_html = modified_html.replace("</head>", f"<script>{QWEBCHANNEL_JS}</script></head>", 1)
                else:
                    modified_html += f"<script>{QWEBCHANNEL_JS}</script>"
                if "</body>" in modified_html.lower():
                    modified_html = modified_html.replace("</body>", CLIENT_SCRIPT + "</body>", 1)
                else:
                    modified_html += CLIENT_SCRIPT

                self.send_response(200)
                self.send_header("Content-type", "text/html")
                self.end_headers()
                self.wfile.write(modified_html.encode('utf-8'))
        except urllib.error.URLError as e:
            self.send_response(500)
            self.end_headers()
            self.wfile.write(f"Error loading {THIRD_PARTY_URL}: {str(e)}".encode('utf-8'))
        except Exception as e:
            self.send_response(500)
            self.end_headers()
            self.wfile.write(f"Unexpected error: {str(e)}".encode('utf-8'))

def start_http_server():
    PORT = 8000
    with socketserver.TCPServer(("", PORT), ProxyHandler) as httpd:
        print(f"HTTP proxy server started at http://localhost:{PORT}")
        httpd.serve_forever()

if __name__ == "__main__":
    app = QApplication(sys.argv)
    
    ws_server = WebSocketServer()
    
    http_thread = threading.Thread(target=start_http_server, daemon=True)
    http_thread.start()
    
    proxy_url = "http://localhost:8000"
    webbrowser.open(proxy_url)
    print(f"Opened proxy URL: {proxy_url}")
    print(f"Proxying third-party URL: {THIRD_PARTY_URL}")
    print("User can now log in. Token will be captured automatically.")
    
    sys.exit(app.exec())











import sys
import threading
import webbrowser
import http.server
import socketserver
import urllib.request
import json
from PySide6.QtWidgets import QApplication
from PySide6.QtWebSockets import QWebSocketServer, QWebSocket
from PySide6.QtCore import QObject, Slot
from PySide6.QtNetwork import QHostAddress

# ç¬¬ä¸‰æ–¹ Web URLï¼ˆæ›¿æ¢ä¸ºå®é™…çš„ç™»å½•é¡µé¢ URLï¼‰
THIRD_PARTY_URL = "https://example.com/login"  # ç¤ºä¾‹ URLï¼Œæ›¿æ¢ä¸ºå®é™…åœ°å€

# å‡è®¾ qwebchannel.js å·²æ”¾å…¥é¡¹ç›®ç›®å½•ï¼Œè¯»å–å…¶å†…å®¹
try:
    with open("qwebchannel.js", "r", encoding="utf-8") as f:
        QWEBCHANNEL_JS = f.read()
except FileNotFoundError:
    print("Error: qwebchannel.js not found in project directory. Please provide it.")
    sys.exit(1)

# æ³¨å…¥çš„å®¢æˆ·ç«¯è„šæœ¬
CLIENT_SCRIPT = """
<script type="text/javascript">
    window.onload = function() {
        var socket = new WebSocket("ws://localhost:12345");
        socket.onopen = function() {
            console.log("WebSocket connected");
            new QWebChannel(socket, function(channel) {
                console.log("QWebChannel initialized");
                var backend = channel.objects.backend;
                window.external = {
                    intoProgram: function(message) {
                        console.log("Calling intoProgram with:", message);
                        backend.intoProgram(message, function(result) {
                            console.log("Received from PySide6:", result);
                        });
                    }
                };
                // æ¨¡æ‹Ÿç™»å½•åå›è°ƒï¼ˆæ›¿æ¢ä¸ºå®é™…é€»è¾‘ï¼‰
                setTimeout(() => {
                    window.external.intoProgram("Token: abc123xyz");
                }, 5000);
            });
        };
        socket.onerror = function(error) {
            console.error("WebSocket error:", error);
        };
        socket.onclose = function() {
            console.log("WebSocket closed");
        };
    };
</script>
"""

class Backend(QObject):
    @Slot(str, result=str)
    def intoProgram(self, message):
        print(f"Received callback from Web: {message}")
        if "token" in message.lower():
            print(f"Detected token: {message}")
        return f"Python processed: {message}"

class WebSocketServer(QObject):
    def __init__(self):
        super().__init__()
        self.server = QWebSocketServer("MyServer", QWebSocketServer.NonSecureMode, self)
        self.server.newConnection.connect(self.on_new_connection)
        self.clients = []
        self.backend = Backend()

        if self.server.listen(QHostAddress.Any, 12345):
            print("WebSocket server listening on port 12345")
        else:
            print("Failed to start server")

    def on_new_connection(self):
        client = self.server.nextPendingConnection()
        client.textMessageReceived.connect(self.on_message_received)
        client.disconnected.connect(lambda: self.clients.remove(client))
        self.clients.append(client)
        # å‘é€åˆå§‹åŒ–æ¶ˆæ¯ï¼Œæ¨¡æ‹Ÿ QWebChannel çš„å¯¹è±¡æ³¨å†Œ
        client.sendTextMessage(json.dumps({
            "type": 0,  # QWebChannel çš„åˆå§‹åŒ–æ¶ˆæ¯ç±»å‹
            "payload": {"backend": {}}
        }))
        print("New client connected")

    def on_message_received(self, message):
        try:
            data = json.loads(message)
            if data.get("type") == 1:  # QWebChannel çš„æ–¹æ³•è°ƒç”¨
                method = data.get("property")
                args = data.get("args", [])
                if method == "intoProgram" and args:
                    result = self.backend.intoProgram(args[0])
                    for client in self.clients:
                        client.sendTextMessage(json.dumps({
                            "type": 3,  # QWebChannel çš„å“åº”ç±»å‹
                            "id": data.get("id"),
                            "data": result
                        }))
        except json.JSONDecodeError:
            print(f"Invalid message received: {message}")

# HTTP ä»£ç†æœåŠ¡å™¨å¤„ç†ç±»
class ProxyHandler(http.server.SimpleHTTPRequestHandler):
    def do_GET(self):
        try:
            req = urllib.request.Request(THIRD_PARTY_URL, headers={"User-Agent": "Mozilla/5.0"})
            with urllib.request.urlopen(req) as response:
                html_content = response.read().decode('utf-8')
                modified_html = html_content
                if "</head>" in modified_html.lower():
                    modified_html = modified_html.replace("</head>", f"<script>{QWEBCHANNEL_JS}</script></head>", 1)
                else:
                    modified_html += f"<script>{QWEBCHANNEL_JS}</script>"
                if "</body>" in modified_html.lower():
                    modified_html = modified_html.replace("</body>", CLIENT_SCRIPT + "</body>", 1)
                else:
                    modified_html += CLIENT_SCRIPT

                self.send_response(200)
                self.send_header("Content-type", "text/html")
                self.end_headers()
                self.wfile.write(modified_html.encode('utf-8'))
        except urllib.error.URLError as e:
            self.send_response(500)
            self.end_headers()
            self.wfile.write(f"Error loading {THIRD_PARTY_URL}: {str(e)}".encode('utf-8'))
        except Exception as e:
            self.send_response(500)
            self.end_headers()
            self.wfile.write(f"Unexpected error: {str(e)}".encode('utf-8'))

def start_http_server():
    PORT = 8000
    with socketserver.TCPServer(("", PORT), ProxyHandler) as httpd:
        print(f"HTTP proxy server started at http://localhost:{PORT}")
        httpd.serve_forever()

if __name__ == "__main__":
    app = QApplication(sys.argv)
    
    ws_server = WebSocketServer()
    
    http_thread = threading.Thread(target=start_http_server, daemon=True)
    http_thread.start()
    
    proxy_url = "http://localhost:8000"
    webbrowser.open(proxy_url)
    print(f"Opened proxy URL: {proxy_url}")
    print(f"Proxying third-party URL: {THIRD_PARTY_URL}")
    print("User can now log in. Token will be captured automatically.")
    
    sys.exit(app.exec())











import sys
import threading
import webbrowser
import http.server
import socketserver
import urllib.request
from PySide6.QtWidgets import QApplication
from PySide6.QtWebSockets import QWebSocketServer, QWebSocket
from PySide6.QtWebChannel import QWebChannel
from PySide6.QtCore import QObject, Slot
from PySide6.QtNetwork import QHostAddress

# ç¬¬ä¸‰æ–¹ Web URLï¼ˆæ›¿æ¢ä¸ºå®é™…çš„ç™»å½•é¡µé¢ URLï¼‰
THIRD_PARTY_URL = "https://example.com/login"  # ç¤ºä¾‹ URLï¼Œæ›¿æ¢ä¸ºå®é™…åœ°å€

# å‡è®¾ qwebchannel.js å·²æ”¾å…¥é¡¹ç›®ç›®å½•ï¼Œè¯»å–å…¶å†…å®¹
try:
    with open("qwebchannel.js", "r", encoding="utf-8") as f:
        QWEBCHANNEL_JS = f.read()
except FileNotFoundError:
    print("Error: qwebchannel.js not found in project directory. Please provide it.")
    sys.exit(1)

# æ³¨å…¥çš„å®¢æˆ·ç«¯è„šæœ¬
CLIENT_SCRIPT = """
<script type="text/javascript">
    window.onload = function() {
        var socket = new WebSocket("ws://localhost:12345");
        socket.onopen = function() {
            console.log("WebSocket connected");
            new QWebChannel(socket, function(channel) {
                console.log("QWebChannel initialized");
                var backend = channel.objects.backend;
                window.external = {
                    intoProgram: function(message) {
                        console.log("Calling intoProgram with:", message);
                        backend.intoProgram(message, function(result) {
                            console.log("Received from PySide6:", result);
                        });
                    }
                };
                // æ¨¡æ‹Ÿç™»å½•åå›è°ƒï¼ˆæ›¿æ¢ä¸ºå®é™…é€»è¾‘ï¼‰
                setTimeout(() => {
                    window.external.intoProgram("Token: abc123xyz");
                }, 5000);
            });
        };
        socket.onerror = function(error) {
            console.error("WebSocket error:", error);
        };
        socket.onclose = function() {
            console.log("WebSocket closed");
        };
    };
</script>
"""

class Backend(QObject):
    @Slot(str, result=str)
    def intoProgram(self, message):
        print(f"Received callback from Web: {message}")
        if "token" in message.lower():
            print(f"Detected token: {message}")
        return f"Python processed: {message}"

class WebSocketServer(QObject):
    def __init__(self):
        super().__init__()
        self.server = QWebSocketServer("MyServer", QWebSocketServer.NonSecureMode, self)
        self.server.newConnection.connect(self.on_new_connection)
        self.clients = []
        self.backend = Backend()
        self.channel = QWebChannel(self)
        self.channel.registerObject("backend", self.backend)

        if self.server.listen(QHostAddress.Any, 12345):
            print("WebSocket server listening on port 12345")
        else:
            print("Failed to start server")

    def on_new_connection(self):
        client = self.server.nextPendingConnection()
        client.setParent(self)
        self.channel.connectTo(client)
        client.disconnected.connect(lambda: self.clients.remove(client))
        self.clients.append(client)
        print("New client connected")

# HTTP ä»£ç†æœåŠ¡å™¨å¤„ç†ç±»
class ProxyHandler(http.server.SimpleHTTPRequestHandler):
    def do_GET(self):
        try:
            # è®¾ç½® User-Agentï¼Œé¿å…è¢«æŸäº›ç½‘ç«™æ‹’ç»
            req = urllib.request.Request(THIRD_PARTY_URL, headers={"User-Agent": "Mozilla/5.0"})
            with urllib.request.urlopen(req) as response:
                html_content = response.read().decode('utf-8')
                # åœ¨ </head> å‰æ³¨å…¥ QWebChannel.jsï¼Œåœ¨ </body> å‰æ³¨å…¥å®¢æˆ·ç«¯è„šæœ¬
                modified_html = html_content
                if "</head>" in modified_html.lower():
                    modified_html = modified_html.replace("</head>", f"<script>{QWEBCHANNEL_JS}</script></head>", 1)
                else:
                    modified_html += f"<script>{QWEBCHANNEL_JS}</script>"
                if "</body>" in modified_html.lower():
                    modified_html = modified_html.replace("</body>", CLIENT_SCRIPT + "</body>", 1)
                else:
                    modified_html += CLIENT_SCRIPT

                self.send_response(200)
                self.send_header("Content-type", "text/html")
                self.end_headers()
                self.wfile.write(modified_html.encode('utf-8'))
        except urllib.error.URLError as e:
            self.send_response(500)
            self.end_headers()
            self.wfile.write(f"Error loading {THIRD_PARTY_URL}: {str(e)}".encode('utf-8'))
        except Exception as e:
            self.send_response(500)
            self.end_headers()
            self.wfile.write(f"Unexpected error: {str(e)}".encode('utf-8'))

def start_http_server():
    PORT = 8000
    with socketserver.TCPServer(("", PORT), ProxyHandler) as httpd:
        print(f"HTTP proxy server started at http://localhost:{PORT}")
        httpd.serve_forever()

if __name__ == "__main__":
    app = QApplication(sys.argv)
    
    # å¯åŠ¨ WebSocket æœåŠ¡å™¨
    ws_server = WebSocketServer()
    
    # åœ¨å•ç‹¬çº¿ç¨‹ä¸­å¯åŠ¨ HTTP ä»£ç†æœåŠ¡å™¨
    http_thread = threading.Thread(target=start_http_server, daemon=True)
    http_thread.start()
    
    # è‡ªåŠ¨æ‰“å¼€æµè§ˆå™¨è®¿é—®ä»£ç†åœ°å€
    proxy_url = "http://localhost:8000"
    webbrowser.open(proxy_url)
    print(f"Opened proxy URL: {proxy_url}")
    print(f"Proxying third-party URL: {THIRD_PARTY_URL}")
    print("User can now log in. Token will be captured automatically.")
    
    sys.exit(app.exec())









import sys
import threading
import webbrowser
import http.server
import socketserver
import urllib.request
from PySide6.QtWidgets import QApplication
from PySide6.QtWebSockets import QWebSocketServer, QWebSocket
from PySide6.QtWebChannel import QWebChannel
from PySide6.QtCore import QObject, Slot
from PySide6.QtNetwork import QHostAddress

# ç¬¬ä¸‰æ–¹ Web URLï¼ˆæ›¿æ¢ä¸ºå®é™…çš„ç™»å½•é¡µé¢ URLï¼‰
THIRD_PARTY_URL = "https://thirdparty.com/login"  # ç¤ºä¾‹ URLï¼Œæ›¿æ¢ä¸ºå®é™…åœ°å€

# QWebChannel.js å†…å®¹ï¼ˆç®€åŒ–ç‰ˆï¼Œå®é™…ä½¿ç”¨æ—¶éœ€æ›¿æ¢ä¸ºå®Œæ•´æ–‡ä»¶ï¼‰
# æ³¨æ„ï¼šè¿™é‡Œä»…ä¸ºæ¼”ç¤ºï¼Œå®é™…è¿è¡Œéœ€ä» Qt æºç æˆ–å®‰è£…ç›®å½•è·å– qwebchannel.js
QWEBCHANNEL_JS = """
// Placeholder for QWebChannel.js - Replace with actual file content
function QWebChannel(transport, initCallback) {
    this.transport = transport;
    this.objects = {};
    transport.onmessage = function(event) {
        var data = JSON.parse(event.data);
        if (data.type === 0) {
            initCallback({objects: data.payload});
        } else if (data.type === 2) {
            var obj = this.objects[data.object];
            if (obj && obj[data.signal]) {
                obj[data.signal](data.args);
            }
        }
    };
    this.exec = function(data) {
        transport.send(JSON.stringify(data));
    };
}
"""

# æ³¨å…¥çš„å®¢æˆ·ç«¯è„šæœ¬
CLIENT_SCRIPT = """
<script type="text/javascript">
    window.onload = function() {
        var socket = new WebSocket("ws://localhost:12345");
        socket.onopen = function() {
            console.log("WebSocket connected");
            new QWebChannel(socket, function(channel) {
                console.log("QWebChannel initialized");
                var backend = channel.objects.backend;
                window.external = {
                    intoProgram: function(message) {
                        console.log("Calling intoProgram with:", message);
                        backend.intoProgram(message, function(result) {
                            console.log("Received from PySide6:", result);
                        });
                    }
                };
                // æ¨¡æ‹Ÿç™»å½•åå›è°ƒï¼ˆæ›¿æ¢ä¸ºå®é™…é€»è¾‘ï¼‰
                setTimeout(() => {
                    window.external.intoProgram("Token: abc123xyz");
                }, 5000);
            });
        };
        socket.onerror = function(error) {
            console.error("WebSocket error:", error);
        };
        socket.onclose = function() {
            console.log("WebSocket closed");
        };
    };
</script>
"""

class Backend(QObject):
    @Slot(str, result=str)
    def intoProgram(self, message):
        print(f"Received callback from Web: {message}")
        if "token" in message.lower():
            print(f"Detected token: {message}")
        return f"Python processed: {message}"

class WebSocketServer(QObject):
    def __init__(self):
        super().__init__()
        self.server = QWebSocketServer("MyServer", QWebSocketServer.NonSecureMode, self)
        self.server.newConnection.connect(self.on_new_connection)
        self.clients = []
        self.backend = Backend()
        self.channel = QWebChannel(self)
        self.channel.registerObject("backend", self.backend)

        if self.server.listen(QHostAddress.Any, 12345):
            print("WebSocket server listening on port 12345")
        else:
            print("Failed to start server")

    def on_new_connection(self):
        client = self.server.nextPendingConnection()
        client.setParent(self)
        self.channel.connectTo(client)
        client.disconnected.connect(lambda: self.clients.remove(client))
        self.clients.append(client)
        print("New client connected")

# HTTP ä»£ç†æœåŠ¡å™¨å¤„ç†ç±»
class ProxyHandler(http.server.SimpleHTTPRequestHandler):
    def do_GET(self):
        try:
            with urllib.request.urlopen(THIRD_PARTY_URL) as response:
                html_content = response.read().decode('utf-8')
                # åœ¨ </head> å‰æ³¨å…¥ QWebChannel.jsï¼Œåœ¨ </body> å‰æ³¨å…¥å®¢æˆ·ç«¯è„šæœ¬
                modified_html = html_content
                if "</head>" in modified_html.lower():
                    modified_html = modified_html.replace("</head>", f"<script>{QWEBCHANNEL_JS}</script></head>", 1)
                if "</body>" in modified_html.lower():
                    modified_html = modified_html.replace("</body>", CLIENT_SCRIPT + "</body>", 1)
                else:
                    modified_html += f"<script>{QWEBCHANNEL_JS}</script>" + CLIENT_SCRIPT

                self.send_response(200)
                self.send_header("Content-type", "text/html")
                self.end_headers()
                self.wfile.write(modified_html.encode('utf-8'))
        except Exception as e:
            self.send_response(500)
            self.end_headers()
            self.wfile.write(f"Error loading {THIRD_PARTY_URL}: {str(e)}".encode('utf-8'))

def start_http_server():
    PORT = 8000
    with socketserver.TCPServer(("", PORT), ProxyHandler) as httpd:
        print(f"HTTP proxy server started at http://localhost:{PORT}")
        httpd.serve_forever()

if __name__ == "__main__":
    app = QApplication(sys.argv)
    
    # å¯åŠ¨ WebSocket æœåŠ¡å™¨
    ws_server = WebSocketServer()
    
    # åœ¨å•ç‹¬çº¿ç¨‹ä¸­å¯åŠ¨ HTTP ä»£ç†æœåŠ¡å™¨
    http_thread = threading.Thread(target=start_http_server, daemon=True)
    http_thread.start()
    
    # è‡ªåŠ¨æ‰“å¼€æµè§ˆå™¨è®¿é—®ä»£ç†åœ°å€
    proxy_url = "http://localhost:8000"
    webbrowser.open(proxy_url)
    print(f"Opened proxy URL: {proxy_url}")
    print(f"Proxying third-party URL: {THIRD_PARTY_URL}")
    print("User can now log in. Token will be captured automatically via QWebChannel.")
    
    sys.exit(app.exec())










import sys
import time
from PySide6.QtWidgets import QApplication, QMainWindow, QComboBox, QVBoxLayout, QWidget, QLabel, QHBoxLayout, QTableWidget
from PySide6.QtCore import QThreadPool, QRunnable, QObject, Signal, Slot
from PySide6.QtGui import QFocusEvent

# ä¿¡å·ç±»
class Signals(QObject):
    data_fetched = Signal(dict)  # åˆå§‹æ•°æ®åŠ è½½å®Œæˆ

# æ•°æ®åŠ è½½ä»»åŠ¡
class DataTask(QRunnable):
    def __init__(self, signals):
        super().__init__()
        self.signals = signals

    def run(self):
        data = self.fetch_initial_data()
        self.signals.data_fetched.emit(data)

    def fetch_initial_data(self):
        time.sleep(2)  # æ¨¡æ‹Ÿå»¶è¿Ÿ
        # è¿”å›åˆå§‹å€¼ç¤ºä¾‹ï¼Œå®é™…åº”ä¸ºç©ºæˆ–é»˜è®¤å€¼
        return {
            "cpu": ["CPU1", "CPU2", "CPU3"],
            "memory": ["8GB", "16GB"],
            "storage": ["1TB", "2TB"]
        }

# è‡ªå®šä¹‰ä¸‹æ‹‰æ¡†ç»„ä»¶
class ComboBoxComponent(QComboBox):
    value_changed = Signal(str, tuple)  # å€¼æ”¹å˜ä¿¡å·

    def __init__(self, parent=None, index=(-1,), category=None, fetch_options=None, selected_value=None):
        super().__init__(parent)
        self.index = index  # å…ƒç»„ï¼Œå·¦ä¾§ä¸º (i,)ï¼Œè¡¨æ ¼ä¸º (row, col)
        self.category = category  # ç§ç±»ï¼šcpu/memory/storage
        self.fetch_options = fetch_options  # æŸ¥è¯¢å‡½æ•°
        self.selected_value = selected_value
        self.data_source = []  # å½“å‰é€‰é¡¹
        self.setEnabled(False)
        self.currentTextChanged.connect(self.on_text_changed)

    def focusInEvent(self, event: QFocusEvent):
        if not self.data_source:
            self.addItem("æ•°æ®æ­£åœ¨åŠ è½½ä¸­...")
        super().focusInEvent(event)

    def on_text_changed(self, text):
        if text and text != "æ•°æ®æ­£åœ¨åŠ è½½ä¸­...":
            self.selected_value = text
            self.value_changed.emit(text, self.index)

    def update_options(self, dependencies=None):
        if self.fetch_options:
            self.data_source = self.fetch_options(self.category, dependencies)
        self.blockSignals(True)
        self.clear()
        self.addItems(self.data_source)
        if self.selected_value in self.data_source:
            self.setCurrentText(self.selected_value)
        elif self.data_source:
            self.selected_value = self.data_source[0]  # é»˜è®¤é€‰ç¬¬ä¸€ä¸ª
        self.setEnabled(True)
        self.blockSignals(False)

# ä¸»çª—å£
class MainWindow(QMainWindow):
    def __init__(self):
        super().__init__()
        self.setWindowTitle("çº§è”ä¸‹æ‹‰æ¡†ç¤ºä¾‹")
        self.resize(800, 600)

        # ä¸»å¸ƒå±€
        main_widget = QWidget()
        main_layout = QHBoxLayout()

        # å·¦ä¾§ä¸‹æ‹‰æ¡†
        self.categories = ["cpu", "memory", "storage"]
        left_widget = QWidget()
        left_layout = QVBoxLayout()
        self.left_combos = []
        self.left_selected = [None] * 3
        for i, category in enumerate(self.categories):
            label = QLabel(f"é€‰æ‹© {category.capitalize()}")
            combo = ComboBoxComponent(index=(i,), category=category, fetch_options=self.fetch_options)
            combo.value_changed.connect(self.on_left_combo_changed)
            left_layout.addWidget(label)
            left_layout.addWidget(combo)
            self.left_combos.append(combo)
        left_layout.addStretch()
        left_widget.setLayout(left_layout)
        main_layout.addWidget(left_widget)

        # å³ä¾§è¡¨æ ¼
        self.table = QTableWidget(5, 3)
        self.table.setHorizontalHeaderLabels(["CPU", "Memory", "Storage"])
        main_layout.addWidget(self.table, stretch=2)

        main_widget.setLayout(main_layout)
        self.setCentralWidget(main_widget)

        # æ•°æ®å’Œçº¿ç¨‹
        self.table_data = {}
        self.signals = Signals()
        self.pool = QThreadPool.globalInstance()
        self.signals.data_fetched.connect(self.init_data)
        self.pool.start(DataTask(self.signals))

    @Slot(dict)
    def init_data(self, initial_data):
        self.initial_data = initial_data
        # åˆå§‹åŒ–å·¦ä¾§
        for i, combo in enumerate(self.left_combos):
            dependencies = {self.categories[j]: self.left_selected[j] for j in range(3) if j != i}
            combo.update_options(dependencies)
            if self.left_selected[i]:
                combo.setCurrentText(self.left_selected[i])
        # åˆå§‹åŒ–è¡¨æ ¼
        self.init_table()

    def init_table(self):
        for row in range(self.table.rowCount()):
            row_data = self.fetch_row_data(row)
            self.table_data[row] = row_data
            for col in range(self.table.columnCount()):
                combo = ComboBoxComponent(
                    index=(row, col),
                    category=self.categories[col],
                    fetch_options=self.fetch_options,
                    selected_value=row_data[col]
                )
                combo.value_changed.connect(self.on_table_combo_changed)
                self.table.setCellWidget(row, col, combo)
            self.update_table_row(row)

    def fetch_options(self, category, dependencies):
        # æ¨¡æ‹Ÿæ¥å£æŸ¥è¯¢ï¼ŒåŸºäºä¾èµ–å€¼è¿”å›é€‰é¡¹
        # dependencies æ˜¯å­—å…¸ï¼Œä¾‹å¦‚ {"cpu": "CPU1", "storage": "1TB"}
        base_options = {
            "cpu": ["CPU1", "CPU2", "CPU3", "CPU4"],
            "memory": ["8GB", "16GB", "32GB"],
            "storage": ["1TB", "2TB", "512GB"]
        }
        options = base_options.get(category, [])
        # ç¤ºä¾‹çº§è”é€»è¾‘ï¼šæ ¹æ®ä¾èµ–å€¼è¿‡æ»¤
        if category == "memory" and dependencies.get("cpu") == "CPU1":
            options = ["8GB", "16GB"]  # CPU1 åªæ”¯æŒéƒ¨åˆ†å†…å­˜
        elif category == "storage" and dependencies.get("memory") == "32GB":
            options = ["2TB", "512GB"]  # 32GB å†…å­˜åªæ”¯æŒéƒ¨åˆ†ç¡¬ç›˜
        return options

    def fetch_row_data(self, row):
        # æ¨¡æ‹Ÿæ¥å£è¿”å›æ¯è¡Œæ•°æ®ï¼Œéœ€ä¸å½“å‰é€‰ä¸­å€¼å’Œç§ç±»åŒ¹é…
        return [
            self.fetch_options("cpu", {"memory": self.table_data.get(row, [None]*3)[1], "storage": self.table_data.get(row, [None]*3)[2]})[row % 3],
            self.fetch_options("memory", {"cpu": self.table_data.get(row, [None]*3)[0], "storage": self.table_data.get(row, [None]*3)[2]})[row % 2],
            self.fetch_options("storage", {"cpu": self.table_data.get(row, [None]*3)[0], "memory": self.table_data.get(row, [None]*3)[1]})[row % 3]
        ]

    def on_left_combo_changed(self, text, index):
        i = index[0]
        self.left_selected[i] = text
        # æ›´æ–°å…¶ä»–å·¦ä¾§ä¸‹æ‹‰æ¡†
        for j, combo in enumerate(self.left_combos):
            if j != i:
                dependencies = {self.categories[k]: self.left_selected[k] for k in range(3) if k != j}
                combo.update_options(dependencies)
        self.update_table()

    def on_table_combo_changed(self, text, index):
        row, col = index
        self.table_data[row][col] = text
        # æ›´æ–°è¯¥è¡Œå…¶ä»–ä¸‹æ‹‰æ¡†
        new_row_data = self.fetch_row_data(row)  # æ¨¡æ‹Ÿæ¥å£è°ƒç”¨
        self.table_data[row] = new_row_data
        self.update_table_row(row)

    def update_table(self):
        for row in range(self.table.rowCount()):
            self.update_table_row(row)

    def update_table_row(self, row):
        for col in range(self.table.columnCount()):
            combo = self.table.cellWidget(row, col)
            dependencies = {self.categories[k]: self.table_data[row][k] for k in range(3) if k != col}
            combo.update_options(dependencies)

if __name__ == "__main__":
    app = QApplication(sys.argv)
    window = MainWindow()
    window.show()
    sys.exit(app.exec())








import sys
from PySide6.QtWidgets import QApplication, QMainWindow, QTableWidget, QTableWidgetItem, QComboBox, QVBoxLayout, QWidget
from PySide6.QtGui import QFont, QColor, QStandardItemModel, QStandardItem
from PySide6.QtCore import Qt, QEvent


class CustomComboBox(QComboBox):
    def __init__(self):
        super().__init__()
        self.setMouseTracking(True)  # å¯ç”¨é¼ æ ‡è·Ÿè¸ª
        self.setFixedWidth(150)  # å›ºå®šå®½åº¦

        # ä½¿ç”¨è‡ªå®šä¹‰æ¨¡å‹
        self.model = QStandardItemModel()
        self.setModel(self.model)

        # ä¸ºä¸‹æ‹‰åˆ—è¡¨è§†å›¾å¯ç”¨é¼ æ ‡è·Ÿè¸ªå¹¶å®‰è£…äº‹ä»¶è¿‡æ»¤å™¨
        self.view().setMouseTracking(True)
        self.view().installEventFilter(self)

    def eventFilter(self, obj, event):
        # å¤„ç†ä¸‹æ‹‰åˆ—è¡¨è§†å›¾çš„é¼ æ ‡ç§»åŠ¨äº‹ä»¶
        if obj == self.view() and event.type() == QEvent.MouseMove:
            index = self.view().indexAt(event.pos())
            if index.isValid():
                full_text = self.itemData(index.row(), Qt.UserRole)
                if full_text:
                    # ä¸ºè§†å›¾è®¾ç½®å·¥å…·æç¤º
                    self.view().setToolTip(full_text)
                    QApplication.processEvents()  # å¼ºåˆ¶åˆ·æ–°å·¥å…·æç¤º
            return True
        elif obj == self.view() and event.type() == QEvent.ToolTip:
            # å¤„ç†å·¥å…·æç¤ºäº‹ä»¶
            index = self.view().indexAt(event.pos())
            if index.isValid():
                full_text = self.itemData(index.row(), Qt.UserRole)
                if full_text:
                    self.view().setToolTip(full_text)
            return True
        return super().eventFilter(obj, event)

    def addCustomItem(self, full_text):
        item = QStandardItem(full_text)
        item.setData(full_text, Qt.UserRole)  # å­˜å‚¨å®Œæ•´æ–‡æœ¬
        item.setToolTip(full_text)  # ä¸ºæ¯ä¸ªé€‰é¡¹è®¾ç½®å·¥å…·æç¤º
        self.model.appendRow(item)


class MainWindow(QMainWindow):
    def __init__(self):
        super().__init__()
        self.setWindowTitle("PySide6 ç¤ºä¾‹")
        self.resize(600, 400)

        # åˆ›å»ºä¸­å¿ƒæ§ä»¶å’Œå¸ƒå±€
        central_widget = QWidget()
        layout = QVBoxLayout(central_widget)
        self.setCentralWidget(central_widget)

        # åˆ›å»ºè¡¨æ ¼
        self.table = QTableWidget(3, 3)
        self.table.setFont(QFont("Arial", 12))
        # self.table.horizontalHeader().setSectionResizeMode(QHeaderView.ResizeToContents)
        self.table.horizontalHeader().setDefaultAlignment(Qt.AlignCenter)
        self.table.setMouseTracking(True)

        # è®¾ç½®å•å…ƒæ ¼
        self.set_custom_cell(0, 0, "ç‰¹æ®Šå•å…ƒæ ¼", font_size=14, color="red")
        self.set_cell_with_tooltip(0, 1, "è¿™æ˜¯ä¸€ä¸ªå¾ˆé•¿çš„æ–‡æœ¬ï¼Œé¼ æ ‡æ‚¬åœåº”è¯¥æ˜¾ç¤ºå®Œæ•´å†…å®¹")

        # åˆ›å»ºè‡ªå®šä¹‰ä¸‹æ‹‰æ¡†
        self.combo = CustomComboBox()

        # æ·»åŠ é€‰é¡¹
        # self.combo.addCustomItem("çŸ­é€‰é¡¹", "çŸ­é€‰é¡¹å®Œæ•´å†…å®¹")
        self.combo.addCustomItem("è¿™æ˜¯ä¸€ä¸ªè¶…é•¿çš„ä¸‹æ‹‰æ¡†é€‰é¡¹ï¼Œé¼ æ ‡æ‚¬åœåº”è¯¥æ˜¾ç¤ºå®Œæ•´å†…å®¹")

        # åˆå§‹åŒ–å·¥å…·æç¤ºå¹¶è¿æ¥ä¿¡å·
        self.combo.currentIndexChanged.connect(self.update_combo_tooltip)
        self.update_combo_tooltip(0)

        # æ·»åŠ åˆ°å¸ƒå±€
        layout.addWidget(self.table)
        layout.addWidget(self.combo)

    def set_custom_cell(self, row, col, text, font_size=12, color="black"):
        item = QTableWidgetItem(text)
        item.setFont(QFont("Arial", font_size))
        item.setForeground(QColor(color))
        item.setTextAlignment(Qt.AlignCenter)
        self.table.setItem(row, col, item)

    def set_cell_with_tooltip(self, row, col, text):
        item = QTableWidgetItem(text)
        item.setToolTip(text)
        if len(text) > 20:
            item.setText(text[:17] + "...")
        else:
            item.setText(text)
        self.table.setItem(row, col, item)

    def update_combo_tooltip(self, index):
        full_text = self.combo.itemData(index, Qt.UserRole)
        if full_text:
            self.combo.setToolTip(full_text)


if __name__ == "__main__":
    app = QApplication(sys.argv)
    app.setStyleSheet("QToolTip { font-size: 12px; background-color: yellow; color: black; }")  # è°ƒæ•´å·¥å…·æç¤ºæ ·å¼
    window = MainWindow()
    window.show()
    sys.exit(app.exec())






åœ¨ PySide6 ä¸­ï¼Œ`QMouseEvent.pos()` æ–¹æ³•å·²è¢«å¼ƒç”¨ï¼ˆDeprecationï¼‰ï¼Œéœ€è¦æ”¹ç”¨ `position().toPoint()`ã€‚ä»¥ä¸‹æ˜¯ **ä¿®å¤å¼ƒç”¨è­¦å‘Š** å¹¶ä¿æŒåŠŸèƒ½å®Œæ•´çš„æ”¹è¿›æ–¹æ¡ˆï¼š

---

### æœ€ç»ˆä¼˜åŒ–ä»£ç ï¼ˆä¿®å¤è­¦å‘Š + å®Œæ•´åŠŸèƒ½ï¼‰
```python
import sys
from PySide6.QtWidgets import QApplication, QTableWidget, QTableWidgetItem, QMainWindow, QVBoxLayout, QWidget, QLabel
from PySide6.QtCore import Qt, QPoint

class HoverTable(QTableWidget):
    def __init__(self, rows, cols):
        super().__init__(rows, cols)
        self.setMouseTracking(True)  # å¯ç”¨é¼ æ ‡è·Ÿè¸ª

    def mouseMoveEvent(self, event):
        # ä½¿ç”¨ position().toPoint() æ›¿ä»£å·²å¼ƒç”¨çš„ pos()
        mouse_pos = event.position().toPoint()  # ğŸš€ ä¿®å¤è­¦å‘Šçš„å…³é”®ä¿®æ”¹
        index = self.indexAt(mouse_pos)
        if index.isValid():
            self.setCursor(Qt.PointingHandCursor)
        else:
            self.unsetCursor()
        super().mouseMoveEvent(event)

class MainWindow(QWidget):
    def __init__(self):
        super().__init__()
        self.initUI()
        self.resize(600, 400)

    def initUI(self):
        layout = QVBoxLayout()
        self.setLayout(layout)

        # æ™®é€šè¡¨æ ¼
        layout.addWidget(QLabel("æ™®é€šè¡¨æ ¼"))
        normal_table = QTableWidget(3, 2)
        self.fill_table(normal_table)
        layout.addWidget(normal_table)

        # å¸¦æ‰‹å‹å…‰æ ‡çš„è¡¨æ ¼
        layout.addWidget(QLabel("æ‚¬åœæ‰‹å‹å…‰æ ‡è¡¨æ ¼"))
        styled_table = HoverTable(3, 2)
        self.fill_table(styled_table)
        styled_table.setStyleSheet("QTableWidget::item { color: blue; }")
        layout.addWidget(styled_table)

    def fill_table(self, table):
        table.setHorizontalHeaderLabels(["åˆ—1", "åˆ—2"])
        for row in range(3):
            for col in range(2):
                item = QTableWidgetItem(f"è¡Œ{row+1}, åˆ—{col+1}")
                table.setItem(row, col, item)
        table.itemClicked.connect(lambda item: print(f"ç‚¹å‡»: {item.text()}"))

if __name__ == '__main__':
    app = QApplication(sys.argv)
    window = MainWindow()
    window.setWindowTitle("ä¿®å¤å¼ƒç”¨è­¦å‘Šæ¼”ç¤º")
    window.show()
    sys.exit(app.exec())
```

---

### å…³é”®ä¿®æ”¹è¯´æ˜

1. **å¼ƒç”¨æ–¹æ³•æ›¿æ¢**ï¼š
   ```python
   # æ—§ä»£ç ï¼ˆå·²å¼ƒç”¨ï¼‰
   index = self.indexAt(event.pos())  

   # æ–°ä»£ç ï¼ˆæ¨èå†™æ³•ï¼‰
   mouse_pos = event.position().toPoint()  
   index = self.indexAt(mouse_pos)
   ```
   - `position()` è¿”å›æµ®ç‚¹åæ ‡ï¼ˆQPointFï¼‰ï¼Œ`toPoint()` å°†å…¶è½¬æ¢ä¸ºæ•´æ•°åæ ‡ï¼ˆQPointï¼‰
   - ä¿æŒä¸ `QTableWidget.indexAt(QPoint)` çš„å‚æ•°å…¼å®¹æ€§

2. **å…¼å®¹æ€§ä¿éšœ**ï¼š
   - PySide6 6.4+ ç‰ˆæœ¬å¿…é¡»ä½¿ç”¨æ­¤å†™æ³•
   - æ—§ç‰ˆ PySide6 (6.0-6.3) ä»å…¼å®¹ `pos()`ï¼Œä½†å»ºè®®ç»Ÿä¸€å‡çº§å†™æ³•

---

### æ•ˆæœéªŒè¯

1. **è¿è¡Œä»£ç **ï¼Œè§‚å¯Ÿæ§åˆ¶å°ï¼š
   - ä¸å†å‡ºç° `DeprecationWarning` è­¦å‘Š
2. **åŠŸèƒ½æµ‹è¯•**ï¼š
   - æ™®é€šè¡¨æ ¼ï¼šæ— æ‰‹å‹å…‰æ ‡ï¼Œæ–‡å­—é»‘è‰²
   - ç‰¹æ•ˆè¡¨æ ¼ï¼šæ‚¬åœæ˜¾ç¤ºæ‰‹å‹å…‰æ ‡ï¼Œæ–‡å­—è“è‰²
   - ç‚¹å‡»ä»»æ„å•å…ƒæ ¼æ­£å¸¸æ‰“å°æ—¥å¿—

---

### æŠ€æœ¯èƒŒæ™¯

| æ–¹æ³•                | è¿”å›å€¼ç±»å‹   | è¯´æ˜                          |
|---------------------|-------------|------------------------------|
| `event.pos()`        | `QPoint`     | å·²å¼ƒç”¨ï¼Œè¿”å›æ•´æ•°åæ ‡          |
| `event.position()`   | `QPointF`    | æ¨èæ–¹æ³•ï¼Œè¿”å›æµ®ç‚¹åæ ‡        |
| `event.pos().toPointF()` | `QPointF` | æ—§ä»£ç çš„ç­‰ä»·è½¬æ¢æ–¹å¼           |

é€šè¿‡ä½¿ç”¨æ–°APIï¼Œå¯ä»¥æ›´å¥½åœ°æ”¯æŒé«˜DPIå±å¹•çš„åæ ‡ç²¾åº¦ï¼ŒåŒæ—¶ä¿æŒå‘åå…¼å®¹æ€§ã€‚


import sys
from PySide6.QtWidgets import (
    QApplication, QMainWindow, QWidget, QVBoxLayout, QHBoxLayout,
    QPushButton, QTableWidget, QTableWidgetItem, QGroupBox,
    QComboBox, QStackedWidget, QStyledItemDelegate,
    QHeaderView, QLabel, QStyleOptionViewItem, QStyle
)
from PySide6.QtCore import Qt, QUrl, QSize, QEvent
from PySide6.QtGui import QIcon, QColor, QPalette, QDesktopServices, QCursor


class LinkDelegate(QStyledItemDelegate):
    def __init__(self, parent=None):
        super().__init__(parent)

    def paint(self, painter, option, index):
        if index.row() == 4:
            # è®¾ç½®é“¾æ¥æ ·å¼
            option.font.setUnderline(True)
            option.palette.setColor(QPalette.Text, QColor("#1890ff"))
            option.displayAlignment = Qt.AlignCenter

            # æ·»åŠ é¼ æ ‡æ‚¬åœæ•ˆæœï¼Œä¸ä¾§è¾¹æ ä¸€è‡´
            if option.state & QStyle.State_MouseOver:
                painter.fillRect(option.rect, QColor("#e3f2fd"))
                QApplication.setOverrideCursor(Qt.PointingHandCursor)
            else:
                QApplication.restoreOverrideCursor()

            super().paint(painter, option, index)
        else:
            super().paint(painter, option, index)
            QApplication.restoreOverrideCursor()

    def editorEvent(self, event, model, option, index):
        if event.type() == QEvent.MouseButtonRelease and index.row() == 4:
            main_window = self.parent().window()
            if main_window:
                main_window.open_link(index)
            return True
        return super().editorEvent(event, model, option, index)


class MainWindow(QMainWindow):
    def __init__(self):
        super().__init__()
        self.setWindowTitle("ç³»ç»Ÿä¿¡æ¯ç›‘æ§å¹³å°")
        self.setGeometry(100, 100, 1280, 720)

        main_widget = QWidget()
        self.setCentralWidget(main_widget)
        main_layout = QHBoxLayout(main_widget)
        main_layout.setContentsMargins(10, 10, 10, 10)
        main_layout.setSpacing(15)

        self.nav_bar = self.create_nav_bar()
        main_layout.addWidget(self.nav_bar, stretch=1)

        self.form_stack = QStackedWidget()
        main_layout.addWidget(self.form_stack, stretch=2)

        self.data_table = self.create_data_table()
        main_layout.addWidget(self.data_table, stretch=5)

        self.init_cpu_page()
        self.init_perf_page()
        self.switch_page(0)

    def create_nav_bar(self):
        nav_group = QGroupBox("åŠŸèƒ½å¯¼èˆª")
        nav_layout = QVBoxLayout(nav_group)
        nav_layout.setContentsMargins(5, 20, 5, 20)

        nav_style = """
            QPushButton {
                height: 50px; 
                font-size: 14px;
                text-align: left;
                padding: 12px 20px;
                border-radius: 5px;
                border: none;
                cursor: pointer;
            }
            QPushButton:hover {
                background-color: #e3f2fd;
            }
            QPushButton:pressed {
                background-color: #bbdefb;
            }
        """
        nav_group.setStyleSheet(nav_style)

        self.btn_cpu = QPushButton(" CPUè§„æ ¼")
        self.btn_perf = QPushButton(" æ€§èƒ½æ•°æ®")
        self.btn_cpu.setIcon(QIcon("cpu_icon.png"))
        self.btn_perf.setIcon(QIcon("chart_icon.png"))
        self.btn_cpu.setIconSize(QSize(24, 24))
        self.btn_perf.setIconSize(QSize(24, 24))
        self.btn_cpu.setCursor(Qt.PointingHandCursor)
        self.btn_perf.setCursor(Qt.PointingHandCursor)

        nav_layout.addStretch(1)
        nav_layout.addWidget(self.btn_cpu)
        nav_layout.addWidget(self.btn_perf)
        nav_layout.addStretch(1)

        self.btn_cpu.clicked.connect(lambda: self.switch_page(0))
        self.btn_perf.clicked.connect(lambda: self.switch_page(1))

        return nav_group

    def init_cpu_page(self):
        page = QWidget()
        layout = QVBoxLayout(page)

        self.cpu_fields = {
            "manufacturer": QComboBox(),
            "model": QComboBox(),
            "cores": QComboBox(),
            "base_clock": QComboBox(),
            "l3_cache": QComboBox(),
            "architecture": QComboBox()
        }

        self.cpu_fields["manufacturer"].addItems(["è‡ªåŠ¨æ£€æµ‹", "Intel", "AMD", "Apple Silicon"])
        self.cpu_fields["manufacturer"].currentTextChanged.connect(self.update_models)

        self.cpu_fields["cores"].addItems(["è‡ªåŠ¨æ£€æµ‹", "4", "6", "8", "12"])
        self.cpu_fields["base_clock"].addItems(["è‡ªåŠ¨æ£€æµ‹", "2.4GHz", "3.0GHz", "3.6GHz"])
        self.cpu_fields["l3_cache"].addItems(["è‡ªåŠ¨æ£€æµ‹", "8MB", "12MB", "16MB"])
        self.cpu_fields["architecture"].addItems(["è‡ªåŠ¨æ£€æµ‹", "x86", "ARM"])

        for field in self.cpu_fields.values():
            field.currentIndexChanged.connect(self.update_cpu_table)

        for label, field in [
            ("åˆ¶é€ å•†:", self.cpu_fields["manufacturer"]),
            ("å‹å·:", self.cpu_fields["model"]),
            ("æ ¸å¿ƒæ•°:", self.cpu_fields["cores"]),
            ("åŸºé¢‘:", self.cpu_fields["base_clock"]),
            ("ä¸‰çº§ç¼“å­˜:", self.cpu_fields["l3_cache"]),
            ("æ¶æ„:", self.cpu_fields["architecture"])
        ]:
            group = QWidget()
            group_layout = QVBoxLayout(group)
            group_layout.addWidget(QLabel(label))
            group_layout.addWidget(field)
            layout.addWidget(group)

        layout.addStretch()
        self.form_stack.addWidget(page)

    def init_perf_page(self):
        page = QWidget()
        layout = QVBoxLayout(page)

        self.perf_fields = {
            "time_range": QComboBox(),
            "metric_type": QComboBox(),
            "aggregation": QComboBox()
        }

        self.perf_fields["time_range"].addItems(["æœ€è¿‘15åˆ†é’Ÿ", "æœ€è¿‘1å°æ—¶", "æœ€è¿‘24å°æ—¶"])
        self.perf_fields["metric_type"].addItems(["CPUä½¿ç”¨ç‡", "å†…å­˜ä½¿ç”¨", "ç£ç›˜IO"])
        self.perf_fields["aggregation"].addItems(["å¹³å‡å€¼", "æœ€å¤§å€¼", "æœ€å°å€¼"])

        for label, field in [
            ("æ—¶é—´èŒƒå›´:", self.perf_fields["time_range"]),
            ("æŒ‡æ ‡ç±»å‹:", self.perf_fields["metric_type"]),
            ("èšåˆæ–¹å¼:", self.perf_fields["aggregation"])
        ]:
            group = QWidget()
            group_layout = QVBoxLayout(group)
            group_layout.addWidget(QLabel(label))
            group_layout.addWidget(field)
            layout.addWidget(group)

        btn_layout = QHBoxLayout()
        btn_query = QPushButton("æŸ¥è¯¢æ•°æ®")
        btn_clear = QPushButton("é‡ç½®æ¡ä»¶")
        btn_query.clicked.connect(self.update_perf_table)
        btn_clear.clicked.connect(self.clear_perf_filters)

        btn_layout.addWidget(btn_clear)
        btn_layout.addWidget(btn_query)

        layout.addLayout(btn_layout)
        layout.addStretch()
        self.form_stack.addWidget(page)

    def create_data_table(self):
        group = QGroupBox("æ•°æ®å±•ç¤º")
        layout = QVBoxLayout(group)

        self.table = QTableWidget()
        self.table.setColumnCount(7)
        self.table.setRowCount(6)  # CPUé¡µé¢æœ‰6ä¸ªå‚æ•°
        headers = ["å‚æ•°"] + [f"CPU {i + 1}" for i in range(6)]
        self.table.setHorizontalHeaderLabels(headers)
        self.table.horizontalHeader().setSectionResizeMode(QHeaderView.Stretch)
        self.table.verticalHeader().setSectionResizeMode(QHeaderView.Fixed)
        self.table.verticalHeader().setDefaultSectionSize(40)

        self.table.setMinimumWidth(600)
        for i in range(7):
            self.table.setColumnWidth(i, 120)

        self.table.setStyleSheet("""
            QTableWidget {
                font-size: 12px;
                gridline-color: #e0e0e0;
            }
            QHeaderView::section {
                background-color: #f5f5f5;
                padding: 8px;
                border: 1px solid #dcdcdc;
            }
            QTableCornerButton::section {
                background-color: #f5f5f5;
                border: 1px solid #dcdcdc;
            }
        """)

        self.add_table_filters()
        self.table.setItemDelegate(LinkDelegate(self.table))

        layout.addWidget(self.table)
        return group

    def add_table_filters(self):
        # CPUé¡µé¢æœ‰6è¡Œï¼Œæ€§èƒ½é¡µé¢æœ‰5è¡Œï¼Œè¿™é‡Œåªè®¾ç½®å¿…è¦çš„è¡Œ
        pass

    def update_models(self):
        manufacturer = self.cpu_fields["manufacturer"].currentText()
        models = []
        if manufacturer == "Intel":
            models = ["i5-12400", "i7-12700K", "i9-12900KS"]
        elif manufacturer == "AMD":
            models = ["Ryzen 5 5600X", "Ryzen 7 5800X3D", "Ryzen 9 5950X"]
        elif manufacturer == "Apple Silicon":
            models = ["M1 Pro", "M1 Max", "M1 Ultra"]

        self.cpu_fields["model"].clear()
        self.cpu_fields["model"].addItems(["è‡ªåŠ¨æ£€æµ‹"] + models)

    def update_cpu_table(self):
        # è®¾ç½®è¡¨æ ¼è¡Œæ•°ä¸º6ï¼Œä¸CPUå‚æ•°ä¸€è‡´
        self.table.setRowCount(6)
        self.table.setVerticalHeaderLabels(["åˆ¶é€ å•†", "å‹å·", "æ ¸å¿ƒæ•°", "åŸºé¢‘", "ä¸‰çº§ç¼“å­˜", "æ¶æ„"])

        # è·å–è¡¨å•é€‰æ‹©çš„å€¼
        manu = self.cpu_fields["manufacturer"].currentText()
        model = self.cpu_fields["model"].currentText()
        cores = self.cpu_fields["cores"].currentText()
        clock = self.cpu_fields["base_clock"].currentText()
        cache = self.cpu_fields["l3_cache"].currentText()
        arch = self.cpu_fields["architecture"].currentText()

        # ä¸ºæ¯ä¸ªCPUå¡«å……æ•°æ®
        for col in range(1, 7):
            manu_value = manu if manu != "è‡ªåŠ¨æ£€æµ‹" else f"Intel-{col}"
            model_value = model if model != "è‡ªåŠ¨æ£€æµ‹" else f"i5-1240{col}"
            cores_value = cores if cores != "è‡ªåŠ¨æ£€æµ‹" else str(4 + col)
            clock_value = clock if clock != "è‡ªåŠ¨æ£€æµ‹" else f"{2.4 + col * 0.2:.1f}GHz"
            cache_value = cache if cache != "è‡ªåŠ¨æ£€æµ‹" else f"{8 + col * 2}MB"
            arch_value = arch if arch != "è‡ªåŠ¨æ£€æµ‹" else "x86"

            self.table.setItem(0, col, QTableWidgetItem(manu_value))
            self.table.setItem(1, col, QTableWidgetItem(model_value))
            self.table.setItem(2, col, QTableWidgetItem(cores_value))
            self.table.setItem(3, col, QTableWidgetItem(clock_value))
            self.table.setItem(4, col, QTableWidgetItem(cache_value))
            self.table.setItem(5, col, QTableWidgetItem(arch_value))

            # æ·»åŠ é“¾æ¥åˆ°æœ€åä¸€åˆ—ï¼ˆä½†è¿™é‡Œæ¯ä¸€åˆ—éƒ½æœ‰è‡ªå·±çš„æ•°æ®ï¼Œæ‰€ä»¥ä¸éœ€è¦é¢å¤–è¡Œï¼‰
        for col in range(1, 7):
            link_item = QTableWidgetItem("æŸ¥çœ‹è¯¦æƒ…")
            link_item.setData(Qt.UserRole, f"https://example.com/cpu/{col}")
            link_item.setTextAlignment(Qt.AlignCenter)
            self.table.setItem(5, col, link_item)  # å°†é“¾æ¥æ”¾åœ¨â€œæ¶æ„â€è¡Œ

    def update_perf_table(self):
        # è®¾ç½®è¡¨æ ¼è¡Œæ•°ä¸º5ï¼ŒåŒ…å«é“¾æ¥è¡Œ
        self.table.setRowCount(5)
        self.table.setVerticalHeaderLabels(["æ—¶é—´èŒƒå›´", "æŒ‡æ ‡ç±»å‹", "èšåˆæ–¹å¼", "ä½¿ç”¨ç‡", "è¯¦æƒ…é“¾æ¥"])

        # è·å–è¡¨å•é€‰æ‹©çš„å€¼
        time_range = self.perf_fields["time_range"].currentText()
        metric = self.perf_fields["metric_type"].currentText()
        agg = self.perf_fields["aggregation"].currentText()

        for col in range(1, 7):
            # è®¡ç®—ä½¿ç”¨ç‡åŸºäºèšåˆæ–¹å¼å’ŒæŒ‡æ ‡ç±»å‹
            base_usage = 50 + col * 5
            if metric == "CPUä½¿ç”¨ç‡":
                adjustment = 10
            elif metric == "å†…å­˜ä½¿ç”¨":
                adjustment = 5
            else:  # ç£ç›˜IO
                adjustment = 15

            if agg == "æœ€å¤§å€¼":
                usage = base_usage + adjustment
            elif agg == "æœ€å°å€¼":
                usage = base_usage - adjustment
            else:  # å¹³å‡å€¼
                usage = base_usage

            self.table.setItem(0, col, QTableWidgetItem(time_range))
            self.table.setItem(1, col, QTableWidgetItem(metric))
            self.table.setItem(2, col, QTableWidgetItem(agg))
            self.table.setItem(3, col, QTableWidgetItem(f"{usage}%"))

            link_item = QTableWidgetItem("æŸ¥çœ‹è¯¦æƒ…")
            link_item.setData(Qt.UserRole, f"https://example.com/perf/{col}")
            link_item.setTextAlignment(Qt.AlignCenter)
            self.table.setItem(4, col, link_item)

    def filter_table(self, row, filter_text):
        for col in range(1, 7):
            item = self.table.item(row, col)
            hide = filter_text != "å…¨éƒ¨" and filter_text != (item.text() if item else "")
            self.table.setColumnHidden(col, hide)

    def switch_page(self, index):
        self.form_stack.setCurrentIndex(index)
        if index == 0:
            self.update_cpu_table()
            self.btn_cpu.setStyleSheet("background-color: #ddeeff;")
            self.btn_perf.setStyleSheet("")
        else:
            self.update_perf_table()
            self.btn_perf.setStyleSheet("background-color: #ddeeff;")
            self.btn_cpu.setStyleSheet("")

    def clear_perf_filters(self):
        for combo in self.perf_fields.values():
            combo.setCurrentIndex(0)
        self.update_perf_table()

    def open_link(self, index):
        if index.row() == (5 if self.form_stack.currentIndex() == 0 else 4):
            url = index.data(Qt.UserRole)
            QDesktopServices.openUrl(QUrl(url))


if __name__ == "__main__":
    app = QApplication(sys.argv)

    app.setStyleSheet("""
        QGroupBox {
            border: 1px solid #dcdcdc;
            border-radius: 6px;
            margin-top: 12px;
            padding-top: 15px;
            font-size: 13px;
        }
        QGroupBox::title {
            subcontrol-origin: margin;
            left: 12px;
            padding: 0 5px;
            color: #666;
        }
        QComboBox {
            padding: 3px;
            border: 1px solid #ccc;
            border-radius: 4px;
            min-width: 100px;
        }
    """)

    window = MainWindow()
    window.show()
    sys.exit(app.exec())






import sys
from PySide6.QtWidgets import QApplication, QMainWindow, QWidget, QVBoxLayout, QHBoxLayout, QPushButton, QLabel
from PySide6.QtCore import Qt, QPoint, QRect

class CustomWindow(QMainWindow):
    def __init__(self):
        super().__init__()
        self.setWindowFlags(Qt.FramelessWindowHint)
        self.setAttribute(Qt.WA_TranslucentBackground)

        # ä¸»å®¹å™¨
        self.main_widget = QWidget()
        self.setCentralWidget(self.main_widget)
        self.layout = QVBoxLayout(self.main_widget)
        self.layout.setContentsMargins(1, 1, 1, 1)
        self.layout.setSpacing(0)

        # æ ‡é¢˜æ 
        self.title_bar = QWidget()
        self.title_bar.setFixedHeight(30)
        self.layout.addWidget(self.title_bar)
        title_layout = QHBoxLayout(self.title_bar)
        title_layout.setContentsMargins(0, 0, 0, 0)
        title_layout.setSpacing(0)

        # æ ‡é¢˜
        self.title_label = QLabel("Custom Window")
        self.title_label.setStyleSheet("color: white; padding-left: 5px;")
        title_layout.addWidget(self.title_label)
        title_layout.addStretch()

        # æ§åˆ¶æŒ‰é’®
        self.min_btn = QPushButton("?")
        self.max_btn = QPushButton("?")
        self.close_btn = QPushButton("?")

        btn_style = """
            QPushButton {
                border: none;
                background: transparent;
                color: white;
                min-width: 30px;
                max-width: 30px;
            }
            QPushButton:hover {
                background: rgba(255, 255, 255, 20);
            }
        """
        self.min_btn.setStyleSheet(btn_style)
        self.max_btn.setStyleSheet(btn_style)
        self.close_btn.setStyleSheet("""
            QPushButton {
                border: none;
                background: transparent;
                color: white;
                min-width: 30px;
                max-width: 30px;
            }
            QPushButton:hover {
                background: #ff4444;
            }
        """)

        self.min_btn.clicked.connect(self.showMinimized)
        self.max_btn.clicked.connect(self.toggle_maximize)
        self.close_btn.clicked.connect(self.close)

        title_layout.addWidget(self.min_btn)
        title_layout.addWidget(self.max_btn)
        title_layout.addWidget(self.close_btn)

        # å†…å®¹åŒºåŸŸ
        self.content = QWidget()
        self.content.setStyleSheet("""
            background-color: #ffffff;
            border-bottom-left-radius: 5px;
            border-bottom-right-radius: 5px;
        """)
        self.layout.addWidget(self.content)

        # æ ·å¼
        self.main_widget.setStyleSheet("background-color: #aaaaaa; border-radius: 5px;")
        self.title_bar.setStyleSheet("background-color: #2d2d2d;")

        # åˆå§‹åŒ–å‚æ•°
        self.resize(800, 600)
        self.drag_pos = QPoint()
        self.pressing = False
        self.resizing = False
        self.resize_direction = 0
        self.minimum_size = self.minimumSize() or QSize(200, 150)  # è®¾ç½®æœ€å°å°ºå¯¸

        # å®šä¹‰æ‹‰ä¼¸æ–¹å‘å¸¸é‡
        self.LEFT = 1
        self.RIGHT = 2
        self.TOP = 4
        self.BOTTOM = 8

    def toggle_maximize(self):
        if self.isMaximized():
            self.showNormal()
            self.max_btn.setText("?")
        else:
            self.showMaximized()
            self.max_btn.setText("?")

    def get_resize_direction(self, pos):
        """æ”¹è¿›è¾¹ç¼˜æ£€æµ‹çµæ•åº¦"""
        margin = 8  # å¢åŠ è¾¹ç¼˜æ£€æµ‹èŒƒå›´
        direction = 0
        
        if pos.x() <= margin:
            direction |= self.LEFT
        elif pos.x() >= self.width() - margin:
            direction |= self.RIGHT
            
        if pos.y() <= margin:
            direction |= self.TOP
        elif pos.y() >= self.height() - margin:
            direction |= self.BOTTOM
            
        return direction

    def update_cursor(self, pos):
        """ä¼˜åŒ–å…‰æ ‡æ˜¾ç¤º"""
        if self.isMaximized():
            self.setCursor(Qt.ArrowCursor)
            return
            
        direction = self.get_resize_direction(pos)
        
        if direction == (self.LEFT | self.TOP) or direction == (self.RIGHT | self.BOTTOM):
            self.setCursor(Qt.SizeFDiagCursor)
        elif direction == (self.RIGHT | self.TOP) or direction == (self.LEFT | self.BOTTOM):
            self.setCursor(Qt.SizeBDiagCursor)
        elif direction & self.LEFT or direction & self.RIGHT:
            self.setCursor(Qt.SizeHorCursor)
        elif direction & self.TOP or direction & self.BOTTOM:
            self.setCursor(Qt.SizeVerCursor)
        else:
            self.setCursor(Qt.ArrowCursor)

    def mousePressEvent(self, event):
        if event.button() != Qt.LeftButton or self.isMaximized():
            return

        pos = event.position().toPoint()
        self.drag_pos = event.globalPosition().toPoint()

        # æ ‡é¢˜æ æ‹–åŠ¨
        if pos.y() <= self.title_bar.height():
            self.pressing = True
            return

        # è¾¹ç¼˜æ‹‰ä¼¸
        self.resize_direction = self.get_resize_direction(pos)
        if self.resize_direction:
            self.resizing = True

    def mouseMoveEvent(self, event):
        pos = event.position().toPoint()
        global_pos = event.globalPosition().toPoint()

        # æœªæŒ‰ä¸‹æ—¶åªæ›´æ–°å…‰æ ‡
        if not (self.pressing or self.resizing):
            self.update_cursor(pos)
            return

        if self.pressing and not self.isMaximized():
            delta = global_pos - self.drag_pos
            self.move(self.pos() + delta)
            self.drag_pos = global_pos
            return

        if self.resizing and not self.isMaximized():
            delta = global_pos - self.drag_pos
            new_rect = QRect(self.geometry())
            min_size = self.minimum_size

            # å¤„ç†å„ä¸ªæ–¹å‘çš„æ‹‰ä¼¸
            if self.resize_direction & self.LEFT:
                new_width = max(min_size.width(), new_rect.width() - delta.x())
                new_rect.setLeft(new_rect.right() - new_width)
            if self.resize_direction & self.RIGHT:
                new_width = max(min_size.width(), new_rect.width() + delta.x())
                new_rect.setWidth(new_width)
            if self.resize_direction & self.TOP:
                new_height = max(min_size.height(), new_rect.height() - delta.y())
                new_rect.setTop(new_rect.bottom() - new_height)
            if self.resize_direction & self.BOTTOM:
                new_height = max(min_size.height(), new_rect.height() + delta.y())
                new_rect.setHeight(new_height)

            # åº”ç”¨æ–°çš„å‡ ä½•å½¢çŠ¶å¹¶é™åˆ¶æœ€å°å°ºå¯¸
            self.setGeometry(new_rect)
            self.drag_pos = global_pos

    def mouseReleaseEvent(self, event):
        self.pressing = False
        self.resizing = False
        self.resize_direction = 0
        self.update_cursor(event.position().toPoint())

    def mouseDoubleClickEvent(self, event):
        if event.button() == Qt.LeftButton and event.position().toPoint().y() <= self.title_bar.height():
            self.toggle_maximize()

if __name__ == '__main__':
    app = QApplication(sys.argv)
    window = CustomWindow()
    window.show()
    sys.exit(app.exec())










import sys
from PySide6.QtWidgets import QApplication, QMainWindow, QWidget, QVBoxLayout, QHBoxLayout, QPushButton, QLabel
from PySide6.QtCore import Qt, QPoint, QRect

class CustomWindow(QMainWindow):
    def __init__(self):
        super().__init__()
        self.setWindowFlags(Qt.FramelessWindowHint)
        self.setAttribute(Qt.WA_TranslucentBackground)

        # ä¸»å®¹å™¨
        self.main_widget = QWidget()
        self.setCentralWidget(self.main_widget)
        self.layout = QVBoxLayout(self.main_widget)
        self.layout.setContentsMargins(1, 1, 1, 1)
        self.layout.setSpacing(0)

        # æ ‡é¢˜æ 
        self.title_bar = QWidget()
        self.title_bar.setFixedHeight(30)
        self.layout.addWidget(self.title_bar)
        title_layout = QHBoxLayout(self.title_bar)
        title_layout.setContentsMargins(0, 0, 0, 0)
        title_layout.setSpacing(0)

        # æ ‡é¢˜
        self.title_label = QLabel("Custom Window")
        self.title_label.setStyleSheet("color: white; padding-left: 5px;")
        title_layout.addWidget(self.title_label)
        title_layout.addStretch()

        # æ§åˆ¶æŒ‰é’®
        self.min_btn = QPushButton("?")
        self.max_btn = QPushButton("?")
        self.close_btn = QPushButton("?")

        btn_style = """
            QPushButton {
                border: none;
                background: transparent;
                color: white;
                min-width: 30px;
                max-width: 30px;
            }
            QPushButton:hover {
                background: rgba(255, 255, 255, 20);
            }
        """
        self.min_btn.setStyleSheet(btn_style)
        self.max_btn.setStyleSheet(btn_style)
        self.close_btn.setStyleSheet("""
            QPushButton {
                border: none;
                background: transparent;
                color: white;
                min-width: 30px;
                max-width: 30px;
            }
            QPushButton:hover {
                background: #ff4444;
            }
        """)

        self.min_btn.clicked.connect(self.showMinimized)
        self.max_btn.clicked.connect(self.toggle_maximize)
        self.close_btn.clicked.connect(self.close)

        title_layout.addWidget(self.min_btn)
        title_layout.addWidget(self.max_btn)
        title_layout.addWidget(self.close_btn)

        # å†…å®¹åŒºåŸŸ
        self.content = QWidget()
        self.content.setStyleSheet("""
            background-color: #ffffff;
            border-bottom-left-radius: 5px;
            border-bottom-right-radius: 5px;
        """)
        self.layout.addWidget(self.content)

        # æ ·å¼
        self.main_widget.setStyleSheet("background-color: #aaaaaa; border-radius: 5px;")
        self.title_bar.setStyleSheet("background-color: #2d2d2d;")

        # åˆå§‹åŒ–å‚æ•°
        self.resize(800, 600)
        self.old_pos = QPoint()
        self.pressing = False
        self.resizing = False
        self.resize_direction = 0  # ä½¿ç”¨ä½æ ‡å¿—è¡¨ç¤ºæ‹‰ä¼¸æ–¹å‘

        # å®šä¹‰æ‹‰ä¼¸æ–¹å‘å¸¸é‡
        self.LEFT = 1
        self.RIGHT = 2
        self.TOP = 4
        self.BOTTOM = 8

    def toggle_maximize(self):
        if self.isMaximized():
            self.showNormal()
            self.max_btn.setText("?")
        else:
            self.showMaximized()
            self.max_btn.setText("?")

    def get_resize_direction(self, pos):
        """æ£€æµ‹é¼ æ ‡ä½ç½®ï¼Œè¿”å›æ‹‰ä¼¸æ–¹å‘"""
        margin = 5
        direction = 0
        
        if pos.x() < margin:
            direction |= self.LEFT
        elif pos.x() > self.width() - margin:
            direction |= self.RIGHT
            
        if pos.y() < margin:
            direction |= self.TOP
        elif pos.y() > self.height() - margin:
            direction |= self.BOTTOM
            
        return direction

    def update_cursor(self, pos):
        """æ ¹æ®ä½ç½®æ›´æ–°é¼ æ ‡å…‰æ ‡"""
        direction = self.get_resize_direction(pos)
        
        if direction == (self.LEFT | self.TOP) or direction == (self.RIGHT | self.BOTTOM):
            self.setCursor(Qt.SizeFDiagCursor)
        elif direction == (self.RIGHT | self.TOP) or direction == (self.LEFT | self.BOTTOM):
            self.setCursor(Qt.SizeBDiagCursor)
        elif direction & (self.LEFT | self.RIGHT):
            self.setCursor(Qt.SizeHorCursor)
        elif direction & (self.TOP | self.BOTTOM):
            self.setCursor(Qt.SizeVerCursor)
        else:
            self.setCursor(Qt.ArrowCursor)

    def mousePressEvent(self, event):
        if event.button() != Qt.LeftButton:
            return

        pos = event.position().toPoint()
        
        # æ ‡é¢˜æ æ‹–åŠ¨
        if pos.y() < self.title_bar.height() and not self.resizing:
            self.pressing = True
            self.old_pos = event.globalPosition().toPoint()
            return

        # è¾¹ç¼˜æ‹‰ä¼¸
        self.resize_direction = self.get_resize_direction(pos)
        if self.resize_direction and not self.isMaximized():
            self.resizing = True
            self.old_pos = event.globalPosition().toPoint()

    def mouseMoveEvent(self, event):
        pos = event.position().toPoint()
        global_pos = event.globalPosition().toPoint()

        # æ›´æ–°å…‰æ ‡
        if not self.resizing and not self.pressing:
            self.update_cursor(pos)
            return

        if self.pressing and not self.isMaximized():
            delta = global_pos - self.old_pos
            self.move(self.pos() + delta)
            self.old_pos = global_pos
            return

        if self.resizing and not self.isMaximized():
            delta = global_pos - self.old_pos
            geo = QRect(self.geometry())

            if self.resize_direction & self.LEFT:
                geo.setLeft(geo.left() + delta.x())
            if self.resize_direction & self.RIGHT:
                geo.setRight(geo.right() + delta.x())
            if self.resize_direction & self.TOP:
                geo.setTop(geo.top() + delta.y())
            if self.resize_direction & self.BOTTOM:
                geo.setBottom(geo.bottom() + delta.y())

            self.setGeometry(geo)
            self.old_pos = global_pos

    def mouseReleaseEvent(self, event):
        self.pressing = False
        self.resizing = False
        self.resize_direction = 0
        self.update_cursor(event.position().toPoint())

    def mouseDoubleClickEvent(self, event):
        if event.button() == Qt.LeftButton and event.position().toPoint().y() < self.title_bar.height():
            self.toggle_maximize()

if __name__ == '__main__':
    app = QApplication(sys.argv)
    window = CustomWindow()
    window.show()
    sys.exit(app.exec())











import sys
from PySide6.QtWidgets import (QApplication, QMainWindow, QWidget, QComboBox, QPushButton, 
                               QLabel, QFrame, QStackedWidget, QMessageBox)
from PySide6.QtCore import Qt, Signal, Slot, QUrl, QRect
from PySide6.QtGui import QFont, QCursor
from PySide6.QtWebEngineWidgets import QWebEngineView
from collections import OrderedDict

# è®¾è®¡å¸¸é‡
DESIGN_WIDTH, DESIGN_HEIGHT = 1634, 1054
TITLE_BAR_HEIGHT = 40
SIDEBAR_WIDTH = 200
SIDEBAR_BUTTON_X = 10
SIDEBAR_BUTTON_Y_START, SIDEBAR_BUTTON_SPACING = 100, 50
RESIZE_BORDER = 5  # æ‹‰ä¼¸è¾¹ç•Œå®½åº¦

# å¸ƒå±€ç®¡ç†å™¨
class LayoutManager:
    def __init__(self, design_size=(DESIGN_WIDTH, DESIGN_HEIGHT), title_bar_height=TITLE_BAR_HEIGHT, sidebar_width=SIDEBAR_WIDTH):
        self.design_width, self.design_height = design_size
        self.title_bar_height = title_bar_height
        self.sidebar_width = sidebar_width

    def calculate_scale(self, widget):
        if widget.isMaximized():
            screen = widget.screen()
            screen_size = screen.availableSize()
            return min(screen_size.width() / self.design_width, screen_size.height() / self.design_height)
        else:
            return min(widget.width() / self.design_width, widget.height() / self.design_height)

    def adjust_geometry(self, widget, layout_config, is_login=False):
        scale = self.calculate_scale(widget)
        if is_login:
            width, height = 400, 300
        else:
            width = widget.width() if widget.isMaximized() else int(self.design_width * scale)
            height = widget.height() if widget.isMaximized() else int(self.design_height * scale)
        widget.resize(width, height)

        for name, config in layout_config.items():
            obj = getattr(widget, name, None)
            if obj:
                x = int(config["x"] * scale) if "x" in config else 0
                y = int(config["y"] * scale) if "y" in config else 0
                w = int(config["w"] * scale) if "w" in config else obj.width()
                h = int(config["h"] * scale) if "h" in config else obj.height()
                if "move" in config and config["move"]:
                    obj.move(x, y)
                if "resize" in config and config["resize"]:
                    obj.resize(w, h)

    def center_on_screen(self, widget):
        if not widget.isMaximized():
            screen = widget.screen()
            screen_size = screen.availableSize()
            x = (screen_size.width() - widget.width()) // 2
            y = (screen_size.height() - widget.height()) // 2
            widget.move(x, y)

# åŸºç¡€æ§åˆ¶å™¨
class BaseSystemController:
    def __init__(self, max_cache_size=3):
        self.max_cache_size = max_cache_size
        self.main_window = None
        self.page_cache = OrderedDict()
        self.layout_manager = LayoutManager()

    def _adjust_widget_size(self, widget, is_login_widget=True):
        widget.adjust_geometry()

    def _switch_page(self, name):
        if name not in self.pages:
            return
        if name in self.page_cache:
            self.page_cache.move_to_end(name)
            print(f"Switched to cached page: {name}")
        else:
            if len(self.page_cache) >= self.max_cache_size:
                self._remove_oldest_page()
            widget_class, model = self.pages[name]["widget_class"], self.pages[name]["model"]
            widget = widget_class(model)
            self.page_cache[name] = widget
            self.main_window.content_stack.addWidget(widget)
            print(f"Created and switched to page: {name}")
        self.main_window.content_stack.setCurrentWidget(self.page_cache[name])

    def _remove_oldest_page(self):
        name, widget = self.page_cache.popitem(last=False)
        self.main_window.content_stack.removeWidget(widget)
        widget.deleteLater()
        print(f"Removed oldest page: {name}")

# ç™»å½•çª—å£
class LoginWidget(QWidget):
    login_signal = Signal(str, str)

    def __init__(self):
        super().__init__()
        self.layout_manager = LayoutManager()
        self.web_view = QWebEngineView(self)
        self.web_view.setFixedSize(400, 300)
        self.web_view.load(QUrl("https://example.com/callback?username=admin&token=123456"))
        self.web_view.urlChanged.connect(self._on_url_changed)
        self.layout_config = {
            "web_view": {"x": 0, "y": 0, "move": True}
        }
        print("LoginWidget initialized")

    def adjust_geometry(self):
        self.layout_manager.adjust_geometry(self, self.layout_config, is_login=True)
        self.layout_manager.center_on_screen(self)

    @Slot(QUrl)
    def _on_url_changed(self, url):
        url_str = url.toString()
        print(f"URL changed to: {url_str}")
        if "callback" in url_str:
            params = dict(param.split("=") for param in url_str.split("?")[1].split("&"))
            username = params.get("username", "")
            token = params.get("token", "")
            print(f"Emitting login_signal: username={username}, token={token}")
            self.login_signal.emit(username, token)

# ä¸»çª—å£
class MainWindow(QMainWindow):
    logout_signal = Signal()

    def __init__(self, username, pages_config):
        super().__init__()
        self.setWindowFlags(Qt.FramelessWindowHint)
        self.setWindowTitle(f"Welcome, {username}")
        self.username = username
        self.is_maximized = False
        self.layout_manager = LayoutManager()
        self.central_widget = QWidget(self)
        self.setCentralWidget(self.central_widget)
        self.setMinimumSize(800, 600)  # è®¾ç½®æœ€å°å°ºå¯¸

        # æ ‡é¢˜æ 
        self.title_bar = QWidget(self.central_widget)
        self.title_bar.setObjectName("titleBar")
        self.logo_label = QLabel("Logo", self.title_bar)
        self.logo_label.setObjectName("titleLabel")
        self.user_label = QLabel(f"User: {self.username}", self.title_bar)
        self.user_label.setObjectName("titleLabel")
        self.user_menu = QComboBox(self.title_bar)
        self.user_menu.addItems(["Profile", "Logout"])
        self.user_menu.setObjectName("userMenu")
        self.user_menu.currentTextChanged.connect(self._on_menu_selected)
        self.minimize_btn = QPushButton("?", self.title_bar)
        self.minimize_btn.setObjectName("titleButton")
        self.minimize_btn.clicked.connect(self.showMinimized)
        self.maximize_btn = QPushButton("â–¡", self.title_bar)
        self.maximize_btn.setObjectName("titleButton")
        self.maximize_btn.clicked.connect(self._toggle_maximize)
        self.close_btn = QPushButton("Ã—", self.title_bar)
        self.close_btn.setObjectName("titleButton")
        self.close_btn.clicked.connect(self.close)

        # ä¾§è¾¹æ 
        self.sidebar = QFrame(self.central_widget)
        self.sidebar.setObjectName("sidebar")
        self.page_buttons = {}
        for i, (name, config) in enumerate(pages_config.items()):
            button = QPushButton(config["label"], self.sidebar)
            button.setObjectName("sidebarButton")
            self.page_buttons[name] = button
        self.clear_cache_btn = QPushButton("Clear Cache", self.sidebar)
        self.clear_cache_btn.setObjectName("sidebarButton")

        # å†…å®¹åŒºåŸŸ
        self.content_stack = QStackedWidget(self.central_widget)

        # å¸ƒå±€é…ç½®
        self.layout_config = {
            "title_bar": {"x": 0, "y": 0, "w": DESIGN_WIDTH, "h": TITLE_BAR_HEIGHT, "move": True, "resize": True},
            "logo_label": {"x": 10, "y": 10, "move": True},
            "user_label": {"x": DESIGN_WIDTH - 234, "y": 10, "move": True},
            "user_menu": {"x": DESIGN_WIDTH - 180, "y": 5, "w": 80, "h": 30, "move": True, "resize": True},
            "minimize_btn": {"x": DESIGN_WIDTH - 100, "y": 5, "w": 30, "h": 30, "move": True, "resize": True},
            "maximize_btn": {"x": DESIGN_WIDTH - 65, "y": 5, "w": 30, "h": 30, "move": True, "resize": True},
            "close_btn": {"x": DESIGN_WIDTH - 30, "y": 5, "w": 30, "h": 30, "move": True, "resize": True},
            "sidebar": {"x": 0, "y": TITLE_BAR_HEIGHT, "w": SIDEBAR_WIDTH, "h": DESIGN_HEIGHT - TITLE_BAR_HEIGHT, "move": True, "resize": True},
            "clear_cache_btn": {"x": SIDEBAR_BUTTON_X, "y": SIDEBAR_BUTTON_Y_START + len(self.page_buttons) * SIDEBAR_BUTTON_SPACING, "move": True},
            "content_stack": {"x": SIDEBAR_WIDTH, "y": TITLE_BAR_HEIGHT, "w": DESIGN_WIDTH - SIDEBAR_WIDTH, "h": DESIGN_HEIGHT - TITLE_BAR_HEIGHT, "move": True, "resize": True}
        }
        for i, (name, button) in enumerate(self.page_buttons.items()):
            self.layout_config[f"page_button_{name}"] = {
                "x": SIDEBAR_BUTTON_X,
                "y": SIDEBAR_BUTTON_Y_START + i * SIDEBAR_BUTTON_SPACING,
                "move": True
            }
            setattr(self, f"page_button_{name}", button)

    def adjust_geometry(self):
        self.layout_manager.adjust_geometry(self, self.layout_config)
        if not self.isMaximized():
            self.layout_manager.center_on_screen(self)
        for name, button in self.page_buttons.items():
            setattr(self, f"page_button_{name}", button)

    @Slot(str)
    def _on_menu_selected(self, option):
        if option == "Logout":
            self.logout_signal.emit()
        elif option == "Profile":
            print("Profile selected")

    @Slot()
    def _toggle_maximize(self):
        if self.is_maximized:
            self.showNormal()
            self.maximize_btn.setText("â–¡")
            self.is_maximized = False
        else:
            self.showMaximized()
            self.maximize_btn.setText("?")
            self.is_maximized = True
        self.adjust_geometry()  # æœ€å¤§åŒ–/è¿˜åŸæ—¶é‡æ–°è°ƒæ•´å¸ƒå±€

    def mousePressEvent(self, event):
        if event.button() == Qt.LeftButton:
            self.drag_pos = event.globalPos() - self.pos()
            self.resize_direction = self._get_resize_direction(event.pos())
            event.accept()

    def mouseMoveEvent(self, event):
        if event.buttons() == Qt.LeftButton:
            if self.resize_direction:
                self._resize_window(event.globalPos())
            elif self.title_bar.underMouse():
                self.move(event.globalPos() - self.drag_pos)
            event.accept()

    def mouseReleaseEvent(self, event):
        self.resize_direction = None
        event.accept()

    def _get_resize_direction(self, pos):
        rect = self.rect()
        if pos.x() < RESIZE_BORDER and pos.y() < RESIZE_BORDER:
            return "top_left"
        elif pos.x() > rect.width() - RESIZE_BORDER and pos.y() < RESIZE_BORDER:
            return "top_right"
        elif pos.x() < RESIZE_BORDER and pos.y() > rect.height() - RESIZE_BORDER:
            return "bottom_left"
        elif pos.x() > rect.width() - RESIZE_BORDER and pos.y() > rect.height() - RESIZE_BORDER:
            return "bottom_right"
        elif pos.x() < RESIZE_BORDER:
            return "left"
        elif pos.x() > rect.width() - RESIZE_BORDER:
            return "right"
        elif pos.y() < RESIZE_BORDER:
            return "top"
        elif pos.y() > rect.height() - RESIZE_BORDER:
            return "bottom"
        return None

    def _resize_window(self, global_pos):
        rect = self.geometry()
        if "left" in self.resize_direction:
            rect.setLeft(global_pos.x())
        if "right" in self.resize_direction:
            rect.setRight(global_pos.x())
        if "top" in self.resize_direction:
            rect.setTop(global_pos.y())
        if "bottom" in self.resize_direction:
            rect.setBottom(global_pos.y())
        self.setGeometry(rect)
        self.adjust_geometry()  # å®æ—¶è°ƒæ•´å¸ƒå±€

    def mouseMoveEvent(self, event):
        super().mouseMoveEvent(event)
        if not (event.buttons() & Qt.LeftButton):
            direction = self._get_resize_direction(event.pos())
            if direction:
                if "left" in direction and "top" in direction:
                    self.setCursor(Qt.SizeFDiagCursor)
                elif "right" in direction and "top" in direction:
                    self.setCursor(Qt.SizeBDiagCursor)
                elif "left" in direction and "bottom" in direction:
                    self.setCursor(Qt.SizeBDiagCursor)
                elif "right" in direction and "bottom" in direction:
                    self.setCursor(Qt.SizeFDiagCursor)
                elif "left" in direction or "right" in direction:
                    self.setCursor(Qt.SizeHorCursor)
                elif "top" in direction or "bottom" in direction:
                    self.setCursor(Qt.SizeVerCursor)
            else:
                self.setCursor(Qt.ArrowCursor)

# é¡µé¢æ§åˆ¶å™¨
class PageController(BaseSystemController):
    def __init__(self, parent_controller, pages_config, max_cache_size=3):
        super().__init__(max_cache_size)
        self.parent_controller = parent_controller
        self.pages = pages_config

    def register_pages(self, main_window):
        self.main_window = main_window
        for name, config in self.pages.items():
            button = main_window.page_buttons[name]
            button.clicked.connect(lambda n=name: self._switch_page(n))

# ç™»å½•æ§åˆ¶å™¨
class LoginController(BaseSystemController):
    def __init__(self, login_widget_class, max_cache_size=3):
        super().__init__(max_cache_size)
        self.login_widget = login_widget_class()
        self.login_model = LoginModel()

    def validate_login(self, username, password):
        is_valid = self.login_model.validate_login(username, password)
        print(f"Validating login: username={username}, password={password}, result={is_valid}")
        return is_valid

    def start(self):
        self._adjust_widget_size(self.login_widget)
        self.login_widget.show()

    @Slot()
    def show_login(self):
        self.login_widget.show()

# åº”ç”¨æ§åˆ¶å™¨
class AppController(BaseSystemController):
    def __init__(self, max_cache_size=3):
        super().__init__(max_cache_size)
        self.pages = {
            "cpu_specs": {"widget_class": QWidget, "label": "CPU Specs", "model": None},
            "server_data": {"widget_class": QWidget, "label": "Server Data", "model": None},
            "virtualization_perf": {"widget_class": QWidget, "label": "Virtualization Perf", "model": None}
        }
        self.login_controller = LoginController(LoginWidget, self.max_cache_size)
        self.page_controller = PageController(self, self.pages, self.max_cache_size)
        self.login_controller.login_widget.login_signal.connect(self._on_login)
        print("AppController initialized, connected to login_signal")

    @Slot(str, str)
    def _on_login(self, username, password):
        print(f"Received login signal: username={username}, password={password}")
        if self.login_controller.validate_login(username, password):
            self.main_window = MainWindow(username, self.pages)
            self._adjust_widget_size(self.main_window, is_login_widget=False)
            self.main_window.logout_signal.connect(self._on_logout)
            self.main_window.clear_cache_btn.clicked.connect(self._clear_all_pages)
            self.page_controller.register_pages(self.main_window)
            self.main_window.show()
            self.login_controller.login_widget.hide()
            print("Login successful, main window shown")
        else:
            QMessageBox.warning(self.login_controller.login_widget, "Login Failed", "Invalid username or password")
            print("Login failed")

    @Slot()
    def _on_logout(self):
        self.main_window.hide()
        self.login_controller.show_login()
        print("Logged out")

    @Slot()
    def _clear_all_pages(self):
        while self.page_cache:
            self._remove_oldest_page()
        QMessageBox.information(self.main_window, "Cache Cleared", "All cached pages have been destroyed.")

    def start(self):
        self.login_controller.start()

# ç™»å½•æ¨¡å‹
class LoginModel:
    def __init__(self):
        self.users = {"admin": "123456"}

    def validate_login(self, username, password):
        return self.users.get(username) == password

# ä¸»å‡½æ•°
def load_stylesheet(app):
    stylesheet = """
    QWidget#titleBar {
        background-color: #333;
        color: white;
    }
    QPushButton#sidebarButton, QPushButton#titleButton {
        background-color: #4CAF50;
        color: white;
        border: none;
        padding: 5px;
    }
    QPushButton#sidebarButton:hover, QPushButton#titleButton:hover {
        background-color: #45a049;
    }
    QComboBox#userMenu {
        background-color: #4CAF50;
        color: white;
        border: none;
        padding: 5px;
    }
    QComboBox#userMenu:hover {
        background-color: #45a049;
    }
    QFrame#sidebar {
        background-color: #f0f0f0;
    }
    """
    app.setStyleSheet(stylesheet)

if __name__ == "__main__":
    QApplication.setAttribute(Qt.AA_EnableHighDpiScaling)
    QApplication.setAttribute(Qt.AA_UseHighDpiPixmaps)
    app = QApplication(sys.argv)
    font = QFont("Arial", 10)
    app.setFont(font)
    load_stylesheet(app)
    app_controller = AppController(max_cache_size=3)
    app_controller.start()
    sys.exit(app.exec())












æ‚¨æåˆ°çš„é—®é¢˜æ˜¯å…³äºå¦‚ä½•æ›´å¥½åœ°æ¨¡å—åŒ– Widgetï¼Œä»¥ä¾¿åœ¨ç­‰æ¯”ä¾‹ç¼©æ”¾æ—¶æ›´æ˜“äºç»´æŠ¤ã€‚å½“å‰ä»£ç ä¸­ï¼ŒMainWindow å’Œå…¶ä»– Widget çš„ç¼©æ”¾é€»è¾‘ï¼ˆadjust_geometry å’Œ center_on_screenï¼‰ç›´æ¥ç¡¬ç¼–ç åœ¨æ¯ä¸ªç±»ä¸­ï¼Œå¯¼è‡´ç»´æŠ¤å›°éš¾ï¼Œå°¤å…¶æ˜¯åœ¨éœ€è¦è°ƒæ•´å¸ƒå±€æˆ–æ”¯æŒä¸åŒåˆ†è¾¨ç‡æ—¶ã€‚æˆ‘å°†åˆ†æç°çŠ¶å¹¶æå‡ºä¼˜åŒ–æ–¹æ¡ˆï¼Œæå‡æ¨¡å—åŒ–å’Œå¯ç»´æŠ¤æ€§ã€‚
å½“å‰é—®é¢˜åˆ†æ
ç°çŠ¶
ç¼©æ”¾é€»è¾‘åˆ†æ•£ï¼š
æ¯ä¸ª Widgetï¼ˆå¦‚ MainWindow, LoginWidget, BaseQueryWidget ç­‰ï¼‰éƒ½æœ‰è‡ªå·±çš„ adjust_geometry æ–¹æ³•ï¼Œé‡å¤è®¡ç®—ç¼©æ”¾æ¯”ä¾‹å’Œå®šä½ã€‚
ç¤ºä¾‹ï¼š
python
def adjust_geometry(self, scale, parent_width, parent_height):
    window_width = int(DESIGN_WIDTH * scale)
    window_height = int(DESIGN_HEIGHT * scale)
    self.resize(window_width, window_height)
    self.title_bar.move(0, 0)
    self.title_bar.resize(window_width, int(TITLE_BAR_HEIGHT * scale))
    # æ›´å¤šæ§ä»¶è°ƒæ•´...
ç¡¬ç¼–ç ä½ç½®ï¼š
æ§ä»¶ä½ç½®å’Œå¤§å°ï¼ˆå¦‚ self.logo_label.move(int(10 * scale), int(10 * scale))ï¼‰ç›´æ¥å†™åœ¨ä»£ç ä¸­ï¼Œéš¾ä»¥æ‰¹é‡ä¿®æ”¹ã€‚
ç»´æŠ¤æ€§å·®ï¼š
æ·»åŠ æ–°æ§ä»¶æˆ–è°ƒæ•´å¸ƒå±€éœ€è¦ä¿®æ”¹æ¯ä¸ªç±»çš„ adjust_geometryï¼Œå®¹æ˜“å‡ºé”™ä¸”å·¥ä½œé‡å¤§ã€‚
è€¦åˆåº¦é«˜ï¼š
ç¼©æ”¾é€»è¾‘ä¸æ§ä»¶åˆ›å»ºé€»è¾‘æ··åœ¨ä¸€èµ·ï¼Œéš¾ä»¥ç‹¬ç«‹æµ‹è¯•æˆ–å¤ç”¨ã€‚
ç›®æ ‡
æ¨¡å—åŒ–ï¼šå°†ç¼©æ”¾é€»è¾‘æŠ½ç¦»ä¸ºç‹¬ç«‹æ¨¡å—ã€‚
å¯ç»´æŠ¤æ€§ï¼šé€šè¿‡é…ç½®æˆ–æŠ½è±¡å‡å°‘ç¡¬ç¼–ç ã€‚
ç­‰æ¯”ä¾‹ç¼©æ”¾ï¼šç¡®ä¿æ‰€æœ‰æ§ä»¶æŒ‰æ¯”ä¾‹è°ƒæ•´ï¼Œæ”¯æŒä¸åŒåˆ†è¾¨ç‡ã€‚
ä¼˜åŒ–æ€è·¯
æŠ½è±¡ç¼©æ”¾ç®¡ç†å™¨ï¼š
åˆ›å»ºä¸€ä¸ª LayoutManager ç±»ï¼Œé›†ä¸­å¤„ç†ç¼©æ”¾å’Œå¸ƒå±€é€»è¾‘ã€‚
æ¯ä¸ª Widget åªéœ€æä¾›æ§ä»¶å’Œåˆå§‹å¸ƒå±€é…ç½®ï¼Œç¼©æ”¾ç”± LayoutManager å¤„ç†ã€‚
é…ç½®é©±åŠ¨å¸ƒå±€ï¼š
ä½¿ç”¨å­—å…¸æˆ–æ•°æ®ç»“æ„å®šä¹‰æ§ä»¶çš„ä½ç½®å’Œå¤§å°ï¼Œæ›¿ä»£ç¡¬ç¼–ç ã€‚
ç»Ÿä¸€ç¼©æ”¾é€»è¾‘ï¼š
å°† adjust_geometry å’Œ center_on_screen ç§»åˆ° LayoutManagerï¼Œå‡å°‘é‡å¤ä»£ç ã€‚
æ”¯æŒåŠ¨æ€è°ƒæ•´ï¼š
å…è®¸åœ¨è¿è¡Œæ—¶ä¿®æ”¹å¸ƒå±€é…ç½®ï¼Œä¾¿äºè°ƒè¯•å’Œæ‰©å±•ã€‚
ä»¥ä¸‹æ˜¯ä¼˜åŒ–åçš„å®ç°ï¼š
ä¼˜åŒ–åçš„ä»£ç 
æ–°å¢ layout_manager.py
python
from PySide6.QtCore import Qt

class LayoutManager:
    def __init__(self, design_size=(1634, 1054), title_bar_height=40, sidebar_width=200):
        self.design_width, self.design_height = design_size
        self.title_bar_height = title_bar_height
        self.sidebar_width = sidebar_width

    def calculate_scale(self, widget):
        screen = widget.screen()
        screen_size = screen.availableSize()
        return min(screen_size.width() / self.design_width, screen_size.height() / self.design_height)

    def adjust_geometry(self, widget, layout_config, is_login=False):
        scale = self.calculate_scale(widget)
        if is_login:
            width, height = 400, 300  # å›ºå®šç™»å½•çª—å£å¤§å°
        else:
            width = int(self.design_width * scale)
            height = int(self.design_height * scale)
        widget.resize(width, height)

        for name, config in layout_config.items():
            obj = getattr(widget, name, None)
            if obj:
                x = int(config["x"] * scale) if "x" in config else 0
                y = int(config["y"] * scale) if "y" in config else 0
                w = int(config["w"] * scale) if "w" in config else obj.width()
                h = int(config["h"] * scale) if "h" in config else obj.height()
                if "move" in config and config["move"]:
                    obj.move(x, y)
                if "resize" in config and config["resize"]:
                    obj.resize(w, h)

    def center_on_screen(self, widget):
        screen = widget.screen()
        screen_size = screen.availableSize()
        x = (screen_size.width() - widget.width()) // 2
        y = (screen_size.height() - widget.height()) // 2
        widget.move(x, y)
ä¿®æ”¹ views.py
python
from PySide6.QtWidgets import (QMainWindow, QWidget, QComboBox, QPushButton, QTableWidget, 
                               QTableWidgetItem, QLabel, QLineEdit, QFrame, QStackedWidget)
from PySide6.QtCore import Qt, Signal, Slot, QTimer
from PySide6.QtGui import QIcon
from PySide6.QtWebEngineWidgets import QWebEngineView
from layout_manager import LayoutManager

DESIGN_WIDTH, DESIGN_HEIGHT = 1634, 1054
TITLE_BAR_HEIGHT = 40
SIDEBAR_WIDTH = 200

class LoginWidget(QWidget):
    login_signal = Signal(str, str)

    def __init__(self):
        super().__init__()
        self.layout_manager = LayoutManager()
        self.web_view = QWebEngineView(self)
        self.web_view.setFixedSize(400, 300)
        self.web_view.load(QUrl("https://example.com/login"))
        self.web_view.urlChanged.connect(self._on_url_changed)
        self.layout_config = {
            "web_view": {"x": 0, "y": 0, "move": True}
        }
        print("LoginWidget initialized")

    def adjust_geometry(self):
        self.layout_manager.adjust_geometry(self, self.layout_config, is_login=True)
        self.layout_manager.center_on_screen(self)

    @Slot(QUrl)
    def _on_url_changed(self, url):
        url_str = url.toString()
        print(f"URL changed to: {url_str}")
        if "callback" in url_str:
            params = dict(param.split("=") for param in url_str.split("?")[1].split("&"))
            username = params.get("username", "")
            token = params.get("token", "")
            print(f"Emitting login_signal: username={username}, token={token}")
            self.login_signal.emit(username, token)

class MainWindow(QMainWindow):
    logout_signal = Signal()

    def __init__(self, username, pages_config):
        super().__init__()
        self.setWindowFlags(Qt.FramelessWindowHint)
        self.setWindowTitle(f"Welcome, {username}")
        self.username = username
        self.is_maximized = False
        self.layout_manager = LayoutManager()
        self.central_widget = QWidget(self)
        self.setCentralWidget(self.central_widget)

        # æ ‡é¢˜æ 
        self.title_bar = QWidget(self.central_widget)
        self.title_bar.setObjectName("titleBar")
        self.logo_label = QLabel("Logo", self.title_bar)
        self.logo_label.setObjectName("titleLabel")
        self.user_label = QLabel(f"User: {self.username}", self.title_bar)
        self.user_label.setObjectName("titleLabel")
        self.user_menu = QComboBox(self.title_bar)
        self.user_menu.addItems(["Profile", "Logout"])
        self.user_menu.setObjectName("userMenu")
        self.user_menu.currentTextChanged.connect(self._on_menu_selected)
        self.minimize_btn = QPushButton("âˆ’", self.title_bar)
        self.minimize_btn.setObjectName("titleButton")
        self.minimize_btn.clicked.connect(self.showMinimized)
        self.maximize_btn = QPushButton("â–¡", self.title_bar)
        self.maximize_btn.setObjectName("titleButton")
        self.maximize_btn.clicked.connect(self._toggle_maximize)
        self.close_btn = QPushButton("Ã—", self.title_bar)
        self.close_btn.setObjectName("titleButton")
        self.close_btn.clicked.connect(self.close)

        # ä¾§è¾¹æ 
        self.sidebar = QFrame(self.central_widget)
        self.sidebar.setObjectName("sidebar")
        self.page_buttons = {}
        for i, (name, config) in enumerate(pages_config.items()):
            button = QPushButton(config["label"], self.sidebar)
            button.setObjectName("sidebarButton")
            self.page_buttons[name] = button
        self.clear_cache_btn = QPushButton("Clear Cache", self.sidebar)
        self.clear_cache_btn.setObjectName("sidebarButton")

        # å†…å®¹åŒºåŸŸ
        self.content_stack = QStackedWidget(self.central_widget)

        # å¸ƒå±€é…ç½®
        self.layout_config = {
            "title_bar": {"x": 0, "y": 0, "w": DESIGN_WIDTH, "h": TITLE_BAR_HEIGHT, "move": True, "resize": True},
            "logo_label": {"x": 10, "y": 10, "move": True},
            "user_label": {"x": DESIGN_WIDTH - 234, "y": 10, "move": True},
            "user_menu": {"x": DESIGN_WIDTH - 180, "y": 5, "w": 80, "h": 30, "move": True, "resize": True},
            "minimize_btn": {"x": DESIGN_WIDTH - 100, "y": 5, "w": 30, "h": 30, "move": True, "resize": True},
            "maximize_btn": {"x": DESIGN_WIDTH - 65, "y": 5, "w": 30, "h": 30, "move": True, "resize": True},
            "close_btn": {"x": DESIGN_WIDTH - 30, "y": 5, "w": 30, "h": 30, "move": True, "resize": True},
            "sidebar": {"x": 0, "y": TITLE_BAR_HEIGHT, "w": SIDEBAR_WIDTH, "h": DESIGN_HEIGHT - TITLE_BAR_HEIGHT, "move": True, "resize": True},
            "clear_cache_btn": {"x": SIDEBAR_BUTTON_X, "y": SIDEBAR_BUTTON_Y_START + len(self.page_buttons) * SIDEBAR_BUTTON_SPACING, "move": True},
            "content_stack": {"x": SIDEBAR_WIDTH, "y": TITLE_BAR_HEIGHT, "w": DESIGN_WIDTH - SIDEBAR_WIDTH, "h": DESIGN_HEIGHT - TITLE_BAR_HEIGHT, "move": True, "resize": True}
        }
        for i, (name, button) in enumerate(self.page_buttons.items()):
            self.layout_config[f"page_button_{name}"] = {
                "x": SIDEBAR_BUTTON_X,
                "y": SIDEBAR_BUTTON_Y_START + i * SIDEBAR_BUTTON_SPACING,
                "move": True
            }
            setattr(self, f"page_button_{name}", button)

    def adjust_geometry(self):
        self.layout_manager.adjust_geometry(self, self.layout_config)
        self.layout_manager.center_on_screen(self)
        for name, button in self.page_buttons.items():
            setattr(self, f"page_button_{name}", button)

    @Slot(str)
    def _on_menu_selected(self, option):
        if option == "Logout":
            self.logout_signal.emit()
        elif option == "Profile":
            print("Profile selected")

    @Slot()
    def _toggle_maximize(self):
        if self.is_maximized:
            self.showNormal()
            self.maximize_btn.setText("â–¡")
            self.is_maximized = False
        else:
            self.showMaximized()
            self.maximize_btn.setText("â")
            self.is_maximized = True

    def mousePressEvent(self, event):
        if event.button() == Qt.LeftButton and self.title_bar.underMouse():
            self.drag_pos = event.globalPos() - self.pos()
            event.accept()

    def mouseMoveEvent(self, event):
        if event.buttons() == Qt.LeftButton and hasattr(self, 'drag_pos'):
            self.move(event.globalPos() - self.drag_pos)
            event.accept()

# å…¶ä»–ç±»ï¼ˆå¦‚ BaseQueryWidget ç­‰ï¼‰ç±»ä¼¼è°ƒæ•´
ä¿®æ”¹ base_controller.py
python
from PySide6.QtCore import QSize
from PySide6.QtGui import QScreen
from collections import OrderedDict
from layout_manager import LayoutManager

class BaseSystemController:
    def __init__(self, max_cache_size=3):
        self.max_cache_size = max_cache_size
        self.main_window = None
        self.page_cache = OrderedDict()
        self.layout_manager = LayoutManager()

    def _adjust_widget_size(self, widget, is_login_widget=True):
        widget.adjust_geometry()  # å§”æ‰˜ç»™ Widget è‡ªå·±çš„æ–¹æ³•

    # å…¶ä»–æ–¹æ³•ä¿æŒä¸å˜
ä¿®æ”¹ app_controller.py
python
from PySide6.QtWidgets import QMessageBox
from PySide6.QtCore import Slot
from base_controller import BaseSystemController
from views import MainWindow, LoginWidget
from login_controller import LoginController
from page_controllers import PageController
import json

class AppController(BaseSystemController):
    def __init__(self, max_cache_size=3):
        super().__init__(max_cache_size)
        self.login_controller = LoginController(LoginWidget, self.max_cache_size)
        with open("pages_config.json", "r") as f:
            pages_config = json.load(f)
        self.page_controller = PageController(self, pages_config, self.max_cache_size)
        self.pages = self.page_controller.pages
        self.login_controller.login_widget.login_signal.connect(self._on_login)
        print("AppController initialized, connected to login_signal")

    @Slot(str, str)
    def _on_login(self, username, password):
        print(f"Received login signal: username={username}, password={password}")
        if self.login_controller.validate_login(username, password):
            self.main_window = MainWindow(username, self.pages)
            self._adjust_widget_size(self.main_window, is_login_widget=False)
            self.main_window.logout_signal.connect(self._on_logout)
            self.main_window.clear_cache_btn.clicked.connect(self._clear_all_pages)
            self.page_controller.register_pages(self.main_window)
            self.main_window.show()
            self.login_controller.login_widget.hide()
            print("Login successful, main window shown")
        else:
            QMessageBox.warning(self.login_controller.login_widget, "Login Failed", "Invalid username or password")
            print("Login failed")

    # å…¶ä»–æ–¹æ³•ä¿æŒä¸å˜
ä¼˜åŒ–ç»†èŠ‚
æ¨¡å—åŒ– LayoutManagerï¼š
LayoutManager é›†ä¸­å¤„ç†ç¼©æ”¾é€»è¾‘ï¼š
python
def adjust_geometry(self, widget, layout_config, is_login=False):
    scale = self.calculate_scale(widget)
    if is_login:
        width, height = 400, 300
    else:
        width = int(self.design_width * scale)
        height = int(self.design_height * scale)
    widget.resize(width, height)
    for name, config in layout_config.items():
        obj = getattr(widget, name, None)
        if obj:
            x = int(config["x"] * scale) if "x" in config else 0
            # ...
æ¯ä¸ª Widget åªéœ€æä¾› layout_configã€‚
é…ç½®é©±åŠ¨ï¼š
MainWindow.layout_config å®šä¹‰æ§ä»¶åˆå§‹ä½ç½®å’Œå¤§å°ï¼š
python
self.layout_config = {
    "title_bar": {"x": 0, "y": 0, "w": DESIGN_WIDTH, "h": TITLE_BAR_HEIGHT, "move": True, "resize": True},
    "logo_label": {"x": 10, "y": 10, "move": True},
    # ...
}
æ”¯æŒåŠ¨æ€æ§ä»¶ï¼ˆå¦‚ page_buttonsï¼‰ã€‚
ç»Ÿä¸€ç¼©æ”¾ï¼š
adjust_geometry è°ƒç”¨ layout_manager.adjust_geometryï¼Œæ— éœ€é‡å¤å®ç°ã€‚
ç»´æŠ¤æ€§æå‡ï¼š
ä¿®æ”¹å¸ƒå±€åªéœ€è°ƒæ•´ layout_configï¼Œæ— éœ€æ”¹åŠ¨ä»£ç é€»è¾‘ã€‚
æ–°å¢æ§ä»¶åªéœ€æ·»åŠ é…ç½®é¡¹ã€‚
æµ‹è¯•æ­¥éª¤
ä¿å­˜æ‰€æœ‰æ–‡ä»¶ï¼ŒåŒ…æ‹¬æ–° layout_manager.pyã€‚
ä¿®æ”¹ LoginWidget.__init__ æ¨¡æ‹Ÿå›è°ƒï¼š
python
self.web_view.load(QUrl("https://example.com/callback?username=admin&token=123456"))
è¿è¡Œ main.pyï¼ŒéªŒè¯ï¼š
ç™»å½•çª—å£å’Œä¸»çª—å£æŒ‰æ¯”ä¾‹ç¼©æ”¾ã€‚
ä¸»çª—å£æ ‡é¢˜æ ã€ä¾§è¾¹æ ã€å†…å®¹åŒºåŸŸå¸ƒå±€æ­£ç¡®ã€‚
è°ƒæ•´å±å¹•åˆ†è¾¨ç‡ï¼Œç¡®è®¤ç­‰æ¯”ä¾‹ç¼©æ”¾ã€‚
æ£€æŸ¥åŠŸèƒ½ï¼š
é€€å‡ºã€æœ€å°åŒ–ã€æœ€å¤§åŒ–æ­£å¸¸ã€‚
é¡µé¢åˆ‡æ¢å’Œç¼“å­˜æ¸…ç†æ­£å¸¸ã€‚
ä¼˜åŒ–äº®ç‚¹
æ¨¡å—åŒ–ï¼š
LayoutManager ç‹¬ç«‹ç®¡ç†ç¼©æ”¾ï¼Œå¤ç”¨æ€§é«˜ã€‚
é…ç½®åŒ–ï¼š
å¸ƒå±€é€šè¿‡å­—å…¸å®šä¹‰ï¼Œæ˜“äºè°ƒæ•´å’Œæ‰©å±•ã€‚
å¯ç»´æŠ¤æ€§ï¼š
ç¼©æ”¾é€»è¾‘é›†ä¸­ï¼Œå‡å°‘ä»£ç é‡å¤ã€‚
çµæ´»æ€§ï¼š
æ”¯æŒåŠ¨æ€æ§ä»¶ï¼ˆå¦‚ä¾§è¾¹æ æŒ‰é’®ï¼‰ã€‚
è¿›ä¸€æ­¥å»ºè®®
JSON é…ç½®æ–‡ä»¶ï¼š
å°† layout_config ç§»åˆ°å¤–éƒ¨ JSON æ–‡ä»¶ï¼Œè¿›ä¸€æ­¥è§£è€¦ï¼š
python
with open("main_window_layout.json", "r") as f:
    self.layout_config = json.load(f)
å¸ƒå±€è°ƒè¯•å·¥å…·ï¼š
æ·»åŠ è¿è¡Œæ—¶è°ƒæ•´å¸ƒå±€çš„åŠŸèƒ½ï¼Œä¾¿äºå¯è§†åŒ–è°ƒè¯•ã€‚
å“åº”å¼è®¾è®¡ï¼š
æ”¯æŒæœ€å°å°ºå¯¸é™åˆ¶ï¼Œé¿å…è¿‡å°ç¼©æ”¾ã€‚
è¯·ç¡®è®¤ä¼˜åŒ–æ•ˆæœï¼Œæˆ–å‘Šè¯‰æˆ‘æ˜¯å¦éœ€è¦è¿›ä¸€æ­¥è°ƒæ•´ï¼ˆå¦‚å¤–éƒ¨é…ç½®æ–‡ä»¶ï¼‰ï¼









import sys
from PySide6.QtWidgets import (QApplication, QMainWindow, QWidget, QVBoxLayout, 
                              QHBoxLayout, QPushButton, QLabel, QComboBox)
from PySide6.QtCore import Qt, QSize, QRect, QPoint
from PySide6.QtGui import QIcon, QPixmap, QScreen

class CustomButton(QWidget):
    def __init__(self, text, icon_path, scale_factor, parent=None):
        super().__init__(parent)
        self.scale_factor = scale_factor
        
        layout = QVBoxLayout(self)
        layout.setSpacing(int(5 * scale_factor))
        layout.setContentsMargins(int(10 * scale_factor), int(10 * scale_factor), 
                                int(10 * scale_factor), int(10 * scale_factor))
        
        self.text_label = QLabel(text)
        self.text_label.setAlignment(Qt.AlignCenter)
        
        self.icon_label = QLabel()
        pixmap = QPixmap(icon_path)
        icon_size = int(24 * scale_factor)
        self.icon_label.setPixmap(pixmap.scaled(icon_size, icon_size, Qt.KeepAspectRatio))
        self.icon_label.setAlignment(Qt.AlignCenter)
        
        layout.addWidget(self.text_label)
        layout.addWidget(self.icon_label)
        
        self.setStyleSheet("""
            QWidget {
                background-color: #3498DB;
                color: white;
                border-radius: 5px;
            }
            QWidget:hover {
                background-color: #2980B9;
            }
            QLabel {
                color: white;
            }
        """)
        
        self.clicked = lambda: None
        self.mousePressEvent = self.on_click
        
    def on_click(self, event):
        self.clicked()

class CustomWindow(QMainWindow):
    def __init__(self):
        super().__init__()

        # åŸºå‡†åˆ†è¾¨ç‡
        BASE_WIDTH = 1500
        BASE_HEIGHT = 1200
        
        self.setWindowFlags(Qt.FramelessWindowHint)
        
        screen = QApplication.primaryScreen()
        screen_geometry = screen.availableGeometry()
        screen_width = screen_geometry.width()
        screen_height = screen_geometry.height()
        
        width_ratio = screen_width / BASE_WIDTH
        height_ratio = screen_height / BASE_HEIGHT
        self.scale_factor = min(width_ratio, height_ratio) * 0.8
        
        window_width = int(BASE_WIDTH * self.scale_factor)
        window_height = int(BASE_HEIGHT * self.scale_factor)
        
        self.setGeometry(
            int((screen_width - window_width) / 2),
            int((screen_height - window_height) / 2),
            window_width,
            window_height
        )
        
        self.setMinimumSize(int(BASE_WIDTH * self.scale_factor * 0.5), 
                          int(BASE_HEIGHT * self.scale_factor * 0.5))

        # ä¸»å¸ƒå±€
        self.main_widget = QWidget()
        self.setCentralWidget(self.main_widget)
        self.main_layout = QHBoxLayout(self.main_widget)
        self.main_layout.setContentsMargins(0, 0, 0, 0)
        self.main_layout.setSpacing(0)

        # å·¦ä¾§ä¾§è¾¹æ 
        self.sidebar = QWidget()
        sidebar_width = int(250 * self.scale_factor)
        self.sidebar.setMinimumWidth(sidebar_width)
        self.sidebar.setMaximumWidth(sidebar_width)
        self.sidebar.setStyleSheet("background-color: #2C3E50;")
        sidebar_layout = QVBoxLayout(self.sidebar)
        
        logo_label = QLabel()
        logo_pixmap = QPixmap("logo.png")
        logo_size = int(100 * self.scale_factor)
        logo_label.setPixmap(logo_pixmap.scaled(logo_size, logo_size, Qt.KeepAspectRatio))
        logo_label.setAlignment(Qt.AlignCenter)
        
        button1 = CustomButton("æŒ‰é’®1", "icon1.png", self.scale_factor)
        button2 = CustomButton("æŒ‰é’®2", "icon2.png", self.scale_factor)
        
        button1.clicked = lambda: print("Button 1 clicked")
        button2.clicked = lambda: print("Button 2 clicked")

        sidebar_layout.addStretch(1)
        sidebar_layout.addWidget(logo_label)
        sidebar_layout.addSpacing(int(50 * self.scale_factor))
        sidebar_layout.addWidget(button1)
        sidebar_layout.addSpacing(int(20 * self.scale_factor))
        sidebar_layout.addWidget(button2)
        sidebar_layout.addStretch(1)

        # å³ä¾§ä¸»å†…å®¹åŒº
        self.content_widget = QWidget()
        self.content_widget.setStyleSheet("background-color: #ECF0F1;")
        content_layout = QVBoxLayout(self.content_widget)

        # æ ‡é¢˜æ 
        self.title_bar = QWidget()
        title_height = int(50 * self.scale_factor)
        self.title_bar.setFixedHeight(title_height)
        self.title_bar.setStyleSheet("background-color: #34495E;")
        title_layout = QHBoxLayout(self.title_bar)
        title_layout.setContentsMargins(int(10 * self.scale_factor), 0, 
                                      int(10 * self.scale_factor), 0)
        
        # ç”¨æˆ·ä¿¡æ¯åŒºåŸŸ
        user_widget = QWidget()
        user_layout = QHBoxLayout(user_widget)
        user_layout.setSpacing(int(5 * self.scale_factor))
        
        # ç”¨æˆ·å¤´åƒ
        avatar_label = QLabel()
        avatar_pixmap = QPixmap("avatar.png")
        avatar_size = int(30 * self.scale_factor)
        avatar_label.setPixmap(avatar_pixmap.scaled(avatar_size, avatar_size, Qt.KeepAspectRatio))
        
        # ç”¨æˆ·åæ ‡ç­¾
        username_label = QLabel("ç”¨æˆ·123")
        username_label.setStyleSheet(f"""
            QLabel {{
                color: white;
                font-size: {int(14 * self.scale_factor)}px;
                padding: {int(5 * self.scale_factor)}px;
            }}
        """)
        
        # ä¸‹æ‹‰èœå•åªæ˜¾ç¤ºâ€œé€€å‡ºç™»å½•â€
        username_combo = QComboBox()
        username_combo.addItem("é€€å‡ºç™»å½•")
        username_combo.setStyleSheet(f"""
            QComboBox {{
                background-color: #3498DB;
                color: white;
                padding: {int(5 * self.scale_factor)}px;
                border-radius: {int(3 * self.scale_factor)}px;
                min-width: {int(100 * self.scale_factor)}px;
            }}
        """)
        
        user_layout.addWidget(avatar_label)
        user_layout.addWidget(username_label)
        user_layout.addWidget(username_combo)
        
        # çª—å£æ§åˆ¶æŒ‰é’®
        self.minimize_btn = QPushButton("âˆ’")
        self.maximize_btn = QPushButton("â–¡")
        self.close_btn = QPushButton("Ã—")
        
        control_style = f"""
            QPushButton {{
                background-color: transparent;
                color: white;
                border: none;
                font-size: {int(16 * self.scale_factor)}px;
                min-width: {int(40 * self.scale_factor)}px;
            }}
            QPushButton:hover {{
                background-color: #E74C3C;
            }}
        """
        
        for btn in (self.minimize_btn, self.maximize_btn, self.close_btn):
            btn.setStyleSheet(control_style)
        
        self.minimize_btn.clicked.connect(self.showMinimized)
        self.maximize_btn.clicked.connect(self.toggle_maximize)
        self.close_btn.clicked.connect(self.close)
        
        title_layout.addStretch(1)
        title_layout.addWidget(user_widget)
        title_layout.addSpacing(int(10 * self.scale_factor))
        title_layout.addWidget(self.minimize_btn)
        title_layout.addWidget(self.maximize_btn)
        title_layout.addWidget(self.close_btn)
        
        main_content = QWidget()
        main_content.setStyleSheet("background-color: #ECF0F1;")
        
        content_layout.addWidget(self.title_bar)
        content_layout.addWidget(main_content)
        
        self.main_layout.addWidget(self.sidebar)
        self.main_layout.addWidget(self.content_widget)

        # ç”¨äºçª—å£æ‹–åŠ¨çš„å˜é‡
        self.dragging = False
        self.drag_position = QPoint()

    def toggle_maximize(self):
        if self.isMaximized():
            self.showNormal()
            self.maximize_btn.setText("â–¡")
        else:
            self.showMaximized()
            self.maximize_btn.setText("â")

    def resizeEvent(self, event):
        super().resizeEvent(event)
        new_width = int(250 * self.scale_factor)
        self.sidebar.setMinimumWidth(new_width)
        self.sidebar.setMaximumWidth(new_width)

    def mousePressEvent(self, event):
        if event.button() == Qt.LeftButton and self.title_bar.underMouse():
            self.dragging = True
            self.drag_position = event.globalPosition().toPoint() - self.frameGeometry().topLeft()
            event.accept()

    def mouseMoveEvent(self, event):
        if self.dragging and event.buttons() & Qt.LeftButton:
            self.move(event.globalPosition().toPoint() - self.drag_position)
            event.accept()

    def mouseReleaseEvent(self, event):
        if event.button() == Qt.LeftButton:
            self.dragging = False
            event.accept()

if __name__ == '__main__':
    app = QApplication(sys.argv)
    window = CustomWindow()
    window.show()
    sys.exit(app.exec())







import sys
from PySide6.QtWidgets import (QApplication, QMainWindow, QWidget, QVBoxLayout, 
                              QHBoxLayout, QPushButton, QLabel, QComboBox)
from PySide6.QtCore import Qt, QSize, QRect
from PySide6.QtGui import QIcon, QPixmap, QScreen

class CustomButton(QWidget):
    """è‡ªå®šä¹‰æŒ‰é’®ç±»ï¼šæ–‡å­—åœ¨ä¸Šï¼Œå›¾æ ‡åœ¨ä¸‹"""
    def __init__(self, text, icon_path, scale_factor, parent=None):
        super().__init__(parent)
        self.scale_factor = scale_factor
        
        layout = QVBoxLayout(self)
        layout.setSpacing(int(5 * scale_factor))
        layout.setContentsMargins(int(10 * scale_factor), int(10 * scale_factor), 
                                int(10 * scale_factor), int(10 * scale_factor))
        
        self.text_label = QLabel(text)
        self.text_label.setAlignment(Qt.AlignCenter)
        
        self.icon_label = QLabel()
        pixmap = QPixmap(icon_path)
        icon_size = int(24 * scale_factor)
        self.icon_label.setPixmap(pixmap.scaled(icon_size, icon_size, Qt.KeepAspectRatio))
        self.icon_label.setAlignment(Qt.AlignCenter)
        
        layout.addWidget(self.text_label)
        layout.addWidget(self.icon_label)
        
        self.setStyleSheet("""
            QWidget {
                background-color: #3498DB;
                color: white;
                border-radius: 5px;
            }
            QWidget:hover {
                background-color: #2980B9;
            }
            QLabel {
                color: white;
            }
        """)
        
        self.clicked = lambda: None
        self.mousePressEvent = self.on_click
        
    def on_click(self, event):
        self.clicked()

class CustomWindow(QMainWindow):
    def __init__(self):
        super().__init__()

        # åŸºå‡†åˆ†è¾¨ç‡
        BASE_WIDTH = 1500
        BASE_HEIGHT = 1200
        
        # å»æ‰é»˜è®¤æ ‡é¢˜æ 
        self.setWindowFlags(Qt.FramelessWindowHint)
        
        # è·å–å±å¹•åˆ†è¾¨ç‡
        screen = QApplication.primaryScreen()
        screen_geometry = screen.availableGeometry()
        screen_width = screen_geometry.width()
        screen_height = screen_geometry.height()
        
        # è®¡ç®—ç¼©æ”¾æ¯”ä¾‹ï¼ˆåŸºäºå±å¹•è¾ƒå°çš„è¾¹ï¼‰
        width_ratio = screen_width / BASE_WIDTH
        height_ratio = screen_height / BASE_HEIGHT
        self.scale_factor = min(width_ratio, height_ratio) * 0.8  # å–80%ä½œä¸ºæ˜¾ç¤ºæ¯”ä¾‹
        
        # è®¡ç®—å®é™…çª—å£å¤§å°
        window_width = int(BASE_WIDTH * self.scale_factor)
        window_height = int(BASE_HEIGHT * self.scale_factor)
        
        # è®¾ç½®çª—å£å¤§å°å¹¶å±…ä¸­
        self.setGeometry(
            int((screen_width - window_width) / 2),
            int((screen_height - window_height) / 2),
            window_width,
            window_height
        )
        
        # è®¾ç½®æœ€å°çª—å£å¤§å°
        self.setMinimumSize(int(BASE_WIDTH * self.scale_factor * 0.5), 
                          int(BASE_HEIGHT * self.scale_factor * 0.5))

        # ä¸»å¸ƒå±€
        self.main_widget = QWidget()
        self.setCentralWidget(self.main_widget)
        self.main_layout = QHBoxLayout(self.main_widget)
        self.main_layout.setContentsMargins(0, 0, 0, 0)
        self.main_layout.setSpacing(0)

        # å·¦ä¾§ä¾§è¾¹æ 
        self.sidebar = QWidget()
        sidebar_width = int(250 * self.scale_factor)
        self.sidebar.setMinimumWidth(sidebar_width)
        self.sidebar.setMaximumWidth(sidebar_width)
        self.sidebar.setStyleSheet("background-color: #2C3E50;")
        sidebar_layout = QVBoxLayout(self.sidebar)
        
        # Logo
        logo_label = QLabel()
        logo_pixmap = QPixmap("logo.png")
        logo_size = int(100 * self.scale_factor)
        logo_label.setPixmap(logo_pixmap.scaled(logo_size, logo_size, Qt.KeepAspectRatio))
        logo_label.setAlignment(Qt.AlignCenter)
        
        # è‡ªå®šä¹‰æŒ‰é’®
        button1 = CustomButton("æŒ‰é’®1", "icon1.png", self.scale_factor)
        button2 = CustomButton("æŒ‰é’®2", "icon2.png", self.scale_factor)
        
        button1.clicked = lambda: print("Button 1 clicked")
        button2.clicked = lambda: print("Button 2 clicked")

        # æ·»åŠ åˆ°ä¾§è¾¹æ å¸ƒå±€
        sidebar_layout.addStretch(1)
        sidebar_layout.addWidget(logo_label)
        sidebar_layout.addSpacing(int(50 * self.scale_factor))
        sidebar_layout.addWidget(button1)
        sidebar_layout.addSpacing(int(20 * self.scale_factor))
        sidebar_layout.addWidget(button2)
        sidebar_layout.addStretch(1)

        # å³ä¾§ä¸»å†…å®¹åŒº
        self.content_widget = QWidget()
        self.content_widget.setStyleSheet("background-color: #ECF0F1;")
        content_layout = QVBoxLayout(self.content_widget)

        # æ ‡é¢˜æ 
        title_bar = QWidget()
        title_height = int(50 * self.scale_factor)
        title_bar.setMinimumHeight(title_height)
        title_bar.setMaximumHeight(title_height)
        title_bar.setStyleSheet("background-color: #34495E;")
        title_layout = QHBoxLayout(title_bar)
        
        # ç”¨æˆ·ä¿¡æ¯
        user_widget = QWidget()
        user_layout = QHBoxLayout(user_widget)
        
        # ç”¨æˆ·å¤´åƒ
        avatar_label = QLabel()
        avatar_pixmap = QPixmap("avatar.png")
        avatar_size = int(30 * self.scale_factor)
        avatar_label.setPixmap(avatar_pixmap.scaled(avatar_size, avatar_size, Qt.KeepAspectRatio))
        
        # ç”¨æˆ·åå’Œä¸‹æ‹‰èœå•
        username_combo = QComboBox()
        username_combo.addItems(["ç”¨æˆ·123", "é€€å‡ºç™»å½•"])
        username_combo.setStyleSheet(f"""
            QComboBox {{
                background-color: #3498DB;
                color: white;
                padding: {int(5 * self.scale_factor)}px;
                border-radius: {int(3 * self.scale_factor)}px;
                min-width: {int(100 * self.scale_factor)}px;
            }}
        """)
        
        user_layout.addWidget(avatar_label)
        user_layout.addWidget(username_combo)
        
        # çª—å£æ§åˆ¶æŒ‰é’®
        minimize_btn = QPushButton("?")
        maximize_btn = QPushButton("?")
        close_btn = QPushButton("?")
        
        control_style = f"""
            QPushButton {{
                background-color: transparent;
                color: white;
                border: none;
                font-size: {int(16 * self.scale_factor)}px;
                min-width: {int(40 * self.scale_factor)}px;
            }}
            QPushButton:hover {{
                background-color: #E74C3C;
            }}
        """
        
        for btn in (minimize_btn, maximize_btn, close_btn):
            btn.setStyleSheet(control_style)
        
        minimize_btn.clicked.connect(self.showMinimized)
        maximize_btn.clicked.connect(self.toggle_maximize)
        close_btn.clicked.connect(self.close)
        
        title_layout.addStretch(1)
        title_layout.addWidget(user_widget)
        title_layout.addWidget(minimize_btn)
        title_layout.addWidget(maximize_btn)
        title_layout.addWidget(close_btn)
        
        # ä¸»å†…å®¹åŒºåŸŸ
        main_content = QWidget()
        main_content.setStyleSheet("background-color: #ECF0F1;")
        
        content_layout.addWidget(title_bar)
        content_layout.addWidget(main_content)
        
        self.main_layout.addWidget(self.sidebar)
        self.main_layout.addWidget(self.content_widget)

    def toggle_maximize(self):
        if self.isMaximized():
            self.showNormal()
        else:
            self.showMaximized()

    def resizeEvent(self, event):
        super().resizeEvent(event)
        # ä¿æŒä¾§è¾¹æ å®½åº¦æ¯”ä¾‹
        new_width = int(250 * self.scale_factor)
        self.sidebar.setMinimumWidth(new_width)
        self.sidebar.setMaximumWidth(new_width)

if __name__ == '__main__':
    app = QApplication(sys.argv)
    window = CustomWindow()
    window.show()
    sys.exit(app.exec())














import sys
from PySide6.QtWidgets import (QApplication, QMainWindow, QWidget, QVBoxLayout, 
                              QHBoxLayout, QPushButton, QLabel, QComboBox)
from PySide6.QtCore import Qt, QSize, QRect
from PySide6.QtGui import QIcon, QPixmap, QScreen

class CustomButton(QWidget):
    """è‡ªå®šä¹‰æŒ‰é’®ç±»ï¼šæ–‡å­—åœ¨ä¸Šï¼Œå›¾æ ‡åœ¨ä¸‹"""
    def __init__(self, text, icon_path, parent=None):
        super().__init__(parent)
        
        # åˆ›å»ºå‚ç›´å¸ƒå±€
        layout = QVBoxLayout(self)
        layout.setSpacing(5)
        layout.setContentsMargins(10, 10, 10, 10)
        
        # æ–‡å­—æ ‡ç­¾
        self.text_label = QLabel(text)
        self.text_label.setAlignment(Qt.AlignCenter)
        
        # å›¾æ ‡
        self.icon_label = QLabel()
        pixmap = QPixmap(icon_path)
        self.icon_label.setPixmap(pixmap.scaled(24, 24, Qt.KeepAspectRatio))
        self.icon_label.setAlignment(Qt.AlignCenter)
        
        # æ·»åŠ åˆ°å¸ƒå±€
        layout.addWidget(self.text_label)
        layout.addWidget(self.icon_label)
        
        # è®¾ç½®æ ·å¼
        self.setStyleSheet("""
            QWidget {
                background-color: #3498DB;
                color: white;
                border-radius: 5px;
            }
            QWidget:hover {
                background-color: #2980B9;
            }
            QLabel {
                color: white;
            }
        """)
        
        # è®¾ç½®ç‚¹å‡»äº‹ä»¶
        self.clicked = lambda: None  # å ä½ç¬¦
        self.mousePressEvent = self.on_click
        
    def on_click(self, event):
        self.clicked()

class CustomWindow(QMainWindow):
    def __init__(self):
        super().__init__()

        # å»æ‰é»˜è®¤æ ‡é¢˜æ 
        self.setWindowFlags(Qt.FramelessWindowHint)
        
        # è·å–å±å¹•åˆ†è¾¨ç‡
        screen = QApplication.primaryScreen()
        screen_geometry = screen.availableGeometry()
        screen_width = screen_geometry.width()
        screen_height = screen_geometry.height()
        
        # è®¾ç½®åˆå§‹çª—å£å¤§å°ä¸ºå±å¹•çš„80%
        initial_width = int(screen_width * 0.8)
        initial_height = int(screen_height * 0.8)
        self.setGeometry(
            int((screen_width - initial_width) / 2),
            int((screen_height - initial_height) / 2),
            initial_width,
            initial_height
        )
        
        # è®¾ç½®æœ€å°çª—å£å¤§å°
        self.setMinimumSize(int(screen_width * 0.4), int(screen_height * 0.4))

        # ä¸»å¸ƒå±€
        self.main_widget = QWidget()
        self.setCentralWidget(self.main_widget)
        self.main_layout = QHBoxLayout(self.main_widget)
        self.main_layout.setContentsMargins(0, 0, 0, 0)
        self.main_layout.setSpacing(0)

        # å·¦ä¾§ä¾§è¾¹æ 
        self.sidebar = QWidget()
        self.sidebar.setMinimumWidth(200)
        self.sidebar.setMaximumWidth(int(screen_width * 0.2))
        self.sidebar.setStyleSheet("background-color: #2C3E50;")
        sidebar_layout = QVBoxLayout(self.sidebar)
        
        # Logo
        logo_label = QLabel()
        logo_pixmap = QPixmap("logo.png")  # è¯·æ›¿æ¢ä¸ºä½ çš„logoè·¯å¾„
        logo_size = min(int(screen_width * 0.08), 100)
        logo_label.setPixmap(logo_pixmap.scaled(logo_size, logo_size, Qt.KeepAspectRatio))
        logo_label.setAlignment(Qt.AlignCenter)
        
        # è‡ªå®šä¹‰æŒ‰é’®ï¼ˆæ–‡å­—åœ¨ä¸Šï¼Œå›¾æ ‡åœ¨ä¸‹ï¼‰
        button1 = CustomButton("æŒ‰é’®1", "icon1.png")  # è¯·æ›¿æ¢ä¸ºä½ çš„å›¾æ ‡è·¯å¾„
        button2 = CustomButton("æŒ‰é’®2", "icon2.png")  # è¯·æ›¿æ¢ä¸ºä½ çš„å›¾æ ‡è·¯å¾„
        
        # æ·»åŠ ç‚¹å‡»äº‹ä»¶ï¼ˆç¤ºä¾‹ï¼‰
        button1.clicked = lambda: print("Button 1 clicked")
        button2.clicked = lambda: print("Button 2 clicked")

        # æ·»åŠ åˆ°ä¾§è¾¹æ å¸ƒå±€
        sidebar_layout.addStretch(1)
        sidebar_layout.addWidget(logo_label)
        sidebar_layout.addSpacing(int(screen_height * 0.04))
        sidebar_layout.addWidget(button1)
        sidebar_layout.addSpacing(int(screen_height * 0.02))
        sidebar_layout.addWidget(button2)
        sidebar_layout.addStretch(1)

        # å³ä¾§ä¸»å†…å®¹åŒº
        self.content_widget = QWidget()
        self.content_widget.setStyleSheet("background-color: #ECF0F1;")
        content_layout = QVBoxLayout(self.content_widget)

        # æ ‡é¢˜æ 
        title_bar = QWidget()
        title_bar.setMinimumHeight(40)
        title_bar.setMaximumHeight(int(screen_height * 0.05))
        title_bar.setStyleSheet("background-color: #34495E;")
        title_layout = QHBoxLayout(title_bar)
        
        # ç”¨æˆ·ä¿¡æ¯
        user_widget = QWidget()
        user_layout = QHBoxLayout(user_widget)
        
        # ç”¨æˆ·å¤´åƒ
        avatar_label = QLabel()
        avatar_pixmap = QPixmap("avatar.png")  # è¯·æ›¿æ¢ä¸ºä½ çš„å¤´åƒè·¯å¾„
        avatar_size = int(screen_height * 0.03)
        avatar_label.setPixmap(avatar_pixmap.scaled(avatar_size, avatar_size, Qt.KeepAspectRatio))
        
        # ç”¨æˆ·åå’Œä¸‹æ‹‰èœå•
        username_combo = QComboBox()
        username_combo.addItems(["ç”¨æˆ·123", "é€€å‡ºç™»å½•"])
        username_combo.setStyleSheet("""
            QComboBox {
                background-color: #3498DB;
                color: white;
                padding: 5px;
                border-radius: 3px;
                min-width: 100px;
            }
        """)
        
        user_layout.addWidget(avatar_label)
        user_layout.addWidget(username_combo)
        
        # çª—å£æ§åˆ¶æŒ‰é’®
        minimize_btn = QPushButton("?")
        maximize_btn = QPushButton("?")
        close_btn = QPushButton("?")
        
        control_style = """
            QPushButton {
                background-color: transparent;
                color: white;
                border: none;
                font-size: 16px;
                min-width: 40px;
            }
            QPushButton:hover {
                background-color: #E74C3C;
            }
        """
        
        for btn in (minimize_btn, maximize_btn, close_btn):
            btn.setStyleSheet(control_style)
        
        # è¿æ¥æŒ‰é’®åŠŸèƒ½
        minimize_btn.clicked.connect(self.showMinimized)
        maximize_btn.clicked.connect(self.toggle_maximize)
        close_btn.clicked.connect(self.close)
        
        # æ·»åŠ åˆ°æ ‡é¢˜å¸ƒå±€
        title_layout.addStretch(1)
        title_layout.addWidget(user_widget)
        title_layout.addWidget(minimize_btn)
        title_layout.addWidget(maximize_btn)
        title_layout.addWidget(close_btn)
        
        # ä¸»å†…å®¹åŒºåŸŸ
        main_content = QWidget()
        main_content.setStyleSheet("background-color: #ECF0F1;")
        
        # æ·»åŠ åˆ°ä¸»å¸ƒå±€
        content_layout.addWidget(title_bar)
        content_layout.addWidget(main_content)
        
        # æ·»åŠ ä¾§è¾¹æ å’Œå†…å®¹åŒºåˆ°ä¸»å¸ƒå±€
        self.main_layout.addWidget(self.sidebar)
        self.main_layout.addWidget(self.content_widget)

    def toggle_maximize(self):
        if self.isMaximized():
            self.showNormal()
        else:
            self.showMaximized()

    def resizeEvent(self, event):
        super().resizeEvent(event)
        current_width = self.width()
        new_sidebar_width = max(200, min(int(current_width * 0.2), 300))
        self.sidebar.setMaximumWidth(new_sidebar_width)

if __name__ == '__main__':
    app = QApplication(sys.argv)
    window = CustomWindow()
    window.show()
    sys.exit(app.exec())










æ ¹æ®æ‚¨çš„è¦æ±‚ï¼Œæˆ‘å°†è¿›ä¸€æ­¥ä¼˜åŒ–ä»£ç ï¼Œå°† pages å­—å…¸ä» page_controllers.py ç§»åˆ°å¤–éƒ¨ JSON é…ç½®æ–‡ä»¶ï¼Œè¿›ä¸€æ­¥è§£è€¦ä»£ç å’Œé…ç½®ã€‚åŒæ—¶ï¼Œè°ƒæ•´ç™»å½•é€»è¾‘ï¼Œä½¿å…¶è°ƒç”¨ç¬¬ä¸‰æ–¹ Web é¡µé¢ï¼Œå¹¶é€šè¿‡å›è°ƒæ˜¾ç¤ºç›¸åº”å­—æ®µæ¥åˆ¤æ–­ç™»å½•æˆåŠŸã€‚ç”±äºç¬¬ä¸‰æ–¹ Web é¡µé¢æ— æ³•ç›´æ¥è·å–è¾“å…¥æ¡†å¤§å°åŠæ–‡å­—ï¼Œæˆ‘å°†å›ºå®šç™»å½•é¡µé¢å¤§å°ï¼Œå¹¶æ¨¡æ‹Ÿå›è°ƒé€»è¾‘ã€‚
ä»¥ä¸‹æ˜¯ä¼˜åŒ–åçš„å®Œæ•´ä»£ç ï¼š
æ–‡ä»¶ç»“æ„
project/
â”œâ”€â”€ views.py
â”œâ”€â”€ styles.qss
â”œâ”€â”€ main.py
â”œâ”€â”€ base_controller.py
â”œâ”€â”€ app_controller.py
â”œâ”€â”€ login_controller.py
â”œâ”€â”€ page_controllers.py
â”œâ”€â”€ base_model.py
â”œâ”€â”€ cpu_specs_model.py
â”œâ”€â”€ server_data_model.py
â”œâ”€â”€ virtualization_perf_model.py
â”œâ”€â”€ login_model.py
â”œâ”€â”€ pages_config.json
pages_config.json
json
{
    "cpu_specs": {
        "widget_class": "CPUSpecsWidget",
        "label": "CPU Specs",
        "model": "CPUSpecsModel"
    },
    "server_data": {
        "widget_class": "ServerDataWidget",
        "label": "Server Data",
        "model": "ServerDataModel"
    },
    "virtualization_perf": {
        "widget_class": "VirtualizationPerfWidget",
        "label": "Virtualization Perf",
        "model": "VirtualizationPerfModel"
    }
}
base_controller.py
python
from PySide6.QtCore import QSize
from PySide6.QtGui import QScreen
from collections import OrderedDict

DESIGN_WIDTH, DESIGN_HEIGHT = 1634, 1054
SIDEBAR_WIDTH = 200
TITLE_BAR_HEIGHT = 40

class BaseSystemController:
    def __init__(self, max_cache_size=3):
        self.max_cache_size = max_cache_size
        self.main_window = None
        self.page_cache = OrderedDict()

    def _adjust_widget_size(self, widget, is_login_widget=True):
        screen = widget.screen()
        screen_size = screen.availableSize()
        scale = min(screen_size.width() / DESIGN_WIDTH, screen_size.height() / DESIGN_HEIGHT)
        if is_login_widget:
            width = 400  # å›ºå®šç™»å½•é¡µé¢å®½åº¦
            height = 300  # å›ºå®šç™»å½•é¡µé¢é«˜åº¦
        else:
            width = screen_size.width() * (0.7 if screen_size.width() < 1600 else 0.8)
            height = screen_size.height() * (0.7 if screen_size.width() < 1600 else 0.8)
        widget.adjust_geometry(scale, width, height)
        widget.center_on_screen(screen_size.width(), screen_size.height())
        widget.scale_factor = scale

    def _switch_page(self, name):
        if name not in self.pages:
            return
        if name in self.page_cache:
            self.page_cache.move_to_end(name)
            print(f"Switched to cached page: {name}")
        else:
            if len(self.page_cache) >= self.max_cache_size:
                self._remove_oldest_page()
            widget_class, model = self.pages[name]["widget_class"], self.pages[name]["model"]
            widget = widget_class(model)
            self.page_cache[name] = widget
            widget.adjust_geometry(self.main_window.scale_factor, DESIGN_WIDTH - SIDEBAR_WIDTH, DESIGN_HEIGHT - TITLE_BAR_HEIGHT)
            self.main_window.content_stack.addWidget(widget)
            self._connect_page_signals(widget)
            print(f"Created and switched to page: {name}")
        self.main_window.content_stack.setCurrentWidget(self.page_cache[name])

    def _remove_oldest_page(self):
        name, widget = self.page_cache.popitem(last=False)
        self.main_window.content_stack.removeWidget(widget)
        widget.deleteLater()
        print(f"Removed oldest page: {name}")

    def _connect_page_signals(self, widget):
        pass  # å­ç±»å®ç°
app_controller.py
python
from PySide6.QtWidgets import QMessageBox
from PySide6.QtCore import Slot
from base_controller import BaseSystemController
from views import MainWindow, LoginWidget
from login_controller import LoginController
from page_controllers import PageController
import json

class AppController(BaseSystemController):
    def __init__(self, max_cache_size=3):
        super().__init__(max_cache_size)
        self.login_controller = LoginController(LoginWidget, self.max_cache_size)
        with open("pages_config.json", "r") as f:
            pages_config = json.load(f)
        self.page_controller = PageController(self, pages_config, self.max_cache_size)
        self.pages = self.page_controller.pages
        self.login_controller.login_signal.connect(self._on_login)

    @Slot(str, str)
    def _on_login(self, username, password):
        if self.login_controller.validate_login(username, password):
            self.main_window = MainWindow(username, self.pages)
            self._adjust_widget_size(self.main_window, is_login_widget=False)
            self.main_window.logout_btn.clicked.connect(self._on_logout)
            self.main_window.clear_cache_btn.clicked.connect(self._clear_all_pages)
            self.page_controller.register_pages(self.main_window)
            self.main_window.show()
        else:
            QMessageBox.warning(self.login_controller.login_widget, "Login Failed", "Invalid username or password")

    @Slot()
    def _on_logout(self):
        self.main_window.hide()
        self.login_controller.show_login()

    @Slot()
    def _clear_all_pages(self):
        while self.page_cache:
            self._remove_oldest_page()
        QMessageBox.information(self.main_window, "Cache Cleared", "All cached pages have been destroyed.")

    def _connect_page_signals(self, widget):
        self.page_controller.connect_signals(widget)

    def start(self):
        self.login_controller.start()
login_controller.py
python
from PySide6.QtCore import Signal, Slot
from base_controller import BaseSystemController
from login_model import LoginModel
from PySide6.QtWebEngineWidgets import QWebEngineView
from PySide6.QtCore import QUrl

class LoginController(BaseSystemController):
    login_signal = Signal(str, str)  # å•ä¸€ä¿¡å·

    def __init__(self, login_widget_class, max_cache_size=3):
        super().__init__(max_cache_size)
        self.login_widget_class = login_widget_class
        self.login_model = LoginModel()
        self.login_widget = None
        self._init_login_widget()

    def _init_login_widget(self):
        self.login_widget = self.login_widget_class()
        self._adjust_widget_size(self.login_widget)
        self.login_widget.web_view.load(QUrl("https://example.com/login"))  # ç¬¬ä¸‰æ–¹ç™»å½•é¡µé¢
        self.login_widget.web_view.urlChanged.connect(self._on_url_changed)

    @Slot(QUrl)
    def _on_url_changed(self, url):
        # æ¨¡æ‹Ÿå›è°ƒï¼šå‡è®¾ç¬¬ä¸‰æ–¹é¡µé¢é‡å®šå‘åˆ°å¸¦æœ‰ç”¨æˆ·ä¿¡æ¯çš„ URL
        url_str = url.toString()
        if "callback" in url_str:  # å‡è®¾å›è°ƒ URL åŒ…å« "callback" å’Œå‚æ•°
            # è§£æ URL ä¸­çš„å‚æ•°ï¼ˆç¤ºä¾‹ï¼‰
            params = dict(param.split("=") for param in url_str.split("?")[1].split("&"))
            username = params.get("username", "")
            token = params.get("token", "")
            self.login_signal.emit(username, token)

    def validate_login(self, username, password):
        # å‡è®¾ password æ˜¯ tokenï¼ŒéªŒè¯é€»è¾‘äº¤ç»™ login_model
        return self.login_model.validate_login(username, password)

    def start(self):
        self.login_widget.show()

    @Slot()
    def show_login(self):
        self.login_widget.show()
page_controllers.py
python
from PySide6.QtCore import Slot
from base_controller import BaseSystemController
from views import CPUSpecsWidget, ServerDataWidget, VirtualizationPerfWidget
from cpu_specs_model import CPUSpecsModel
from server_data_model import ServerDataModel
from virtualization_perf_model import VirtualizationPerfModel

class PageController(BaseSystemController):
    def __init__(self, parent_controller, pages_config, max_cache_size=3):
        super().__init__(max_cache_size)
        self.parent_controller = parent_controller
        self.pages = self._load_pages(pages_config)

    def _load_pages(self, pages_config):
        widget_map = {
            "CPUSpecsWidget": CPUSpecsWidget,
            "ServerDataWidget": ServerDataWidget,
            "VirtualizationPerfWidget": VirtualizationPerfWidget
        }
        model_map = {
            "CPUSpecsModel": CPUSpecsModel,
            "ServerDataModel": ServerDataModel,
            "VirtualizationPerfModel": VirtualizationPerfModel
        }
        pages = {}
        for name, config in pages_config.items():
            pages[name] = {
                "widget_class": widget_map[config["widget_class"]],
                "label": config["label"],
                "model": model_map[config["model"]]()
            }
        return pages

    def register_pages(self, main_window):
        self.main_window = main_window
        for name, config in self.pages.items():
            button = main_window.page_buttons[name]
            button.clicked.connect(lambda n=name: self._switch_page(n))

    def connect_signals(self, widget):
        widget.query_signal.connect(widget.update_table)
        widget.clear_signal.connect(widget.clear_table)
        if isinstance(widget, ServerDataWidget):
            widget.modify_signal.connect(self._modify_server_data)

    @Slot(str, int, str, str)
    def _modify_server_data(self, cpu_model, row, key, text):
        model = self.pages["server_data"]["model"]
        model.update_data(cpu_model, key, f"{text} ({model.get_data(cpu_model)[key].split(' (')[0]})")
        widget = self.main_window.content_stack.currentWidget()
        if widget:
            widget.update_table()
        print(f"Row {row} modified: {key} = {model.get_data(cpu_model)[key]}")
views.py
python
from PySide6.QtWidgets import (QMainWindow, QWidget, QComboBox, QPushButton, QTableWidget, 
                               QTableWidgetItem, QLabel, QLineEdit, QFrame, QStackedWidget)
from PySide6.QtCore import Qt, Signal, Slot, QTimer
from PySide6.QtGui import QIcon
from PySide6.QtWebEngineWidgets import QWebEngineView

DESIGN_WIDTH, DESIGN_HEIGHT = 1634, 1054
TITLE_BAR_HEIGHT = 40
SIDEBAR_WIDTH = 200
CONTENT_TOP_MARGIN = 40
DROPDOWN_X, DROPDOWN_BASE_Y = 138, 84
DROPDOWN_SPACING = 40
BUTTON_QUERY_X, BUTTON_CLEAR_X, BUTTON_ADD_X, BUTTON_REMOVE_X = 400, 500, 600, 640
BUTTON_Y_OFFSET = 0
TABLE_X, TABLE_Y = 138, 180
TABLE_WIDTH, TABLE_HEIGHT = 1200, 800
SIDEBAR_BUTTON_X = 10
SIDEBAR_BUTTON_Y_START, SIDEBAR_BUTTON_SPACING = 100, 50

class LoginWidget(QWidget):
    login_signal = Signal(str, str)

    def __init__(self):
        super().__init__()
        self.web_view = QWebEngineView(self)
        self.web_view.setFixedSize(400, 300)  # å›ºå®šå¤§å°

    def adjust_geometry(self, scale, parent_width, parent_height):
        self.resize(400, 300)  # å›ºå®šå¤§å°ï¼Œä¸éš scale å˜åŒ–
        self.web_view.move(0, 0)

    def center_on_screen(self, screen_width, screen_height):
        x = (screen_width - self.width()) // 2
        y = (screen_height - self.height()) // 2
        self.move(x, y)

class MainWindow(QMainWindow):
    def __init__(self, username, pages_config):
        super().__init__()
        self.setWindowTitle("Information Query System")
        self.username = username
        self.central_widget = QWidget(self)
        self.setCentralWidget(self.central_widget)

        self.title_bar = QWidget(self.central_widget)
        self.title_bar.setObjectName("titleBar")
        self.logo_label = QLabel("Logo", self.title_bar)
        self.logo_label.setObjectName("titleLabel")
        self.user_label = QLabel(f"User: {self.username}", self.title_bar)
        self.user_label.setObjectName("titleLabel")
        self.logout_btn = QPushButton("Logout", self.title_bar)
        self.logout_btn.setObjectName("logoutButton")

        self.sidebar = QFrame(self.central_widget)
        self.sidebar.setObjectName("sidebar")
        self.page_buttons = {}
        for i, (name, config) in enumerate(pages_config.items()):
            button = QPushButton(config["label"], self.sidebar)
            button.setObjectName("sidebarButton")
            button.move(int(SIDEBAR_BUTTON_X * 1.0), int(SIDEBAR_BUTTON_Y_START + i * SIDEBAR_BUTTON_SPACING))
            self.page_buttons[name] = button
        self.clear_cache_btn = QPushButton("Clear Cache", self.sidebar)
        self.clear_cache_btn.setObjectName("sidebarButton")

        self.content_stack = QStackedWidget(self.central_widget)

    def adjust_geometry(self, scale, parent_width, parent_height):
        window_width = int(DESIGN_WIDTH * scale)
        window_height = int(DESIGN_HEIGHT * scale)
        self.resize(window_width, window_height)

        self.title_bar.move(0, 0)
        self.title_bar.resize(window_width, int(TITLE_BAR_HEIGHT * scale))
        self.logo_label.move(int(10 * scale), int(10 * scale))
        self.user_label.move(int((DESIGN_WIDTH - 234) * scale), int(10 * scale))
        self.logout_btn.move(int((DESIGN_WIDTH - 84) * scale), int(5 * scale))

        sidebar_width = int(SIDEBAR_WIDTH * scale)
        self.sidebar.move(0, int(TITLE_BAR_HEIGHT * scale))
        self.sidebar.resize(sidebar_width, int((DESIGN_HEIGHT - TITLE_BAR_HEIGHT) * scale))
        for i, button in enumerate(self.page_buttons.values()):
            button.move(int(SIDEBAR_BUTTON_X * scale), int((SIDEBAR_BUTTON_Y_START + i * SIDEBAR_BUTTON_SPACING) * scale))
        self.clear_cache_btn.move(int(SIDEBAR_BUTTON_X * scale), int((SIDEBAR_BUTTON_Y_START + len(self.page_buttons) * SIDEBAR_BUTTON_SPACING) * scale))

        self.content_stack.move(sidebar_width, int(TITLE_BAR_HEIGHT * scale))
        self.content_stack.resize(int((DESIGN_WIDTH - SIDEBAR_WIDTH) * scale), int((DESIGN_HEIGHT - TITLE_BAR_HEIGHT) * scale))

    def center_on_screen(self, screen_width, screen_height):
        x = (screen_width - self.width()) // 2
        y = (screen_height - self.height()) // 2
        self.move(x, y)

class BaseQueryWidget(QWidget):
    query_signal = Signal(str)
    clear_signal = Signal()
    modify_signal = Signal(str, int, str, str)

    def __init__(self, model, column_count=2, headers=["Property", "Value"]):
        super().__init__()
        self.model = model
        self.column_count = column_count
        self.headers = headers
        self.init_ui()

    def init_ui(self):
        self.cpu_combo = QComboBox(self)
        self.cpu_combo.addItems(self.model.cpu_models if hasattr(self.model, 'cpu_models') else ["Unknown"])
        self.cpu_combo.setObjectName("dropdown")
        self.query_btn = QPushButton("Query", self)
        self.query_btn.setObjectName("actionButton")
        self.query_btn.clicked.connect(lambda: self.query_signal.emit(self.cpu_combo.currentText()))
        self.clear_btn = QPushButton("Clear", self)
        self.clear_btn.setObjectName("actionButton")
        self.clear_btn.clicked.connect(self.clear_signal)
        self.table = QTableWidget(self)
        self.table.setObjectName("dataTable")
        self.table.setColumnCount(self.column_count)
        self.table.setHorizontalHeaderLabels(self.headers)
        self.table.horizontalHeader().setStretchLastSection(True)

    def adjust_geometry(self, scale, parent_width, parent_height):
        self.cpu_combo.move(int(DROPDOWN_X * scale), int(DROPDOWN_BASE_Y * scale))
        self.query_btn.move(int(BUTTON_QUERY_X * scale), int(DROPDOWN_BASE_Y + BUTTON_Y_OFFSET * scale))
        self.clear_btn.move(int(BUTTON_CLEAR_X * scale), int(DROPDOWN_BASE_Y + BUTTON_Y_OFFSET * scale))
        self.table.move(int(TABLE_X * scale), int(TABLE_Y * scale))
        self.table.resize(int(TABLE_WIDTH * scale), int(TABLE_HEIGHT * scale))

    def update_table(self, cpu_model=None):
        QTimer.singleShot(0, lambda: self._update_table_async(cpu_model))

    def _update_table_async(self, cpu_model=None):
        pass

    def clear_table(self):
        self.table.setRowCount(0)

class CPUSpecsWidget(BaseQueryWidget):
    def __init__(self, model):
        super().__init__(model, column_count=2, headers=["Property", "Value"])
        self.combos = []
        self.add_btn = QPushButton("+", self)
        self.add_btn.setObjectName("actionButton")
        self.add_btn.clicked.connect(self.add_combo)
        self.remove_btn = QPushButton("-", self)
        self.remove_btn.setObjectName("actionButton")
        self.remove_btn.clicked.connect(self.remove_combo)
        for _ in range(5):
            self.add_combo()

    def adjust_geometry(self, scale, parent_width, parent_height):
        super().adjust_geometry(scale, parent_width, parent_height)
        self.add_btn.move(int(BUTTON_ADD_X * scale), int(DROPDOWN_BASE_Y + BUTTON_Y_OFFSET * scale))
        self.remove_btn.move(int(BUTTON_REMOVE_X * scale), int(DROPDOWN_BASE_Y + BUTTON_Y_OFFSET * scale))
        for i, combo in enumerate(self.combos):
            combo.move(int(DROPDOWN_X * scale), int(DROPDOWN_BASE_Y * scale + i * DROPDOWN_SPACING * scale))

    def add_combo(self):
        combo = QComboBox(self)
        combo.addItems(self.model.cpu_models)
        combo.setObjectName("dropdown")
        combo.currentTextChanged.connect(lambda text: self.query_signal.emit(text))
        combo.show()
        self.combos.append(combo)
        self.adjust_geometry(self.scale_factor if hasattr(self, 'scale_factor') else 1.0, DESIGN_WIDTH - SIDEBAR_WIDTH, DESIGN_HEIGHT - TITLE_BAR_HEIGHT)

    def remove_combo(self):
        if len(self.combos) > 1:
            combo = self.combos.pop()
            combo.deleteLater()
            self.table.clearContents()
            self.adjust_geometry(self.scale_factor if hasattr(self, 'scale_factor') else 1.0, DESIGN_WIDTH - SIDEBAR_WIDTH, DESIGN_HEIGHT - TITLE_BAR_HEIGHT)

    def _update_table_async(self, cpu_model=None):
        if cpu_model is None:
            cpu_model = self.cpu_combo.currentText()
        specs = self.model.get_data(cpu_model)
        self.table.setRowCount(len(specs))
        for i, (key, value) in enumerate(specs.items()):
            self.table.setItem(i, 0, QTableWidgetItem(key))
            self.table.setItem(i, 1, QTableWidgetItem(str(value)))
        self.table.resizeColumnsToContents()

class ServerDataWidget(BaseQueryWidget):
    def __init__(self, model):
        super().__init__(model, column_count=4, headers=["Property", "Value", "Modify", "Link"])
        self.extra_combo = QComboBox(self)
        self.extra_combo.addItems(["Option1", "Option2"])
        self.extra_combo.setObjectName("dropdown")

    def adjust_geometry(self, scale, parent_width, parent_height):
        super().adjust_geometry(scale, parent_width, parent_height)
        self.extra_combo.move(int(DROPDOWN_X * scale), int((DROPDOWN_BASE_Y - 40) * scale))

    def _update_table_async(self, cpu_model=None):
        if cpu_model is None:
            cpu_model = self.cpu_combo.currentText()
        data = self.model.get_data(cpu_model)
        self.table.setRowCount(len(data))
        modify_values = {}
        for row in range(self.table.rowCount()):
            combo = self.table.cellWidget(row, 2)
            if combo:
                modify_values[row] = combo.currentText()

        for i, (key, value) in enumerate(data.items()):
            self.table.setItem(i, 0, QTableWidgetItem(key))
            self.table.setItem(i, 1, QTableWidgetItem(value))
            combo = QComboBox()
            combo.addItems(["Low", "Medium", "High"])
            combo.setCurrentText(modify_values.get(i, "Medium"))
            combo.currentTextChanged.connect(lambda text, r=i, k=key: self.modify_signal.emit(cpu_model, r, k, text))
            self.table.setCellWidget(i, 2, combo)
            btn = QPushButton("Link")
            btn.setObjectName("linkButton")
            btn.clicked.connect(self.open_link)
            self.table.setCellWidget(i, 3, btn)
        self.table.resizeColumnsToContents()

    def open_link(self):
        from PySide6.QtGui import QDesktopServices, QUrl
        QDesktopServices.openUrl(QUrl("https://www.example.com"))
        print("Opening example homepage")

class VirtualizationPerfWidget(BaseQueryWidget):
    def __init__(self, model):
        super().__init__(model, column_count=2, headers=["Property", "Value"])

    def _update_table_async(self, cpu_model=None):
        if cpu_model is None:
            cpu_model = self.cpu_combo.currentText()
        data = self.model.get_data(cpu_model)
        self.table.setRowCount(len(data))
        for i, (key, value) in enumerate(data.items()):
            self.table.setItem(i, 0, QTableWidgetItem(key))
            self.table.setItem(i, 1, QTableWidgetItem(str(value)))
        self.table.resizeColumnsToContents()
main.py
python
from PySide6.QtWidgets import QApplication
from PySide6.QtCore import Qt, QFile, QTextStream
from PySide6.QtGui import QFont
from app_controller import AppController

def load_stylesheet(app, filename="styles.qss"):
    file = QFile(filename)
    if file.open(QFile.ReadOnly | QFile.Text):
        stream = QTextStream(file)
        app.setStyleSheet(stream.readAll())
        file.close()

if __name__ == "__main__":
    QApplication.setAttribute(Qt.AA_EnableHighDpiScaling)
    QApplication.setAttribute(Qt.AA_UseHighDpiPixmaps)

    app = QApplication(sys.argv)
    
    font = QFont("Arial", 10)
    app.setFont(font)
    
    load_stylesheet(app, "styles.qss")
    
    app_controller = AppController(max_cache_size=3)
    app_controller.start()
    
    sys.exit(app.exec())
base_model.py
python
class BaseModel:
    def __init__(self):
        pass

    def get_data(self, key):
        raise NotImplementedError("Subclasses must implement get_data")
cpu_specs_model.py
python
from base_model import BaseModel

class CPUSpecsModel(BaseModel):
    def __init__(self):
        self.cpu_models = ["Intel i5", "Intel i7", "AMD Ryzen 5", "AMD Ryzen 7"]
        self.specs = {
            "Intel i5": {"Cores": 4, "Threads": 8, "Clock Speed": "3.2 GHz"},
            "Intel i7": {"Cores": 6, "Threads": 12, "Clock Speed": "3.8 GHz"},
            "AMD Ryzen 5": {"Cores": 6, "Threads": 12, "Clock Speed": "3.6 GHz"},
            "AMD Ryzen 7": {"Cores": 8, "Threads": 16, "Clock Speed": "4.0 GHz"}
        }

    def get_data(self, cpu_model):
        return self.specs.get(cpu_model, {})
server_data_model.py
python
from base_model import BaseModel

class ServerDataModel(BaseModel):
    def __init__(self):
        self.server_data = {
            "Intel i5": {"CPU Usage": "Medium (45%)", "Memory": "16 GB", "Uptime": "48 hours"},
            "Intel i7": {"CPU Usage": "High (70%)", "Memory": "32 GB", "Uptime": "72 hours"},
            "AMD Ryzen 5": {"CPU Usage": "Low (30%)", "Memory": "16 GB", "Uptime": "24 hours"},
            "AMD Ryzen 7": {"CPU Usage": "Medium (50%)", "Memory": "64 GB", "Uptime": "96 hours"}
        }

    def get_data(self, cpu_model):
        return self.server_data.get(cpu_model, {})

    def update_data(self, cpu_model, key, value):
        if cpu_model in self.server_data:
            self.server_data[cpu_model][key] = value
virtualization_perf_model.py
python
from base_model import BaseModel

class VirtualizationPerfModel(BaseModel):
    def __init__(self):
        self.virtualization_data = {
            "Intel i5": {"VM Count": 5, "Latency": "20 ms"},
            "Intel i7": {"VM Count": 8, "Latency": "15 ms"},
            "AMD Ryzen 5": {"VM Count": 6, "Latency": "18 ms"},
            "AMD Ryzen 7": {"VM Count": 10, "Latency": "12 ms"}
        }

    def get_data(self, cpu_model):
        return self.virtualization_data.get(cpu_model, {})
login_model.py
python
from base_model import BaseModel

class LoginModel(BaseModel):
    def __init__(self):
        self.users = {"admin": "123456"}

    def validate_login(self, username, password):
        return self.users.get(username) == password
styles.qss
css
/* ç¤ºä¾‹æ ·å¼ */
QWidget#titleBar {
    background-color: #333;
    color: white;
}
QPushButton#loginButton, QPushButton#logoutButton, QPushButton#sidebarButton, QPushButton#actionButton {
    background-color: #4CAF50;
    color: white;
    border: none;
    padding: 5px;
}
QPushButton#loginButton:hover, QPushButton#logoutButton:hover, QPushButton#sidebarButton:hover, QPushButton#actionButton:hover {
    background-color: #45a049;
}
QLineEdit#loginInput {
    padding: 5px;
    border: 1px solid #ccc;
}
QTableWidget#dataTable {
    border: 1px solid #ccc;
}
QFrame#sidebar {
    background-color: #f0f0f0;
}
ä¼˜åŒ–ç»†èŠ‚
1. å°† pages ç§»åˆ° JSON é…ç½®æ–‡ä»¶
ä¹‹å‰ï¼š
pages å­—å…¸ç¡¬ç¼–ç åœ¨ page_controllers.py ä¸­ï¼š
python
self.pages = {
    "cpu_specs": {"widget_class": CPUSpecsWidget, "label": "CPU Specs", "model": CPUSpecsModel()}
}
ç°åœ¨ï¼š
ç§»åˆ° pages_config.jsonï¼ŒPageController é€šè¿‡ _load_pages è¯»å–ï¼š
python
def _load_pages(self, pages_config):
    widget_map = {
        "CPUSpecsWidget": CPUSpecsWidget,
        "ServerDataWidget": ServerDataWidget,
        "VirtualizationPerfWidget": VirtualizationPerfWidget
    }
    model_map = {
        "CPUSpecsModel": CPUSpecsModel,
        "ServerDataModel": ServerDataModel,
        "VirtualizationPerfModel": VirtualizationPerfModel
    }
    pages = {}
    for name, config in pages_config.items():
        pages[name] = {
            "widget_class": widget_map[config["widget_class"]],
            "label": config["label"],
            "model": model_map[config["model"]]()
        }
    return pages
AppController ä»æ–‡ä»¶ä¸­åŠ è½½ï¼š
python
with open("pages_config.json", "r") as f:
    pages_config = json.load(f)
self.page_controller = PageController(self, pages_config, self.max_cache_size)
å¥½å¤„ï¼š
é…ç½®ä¸ä»£ç åˆ†ç¦»ï¼Œæ–°å¢é¡µé¢åªéœ€ä¿®æ”¹ JSON æ–‡ä»¶ï¼Œæ— éœ€æ”¹åŠ¨ä»£ç ã€‚
æé«˜çµæ´»æ€§ï¼Œæ˜“äºç»´æŠ¤ã€‚
2. ç¬¬ä¸‰æ–¹ Web ç™»å½•é¡µé¢
ä¹‹å‰ï¼š
ä½¿ç”¨æœ¬åœ° QLineEdit è¾“å…¥ç”¨æˆ·åå’Œå¯†ç ã€‚
ç°åœ¨ï¼š
ä½¿ç”¨ QWebEngineView åŠ è½½ç¬¬ä¸‰æ–¹ç™»å½•é¡µé¢ï¼š
python
self.web_view = QWebEngineView(self)
self.web_view.setFixedSize(400, 300)
self.web_view.load(QUrl("https://example.com/login"))
é€šè¿‡ URL å›è°ƒæ¨¡æ‹Ÿç™»å½•æˆåŠŸï¼š
python
@Slot(QUrl)
def _on_url_changed(self, url):
    url_str = url.toString()
    if "callback" in url_str:
        params = dict(param.split("=") for param in url_str.split("?")[1].split("&"))
        username = params.get("username", "")
        token = params.get("token", "")
        self.login_signal.emit(username, token)
å›ºå®šå¤§å°ï¼š
python
def _adjust_widget_size(self, widget, is_login_widget=True):
    if is_login_widget:
        width = 400  # å›ºå®šå®½åº¦
        height = 300  # å›ºå®šé«˜åº¦
python
def adjust_geometry(self, scale, parent_width, parent_height):
    self.resize(400, 300)  # ä¸éš scale å˜åŒ–
å‡è®¾ï¼š
ç¬¬ä¸‰æ–¹é¡µé¢é‡å®šå‘åˆ°ç±»ä¼¼ https://example.com/callback?username=admin&token=123456 çš„ URLã€‚
LoginModel.validate_login éªŒè¯ username å’Œ tokenï¼ˆè¿™é‡Œä»ä½¿ç”¨åŸæœ‰é€»è¾‘ï¼Œå®é™…éœ€é€‚é…ç¬¬ä¸‰æ–¹è®¤è¯ï¼‰ã€‚
å¥½å¤„ï¼š
æ¨¡æ‹ŸçœŸå®ç¬¬ä¸‰æ–¹ç™»å½•åœºæ™¯ï¼Œæ§åˆ¶å™¨æ— éœ€ç›´æ¥å¤„ç†è¾“å…¥æ¡†ã€‚
å›ºå®šå¤§å°é€‚åº” Web è§†å›¾ï¼Œé¿å…åŠ¨æ€è°ƒæ•´é—®é¢˜ã€‚
æµ‹è¯•æ­¥éª¤
ä¿å­˜æ‰€æœ‰æ–‡ä»¶ï¼Œç¡®ä¿ pages_config.json åœ¨é¡¹ç›®ç›®å½•ä¸‹ã€‚
è¿è¡Œ main.pyï¼Œæ˜¾ç¤ºç¬¬ä¸‰æ–¹ç™»å½•é¡µé¢ï¼ˆç¤ºä¾‹ä½¿ç”¨ https://example.com/loginï¼‰ã€‚
æ¨¡æ‹Ÿå›è°ƒï¼š
æ‰‹åŠ¨åœ¨æµè§ˆå™¨è®¿é—®ç±»ä¼¼ https://example.com/callback?username=admin&token=123456ï¼Œæˆ–ä¿®æ”¹ä»£ç æ¨¡æ‹Ÿï¼š
python
self.login_widget.web_view.load(QUrl("https://example.com/callback?username=admin&token=123456"))
ç¡®è®¤ä¸»çª—å£æ˜¾ç¤ºï¼Œä¾§è¾¹æ ç”Ÿæˆ 3 ä¸ªæŒ‰é’®ã€‚
éªŒè¯åŠŸèƒ½ï¼š
ç‚¹å‡»æŒ‰é’®ï¼Œåˆ‡æ¢é¡µé¢ï¼š
cpu_specs æ˜¾ç¤º CPU è§„æ ¼ã€‚
server_data æ˜¾ç¤ºå¹¶å¯ä¿®æ”¹æœåŠ¡å™¨æ•°æ®ã€‚
virtualization_perf æ˜¾ç¤ºè™šæ‹ŸåŒ–æ€§èƒ½ã€‚
ç‚¹å‡»é€€å‡ºï¼Œä¸»çª—å£éšè—ï¼Œç™»å½•é¡µé¢é‡æ–°æ˜¾ç¤ºã€‚
æµ‹è¯•æ‰©å±•æ€§ï¼š
åœ¨ pages_config.json æ·»åŠ æ–°é¡µé¢ï¼š
json
"network": {
    "widget_class": "NetworkWidget",
    "label": "Network",
    "model": "NetworkModel"
}
æ›´æ–° widget_map å’Œ model_mapï¼Œç¡®è®¤æ–°æŒ‰é’®å’Œé¡µé¢åŠ è½½ã€‚
ç¤ºä¾‹è¾“å‡º
# æ¨¡æ‹Ÿå›è°ƒ
Created and switched to page: cpu_specs  # ç™»å½•æˆåŠŸåæ˜¾ç¤º Intel i5 è§„æ ¼
Switched to cached page: server_data  # ç‚¹å‡» Server Data æŒ‰é’®
Row 0 modified: CPU Usage = High (45%)

# å¤±è´¥æƒ…å†µ
# å¼¹å‡º "Login Failed" æç¤ºï¼ˆéœ€ç¬¬ä¸‰æ–¹è¿”å›é”™è¯¯ URLï¼‰
ä¼˜åŒ–äº®ç‚¹
é…ç½®æ–‡ä»¶ï¼š
pages ç§»åˆ° pages_config.jsonï¼Œä»£ç ä¸é…ç½®è§£è€¦ï¼Œæ‰©å±•åªéœ€ä¿®æ”¹ JSONã€‚
ç¬¬ä¸‰æ–¹ç™»å½•ï¼š
ä½¿ç”¨ QWebEngineView åŠ è½½ Web é¡µé¢ï¼Œé€šè¿‡å›è°ƒè·å–ç”¨æˆ·ä¿¡æ¯ï¼Œé€‚åº”çœŸå®åœºæ™¯ã€‚
å›ºå®šå¤§å°ï¼ˆ400x300ï¼‰ï¼Œé¿å…æ— æ³•è·å–è¾“å…¥æ¡†çš„é—®é¢˜ã€‚
ç®€æ´æ€§ï¼š
åŠ¨æ€æŒ‰é’®å’Œå•ä¸€ä¿¡å·ä¿æŒï¼Œä»£ç ç»“æ„æ¸…æ™°ã€‚
æ³¨æ„äº‹é¡¹
ç¬¬ä¸‰æ–¹ URLï¼šå½“å‰ä½¿ç”¨ https://example.com/login ä»…ä¸ºç¤ºä¾‹ï¼Œéœ€æ›¿æ¢ä¸ºå®é™…ç™»å½•é¡µé¢ URLã€‚
å›è°ƒè§£æï¼š_on_url_changed ä¸­çš„å‚æ•°è§£ææ˜¯ç®€åŒ–çš„ï¼Œå®é™…éœ€æ ¹æ®ç¬¬ä¸‰æ–¹ API è°ƒæ•´ã€‚
æ–°é¡µé¢æ”¯æŒï¼šæ·»åŠ æ–°é¡µé¢éœ€ç¡®ä¿ widget_map å’Œ model_map åŒ…å«å¯¹åº”ç±»ã€‚
å¦‚æœæ‚¨å¯¹å½“å‰ç‰ˆæœ¬æœ‰ä»»ä½•æ„è§æˆ–éœ€è¦è¿›ä¸€æ­¥è°ƒæ•´ï¼ˆå¦‚ç§»é™¤æ›´å¤šç»§æ‰¿æˆ–é€‚é…å…·ä½“ç¬¬ä¸‰æ–¹ APIï¼‰ï¼Œè¯·å‘Šè¯‰æˆ‘ï¼















å½“å‰ä»£ç ä¸­å¸ƒå±€åæ ‡ï¼ˆå¦‚ x=138, y=124 ç­‰ï¼‰ç›´æ¥ç¡¬ç¼–ç åœ¨ move å’Œ resize ä¸­ï¼Œç¡®å®ä¸ä¾¿äºç»´æŠ¤ï¼Œä¸”å˜é‡å«ä¹‰å®¹æ˜“æ··æ·†ã€‚ä¸ºäº†ä¼˜åŒ–å¸ƒå±€åæ ‡ï¼Œæˆ‘å°†ï¼š
å®šä¹‰å¸¸é‡ï¼šå°†æ‰€æœ‰å…³é”®åæ ‡å’Œå°ºå¯¸æå–ä¸ºå‘½åå¸¸é‡ï¼Œä¾¿äºç†è§£å’Œç»´æŠ¤ã€‚
ç»“æ„åŒ–å¸ƒå±€ï¼šå°†å¸ƒå±€å‚æ•°åˆ†ç»„ï¼ˆå¦‚æ ‡é¢˜æ ã€ä¾§è¾¹æ ã€å†…å®¹åŒºï¼‰ï¼Œæé«˜å¯è¯»æ€§ã€‚
åŠ¨æ€è®¡ç®—ï¼šå‡å°‘ç¡¬ç¼–ç ï¼Œä½¿ç”¨ç›¸å¯¹åç§»å’Œæ¯”ä¾‹ï¼Œä¾¿äºè°ƒæ•´ã€‚
ä»¥ä¸‹æ˜¯ä¼˜åŒ–åçš„ä»£ç ï¼Œé‡ç‚¹æ”¹è¿› views.py ä¸­çš„å¸ƒå±€ç®¡ç†ï¼š
ä¼˜åŒ–åçš„å®Œæ•´ä»£ç 
model.py å’Œ styles.qss
ï¼ˆä¿æŒä¸å˜ï¼Œç•¥ï¼‰
views.py
python
from PySide6.QtWidgets import (QMainWindow, QWidget, QComboBox, QPushButton, QTableWidget, 
                               QTableWidgetItem, QLabel, QLineEdit, QMessageBox)
from PySide6.QtCore import Qt, Signal, Slot, QTimer
from PySide6.QtGui import QIcon

# è®¾è®¡åˆ†è¾¨ç‡å’Œå¸ƒå±€å¸¸é‡
DESIGN_WIDTH, DESIGN_HEIGHT = 1634, 1054
TITLE_BAR_HEIGHT = 40
SIDEBAR_WIDTH = 200
CONTENT_OFFSET_X = SIDEBAR_WIDTH  # å†…å®¹åŒºç›¸å¯¹çª—å£å·¦è¾¹çš„åç§»

# ç™»å½•çª—å£å¸ƒå±€å‚æ•°
LOGIN_DESIGN_WIDTH, LOGIN_DESIGN_HEIGHT = 400, 300
LOGIN_INPUT_X, LOGIN_INPUT_WIDTH = 80, 240
LOGIN_USERNAME_Y, LOGIN_PASSWORD_Y = 80, 140
LOGIN_BUTTON_X, LOGIN_BUTTON_Y, LOGIN_BUTTON_WIDTH = 160, 200, 80
INPUT_HEIGHT, BUTTON_HEIGHT = 32, 32

# å†…å®¹åŒºå¸ƒå±€å‚æ•°
CONTENT_TOP_MARGIN = 40  # å†…å®¹åŒºé¡¶éƒ¨ä¸æ ‡é¢˜æ çš„é—´è·
DROPDOWN_X, DROPDOWN_BASE_Y, DROPDOWN_WIDTH = 138, 84, 240  # ä¸‹æ‹‰æ¡†åŸºç¡€ä½ç½®å’Œå®½åº¦
DROPDOWN_SPACING = 40  # å¤šä¸‹æ‹‰æ¡†é—´è·
BUTTON_QUERY_X, BUTTON_CLEAR_X, BUTTON_ADD_X, BUTTON_REMOVE_X = 400, 500, 600, 640
BUTTON_Y_OFFSET = 0  # æŒ‰é’®ä¸ä¸‹æ‹‰æ¡†çš„ Y åç§»
BUTTON_WIDTH, BUTTON_SMALL_WIDTH = 80, 32
TABLE_X, TABLE_Y, TABLE_WIDTH, TABLE_HEIGHT = 138, 180, 1200, 800

# ä¾§è¾¹æ æŒ‰é’®å¸ƒå±€å‚æ•°
SIDEBAR_BUTTON_X, SIDEBAR_BUTTON_WIDTH = 10, 180
SIDEBAR_BUTTON_Y_START, SIDEBAR_BUTTON_SPACING = 100, 50

class LoginWidget(QWidget):
    login_signal = Signal(str, str)

    def __init__(self):
        super().__init__()
        self.username_input = QLineEdit(self)
        self.username_input.setPlaceholderText("Username")
        self.password_input = QLineEdit(self)
        self.password_input.setPlaceholderText("Password")
        self.password_input.setEchoMode(QLineEdit.Password)
        self.login_btn = QPushButton("Login", self)
        self.login_btn.setObjectName("loginButton")

    def adjust_geometry(self, scale, parent_width, parent_height):
        """è°ƒæ•´æ§ä»¶ä½ç½®ï¼Œç›¸å¯¹äºçª—å£"""
        self.resize(int(LOGIN_DESIGN_WIDTH * scale), int(LOGIN_DESIGN_HEIGHT * scale))
        self.username_input.move(int(LOGIN_INPUT_X * scale), int(LOGIN_USERNAME_Y * scale))
        self.username_input.resize(max(int(LOGIN_INPUT_WIDTH * scale), 150), max(int(INPUT_HEIGHT * scale), 20))
        self.password_input.move(int(LOGIN_INPUT_X * scale), int(LOGIN_PASSWORD_Y * scale))
        self.password_input.resize(max(int(LOGIN_INPUT_WIDTH * scale), 150), max(int(INPUT_HEIGHT * scale), 20))
        self.login_btn.move(int(LOGIN_BUTTON_X * scale), int(LOGIN_BUTTON_Y * scale))
        self.login_btn.resize(max(int(LOGIN_BUTTON_WIDTH * scale), 60), max(int(BUTTON_HEIGHT * scale), 20))

    def center_on_screen(self, screen_width, screen_height):
        """å°†çª—å£å±…ä¸­æ˜¾ç¤º"""
        x = (screen_width - self.width()) // 2
        y = (screen_height - self.height()) // 2
        self.move(x, y)

    @Slot()
    def emit_login(self):
        self.login_signal.emit(self.username_input.text(), self.password_input.text())

class MainWindow(QMainWindow):
    def __init__(self, username):
        super().__init__()
        self.setWindowTitle("Information Query System")
        self.username = username
        self.central_widget = QWidget(self)
        self.setCentralWidget(self.central_widget)

        # æ ‡é¢˜æ 
        self.title_bar = QWidget(self.central_widget)
        self.title_bar.setObjectName("titleBar")
        self.logo_label = QLabel("Logo", self.title_bar)
        self.user_label = QLabel(f"User: {self.username}", self.title_bar)
        self.logout_btn = QPushButton("Logout", self.title_bar)
        self.logout_btn.setObjectName("logoutButton")

        # ä¾§è¾¹æ 
        self.sidebar = QFrame(self.central_widget)
        self.sidebar.setObjectName("sidebar")
        self.cpu_btn = QPushButton("CPU Specs", self.sidebar)
        self.cpu_btn.setIcon(QIcon("cpu_icon.png"))
        self.cpu_btn.setIconSize(Qt.QSize(24, 24))
        self.cpu_btn.setObjectName("sidebarButton")
        self.server_btn = QPushButton("Server Data", self.sidebar)
        self.server_btn.setObjectName("sidebarButton")
        self.virtual_btn = QPushButton("Virtualization Perf", self.sidebar)
        self.virtual_btn.setObjectName("sidebarButton")
        self.clear_cache_btn = QPushButton("Clear Cache", self.sidebar)
        self.clear_cache_btn.setObjectName("sidebarButton")

        # å†…å®¹åŒºåŸŸ
        self.content_stack = QStackedWidget(self.central_widget)

    def adjust_geometry(self, scale, parent_width, parent_height):
        """è°ƒæ•´æ§ä»¶ä½ç½®ï¼Œç›¸å¯¹äºçª—å£"""
        window_width = int(DESIGN_WIDTH * scale)
        window_height = int(DESIGN_HEIGHT * scale)
        self.resize(window_width, window_height)

        # æ ‡é¢˜æ 
        self.title_bar.move(0, 0)
        self.title_bar.resize(window_width, int(TITLE_BAR_HEIGHT * scale))
        self.logo_label.move(int(10 * scale), int(10 * scale))
        self.logo_label.resize(int(50 * scale), int(20 * scale))
        self.user_label.move(int((DESIGN_WIDTH - 234) * scale), int(10 * scale))
        self.user_label.resize(int(150 * scale), int(20 * scale))
        self.logout_btn.move(int((DESIGN_WIDTH - 84) * scale), int(5 * scale))
        self.logout_btn.resize(int(80 * scale), int(30 * scale))

        # ä¾§è¾¹æ 
        sidebar_width = int(SIDEBAR_WIDTH * scale)
        self.sidebar.move(0, int(TITLE_BAR_HEIGHT * scale))
        self.sidebar.resize(sidebar_width, int((DESIGN_HEIGHT - TITLE_BAR_HEIGHT) * scale))
        self.cpu_btn.move(int(SIDEBAR_BUTTON_X * scale), int(SIDEBAR_BUTTON_Y_START * scale))
        self.cpu_btn.resize(int(SIDEBAR_BUTTON_WIDTH * scale), int(40 * scale))
        self.server_btn.move(int(SIDEBAR_BUTTON_X * scale), int((SIDEBAR_BUTTON_Y_START + SIDEBAR_BUTTON_SPACING) * scale))
        self.server_btn.resize(int(SIDEBAR_BUTTON_WIDTH * scale), int(40 * scale))
        self.virtual_btn.move(int(SIDEBAR_BUTTON_X * scale), int((SIDEBAR_BUTTON_Y_START + 2 * SIDEBAR_BUTTON_SPACING) * scale))
        self.virtual_btn.resize(int(SIDEBAR_BUTTON_WIDTH * scale), int(40 * scale))
        self.clear_cache_btn.move(int(SIDEBAR_BUTTON_X * scale), int((SIDEBAR_BUTTON_Y_START + 3 * SIDEBAR_BUTTON_SPACING) * scale))
        self.clear_cache_btn.resize(int(SIDEBAR_BUTTON_WIDTH * scale), int(40 * scale))

        # å†…å®¹åŒºåŸŸ
        self.content_stack.move(sidebar_width, int(TITLE_BAR_HEIGHT * scale))
        self.content_stack.resize(int((DESIGN_WIDTH - SIDEBAR_WIDTH) * scale), int((DESIGN_HEIGHT - TITLE_BAR_HEIGHT) * scale))

    def center_on_screen(self, screen_width, screen_height):
        """å°†çª—å£å±…ä¸­æ˜¾ç¤º"""
        x = (screen_width - self.width()) // 2
        y = (screen_height - self.height()) // 2
        self.move(x, y)

class BaseQueryWidget(QWidget):
    query_signal = Signal(str)
    clear_signal = Signal()
    modify_signal = Signal(str, int, str, str)

    def __init__(self, model, column_count=2, headers=["Property", "Value"]):
        super().__init__()
        self.model = model
        self.column_count = column_count
        self.headers = headers
        self.init_ui()

    def init_ui(self):
        self.cpu_combo = QComboBox(self)
        self.cpu_combo.addItems(self.model.cpu_models)
        self.query_btn = QPushButton("Query", self)
        self.query_btn.setObjectName("actionButton")
        self.query_btn.clicked.connect(lambda: self.query_signal.emit(self.cpu_combo.currentText()))
        self.clear_btn = QPushButton("Clear", self)
        self.clear_btn.setObjectName("actionButton")
        self.clear_btn.clicked.connect(self.clear_signal)
        self.table = QTableWidget(self)
        self.table.setObjectName("dataTable")
        self.table.setColumnCount(self.column_count)
        self.table.setHorizontalHeaderLabels(self.headers)
        self.table.horizontalHeader().setStretchLastSection(True)

    def adjust_geometry(self, scale, parent_width, parent_height):
        """è°ƒæ•´æ§ä»¶ä½ç½®ï¼Œç›¸å¯¹äºå†…å®¹åŒºå·¦ä¸Šè§’"""
        self.cpu_combo.move(int(DROPDOWN_X * scale), int(DROPDOWN_BASE_Y * scale))
        self.cpu_combo.resize(max(int(DROPDOWN_WIDTH * scale), 150), max(int(INPUT_HEIGHT * scale), 20))
        self.query_btn.move(int(BUTTON_QUERY_X * scale), int(DROPDOWN_BASE_Y + BUTTON_Y_OFFSET * scale))
        self.query_btn.resize(max(int(BUTTON_WIDTH * scale), 60), max(int(BUTTON_HEIGHT * scale), 20))
        self.clear_btn.move(int(BUTTON_CLEAR_X * scale), int(DROPDOWN_BASE_Y + BUTTON_Y_OFFSET * scale))
        self.clear_btn.resize(max(int(BUTTON_WIDTH * scale), 60), max(int(BUTTON_HEIGHT * scale), 20))
        self.table.move(int(TABLE_X * scale), int(TABLE_Y * scale))
        self.table.resize(int(TABLE_WIDTH * scale), int(TABLE_HEIGHT * scale))

    def update_table(self, cpu_model=None):
        QTimer.singleShot(0, lambda: self._update_table_async(cpu_model))

    def _update_table_async(self, cpu_model=None):
        pass

    def clear_table(self):
        self.table.setRowCount(0)

class CPUSpecsWidget(BaseQueryWidget):
    def __init__(self, model):
        super().__init__(model, column_count=2, headers=["Property", "Value"])
        self.combos = []
        self.add_btn = QPushButton("+", self)
        self.add_btn.setObjectName("actionButton")
        self.add_btn.clicked.connect(self.add_combo)
        self.remove_btn = QPushButton("-", self)
        self.remove_btn.setObjectName("actionButton")
        self.remove_btn.clicked.connect(self.remove_combo)
        for _ in range(5):
            self.add_combo()

    def adjust_geometry(self, scale, parent_width, parent_height):
        super().adjust_geometry(scale, parent_width, parent_height)
        self.add_btn.move(int(BUTTON_ADD_X * scale), int(DROPDOWN_BASE_Y + BUTTON_Y_OFFSET * scale))
        self.add_btn.resize(max(int(BUTTON_SMALL_WIDTH * scale), 20), max(int(BUTTON_HEIGHT * scale), 20))
        self.remove_btn.move(int(BUTTON_REMOVE_X * scale), int(DROPDOWN_BASE_Y + BUTTON_Y_OFFSET * scale))
        self.remove_btn.resize(max(int(BUTTON_SMALL_WIDTH * scale), 20), max(int(BUTTON_HEIGHT * scale), 20))
        for i, combo in enumerate(self.combos):
            combo.move(int(DROPDOWN_X * scale), int(DROPDOWN_BASE_Y * scale + i * DROPDOWN_SPACING * scale))
            combo.resize(max(int(DROPDOWN_WIDTH * scale), 150), max(int(INPUT_HEIGHT * scale), 20))

    def add_combo(self):
        combo = QComboBox(self)
        combo.addItems(self.model.cpu_models)
        combo.currentTextChanged.connect(lambda text: self.query_signal.emit(text))
        combo.show()
        self.combos.append(combo)
        self.adjust_geometry(self.scale_factor if hasattr(self, 'scale_factor') else 1.0, DESIGN_WIDTH - SIDEBAR_WIDTH, DESIGN_HEIGHT - TITLE_BAR_HEIGHT)

    def remove_combo(self):
        if len(self.combos) > 1:
            combo = self.combos.pop()
            combo.deleteLater()
            self.table.clearContents()
            self.adjust_geometry(self.scale_factor if hasattr(self, 'scale_factor') else 1.0, DESIGN_WIDTH - SIDEBAR_WIDTH, DESIGN_HEIGHT - TITLE_BAR_HEIGHT)

    def _update_table_async(self, cpu_model=None):
        if cpu_model is None:
            cpu_model = self.cpu_combo.currentText()
        specs = self.model.get_cpu_specs(cpu_model)
        self.table.setRowCount(len(specs))
        for i, (key, value) in enumerate(specs.items()):
            self.table.setItem(i, 0, QTableWidgetItem(key))
            self.table.setItem(i, 1, QTableWidgetItem(str(value)))
        self.table.resizeColumnsToContents()

class ServerDataWidget(BaseQueryWidget):
    def __init__(self, model):
        super().__init__(model, column_count=4, headers=["Property", "Value", "Modify", "Link"])
        self.extra_combo = QComboBox(self)
        self.extra_combo.addItems(["Option1", "Option2"])

    def adjust_geometry(self, scale, parent_width, parent_height):
        super().adjust_geometry(scale, parent_width, parent_height)
        self.extra_combo.move(int(DROPDOWN_X * scale), int((DROPDOWN_BASE_Y - 40) * scale))  # ä¸Šæ–¹é¢å¤–ä¸‹æ‹‰æ¡†
        self.extra_combo.resize(max(int(DROPDOWN_WIDTH * scale), 150), max(int(INPUT_HEIGHT * scale), 20))

    def _update_table_async(self, cpu_model=None):
        if cpu_model is None:
            cpu_model = self.cpu_combo.currentText()
        data = self.model.get_server_data(cpu_model)
        self.table.setRowCount(len(data))
        modify_values = {}
        for row in range(self.table.rowCount()):
            combo = self.table.cellWidget(row, 2)
            if combo:
                modify_values[row] = combo.currentText()

        for i, (key, value) in enumerate(data.items()):
            self.table.setItem(i, 0, QTableWidgetItem(key))
            self.table.setItem(i, 1, QTableWidgetItem(value))
            combo = QComboBox()
            combo.addItems(["Low", "Medium", "High"])
            combo.setCurrentText(modify_values.get(i, "Medium"))
            combo.currentTextChanged.connect(lambda text, r=i, k=key: self.modify_signal.emit(cpu_model, r, k, text))
            self.table.setCellWidget(i, 2, combo)
            btn = QPushButton("Link")
            btn.setObjectName("linkButton")
            btn.clicked.connect(self.open_link)
            self.table.setCellWidget(i, 3, btn)
        self.table.resizeColumnsToContents()

    def open_link(self):
        from PySide6.QtGui import QDesktopServices, QUrl
        QDesktopServices.openUrl(QUrl("https://www.baidu.com"))
        print("Opening Baidu homepage")

class VirtualizationPerfWidget(BaseQueryWidget):
    def __init__(self, model):
        super().__init__(model, column_count=2, headers=["Property", "Value"])

    def _update_table_async(self, cpu_model=None):
        if cpu_model is None:
            cpu_model = self.cpu_combo.currentText()
        data = self.model.get_virtualization_data(cpu_model)
        self.table.setRowCount(len(data))
        for i, (key, value) in enumerate(data.items()):
            self.table.setItem(i, 0, QTableWidgetItem(key))
            self.table.setItem(i, 1, QTableWidgetItem(str(value)))
        self.table.resizeColumnsToContents()
controller.py
python
from PySide6.QtWidgets import QMessageBox
from PySide6.QtCore import Slot, QSize
from PySide6.QtGui import QScreen
from collections import OrderedDict
from views import MainWindow, LoginWidget, CPUSpecsWidget, ServerDataWidget, VirtualizationPerfWidget

class BaseSystemController:
    def __init__(self, model, login_widget_class=LoginWidget, main_window_class=MainWindow, max_cache_size=3):
        self.model = model
        self.login_widget_class = login_widget_class
        self.main_window_class = main_window_class
        self.max_cache_size = max_cache_size
        self.main_window = None
        self.login_widget = None
        self.page_cache = OrderedDict()
        
        self._init_login_widget()

    def _init_login_widget(self):
        self.login_widget = self.login_widget_class()
        self._adjust_widget_size(self.login_widget)
        self.login_widget.login_signal.connect(self._on_login)

    def _adjust_widget_size(self, widget, is_login_widget=True):
        screen = widget.screen()
        screen_size = screen.availableSize()
        scale = min(screen_size.width() / DESIGN_WIDTH, screen_size.height() / DESIGN_HEIGHT)
        if is_login_widget:
            width = screen_size.width() * (0.25 if screen_size.width() < 1600 else 0.3)
            height = screen_size.height() * (0.25 if screen_size.width() < 1600 else 0.3)
        else:
            width = screen_size.width() * (0.7 if screen_size.width() < 1600 else 0.8)
            height = screen_size.height() * (0.7 if screen_size.width() < 1600 else 0.8)
        widget.adjust_geometry(scale, width, height)
        widget.center_on_screen(screen_size.width(), screen_size.height())
        widget.scale_factor = scale

    def _init_main_window(self, username):
        self.main_window = self.main_window_class(username)
        self._adjust_widget_size(self.main_window, is_login_widget=False)
        self.main_window.logout_btn.clicked.connect(self._on_logout)
        self.main_window.clear_cache_btn.clicked.connect(self._clear_all_pages)
        self._register_pages()

    def _register_pages(self):
        raise NotImplementedError("Subclasses must implement _register_pages")

    def _switch_page(self, name):
        if name in self.page_cache:
            self.page_cache.move_to_end(name)
            print(f"Switched to cached page: {name}")
        else:
            if len(self.page_cache) >= self.max_cache_size:
                self._remove_oldest_page()
            widget_class = self.pages[name][0]
            self.page_cache[name] = widget_class(self.model)
            self.page_cache[name].adjust_geometry(self.main_window.scale_factor, DESIGN_WIDTH - SIDEBAR_WIDTH, DESIGN_HEIGHT - TITLE_BAR_HEIGHT)
            self.main_window.content_stack.addWidget(self.page_cache[name])
            self._connect_page_signals(self.page_cache[name])
            print(f"Created and switched to page: {name}")
        self.main_window.content_stack.setCurrentWidget(self.page_cache[name])

    def _remove_oldest_page(self):
        name, widget = self.page_cache.popitem(last=False)
        self.main_window.content_stack.removeWidget(widget)
        widget.deleteLater()
        print(f"Removed oldest page: {name}")

    def _connect_page_signals(self, widget):
        widget.query_signal.connect(widget.update_table)
        widget.clear_signal.connect(widget.clear_table)

    @Slot(str, str)
    def _on_login(self, username, password):
        if self.model.validate_login(username, password):
            self._init_main_window(username)
            self.main_window.show()
            self.login_widget.hide()
        else:
            QMessageBox.warning(self.login_widget, "Login Failed", "Invalid username or password")

    @Slot()
    def _on_logout(self):
        self.main_window.hide()
        self.login_widget.show()

    @Slot()
    def _clear_all_pages(self):
        while self.page_cache:
            self._remove_oldest_page()
        QMessageBox.information(self.main_window, "Cache Cleared", "All cached pages have been destroyed.")

    def start(self):
        self.login_widget.show()

class SpecificSystemController(BaseSystemController):
    def _register_pages(self):
        self.pages = {
            "cpu_specs": (CPUSpecsWidget, self.main_window.cpu_btn),
            "server_data": (ServerDataWidget, self.main_window.server_btn),
            "virtualization_perf": (VirtualizationPerfWidget, self.main_window.virtual_btn)
        }
        for name, (_, button) in self.pages.items():
            button.clicked.connect(lambda n=name: self._switch_page(n))

    def _connect_page_signals(self, widget):
        super()._connect_page_signals(widget)
        if isinstance(widget, ServerDataWidget):
            widget.modify_signal.connect(self._modify_server_data)

    @Slot(str, int, str, str)
    def _modify_server_data(self, cpu_model, row, key, text):
        self.model.update_server_data(cpu_model, key, f"{text} ({self.model.get_server_data(cpu_model)[key].split(' (')[0]})")
        widget = self.main_window.content_stack.currentWidget()
        if widget:
            widget.update_table()
        print(f"Row {row} modified: {key} = {self.model.get_server_data(cpu_model)[key]}")
main.py
python
from PySide6.QtWidgets import QApplication
from PySide6.QtCore import Qt, QFile, QTextStream
from PySide6.QtGui import QFont
from model import SystemModel
from controller import SpecificSystemController

def load_stylesheet(app, filename="styles.qss"):
    file = QFile(filename)
    if file.open(QFile.ReadOnly | QFile.Text):
        stream = QTextStream(file)
        app.setStyleSheet(stream.readAll())
        file.close()

if __name__ == "__main__":
    QApplication.setAttribute(Qt.AA_EnableHighDpiScaling)
    QApplication.setAttribute(Qt.AA_UseHighDpiPixmaps)

    app = QApplication(sys.argv)
    
    font = QFont("Arial", 10)
    app.setFont(font)
    
    load_stylesheet(app, "styles.qss")
    
    model = SystemModel()
    controller = SpecificSystemController(model, max_cache_size=3)
    controller.start()
    sys.exit(app.exec())
å¸ƒå±€åæ ‡ä¼˜åŒ–å®ç°
å¸¸é‡å®šä¹‰
å…¨å±€å¸¸é‡ï¼š
DESIGN_WIDTH, DESIGN_HEIGHTï¼šè®¾è®¡åˆ†è¾¨ç‡ã€‚
TITLE_BAR_HEIGHT, SIDEBAR_WIDTHï¼šæ ‡é¢˜æ å’Œä¾§è¾¹æ åŸºç¡€å°ºå¯¸ã€‚
CONTENT_OFFSET_Xï¼šå†…å®¹åŒº X è½´åç§»ï¼ˆç­‰äºä¾§è¾¹æ å®½åº¦ï¼‰ã€‚
ç™»å½•çª—å£ï¼š
LOGIN_INPUT_X, LOGIN_USERNAME_Y ç­‰ï¼šè¾“å…¥æ¡†å’ŒæŒ‰é’®çš„ç›¸å¯¹ä½ç½®ã€‚
ä½¿ç”¨å‘½åå¸¸é‡ä»£æ›¿ç¡¬ç¼–ç æ•°å­—ï¼ˆå¦‚ 80, 140ï¼‰ã€‚
å†…å®¹åŒºï¼š
DROPDOWN_X, DROPDOWN_BASE_Yï¼šä¸‹æ‹‰æ¡†åŸºç¡€ä½ç½®ã€‚
BUTTON_QUERY_X, BUTTON_CLEAR_Xï¼šæŒ‰é’®ä½ç½®ï¼ŒåŸºäºä¸‹æ‹‰æ¡†çš„ç›¸å¯¹åç§»ã€‚
TABLE_X, TABLE_Yï¼šè¡¨æ ¼ä½ç½®ï¼ŒåŸºäºå†…å®¹åŒºé¡¶éƒ¨ã€‚
ä¾§è¾¹æ ï¼š
SIDEBAR_BUTTON_X, SIDEBAR_BUTTON_Y_START, SIDEBAR_BUTTON_SPACINGï¼šæŒ‰é’®ä½ç½®å’Œé—´è·ã€‚
åŠ¨æ€è°ƒæ•´
ç›¸å¯¹ä½ç½®ï¼š
æ‰€æœ‰æ§ä»¶åæ ‡ï¼ˆå¦‚ DROPDOWN_X=138ï¼‰æ˜¯ç›¸å¯¹äºçˆ¶æ§ä»¶ï¼ˆå†…å®¹åŒºæˆ–çª—å£ï¼‰çš„åç§»ã€‚
åœ¨ adjust_geometry ä¸­ï¼Œä½¿ç”¨ scale åŠ¨æ€ç¼©æ”¾è¿™äº›åæ ‡ï¼š
python
self.cpu_combo.move(int(DROPDOWN_X * scale), int(DROPDOWN_BASE_Y * scale))
ç»“æ„åŒ–å¸ƒå±€ï¼š
MainWindow.adjust_geometry åˆ†ç»„è°ƒæ•´æ ‡é¢˜æ ã€ä¾§è¾¹æ å’Œå†…å®¹åŒºã€‚
BaseQueryWidget.adjust_geometry ç»Ÿä¸€ç®¡ç†ä¸‹æ‹‰æ¡†ã€æŒ‰é’®å’Œè¡¨æ ¼ã€‚
ç»´æŠ¤æ€§ï¼š
ä¿®æ”¹å¸ƒå±€åªéœ€è°ƒæ•´å¸¸é‡ï¼ˆå¦‚ DROPDOWN_BASE_Y ä» 84 æ”¹ä¸º 100ï¼‰ï¼Œæ— éœ€æ·±å…¥ä»£ç ã€‚
å¸¸é‡åç§°ç›´è§‚ï¼ˆå¦‚ BUTTON_ADD_X è¡¨ç¤ºæ·»åŠ æŒ‰é’®çš„ X åæ ‡ï¼‰ã€‚
æµ‹è¯•æ­¥éª¤
è¿è¡Œ main.pyï¼Œè¾“å…¥ admin å’Œ 123456ã€‚
éªŒè¯å±…ä¸­æ˜¾ç¤ºï¼š
ç™»å½•çª—å£å’Œä¸»çª—å£åœ¨å±å¹•ä¸­å¿ƒã€‚
éªŒè¯ç›¸å¯¹ä½ç½®ï¼š
ç¬”è®°æœ¬ï¼ˆ1366x768ï¼‰ï¼š
ç¼©æ”¾æ¯”ä¾‹çº¦ 0.835ï¼Œä¸‹æ‹‰æ¡†çº¦ (115, 70)ï¼Œè¡¨æ ¼çº¦ (115, 150)ã€‚
å°å¼æœºï¼ˆ2560x1440ï¼‰ï¼š
ç¼©æ”¾æ¯”ä¾‹çº¦ 1.36ï¼Œä¸‹æ‹‰æ¡†çº¦ (188, 114)ï¼Œè¡¨æ ¼çº¦ (188, 245)ã€‚
æµ‹è¯•ç»´æŠ¤æ€§ï¼š
ä¿®æ”¹ DROPDOWN_BASE_Y=100ï¼Œç¡®è®¤ä¸‹æ‹‰æ¡† Y åæ ‡å˜åŒ–ï¼ˆå¦‚ 83 æˆ– 136ï¼‰ã€‚
ç¤ºä¾‹è¾“å‡º
# ç¬”è®°æœ¬ (1366x768)
Created and switched to page: cpu_specs  # ä¸»çª—å£å±…ä¸­ï¼Œä¸‹æ‹‰æ¡†çº¦ (115, 70)
Switched to cached page: server_data

# å°å¼æœº (2560x1440)
Created and switched to page: cpu_specs  # ä¸»çª—å£å±…ä¸­ï¼Œä¸‹æ‹‰æ¡†çº¦ (188, 114)
Switched to cached page: server_data
ä¼˜åŒ–äº®ç‚¹
å‘½åæ¸…æ™°ï¼šå¸¸é‡å¦‚ DROPDOWN_X, TABLE_Y ç›´è§‚è¡¨ç¤ºæ§ä»¶ä½ç½®ï¼Œå‡å°‘æ··æ·†ã€‚
æ˜“äºç»´æŠ¤ï¼šè°ƒæ•´å¸ƒå±€åªéœ€ä¿®æ”¹é¡¶éƒ¨å¸¸é‡ï¼Œæ— éœ€æ·±å…¥å‡½æ•°ã€‚
åŠ¨æ€é€‚é…ï¼šç›¸å¯¹ä½ç½®éšç¼©æ”¾æ¯”ä¾‹è‡ªåŠ¨è°ƒæ•´ï¼Œä¿æŒä¸€è‡´æ€§ã€‚
å¦‚æœæ‚¨éœ€è¦è°ƒæ•´ç‰¹å®šæ§ä»¶ä½ç½®ï¼ˆå¦‚ä¸‹æ‹‰æ¡†æ›´é å·¦ï¼‰æˆ–æ·»åŠ æ›´å¤šå¸ƒå±€å‚æ•°ï¼Œè¯·å‘Šè¯‰æˆ‘å…·ä½“éœ€æ±‚ï¼















ä¸ºäº†å®ç°åŠ¨æ€ç¼©æ”¾ä¼˜åŒ–ï¼Œæˆ‘ä»¬éœ€è¦æ ¹æ®å±å¹•åˆ†è¾¨ç‡åŠ¨æ€è°ƒæ•´ç»„ä»¶çš„ä½ç½®å’Œå¤§å°ï¼Œä½¿å…¶åœ¨ä¸åŒåˆ†è¾¨ç‡ä¸‹ä¿æŒæ¯”ä¾‹ä¸€è‡´ï¼ŒåŒæ—¶é¿å…æº¢å‡ºæˆ–è¿‡å°ã€‚å½“å‰ä»£ç åŸºäºå›ºå®šåæ ‡ï¼ˆå¦‚ä¸»çª—å£ 1634x1054ï¼Œä¸‹æ‹‰æ¡† 138,164,240,32ï¼‰ï¼Œåœ¨å°å±å¹•ï¼ˆå¦‚ 1366x768ï¼‰ä¸Šå¯èƒ½æº¢å‡ºï¼Œå¤§å±å¹•ï¼ˆå¦‚ 2560x1440ï¼‰ä¸Šå¯èƒ½æ˜¾å¾—è¿‡å°ã€‚ä»¥ä¸‹æ˜¯åŠ¨æ€ç¼©æ”¾ä¼˜åŒ–çš„æ–¹æ¡ˆï¼š
ä¼˜åŒ–ç›®æ ‡
åŠ¨æ€ç¼©æ”¾ï¼š
ä»¥è®¾è®¡åˆ†è¾¨ç‡ï¼ˆ1634x1054ï¼‰ä¸ºåŸºå‡†ï¼Œè®¡ç®—ç¼©æ”¾æ¯”ä¾‹ã€‚
æ ¹æ®å±å¹•å®é™…å¤§å°è°ƒæ•´ç»„ä»¶çš„ x, y, width, heightã€‚
ä¿æŒæ¯”ä¾‹ï¼š
ç¡®ä¿ç»„ä»¶ä¹‹é—´çš„ç›¸å¯¹ä½ç½®å’Œå¤§å°æ¯”ä¾‹ä¸å˜ã€‚
é€‚é…è¾¹ç•Œï¼š
é˜²æ­¢ç»„ä»¶è¶…å‡ºçª—å£è¾¹ç•Œï¼Œè®¾ç½®æœ€å°å’Œæœ€å¤§é™åˆ¶ã€‚
æ”¹è¿›æ–¹æ¡ˆ
è®¡ç®—ç¼©æ”¾æ¯”ä¾‹ï¼š
ä½¿ç”¨å±å¹•å¯ç”¨å°ºå¯¸ä¸è®¾è®¡å°ºå¯¸çš„æ¯”ç‡ï¼Œåˆ†åˆ«è®¡ç®—å®½åº¦å’Œé«˜åº¦çš„ç¼©æ”¾å› å­ã€‚
å–è¾ƒå°å€¼ä½œä¸ºç»Ÿä¸€ç¼©æ”¾æ¯”ä¾‹ï¼Œç¡®ä¿ç»„ä»¶ä¸æº¢å‡ºã€‚
åŠ¨æ€è°ƒæ•´æ§ä»¶ï¼š
åœ¨ BaseQueryWidget å’Œå…¶ä»–ç±»ä¸­ï¼Œä½¿ç”¨ç¼©æ”¾æ¯”ä¾‹é‡æ–°è®¡ç®— move å’Œ resizeã€‚
ä¸»çª—å£å’Œä¾§è¾¹æ ä¹ŸåŠ¨æ€è°ƒæ•´ã€‚
æœ€å°å°ºå¯¸ä¿æŠ¤ï¼š
ä¸ºå…³é”®æ§ä»¶ï¼ˆå¦‚ä¸‹æ‹‰æ¡†ã€æŒ‰é’®ï¼‰è®¾ç½®æœ€å°å°ºå¯¸ï¼Œé¿å…è¿‡å°ã€‚
ä¼˜åŒ–åçš„å®Œæ•´ä»£ç 
model.py å’Œ styles.qss
ï¼ˆä¿æŒä¸å˜ï¼Œç•¥ï¼‰
views.py
python
from PySide6.QtWidgets import (QMainWindow, QWidget, QComboBox, QPushButton, QTableWidget, 
                               QTableWidgetItem, QLabel, QLineEdit, QMessageBox)
from PySide6.QtCore import Qt, Signal, Slot, QTimer
from PySide6.QtGui import QIcon

DESIGN_WIDTH, DESIGN_HEIGHT = 1634, 1054  # è®¾è®¡åˆ†è¾¨ç‡

class LoginWidget(QWidget):
    login_signal = Signal(str, str)

    def __init__(self):
        super().__init__()
        self.setGeometry(0, 0, 400, 300)  # é»˜è®¤å¤§å°ï¼Œcontroller ä¼šè°ƒæ•´
        self.username_input = QLineEdit(self)
        self.username_input.setPlaceholderText("Username")
        self.password_input = QLineEdit(self)
        self.password_input.setPlaceholderText("Password")
        self.password_input.setEchoMode(QLineEdit.Password)
        self.login_btn = QPushButton("Login", self)
        self.login_btn.setObjectName("loginButton")

    def adjust_geometry(self, scale):
        self.username_input.move(int(80 * scale), int(80 * scale))
        self.username_input.resize(int(240 * scale), int(32 * scale))
        self.password_input.move(int(80 * scale), int(140 * scale))
        self.password_input.resize(int(240 * scale), int(32 * scale))
        self.login_btn.move(int(160 * scale), int(200 * scale))
        self.login_btn.resize(int(80 * scale), int(32 * scale))

    @Slot()
    def emit_login(self):
        self.login_signal.emit(self.username_input.text(), self.password_input.text())

class MainWindow(QMainWindow):
    def __init__(self, username):
        super().__init__()
        self.setWindowTitle("Information Query System")
        self.username = username
        self.setGeometry(0, 0, DESIGN_WIDTH, DESIGN_HEIGHT)
        self.central_widget = QWidget(self)
        self.setCentralWidget(self.central_widget)

        # æ ‡é¢˜æ 
        self.title_bar = QWidget(self.central_widget)
        self.title_bar.setObjectName("titleBar")
        self.logo_label = QLabel("Logo", self.title_bar)
        self.user_label = QLabel(f"User: {self.username}", self.title_bar)
        self.logout_btn = QPushButton("Logout", self.title_bar)
        self.logout_btn.setObjectName("logoutButton")

        # ä¾§è¾¹æ 
        self.sidebar = QFrame(self.central_widget)
        self.sidebar.setObjectName("sidebar")
        self.cpu_btn = QPushButton("CPU Specs", self.sidebar)
        self.cpu_btn.setIcon(QIcon("cpu_icon.png"))
        self.cpu_btn.setIconSize(Qt.QSize(24, 24))
        self.cpu_btn.setObjectName("sidebarButton")
        self.server_btn = QPushButton("Server Data", self.sidebar)
        self.server_btn.setObjectName("sidebarButton")
        self.virtual_btn = QPushButton("Virtualization Perf", self.sidebar)
        self.virtual_btn.setObjectName("sidebarButton")
        self.clear_cache_btn = QPushButton("Clear Cache", self.sidebar)
        self.clear_cache_btn.setObjectName("sidebarButton")

        # å†…å®¹åŒºåŸŸ
        self.content_stack = QStackedWidget(self.central_widget)

    def adjust_geometry(self, scale):
        """æ ¹æ®ç¼©æ”¾æ¯”ä¾‹è°ƒæ•´ç»„ä»¶ä½ç½®å’Œå¤§å°"""
        # æ ‡é¢˜æ 
        self.title_bar.move(0, 0)
        self.title_bar.resize(int(DESIGN_WIDTH * scale), int(40 * scale))
        self.logo_label.move(int(10 * scale), int(10 * scale))
        self.logo_label.resize(int(50 * scale), int(20 * scale))
        self.user_label.move(int(1400 * scale), int(10 * scale))
        self.user_label.resize(int(150 * scale), int(20 * scale))
        self.logout_btn.move(int(1550 * scale), int(5 * scale))
        self.logout_btn.resize(int(80 * scale), int(30 * scale))

        # ä¾§è¾¹æ 
        sidebar_width = int(200 * scale)
        self.sidebar.move(0, int(40 * scale))
        self.sidebar.resize(sidebar_width, int(1014 * scale))
        self.cpu_btn.move(int(10 * scale), int(100 * scale))
        self.cpu_btn.resize(int(180 * scale), int(40 * scale))
        self.server_btn.move(int(10 * scale), int(150 * scale))
        self.server_btn.resize(int(180 * scale), int(40 * scale))
        self.virtual_btn.move(int(10 * scale), int(200 * scale))
        self.virtual_btn.resize(int(180 * scale), int(40 * scale))
        self.clear_cache_btn.move(int(10 * scale), int(250 * scale))
        self.clear_cache_btn.resize(int(180 * scale), int(40 * scale))

        # å†…å®¹åŒºåŸŸ
        self.content_stack.move(sidebar_width, int(40 * scale))
        self.content_stack.resize(int((DESIGN_WIDTH - 200) * scale), int(1014 * scale))

class BaseQueryWidget(QWidget):
    query_signal = Signal(str)
    clear_signal = Signal()
    modify_signal = Signal(str, int, str, str)

    def __init__(self, model, column_count=2, headers=["Property", "Value"]):
        super().__init__()
        self.model = model
        self.column_count = column_count
        self.headers = headers
        self.init_ui()

    def init_ui(self):
        self.cpu_combo = QComboBox(self)
        self.cpu_combo.addItems(self.model.cpu_models)
        self.query_btn = QPushButton("Query", self)
        self.query_btn.setObjectName("actionButton")
        self.query_btn.clicked.connect(lambda: self.query_signal.emit(self.cpu_combo.currentText()))
        self.clear_btn = QPushButton("Clear", self)
        self.clear_btn.setObjectName("actionButton")
        self.clear_btn.clicked.connect(self.clear_signal)
        self.table = QTableWidget(self)
        self.table.setObjectName("dataTable")
        self.table.setColumnCount(self.column_count)
        self.table.setHorizontalHeaderLabels(self.headers)
        self.table.horizontalHeader().setStretchLastSection(True)

    def adjust_geometry(self, scale):
        self.cpu_combo.move(int(138 * scale), int(164 * scale))
        self.cpu_combo.resize(max(int(240 * scale), 150), max(int(32 * scale), 20))  # æœ€å°å°ºå¯¸ä¿æŠ¤
        self.query_btn.move(int(400 * scale), int(164 * scale))
        self.query_btn.resize(max(int(80 * scale), 60), max(int(32 * scale), 20))
        self.clear_btn.move(int(500 * scale), int(164 * scale))
        self.clear_btn.resize(max(int(80 * scale), 60), max(int(32 * scale), 20))
        self.table.move(int(138 * scale), int(220 * scale))
        self.table.resize(int(1200 * scale), int(800 * scale))

    def update_table(self, cpu_model=None):
        QTimer.singleShot(0, lambda: self._update_table_async(cpu_model))

    def _update_table_async(self, cpu_model=None):
        pass

    def clear_table(self):
        self.table.setRowCount(0)

class CPUSpecsWidget(BaseQueryWidget):
    def __init__(self, model):
        super().__init__(model, column_count=2, headers=["Property", "Value"])
        self.combos = []
        self.add_btn = QPushButton("+", self)
        self.add_btn.setObjectName("actionButton")
        self.add_btn.clicked.connect(self.add_combo)
        self.remove_btn = QPushButton("-", self)
        self.remove_btn.setObjectName("actionButton")
        self.remove_btn.clicked.connect(self.remove_combo)
        for _ in range(5):
            self.add_combo()

    def adjust_geometry(self, scale):
        super().adjust_geometry(scale)
        self.add_btn.move(int(600 * scale), int(164 * scale))
        self.add_btn.resize(max(int(32 * scale), 20), max(int(32 * scale), 20))
        self.remove_btn.move(int(640 * scale), int(164 * scale))
        self.remove_btn.resize(max(int(32 * scale), 20), max(int(32 * scale), 20))
        for i, combo in enumerate(self.combos):
            combo.move(int(138 * scale), int(164 * scale + i * 40 * scale))
            combo.resize(max(int(240 * scale), 150), max(int(32 * scale), 20))

    def add_combo(self):
        combo = QComboBox(self)
        combo.addItems(self.model.cpu_models)
        combo.currentTextChanged.connect(lambda text: self.query_signal.emit(text))
        combo.show()
        self.combos.append(combo)
        self.adjust_geometry(self.scale_factor if hasattr(self, 'scale_factor') else 1.0)

    def remove_combo(self):
        if len(self.combos) > 1:
            combo = self.combos.pop()
            combo.deleteLater()
            self.table.clearContents()
            self.adjust_geometry(self.scale_factor if hasattr(self, 'scale_factor') else 1.0)

    def _update_table_async(self, cpu_model=None):
        if cpu_model is None:
            cpu_model = self.cpu_combo.currentText()
        specs = self.model.get_cpu_specs(cpu_model)
        self.table.setRowCount(len(specs))
        for i, (key, value) in enumerate(specs.items()):
            self.table.setItem(i, 0, QTableWidgetItem(key))
            self.table.setItem(i, 1, QTableWidgetItem(str(value)))
        self.table.resizeColumnsToContents()

class ServerDataWidget(BaseQueryWidget):
    def __init__(self, model):
        super().__init__(model, column_count=4, headers=["Property", "Value", "Modify", "Link"])
        self.extra_combo = QComboBox(self)
        self.extra_combo.addItems(["Option1", "Option2"])

    def adjust_geometry(self, scale):
        super().adjust_geometry(scale)
        self.extra_combo.move(int(138 * scale), int(124 * scale))
        self.extra_combo.resize(max(int(240 * scale), 150), max(int(32 * scale), 20))

    def _update_table_async(self, cpu_model=None):
        if cpu_model is None:
            cpu_model = self.cpu_combo.currentText()
        data = self.model.get_server_data(cpu_model)
        self.table.setRowCount(len(data))
        modify_values = {}
        for row in range(self.table.rowCount()):
            combo = self.table.cellWidget(row, 2)
            if combo:
                modify_values[row] = combo.currentText()

        for i, (key, value) in enumerate(data.items()):
            self.table.setItem(i, 0, QTableWidgetItem(key))
            self.table.setItem(i, 1, QTableWidgetItem(value))
            combo = QComboBox()
            combo.addItems(["Low", "Medium", "High"])
            combo.setCurrentText(modify_values.get(i, "Medium"))
            combo.currentTextChanged.connect(lambda text, r=i, k=key: self.modify_signal.emit(cpu_model, r, k, text))
            self.table.setCellWidget(i, 2, combo)
            btn = QPushButton("Link")
            btn.setObjectName("linkButton")
            btn.clicked.connect(self.open_link)
            self.table.setCellWidget(i, 3, btn)
        self.table.resizeColumnsToContents()

    def open_link(self):
        from PySide6.QtGui import QDesktopServices, QUrl
        QDesktopServices.openUrl(QUrl("https://www.baidu.com"))
        print("Opening Baidu homepage")

class VirtualizationPerfWidget(BaseQueryWidget):
    def __init__(self, model):
        super().__init__(model, column_count=2, headers=["Property", "Value"])

    def _update_table_async(self, cpu_model=None):
        if cpu_model is None:
            cpu_model = self.cpu_combo.currentText()
        data = self.model.get_virtualization_data(cpu_model)
        self.table.setRowCount(len(data))
        for i, (key, value) in enumerate(data.items()):
            self.table.setItem(i, 0, QTableWidgetItem(key))
            self.table.setItem(i, 1, QTableWidgetItem(str(value)))
        self.table.resizeColumnsToContents()
controller.py
python
from PySide6.QtWidgets import QMessageBox
from PySide6.QtCore import Slot, QSize
from PySide6.QtGui import QScreen
from collections import OrderedDict
from views import MainWindow, LoginWidget, CPUSpecsWidget, ServerDataWidget, VirtualizationPerfWidget

class BaseSystemController:
    def __init__(self, model, login_widget_class=LoginWidget, main_window_class=MainWindow, max_cache_size=3):
        self.model = model
        self.login_widget_class = login_widget_class
        self.main_window_class = main_window_class
        self.max_cache_size = max_cache_size
        self.main_window = None
        self.login_widget = None
        self.page_cache = OrderedDict()
        
        self._init_login_widget()

    def _init_login_widget(self):
        self.login_widget = self.login_widget_class()
        self._adjust_widget_size(self.login_widget)
        self.login_widget.login_signal.connect(self._on_login)

    def _adjust_widget_size(self, widget, is_login_widget=True):
        screen = widget.screen()
        screen_size = screen.availableSize()
        scale = min(screen_size.width() / DESIGN_WIDTH, screen_size.height() / DESIGN_HEIGHT)
        if is_login_widget:
            width = screen_size.width() * (0.25 if screen_size.width() < 1600 else 0.3)
            height = screen_size.height() * (0.25 if screen_size.width() < 1600 else 0.3)
            widget.resize(int(width), int(height))
            widget.setMinimumSize(QSize(300, 200))
            widget.setMaximumSize(QSize(500, 400))
        else:
            width = screen_size.width() * (0.7 if screen_size.width() < 1600 else 0.8)
            height = screen_size.height() * (0.7 if screen_size.width() < 1600 else 0.8)
            widget.resize(int(width), int(height))
            widget.setMinimumSize(QSize(800, 600))
            widget.adjust_geometry(scale)  # è°ƒæ•´å†…éƒ¨ç»„ä»¶
        widget.scale_factor = scale  # ä¿å­˜ç¼©æ”¾æ¯”ä¾‹ä¾›å­æ§ä»¶ä½¿ç”¨

    def _init_main_window(self, username):
        self.main_window = self.main_window_class(username)
        self._adjust_widget_size(self.main_window, is_login_widget=False)
        self.main_window.logout_btn.clicked.connect(self._on_logout)
        self.main_window.clear_cache_btn.clicked.connect(self._clear_all_pages)
        self._register_pages()

    def _register_pages(self):
        raise NotImplementedError("Subclasses must implement _register_pages")

    def _switch_page(self, name):
        if name in self.page_cache:
            self.page_cache.move_to_end(name)
            print(f"Switched to cached page: {name}")
        else:
            if len(self.page_cache) >= self.max_cache_size:
                self._remove_oldest_page()
            widget_class = self.pages[name][0]
            self.page_cache[name] = widget_class(self.model)
            self.page_cache[name].adjust_geometry(self.main_window.scale_factor)
            self.main_window.content_stack.addWidget(self.page_cache[name])
            self._connect_page_signals(self.page_cache[name])
            print(f"Created and switched to page: {name}")
        self.main_window.content_stack.setCurrentWidget(self.page_cache[name])

    def _remove_oldest_page(self):
        name, widget = self.page_cache.popitem(last=False)
        self.main_window.content_stack.removeWidget(widget)
        widget.deleteLater()
        print(f"Removed oldest page: {name}")

    def _connect_page_signals(self, widget):
        widget.query_signal.connect(widget.update_table)
        widget.clear_signal.connect(widget.clear_table)

    @Slot(str, str)
    def _on_login(self, username, password):
        if self.model.validate_login(username, password):
            self._init_main_window(username)
            self.main_window.show()
            self.login_widget.hide()
        else:
            QMessageBox.warning(self.login_widget, "Login Failed", "Invalid username or password")

    @Slot()
    def _on_logout(self):
        self.main_window.hide()
        self.login_widget.show()

    @Slot()
    def _clear_all_pages(self):
        while self.page_cache:
            self._remove_oldest_page()
        QMessageBox.information(self.main_window, "Cache Cleared", "All cached pages have been destroyed.")

    def start(self):
        self.login_widget.show()

class SpecificSystemController(BaseSystemController):
    def _register_pages(self):
        self.pages = {
            "cpu_specs": (CPUSpecsWidget, self.main_window.cpu_btn),
            "server_data": (ServerDataWidget, self.main_window.server_btn),
            "virtualization_perf": (VirtualizationPerfWidget, self.main_window.virtual_btn)
        }
        for name, (_, button) in self.pages.items():
            button.clicked.connect(lambda n=name: self._switch_page(n))

    def _connect_page_signals(self, widget):
        super()._connect_page_signals(widget)
        if isinstance(widget, ServerDataWidget):
            widget.modify_signal.connect(self._modify_server_data)

    @Slot(str, int, str, str)
    def _modify_server_data(self, cpu_model, row, key, text):
        self.model.update_server_data(cpu_model, key, f"{text} ({self.model.get_server_data(cpu_model)[key].split(' (')[0]})")
        widget = self.main_window.content_stack.currentWidget()
        if widget:
            widget.update_table()
        print(f"Row {row} modified: {key} = {self.model.get_server_data(cpu_model)[key]}")
styles.qss
ï¼ˆä¿æŒä¸å˜ï¼Œç•¥ï¼‰
main.py
python
from PySide6.QtWidgets import QApplication
from PySide6.QtCore import Qt, QFile, QTextStream
from PySide6.QtGui import QFont
from model import SystemModel
from controller import SpecificSystemController

def load_stylesheet(app, filename="styles.qss"):
    file = QFile(filename)
    if file.open(QFile.ReadOnly | QFile.Text):
        stream = QTextStream(file)
        app.setStyleSheet(stream.readAll())
        file.close()

if __name__ == "__main__":
    QApplication.setAttribute(Qt.AA_EnableHighDpiScaling)
    QApplication.setAttribute(Qt.AA_UseHighDpiPixmaps)

    app = QApplication(sys.argv)
    
    font = QFont("Arial", 10)
    app.setFont(font)
    
    load_stylesheet(app, "styles.qss")
    
    model = SystemModel()
    controller = SpecificSystemController(model, max_cache_size=3)
    controller.start()
    sys.exit(app.exec())
åŠ¨æ€ç¼©æ”¾ä¼˜åŒ–çš„å®ç°
ç¼©æ”¾æ¯”ä¾‹è®¡ç®—
åœ¨ _adjust_widget_size ä¸­ï¼š
python
scale = min(screen_size.width() / DESIGN_WIDTH, screen_size.height() / DESIGN_HEIGHT)
DESIGN_WIDTH=1634, DESIGN_HEIGHT=1054 æ˜¯åŸºå‡†åˆ†è¾¨ç‡ã€‚
scale å–å®½åº¦å’Œé«˜åº¦ç¼©æ”¾æ¯”ä¾‹çš„æœ€å°å€¼ï¼Œç¡®ä¿ç»„ä»¶ä¸æº¢å‡ºã€‚
ç»„ä»¶åŠ¨æ€è°ƒæ•´
ä¸»çª—å£ï¼š
MainWindow.adjust_geometry(scale)ï¼šæ ¹æ®æ¯”ä¾‹è°ƒæ•´æ ‡é¢˜æ ã€ä¾§è¾¹æ å’Œå†…å®¹åŒºã€‚
ä¾§è¾¹æ å®½åº¦ä» 200 åŠ¨æ€ç¼©æ”¾åˆ° 200 * scaleï¼Œå†…å®¹åŒºéšä¹‹è°ƒæ•´ã€‚
ä¸‹æ‹‰æ¡†å’Œå…¶ä»–æ§ä»¶ï¼š
BaseQueryWidget.adjust_geometry(scale)ï¼š
ä¸‹æ‹‰æ¡†ï¼šx=138*scale, y=164*scale, width=240*scale, height=32*scaleã€‚
æŒ‰é’®å’Œè¡¨æ ¼æŒ‰æ¯”ä¾‹ç¼©æ”¾ï¼Œè®¾ç½®æœ€å°å°ºå¯¸ï¼ˆå¦‚ä¸‹æ‹‰æ¡†å®½åº¦æœ€å° 150pxï¼‰ã€‚
CPUSpecsWidgetï¼šé™„åŠ ä¸‹æ‹‰æ¡† Y è½´é€’å¢ï¼ˆ164 + i * 40 * scaleï¼‰ã€‚
æœ€å°å°ºå¯¸ä¿æŠ¤ï¼š
ä½¿ç”¨ max() ç¡®ä¿æ§ä»¶ä¸å°äºå¯æ“ä½œå°ºå¯¸ï¼ˆå¦‚æŒ‰é’®å®½åº¦æœ€å° 60pxï¼Œé«˜åº¦ 20pxï¼‰ã€‚
æ§åˆ¶å™¨é›†æˆ
_adjust_widget_size è°ƒç”¨ adjust_geometryï¼Œå°†ç¼©æ”¾æ¯”ä¾‹ä¿å­˜åˆ° widget.scale_factorï¼Œä¾›å­æ§ä»¶åŠ¨æ€è°ƒæ•´ä½¿ç”¨ã€‚
æµ‹è¯•æ­¥éª¤
è¿è¡Œ main.pyï¼Œè¾“å…¥ admin å’Œ 123456ã€‚
éªŒè¯åŠ¨æ€ç¼©æ”¾ï¼š
ç¬”è®°æœ¬ï¼ˆ1366x768ï¼‰ï¼š
ç¼©æ”¾æ¯”ä¾‹çº¦ 0.835ï¼ˆ1366/1634ï¼‰ï¼Œä¸‹æ‹‰æ¡†ä½ç½®çº¦ (115, 137)ï¼Œå¤§å°çº¦ (200x27)ã€‚
çª—å£å  70%ï¼Œç»„ä»¶æ¯”ä¾‹ç¼©å°ä½†æ¸…æ™°ã€‚
å°å¼æœºï¼ˆ2560x1440ï¼‰ï¼š
ç¼©æ”¾æ¯”ä¾‹çº¦ 1.36ï¼ˆ2560/1634 å—é«˜åº¦é™åˆ¶ä¸º 1440/1054ï¼‰ï¼Œä¸‹æ‹‰æ¡†ä½ç½®çº¦ (188, 223)ï¼Œå¤§å°çº¦ (326x43)ã€‚
çª—å£å  80%ï¼Œç»„ä»¶æ”¾å¤§ã€‚
æµ‹è¯•çŠ¶æ€ä¿æŒï¼š
æ·»åŠ ä¸‹æ‹‰æ¡†ã€ä¿®æ”¹è¡¨æ ¼ï¼Œåˆ‡æ¢é¡µé¢ï¼Œç¡®è®¤ç¼“å­˜å†…çŠ¶æ€ä¿ç•™ã€‚
éªŒè¯è¾¹ç•Œï¼š
å°å±å¹•æ— æº¢å‡ºï¼Œå¤§å±å¹•ç»„ä»¶ä¸è¿‡å°ã€‚
ç¤ºä¾‹è¾“å‡º
# ç¬”è®°æœ¬ (1366x768)
Created and switched to page: cpu_specs  # ä¸‹æ‹‰æ¡†çº¦ (115, 137, 200, 27)
Switched to cached page: server_data

# å°å¼æœº (2560x1440)
Created and switched to page: cpu_specs  # ä¸‹æ‹‰æ¡†çº¦ (188, 223, 326, 43)
Switched to cached page: server_data
ä¼˜åŒ–äº®ç‚¹
åŠ¨æ€ç¼©æ”¾ï¼šç»„ä»¶ä½ç½®å’Œå¤§å°éšå±å¹•åˆ†è¾¨ç‡è°ƒæ•´ï¼Œä¿æŒè®¾è®¡æ¯”ä¾‹ã€‚
è¾¹ç•Œä¿æŠ¤ï¼šæœ€å°å°ºå¯¸ç¡®ä¿å°å±å¹•å¯ç”¨æ€§ï¼Œå¤§å±å¹•ä¸è¿‡å¤§ã€‚
ä»£ç å¤ç”¨ï¼šadjust_geometry åœ¨çˆ¶ç±»å’Œå­ç±»ä¸­ç»Ÿä¸€è°ƒç”¨ï¼Œå‡å°‘é‡å¤ã€‚
å¦‚æœæ‚¨æœ‰æ›´å¤šç»„ä»¶åæ ‡éœ€è¦åŠ¨æ€è°ƒæ•´ï¼Œæˆ–éœ€è¦è¿›ä¸€æ­¥ä¼˜åŒ–ï¼ˆå¦‚åŠ¨ç”»æ•ˆæœï¼‰ï¼Œè¯·æä¾›è¯¦æƒ…ï¼











æŒ‰ç…§æ‚¨çš„è¦æ±‚ï¼Œæˆ‘å°†å»æ‰ä¸»é¡µä¾§è¾¹æ çš„æ”¶ç¼©æŒ‰é’®ï¼ˆtoggle_btnï¼‰ï¼Œå¹¶ç»“åˆä¹‹å‰çš„æ‰€æœ‰åŠŸèƒ½ï¼ˆåŒ…æ‹¬åˆ†è¾¨ç‡é€‚é…ã€åŠ¨æ€æ¸²æŸ“ã€ä¿¡å·ä¼˜åŒ–ç­‰ï¼‰ï¼Œè¾“å‡ºå®Œæ•´çš„ä¼˜åŒ–ä»£ç ã€‚ä»¥ä¸‹æ˜¯å®Œæ•´å®ç°ï¼š
å®Œæ•´ä»£ç 
model.py
python
class SystemModel:
    def __init__(self):
        self.users = {"admin": "123456"}
        self.cpu_models = ["Intel i9-13900K", "AMD Ryzen 9 7950X", "Intel i7-13700K", "AMD Ryzen 7 7700X", "Intel i5-13600K", "AMD Ryzen 5 7600X"]
        self.cpu_specs = {
            "Intel i9-13900K": {"Cores": 24, "Threads": 32, "Base Clock": "3.0 GHz", "Boost Clock": "5.8 GHz", "Cache": "36 MB", "TDP": "125 W"},
            "AMD Ryzen 9 7950X": {"Cores": 16, "Threads": 32, "Base Clock": "4.5 GHz", "Boost Clock": "5.7 GHz", "Cache": "80 MB", "TDP": "170 W"},
            "Intel i7-13700K": {"Cores": 16, "Threads": 24, "Base Clock": "3.4 GHz", "Boost Clock": "5.4 GHz", "Cache": "30 MB", "TDP": "125 W"},
            "AMD Ryzen 7 7700X": {"Cores": 8, "Threads": 16, "Base Clock": "4.5 GHz", "Boost Clock": "5.4 GHz", "Cache": "40 MB", "TDP": "105 W"},
            "Intel i5-13600K": {"Cores": 14, "Threads": 20, "Base Clock": "3.5 GHz", "Boost Clock": "5.1 GHz", "Cache": "24 MB", "TDP": "125 W"},
            "AMD Ryzen 5 7600X": {"Cores": 6, "Threads": 12, "Base Clock": "4.7 GHz", "Boost Clock": "5.3 GHz", "Cache": "38 MB", "TDP": "105 W"},
        }
        self.server_data = {
            "Intel i9-13900K": {"CPU Usage": "45%", "Memory": "16 GB", "Latency": "5 ms", "Disk I/O": "120 MB/s", "Network": "1 Gbps"},
            "AMD Ryzen 9 7950X": {"CPU Usage": "60%", "Memory": "32 GB", "Latency": "4 ms", "Disk I/O": "200 MB/s", "Network": "2 Gbps"},
            "Intel i7-13700K": {"CPU Usage": "35%", "Memory": "12 GB", "Latency": "6 ms", "Disk I/O": "100 MB/s", "Network": "800 Mbps"},
            "AMD Ryzen 7 7700X": {"CPU Usage": "50%", "Memory": "24 GB", "Latency": "3 ms", "Disk I/O": "150 MB/s", "Network": "1.5 Gbps"},
            "Intel i5-13600K": {"CPU Usage": "40%", "Memory": "8 GB", "Latency": "7 ms", "Disk I/O": "90 MB/s", "Network": "700 Mbps"},
            "AMD Ryzen 5 7600X": {"CPU Usage": "55%", "Memory": "16 GB", "Latency": "5 ms", "Disk I/O": "130 MB/s", "Network": "1 Gbps"},
        }
        self.virtualization_data = {
            "Intel i9-13900K": {"VM Count": "10", "vCPU Usage": "50%", "Memory Usage": "12 GB", "IOPS": "5000"},
            "AMD Ryzen 9 7950X": {"VM Count": "15", "vCPU Usage": "65%", "Memory Usage": "24 GB", "IOPS": "7000"},
            "Intel i7-13700K": {"VM Count": "8", "vCPU Usage": "40%", "Memory Usage": "10 GB", "IOPS": "4000"},
            "AMD Ryzen 7 7700X": {"VM Count": "12", "vCPU Usage": "55%", "Memory Usage": "18 GB", "IOPS": "6000"},
            "Intel i5-13600K": {"VM Count": "6", "vCPU Usage": "45%", "Memory Usage": "6 GB", "IOPS": "3000"},
            "AMD Ryzen 5 7600X": {"VM Count": "9", "vCPU Usage": "60%", "Memory Usage": "14 GB", "IOPS": "4500"},
        }

    def validate_login(self, username, password):
        return username in self.users and self.users[username] == password

    def get_cpu_specs(self, cpu_model):
        return self.cpu_specs.get(cpu_model, {})

    def get_server_data(self, cpu_model):
        return self.server_data.get(cpu_model, {})

    def get_virtualization_data(self, cpu_model):
        return self.virtualization_data.get(cpu_model, {})

    def update_server_data(self, cpu_model, key, value):
        if cpu_model in self.server_data:
            self.server_data[cpu_model][key] = value
views.py
python
from PySide6.QtWidgets import (QMainWindow, QWidget, QVBoxLayout, QHBoxLayout, QComboBox, 
                               QPushButton, QTableWidget, QTableWidgetItem, QLabel, 
                               QLineEdit, QFrame, QMessageBox, QSpacerItem, QSizePolicy, QStackedWidget)
from PySide6.QtCore import Qt, Signal, Slot, QTimer
from PySide6.QtGui import QIcon

# å…¨å±€æ ·å¼
GLOBAL_STYLES = {
    "button_primary": "padding: 10px; background-color: #2196F3; color: white;",
    "button_action": "padding: 5px; background-color: #4CAF50; color: white;",
    "button_danger": "padding: 5px; background-color: #F44336; color: white;",
    "table": "border: 1px solid #ccc; padding: 5px;",
    "sidebar": "background-color: #f0f0f0; border-right: 1px solid #ccc;"
}

class LoginWidget(QWidget):
    login_signal = Signal(str, str)

    def __init__(self):
        super().__init__()
        layout = QVBoxLayout()
        layout.setSpacing(10)
        layout.setContentsMargins(20, 20, 20, 20)
        self.username_input = QLineEdit(self)
        self.username_input.setPlaceholderText("Username")
        self.password_input = QLineEdit(self)
        self.password_input.setPlaceholderText("Password")
        self.password_input.setEchoMode(QLineEdit.Password)
        self.login_btn = QPushButton("Login")
        self.login_btn.setStyleSheet(GLOBAL_STYLES["button_action"])
        self.login_btn.setMinimumHeight(30)
        layout.addWidget(self.username_input)
        layout.addWidget(self.password_input)
        layout.addWidget(self.login_btn)
        layout.addStretch()
        self.setLayout(layout)
        self.login_btn.clicked.connect(self.emit_login)

    @Slot()
    def emit_login(self):
        self.login_signal.emit(self.username_input.text(), self.password_input.text())

class MainWindow(QMainWindow):
    def __init__(self, username):
        super().__init__()
        self.setWindowTitle("Information Query System")
        self.username = username
        self.init_ui()

    def init_ui(self):
        title_bar = QWidget()
        title_layout = QHBoxLayout()
        title_bar.setMinimumHeight(40)
        title_bar.setStyleSheet("background-color: #2E2E2E; color: white; padding: 5px;")
        logo_label = QLabel("Logo")
        user_label = QLabel(f"User: {self.username}")
        self.logout_btn = QPushButton("Logout")
        self.logout_btn.setStyleSheet(GLOBAL_STYLES["button_danger"])
        self.logout_btn.setMinimumHeight(30)
        title_layout.addWidget(logo_label)
        title_layout.addStretch()
        title_layout.addWidget(user_label)
        title_layout.addWidget(self.logout_btn)
        title_bar.setLayout(title_layout)

        main_widget = QWidget()
        main_layout = QHBoxLayout()
        main_layout.setContentsMargins(10, 10, 10, 10)
        main_layout.setSpacing(10)

        self.sidebar = QFrame()
        self.sidebar.setStyleSheet(GLOBAL_STYLES["sidebar"])
        sidebar_layout = QVBoxLayout()
        sidebar_layout.setAlignment(Qt.AlignCenter)
        sidebar_layout.setSpacing(5)

        self.cpu_btn = QPushButton("CPU Specs")
        self.cpu_btn.setIcon(QIcon("cpu_icon.png"))
        self.cpu_btn.setIconSize(Qt.QSize(24, 24))
        self.server_btn = QPushButton("Server Data")
        self.virtual_btn = QPushButton("Virtualization Perf")
        self.clear_cache_btn = QPushButton("Clear Cache")
        for btn in [self.cpu_btn, self.server_btn, self.virtual_btn, self.clear_cache_btn]:
            btn.setStyleSheet(GLOBAL_STYLES["button_primary"] + " margin: 5px; text-align: left;")
            btn.setMinimumHeight(40)

        # å»æ‰ toggle_btn å’Œ toggle_layout
        sidebar_layout.addSpacerItem(QSpacerItem(20, 40, QSizePolicy.Minimum, QSizePolicy.Expanding))
        sidebar_layout.addWidget(self.cpu_btn)
        sidebar_layout.addWidget(self.server_btn)
        sidebar_layout.addWidget(self.virtual_btn)
        sidebar_layout.addWidget(self.clear_cache_btn)
        sidebar_layout.addSpacerItem(QSpacerItem(20, 20, QSizePolicy.Minimum, QSizePolicy.Fixed))
        sidebar_layout.addSpacerItem(QSpacerItem(20, 40, QSizePolicy.Minimum, QSizePolicy.Expanding))
        self.sidebar.setLayout(sidebar_layout)

        self.content_stack = QStackedWidget()

        main_layout.addWidget(self.sidebar, stretch=1)
        main_layout.addWidget(self.content_stack, stretch=4)
        main_widget.setLayout(main_layout)

        central_layout = QVBoxLayout()
        central_layout.addWidget(title_bar)
        central_layout.addWidget(main_widget)
        central_widget = QWidget()
        central_widget.setLayout(central_layout)
        self.setCentralWidget(central_widget)

    def setWidth(self, width):
        self.sidebar.setFixedWidth(width)

class BaseQueryWidget(QWidget):
    query_signal = Signal(str)
    clear_signal = Signal()
    modify_signal = Signal(str, int, str, str)

    def __init__(self, model, column_count=2, headers=["Property", "Value"]):
        super().__init__()
        self.model = model
        self.column_count = column_count
        self.headers = headers
        self.init_ui()

    def init_ui(self):
        layout = QHBoxLayout()
        layout.setContentsMargins(10, 10, 10, 10)
        layout.setSpacing(10)

        left_widget = QWidget()
        self.left_layout = QVBoxLayout()
        self.left_layout.setSpacing(5)
        self.cpu_combo = QComboBox()
        self.cpu_combo.addItems(self.model.cpu_models)
        self.cpu_combo.setMinimumWidth(150)
        self.query_btn = QPushButton("Query")
        self.clear_btn = QPushButton("Clear")
        for btn in [self.query_btn, self.clear_btn]:
            btn.setStyleSheet(GLOBAL_STYLES["button_action"])
            btn.setMinimumHeight(30)
        self.left_layout.addWidget(self.cpu_combo)
        self.init_extra_ui()
        self.left_layout.addWidget(self.query_btn)
        self.left_layout.addWidget(self.clear_btn)
        self.left_layout.addStretch()
        left_widget.setLayout(self.left_layout)

        self.table = QTableWidget()
        self.table.setColumnCount(self.column_count)
        self.table.setHorizontalHeaderLabels(self.headers)
        self.table.setStyleSheet(GLOBAL_STYLES["table"])
        self.table.horizontalHeader().setStretchLastSection(True)

        layout.addWidget(left_widget, stretch=1)
        layout.addWidget(self.table, stretch=3)
        self.setLayout(layout)

        self.query_btn.clicked.connect(lambda: self.query_signal.emit(self.cpu_combo.currentText()))
        self.clear_btn.clicked.connect(self.clear_signal)

    def init_extra_ui(self):
        pass

    def update_table(self, cpu_model=None):
        QTimer.singleShot(0, lambda: self._update_table_async(cpu_model))

    def _update_table_async(self, cpu_model=None):
        pass

    def clear_table(self):
        self.table.setRowCount(0)

class CPUSpecsWidget(BaseQueryWidget):
    def __init__(self, model):
        super().__init__(model, column_count=2, headers=["Property", "Value"])
        self.combos = []
        self.add_btn.clicked.connect(self.add_combo)
        self.remove_btn.clicked.connect(self.remove_combo)

    def init_extra_ui(self):
        self.add_btn = QPushButton("+")
        self.remove_btn = QPushButton("-")
        for btn in [self.add_btn, self.remove_btn]:
            btn.setStyleSheet(GLOBAL_STYLES["button_action"])
            btn.setMinimumHeight(30)
        for _ in range(5):
            self.add_combo()
        self.left_layout.insertWidget(1, self.add_btn)
        self.left_layout.insertWidget(2, self.remove_btn)

    def add_combo(self):
        combo = QComboBox()
        combo.addItems(self.model.cpu_models)
        combo.currentTextChanged.connect(lambda text: self.query_signal.emit(text))
        self.combos.append(combo)
        self.left_layout.insertWidget(len(self.combos), combo)

    def remove_combo(self):
        if len(self.combos) > 0:
            combo = self.combos.pop()
            combo.deleteLater()
            self.table.clearContents()

    def _update_table_async(self, cpu_model=None):
        if cpu_model is None:
            cpu_model = self.cpu_combo.currentText()
        specs = self.model.get_cpu_specs(cpu_model)
        self.table.setRowCount(len(specs))
        for i, (key, value) in enumerate(specs.items()):
            self.table.setItem(i, 0, QTableWidgetItem(key))
            self.table.setItem(i, 1, QTableWidgetItem(str(value)))
        self.table.resizeColumnsToContents()

class ServerDataWidget(BaseQueryWidget):
    def __init__(self, model):
        super().__init__(model, column_count=4, headers=["Property", "Value", "Modify", "Link"])

    def init_extra_ui(self):
        self.extra_combo = QComboBox()
        self.extra_combo.addItems(["Option1", "Option2"])
        self.extra_combo.setMinimumWidth(150)
        self.left_layout.insertWidget(1, self.extra_combo)

    def _update_table_async(self, cpu_model=None):
        if cpu_model is None:
            cpu_model = self.cpu_combo.currentText()
        data = self.model.get_server_data(cpu_model)
        self.table.setRowCount(len(data))
        modify_values = {}
        for row in range(self.table.rowCount()):
            combo = self.table.cellWidget(row, 2)
            if combo:
                modify_values[row] = combo.currentText()

        for i, (key, value) in enumerate(data.items()):
            self.table.setItem(i, 0, QTableWidgetItem(key))
            self.table.setItem(i, 1, QTableWidgetItem(value))
            combo = QComboBox()
            combo.addItems(["Low", "Medium", "High"])
            combo.setCurrentText(modify_values.get(i, "Medium"))
            combo.currentTextChanged.connect(lambda text, r=i, k=key: self.modify_signal.emit(cpu_model, r, k, text))
            self.table.setCellWidget(i, 2, combo)
            btn = QPushButton("Link")
            btn.clicked.connect(self.open_link)
            self.table.setCellWidget(i, 3, btn)
        self.table.resizeColumnsToContents()

    def open_link(self):
        from PySide6.QtGui import QDesktopServices, QUrl
        QDesktopServices.openUrl(QUrl("https://www.baidu.com"))
        print("Opening Baidu homepage")

class VirtualizationPerfWidget(BaseQueryWidget):
    def __init__(self, model):
        super().__init__(model, column_count=2, headers=["Property", "Value"])

    def _update_table_async(self, cpu_model=None):
        if cpu_model is None:
            cpu_model = self.cpu_combo.currentText()
        data = self.model.get_virtualization_data(cpu_model)
        self.table.setRowCount(len(data))
        for i, (key, value) in enumerate(data.items()):
            self.table.setItem(i, 0, QTableWidgetItem(key))
            self.table.setItem(i, 1, QTableWidgetItem(value))
        self.table.resizeColumnsToContents()
controller.py
python
from PySide6.QtWidgets import QMessageBox
from PySide6.QtCore import Slot, QSize
from PySide6.QtGui import QScreen
from views import MainWindow, CPUSpecsWidget, ServerDataWidget, VirtualizationPerfWidget

class SystemController:
    def __init__(self, model, login_widget, main_window_class=MainWindow, use_dynamic_rendering=False):
        self.model = model
        self.login_widget = login_widget
        self.main_window_class = main_window_class
        self.use_dynamic_rendering = use_dynamic_rendering
        self.main_window = None
        self.current_page = None
        
        self.login_widget.login_signal.connect(self._on_login)
        self._adjust_widget_size(self.login_widget)

    def _adjust_widget_size(self, widget, is_login_widget=True):
        screen = widget.screen()
        screen_size = screen.availableSize()
        if is_login_widget:
            if screen_size.width() < 1600:  # ç¬”è®°æœ¬
                width, height = screen_size.width() * 0.25, screen_size.height() * 0.25
            else:  # å°å¼æœº
                width, height = screen_size.width() * 0.3, screen_size.height() * 0.3
            widget.resize(int(width), int(height))
            widget.setMinimumSize(QSize(300, 200))
            widget.setMaximumSize(QSize(500, 400))
        else:
            if screen_size.width() < 1600:
                width, height = screen_size.width() * 0.7, screen_size.height() * 0.7
                sidebar_width = int(screen_size.width() * 0.1)
            else:
                width, height = screen_size.width() * 0.8, screen_size.height() * 0.8
                sidebar_width = int(screen_size.width() * 0.15)
            widget.resize(int(width), int(height))
            widget.setMinimumSize(QSize(800, 600))
            widget.sidebar.setWidth(sidebar_width)
            widget.sidebar.setMinimumWidth(int(screen_size.width() * 0.05))
            widget.sidebar.setMaximumWidth(int(screen_size.width() * 0.25))

    def _init_main_window(self, username):
        self.main_window = self.main_window_class(username)
        self._adjust_widget_size(self.main_window, is_login_widget=False)
        
        self.main_window.logout_btn.clicked.connect(self._on_logout)
        self.main_window.clear_cache_btn.clicked.connect(self._clear_current_page)
        
        self._register_page("cpu_specs", CPUSpecsWidget, self.main_window.cpu_btn)
        self._register_page("server_data", ServerDataWidget, self.main_window.server_btn)
        self._register_page("virtualization_perf", VirtualizationPerfWidget, self.main_window.virtual_btn)

    def _register_page(self, name, widget_class, button):
        button.clicked.connect(lambda: self._switch_page(name, widget_class))

    @Slot(str, str)
    def _on_login(self, username, password):
        if self.model.validate_login(username, password):
            self._init_main_window(username)
            self.main_window.show()
            self.login_widget.hide()
        else:
            QMessageBox.warning(self.login_widget, "Login Failed", "Invalid username or password")

    @Slot()
    def _on_logout(self):
        self._clear_current_page()
        self.main_window.hide()
        self.login_widget.show()

    @Slot()
    def _clear_current_page(self):
        if self.current_page:
            self.main_window.content_stack.removeWidget(self.current_page)
            self.current_page.deleteLater()
            self.current_page = None
            print("Cleared current page")

    def _switch_page(self, name, widget_class):
        if self.use_dynamic_rendering or self.current_page is None:
            self._clear_current_page()
            self.current_page = widget_class(self.model)
            self.main_window.content_stack.addWidget(self.current_page)
            self._connect_page_signals(self.current_page)
            print(f"Rendered new page: {name}")
        else:
            if self.current_page.__class__.__name__ != widget_class.__name__:
                self._clear_current_page()
                self.current_page = widget_class(self.model)
                self.main_window.content_stack.addWidget(self.current_page)
                self._connect_page_signals(self.current_page)
                print(f"Switched to new page: {name}")
            else:
                print(f"Already on page: {name}")

    def _connect_page_signals(self, widget):
        widget.query_signal.connect(widget.update_table)
        widget.clear_signal.connect(widget.clear_table)
        if hasattr(widget, "modify_signal"):
            widget.modify_signal.connect(self._modify_server_data)

    @Slot(str, int, str, str)
    def _modify_server_data(self, cpu_model, row, key, text):
        self.model.update_server_data(cpu_model, key, f"{text} ({self.model.get_server_data(cpu_model)[key].split(' (')[0]})")
        if self.current_page:
            self.current_page.update_table()
        print(f"Row {row} modified: {key} = {self.model.get_server_data(cpu_model)[key]}")
main.py
python
from PySide6.QtWidgets import QApplication
from PySide6.QtCore import Qt
from PySide6.QtGui import QFont
from model import SystemModel
from views import LoginWidget, GLOBAL_STYLES
from controller import SystemController

if __name__ == "__main__":
    QApplication.setAttribute(Qt.AA_EnableHighDpiScaling)
    QApplication.setAttribute(Qt.AA_UseHighDpiPixmaps)

    app = QApplication(sys.argv)
    
    font = QFont("Arial", 10)
    app.setFont(font)
    
    app.setStyleSheet(f"QWidget {{ font-size: 14px; }} QPushButton {{ {GLOBAL_STYLES['button_primary']} }}")
    
    model = SystemModel()
    login_widget = LoginWidget()
    controller = SystemController(model, login_widget, use_dynamic_rendering=True)
    login_widget.show()
    sys.exit(app.exec())
ä¸»è¦ä¼˜åŒ–ç‚¹
å»æ‰ä¾§è¾¹æ æ”¶ç¼©æŒ‰é’®ï¼š
MainWindow ä¸­ç§»é™¤ toggle_btn å’Œ toggle_layoutï¼Œä¾§è¾¹æ å®½åº¦å›ºå®šä½†åŠ¨æ€è°ƒæ•´ã€‚
SystemController ä¸­åˆ é™¤ _toggle_sidebar æ–¹æ³•ï¼Œç®€åŒ–é€»è¾‘ã€‚
åˆ†è¾¨ç‡é€‚é…ï¼š
_adjust_widget_size æ ¹æ®å±å¹•å®½åº¦ï¼ˆ<1600px ä¸ºç¬”è®°æœ¬ï¼Œâ‰¥1600px ä¸ºå°å¼æœºï¼‰è®¾ç½®çª—å£å’Œä¾§è¾¹æ å¤§å°ã€‚
ç™»å½•çª—å£ï¼šç¬”è®°æœ¬ 25%ï¼Œå°å¼æœº 30%ï¼Œæœ€å° 300x200ï¼Œæœ€å¤§ 500x400ã€‚
ä¸»çª—å£ï¼šç¬”è®°æœ¬ 70%ï¼Œå°å¼æœº 80%ï¼Œæœ€å° 800x600ã€‚
ä¾§è¾¹æ ï¼šç¬”è®°æœ¬ 10%ï¼Œå°å¼æœº 15%ï¼Œæœ€å° 5%ï¼Œæœ€å¤§ 25%ã€‚
åŠ¨æ€æ¸²æŸ“ï¼š
use_dynamic_rendering=True æ—¶ï¼Œæ¯æ¬¡ç‚¹å‡»é‡æ–°æ¸²æŸ“é¡µé¢ï¼Œå†…å­˜å ç”¨ä½ã€‚
False æ—¶ï¼Œä»…é¦–æ¬¡æ¸²æŸ“å¹¶åˆ‡æ¢ï¼Œä¿ç•™çŠ¶æ€ã€‚
ä¿¡å·ä¼˜åŒ–ï¼š
æ‰€æœ‰ä¿¡å·ï¼ˆquery_signalã€clear_signalã€modify_signalï¼‰é›†ä¸­åœ¨ BaseQueryWidgetï¼Œå­ç±»ç»§æ‰¿ä½¿ç”¨ã€‚
è‡ªé€‚åº”å¸ƒå±€ï¼š
ä¸»å¸ƒå±€ä½¿ç”¨ stretchï¼ˆä¾§è¾¹æ  1: å†…å®¹åŒº 4ï¼‰ï¼Œéšçª—å£å¤§å°è°ƒæ•´ã€‚
è¡¨æ ¼ä½¿ç”¨ setStretchLastSection(True)ï¼Œé€‚é…å†…å®¹åŒºå®½åº¦ã€‚
æµ‹è¯•æ­¥éª¤
ç¬”è®°æœ¬ï¼ˆ1366x768ï¼‰ï¼š
è¿è¡Œç¨‹åºï¼Œç¡®è®¤çª—å£å  70%ï¼Œä¾§è¾¹æ çº¦ 130pxï¼Œæ— æ”¶ç¼©æŒ‰é’®ã€‚
åˆ‡æ¢é¡µé¢ï¼ŒéªŒè¯å†…å®¹åŒºè‡ªé€‚åº”ã€‚
å°å¼æœºï¼ˆ2560x1440ï¼‰ï¼š
ç¡®è®¤çª—å£å  80%ï¼Œä¾§è¾¹æ çº¦ 384pxï¼Œæ— æ”¶ç¼©æŒ‰é’®ã€‚
æ£€æŸ¥å­—ä½“æ¸…æ™°åº¦å’Œæ§ä»¶æ¯”ä¾‹ã€‚
æ“ä½œï¼š
ç™»å½•ã€åˆ‡æ¢é¡µé¢ã€ä¿®æ”¹è¡¨æ ¼ã€æ¸…é™¤ç¼“å­˜ã€é€€å‡ºï¼Œç¡®ä¿åŠŸèƒ½æ­£å¸¸ã€‚
ç¤ºä¾‹è¾“å‡º
# ç¬”è®°æœ¬ (1366x768)
Rendered new page: cpu_specs  # çª—å£çº¦ 950x530ï¼Œä¾§è¾¹æ çº¦ 130px
Switched to new page: server_data
Row 0 modified: CPU Usage = High (45%)

# å°å¼æœº (2560x1440)
Rendered new page: cpu_specs  # çª—å£çº¦ 2048x1152ï¼Œä¾§è¾¹æ çº¦ 384px
Switched to new page: server_data
åŠŸèƒ½éªŒè¯
åˆ†è¾¨ç‡é€‚é…ï¼šç¬”è®°æœ¬å’Œå°å¼æœºå±å¹•å¤§å°åŠ¨æ€è°ƒæ•´ã€‚
æ— æ”¶ç¼©æŒ‰é’®ï¼šä¾§è¾¹æ å›ºå®šå®½åº¦ï¼Œç®€åŒ– UIã€‚
åŠ¨æ€æ¸²æŸ“ï¼šæ”¯æŒé¡µé¢å®æ—¶æ¸²æŸ“æˆ–åˆ‡æ¢ã€‚
ä¿¡å·ä¼˜åŒ–ï¼šå­ç±»å¤ç”¨çˆ¶ç±»ä¿¡å·ï¼Œå‡å°‘é‡å¤ã€‚
å¦‚æœæ‚¨éœ€è¦è¿›ä¸€æ­¥è°ƒæ•´ï¼ˆå¦‚ä¾§è¾¹æ å®½åº¦å¾®è°ƒã€çŠ¶æ€ä¿å­˜ï¼‰ï¼Œè¯·å‘Šè¯‰æˆ‘ï¼







from PySide6.QtWidgets import QMessageBox
from PySide6.QtCore import Slot
from views import MainWindow, CPUSpecsWidget, ServerDataWidget, VirtualizationPerfWidget

class SystemController:
    def __init__(self, model, login_widget, main_window_class=MainWindow, use_dynamic_rendering=False):
        self.model = model
        self.login_widget = login_widget
        self.main_window_class = main_window_class
        self.use_dynamic_rendering = use_dynamic_rendering  # æ˜¯å¦åŠ¨æ€æ¸²æŸ“
        self.main_window = None
        self.current_page = None
        
        self.login_widget.login_signal.connect(self._on_login)

    def _init_main_window(self, username):
        self.main_window = self.main_window_class(username)
        self.main_window.toggle_btn.clicked.connect(self.main_window.toggle_sidebar)
        self.main_window.logout_btn.clicked.connect(self._on_logout)
        self.main_window.clear_cache_btn.clicked.connect(self._clear_current_page)
        
        # æ³¨å†Œé¡µé¢
        self._register_page("cpu_specs", CPUSpecsWidget, self.main_window.cpu_btn)
        self._register_page("server_data", ServerDataWidget, self.main_window.server_btn)
        self._register_page("virtualization_perf", VirtualizationPerfWidget, self.main_window.virtual_btn)

    def _register_page(self, name, widget_class, button):
        button.clicked.connect(lambda: self._switch_page(name, widget_class))

    @Slot(str, str)
    def _on_login(self, username, password):
        if self.model.validate_login(username, password):
            self._init_main_window(username)
            self.main_window.show()
            self.login_widget.hide()
        else:
            QMessageBox.warning(self.login_widget, "Login Failed", "Invalid username or password")

    @Slot()
    def _on_logout(self):
        self._clear_current_page()
        self.main_window.hide()
        self.login_widget.show()

    @Slot()
    def _clear_current_page(self):
        if self.current_page:
            self.main_window.content_stack.removeWidget(self.current_page)
            self.current_page.deleteLater()
            self.current_page = None
            print("Cleared current page")

    def _switch_page(self, name, widget_class):
        if self.use_dynamic_rendering or self.current_page is None:
            self._clear_current_page()
            self.current_page = widget_class(self.model)
            self.main_window.content_stack.addWidget(self.current_page)
            self._connect_page_signals(self.current_page)
            print(f"Rendered new page: {name}")
        else:
            # å¦‚æœä¸åŠ¨æ€æ¸²æŸ“ï¼Œä¿æŒå½“å‰é¡µé¢ï¼ˆå¯é€‰æ‰©å±•ä¸ºç¼“å­˜ï¼‰
            if self.current_page.__class__.__name__ != widget_class.__name__:
                self._clear_current_page()
                self.current_page = widget_class(self.model)
                self.main_window.content_stack.addWidget(self.current_page)
                self._connect_page_signals(self.current_page)
                print(f"Switched to new page: {name}")
            else:
                print(f"Already on page: {name}")

    def _connect_page_signals(self, widget):
        widget.query_signal.connect(widget.update_table)
        widget.clear_signal.connect(widget.clear_table)
        if hasattr(widget, "modify_signal"):
            widget.modify_signal.connect(self._modify_server_data)

    @Slot(str, int, str, str)
    def _modify_server_data(self, cpu_model, row, key, text):
        self.model.update_server_data(cpu_model, key, f"{text} ({self.model.get_server_data(cpu_model)[key].split(' (')[0]})")
        if self.current_page:
            self.current_page.update_table()
        print(f"Row {row} modified: {key} = {self.model.get_server_data(cpu_model)[key]}")



from PySide6.QtWidgets import (QMainWindow, QWidget, QVBoxLayout, QHBoxLayout, QComboBox, 
                               QPushButton, QTableWidget, QTableWidgetItem, QLabel, 
                               QLineEdit, QFrame, QMessageBox, QSpacerItem, QSizePolicy, QStackedWidget)
from PySide6.QtCore import Qt, Signal, Slot, QTimer
from PySide6.QtGui import QIcon

# å…¨å±€æ ·å¼
GLOBAL_STYLES = {
    "button_primary": "padding: 10px; background-color: #2196F3; color: white;",
    "button_action": "padding: 5px; background-color: #4CAF50; color: white;",
    "button_danger": "padding: 5px; background-color: #F44336; color: white;",
    "table": "border: 1px solid #ccc; padding: 5px;",
    "sidebar": "background-color: #f0f0f0; border-right: 1px solid #ccc;"
}

class LoginWidget(QWidget):
    login_signal = Signal(str, str)

    def __init__(self):
        super().__init__()
        layout = QVBoxLayout()
        layout.setSpacing(10)
        layout.setContentsMargins(20, 20, 20, 20)
        self.username_input = QLineEdit(self)
        self.username_input.setPlaceholderText("Username")
        self.password_input = QLineEdit(self)
        self.password_input.setPlaceholderText("Password")
        self.password_input.setEchoMode(QLineEdit.Password)
        self.login_btn = QPushButton("Login")
        self.login_btn.setStyleSheet(GLOBAL_STYLES["button_action"])
        layout.addWidget(self.username_input)
        layout.addWidget(self.password_input)
        layout.addWidget(self.login_btn)
        layout.addStretch()
        self.setLayout(layout)
        self.login_btn.clicked.connect(self.emit_login)

    @Slot()
    def emit_login(self):
        self.login_signal.emit(self.username_input.text(), self.password_input.text())

class MainWindow(QMainWindow):
    def __init__(self, username):
        super().__init__()
        self.setWindowTitle("Information Query System")
        self.resize(1200, 800)
        self.username = username
        self.init_ui()

    def init_ui(self):
        title_bar = QWidget()
        title_layout = QHBoxLayout()
        title_bar.setFixedHeight(60)
        title_bar.setStyleSheet("background-color: #2E2E2E; color: white; padding: 5px;")
        logo_label = QLabel("Logo")
        user_label = QLabel(f"User: {self.username}")
        self.logout_btn = QPushButton("Logout")
        self.logout_btn.setStyleSheet(GLOBAL_STYLES["button_danger"])
        title_layout.addWidget(logo_label)
        title_layout.addStretch()
        title_layout.addWidget(user_label)
        title_layout.addWidget(self.logout_btn)
        title_bar.setLayout(title_layout)

        main_widget = QWidget()
        main_layout = QHBoxLayout()
        main_layout.setContentsMargins(10, 10, 10, 10)
        main_layout.setSpacing(10)

        self.sidebar = QFrame()
        self.sidebar.setFixedWidth(200)
        self.sidebar.setStyleSheet(GLOBAL_STYLES["sidebar"])
        sidebar_layout = QVBoxLayout()
        sidebar_layout.setAlignment(Qt.AlignCenter)

        self.cpu_btn = QPushButton("CPU Specs")
        self.cpu_btn.setIcon(QIcon("cpu_icon.png"))
        self.cpu_btn.setIconSize(Qt.QSize(24, 24))
        self.server_btn = QPushButton("Server Data")
        self.virtual_btn = QPushButton("Virtualization Perf")
        self.clear_cache_btn = QPushButton("Clear Cache")
        for btn in [self.cpu_btn, self.server_btn, self.virtual_btn]:
            btn.setStyleSheet(GLOBAL_STYLES["button_primary"] + " margin: 5px; text-align: left;")
        self.clear_cache_btn.setStyleSheet(GLOBAL_STYLES["button_danger"] + " margin: 5px;")
        
        self.toggle_btn = QPushButton("<<")
        self.toggle_btn.setStyleSheet(GLOBAL_STYLES["button_primary"] + " border: none;")
        self.toggle_btn.setFixedWidth(20)
        toggle_layout = QHBoxLayout()
        toggle_layout.addStretch()
        toggle_layout.addWidget(self.toggle_btn)

        sidebar_layout.addSpacerItem(QSpacerItem(20, 40, QSizePolicy.Minimum, QSizePolicy.Expanding))
        sidebar_layout.addWidget(self.cpu_btn)
        sidebar_layout.addWidget(self.server_btn)
        sidebar_layout.addWidget(self.virtual_btn)
        sidebar_layout.addWidget(self.clear_cache_btn)
        sidebar_layout.addSpacerItem(QSpacerItem(20, 20, QSizePolicy.Minimum, QSizePolicy.Fixed))
        sidebar_layout.addLayout(toggle_layout)
        sidebar_layout.addSpacerItem(QSpacerItem(20, 40, QSizePolicy.Minimum, QSizePolicy.Expanding))
        self.sidebar.setLayout(sidebar_layout)

        self.content_stack = QStackedWidget()

        main_layout.addWidget(self.sidebar)
        main_layout.addWidget(self.content_stack)
        main_widget.setLayout(main_layout)

        central_layout = QVBoxLayout()
        central_layout.addWidget(title_bar)
        central_layout.addWidget(main_widget)
        central_widget = QWidget()
        central_widget.setLayout(central_layout)
        self.setCentralWidget(central_widget)

    def toggle_sidebar(self):
        if self.sidebar.width() > 50:
            self.sidebar.setFixedWidth(50)
            self.toggle_btn.setText(">>")
        else:
            self.sidebar.setFixedWidth(200)
            self.toggle_btn.setText("<<")

class BaseQueryWidget(QWidget):
    # é›†ä¸­å®šä¹‰æ‰€æœ‰é€šç”¨ä¿¡å·
    query_signal = Signal(str)  # ç”¨äº CPU ä¸‹æ‹‰æ¡†è§¦å‘çš„æŸ¥è¯¢
    clear_signal = Signal()
    modify_signal = Signal(str, int, str, str)  # ç”¨äºè¡¨æ ¼ä¿®æ”¹

    def __init__(self, model, column_count=2, headers=["Property", "Value"]):
        super().__init__()
        self.model = model
        self.column_count = column_count
        self.headers = headers
        self.init_ui()

    def init_ui(self):
        layout = QHBoxLayout()
        layout.setSpacing(10)
        layout.setContentsMargins(10, 10, 10, 10)

        left_widget = QWidget()
        self.left_layout = QVBoxLayout()
        self.left_layout.setSpacing(5)
        self.cpu_combo = QComboBox()
        self.cpu_combo.addItems(self.model.cpu_models)
        self.query_btn = QPushButton("Query")
        self.clear_btn = QPushButton("Clear")
        for btn in [self.query_btn, self.clear_btn]:
            btn.setStyleSheet(GLOBAL_STYLES["button_action"])
        self.left_layout.addWidget(self.cpu_combo)
        self.init_extra_ui()
        self.left_layout.addWidget(self.query_btn)
        self.left_layout.addWidget(self.clear_btn)
        self.left_layout.addStretch()
        left_widget.setLayout(self.left_layout)

        self.table = QTableWidget()
        self.table.setColumnCount(self.column_count)
        self.table.setHorizontalHeaderLabels(self.headers)
        self.table.setStyleSheet(GLOBAL_STYLES["table"])

        layout.addWidget(left_widget)
        layout.addWidget(self.table, stretch=1)
        self.setLayout(layout)

        # è¿æ¥æŒ‰é’®ä¿¡å·
        self.query_btn.clicked.connect(lambda: self.query_signal.emit(self.cpu_combo.currentText()))
        self.clear_btn.clicked.connect(self.clear_signal)

    def init_extra_ui(self):
        pass

    def update_table(self, cpu_model=None):
        QTimer.singleShot(0, lambda: self._update_table_async(cpu_model))

    def _update_table_async(self, cpu_model=None):
        pass

    def clear_table(self):
        self.table.setRowCount(0)

class CPUSpecsWidget(BaseQueryWidget):
    def __init__(self, model):
        super().__init__(model, column_count=2, headers=["Property", "Value"])
        self.combos = []
        self.add_btn.clicked.connect(self.add_combo)
        self.remove_btn.clicked.connect(self.remove_combo)

    def init_extra_ui(self):
        self.add_btn = QPushButton("+")
        self.remove_btn = QPushButton("-")
        for btn in [self.add_btn, self.remove_btn]:
            btn.setStyleSheet(GLOBAL_STYLES["button_action"])
        for _ in range(5):
            self.add_combo()
        self.left_layout.insertWidget(1, self.add_btn)
        self.left_layout.insertWidget(2, self.remove_btn)

    def add_combo(self):
        combo = QComboBox()
        combo.addItems(self.model.cpu_models)
        combo.currentTextChanged.connect(lambda text: self.query_signal.emit(text))
        self.combos.append(combo)
        self.left_layout.insertWidget(len(self.combos), combo)

    def remove_combo(self):
        if len(self.combos) > 0:
            combo = self.combos.pop()
            combo.deleteLater()
            self.table.clearContents()

    def _update_table_async(self, cpu_model=None):
        if cpu_model is None:
            cpu_model = self.cpu_combo.currentText()
        specs = self.model.get_cpu_specs(cpu_model)
        self.table.setRowCount(len(specs))
        for i, (key, value) in enumerate(specs.items()):
            self.table.setItem(i, 0, QTableWidgetItem(key))
            self.table.setItem(i, 1, QTableWidgetItem(str(value)))
        self.table.resizeColumnsToContents()

class ServerDataWidget(BaseQueryWidget):
    def __init__(self, model):
        super().__init__(model, column_count=4, headers=["Property", "Value", "Modify", "Link"])

    def init_extra_ui(self):
        self.extra_combo = QComboBox()
        self.extra_combo.addItems(["Option1", "Option2"])
        self.left_layout.insertWidget(1, self.extra_combo)

    def _update_table_async(self, cpu_model=None):
        if cpu_model is None:
            cpu_model = self.cpu_combo.currentText()
        data = self.model.get_server_data(cpu_model)
        self.table.setRowCount(len(data))
        modify_values = {}
        for row in range(self.table.rowCount()):
            combo = self.table.cellWidget(row, 2)
            if combo:
                modify_values[row] = combo.currentText()

        for i, (key, value) in enumerate(data.items()):
            self.table.setItem(i, 0, QTableWidgetItem(key))
            self.table.setItem(i, 1, QTableWidgetItem(value))
            combo = QComboBox()
            combo.addItems(["Low", "Medium", "High"])
            combo.setCurrentText(modify_values.get(i, "Medium"))
            combo.currentTextChanged.connect(lambda text, r=i, k=key: self.modify_signal.emit(cpu_model, r, k, text))
            self.table.setCellWidget(i, 2, combo)
            btn = QPushButton("Link")
            btn.clicked.connect(self.open_link)
            self.table.setCellWidget(i, 3, btn)
        self.table.resizeColumnsToContents()

    def open_link(self):
        from PySide6.QtGui import QDesktopServices, QUrl
        QDesktopServices.openUrl(QUrl("https://www.baidu.com"))
        print("Opening Baidu homepage")

class VirtualizationPerfWidget(BaseQueryWidget):
    def __init__(self, model):
        super().__init__(model, column_count=2, headers=["Property", "Value"])

    def _update_table_async(self, cpu_model=None):
        if cpu_model is None:
            cpu_model = self.cpu_combo.currentText()
        data = self.model.get_virtualization_data(cpu_model)
        self.table.setRowCount(len(data))
        for i, (key, value) in enumerate(data.items()):
            self.table.setItem(i, 0, QTableWidgetItem(key))
            self.table.setItem(i, 1, QTableWidgetItem(value))
        self.table.resizeColumnsToContents()





æ‚¨çš„é—®é¢˜ä¸ä¹‹å‰ç›¸åŒï¼Œæˆ‘ç†è§£æ‚¨å¯èƒ½å¸Œæœ›è¿›ä¸€æ­¥æ¢è®¨æˆ–ç¡®è®¤é¡µé¢é”€æ¯æœºåˆ¶çš„å®ç°ã€‚åŸºäºä¹‹å‰çš„å›ç­”ï¼Œæˆ‘å·²ç»æä¾›äº†ä½¿ç”¨ QStackedWidget æ—¶é€šè¿‡æ‡’åŠ è½½å’Œ LRUï¼ˆæœ€è¿‘æœ€å°‘ä½¿ç”¨ï¼‰ç¼“å­˜æ¥å®ç°é¡µé¢é”€æ¯çš„æ–¹æ¡ˆã€‚ä¸ºäº†é¿å…é‡å¤ï¼Œæˆ‘å°†ä»å¦ä¸€ä¸ªè§’åº¦ä¼˜åŒ–é¡µé¢é”€æ¯æœºåˆ¶ï¼Œé‡ç‚¹è§£å†³ä»¥ä¸‹é—®é¢˜ï¼š
åŠ¨æ€é¡µé¢ç®¡ç†ï¼šæ”¯æŒæ‰‹åŠ¨é”€æ¯ç‰¹å®šé¡µé¢ï¼Œè€Œä¸æ˜¯ä»…ä¾èµ– LRUã€‚
å†…å­˜é‡Šæ”¾ç¡®è®¤ï¼šç¡®ä¿é¡µé¢é”€æ¯åå†…å­˜è¢«æ­£ç¡®é‡Šæ”¾ã€‚
ç”¨æˆ·æ§åˆ¶ï¼šå…è®¸ç”¨æˆ·é€‰æ‹©é”€æ¯é¡µé¢ï¼Œæå‡äº¤äº’æ€§ã€‚
ä»¥ä¸‹æ˜¯æ–°çš„ä¼˜åŒ–æ–¹æ¡ˆï¼ŒåŸºäºä¹‹å‰çš„ä»£ç æ·»åŠ äº†æ‰‹åŠ¨é”€æ¯åŠŸèƒ½å’Œå†…å­˜ç®¡ç†æ”¹è¿›ã€‚
ä¼˜åŒ–åçš„é¡µé¢é”€æ¯æœºåˆ¶è®¾è®¡
ç›®æ ‡
æ‡’åŠ è½½ï¼šé¡µé¢ä»…åœ¨é¦–æ¬¡è®¿é—®æ—¶åˆ›å»ºã€‚
ç¼“å­˜é™åˆ¶ï¼šé™åˆ¶ç¼“å­˜é¡µé¢æ•°ï¼Œè‡ªåŠ¨é”€æ¯æœ€æ—§é¡µé¢ã€‚
æ‰‹åŠ¨é”€æ¯ï¼šæä¾›æ¥å£å…è®¸ç”¨æˆ·æˆ–ç³»ç»Ÿæ‰‹åŠ¨é”€æ¯ç‰¹å®šé¡µé¢ã€‚
å†…å­˜é‡Šæ”¾ï¼šç¡®ä¿é”€æ¯åå†…å­˜è¢«æ­£ç¡®å›æ”¶ã€‚
å®ç°æ­¥éª¤
ä½¿ç”¨ QStackedWidget ç®¡ç†é¡µé¢ï¼Œä½†å°†é¡µé¢å®ä¾‹å­˜å‚¨åœ¨ç‹¬ç«‹çš„ç¼“å­˜ä¸­ã€‚
å¼•å…¥ OrderedDict å®ç° LRU ç¼“å­˜ï¼Œè‡ªåŠ¨ç§»é™¤è¶…é™é¡µé¢ã€‚
æ·»åŠ æ‰‹åŠ¨é”€æ¯åŠŸèƒ½ï¼Œé€šè¿‡ä¾§è¾¹æ æŒ‰é’®æˆ–ä¸Šä¸‹æ–‡èœå•è§¦å‘ã€‚
ä½¿ç”¨ deleteLater() å’Œåƒåœ¾å›æ”¶ç¡®è®¤å†…å­˜é‡Šæ”¾ã€‚
ä¼˜åŒ–åçš„å®Œæ•´ä»£ç 
model.py
python
class SystemModel:
    def __init__(self):
        self.users = {"admin": "123456"}
        self.cpu_models = ["Intel i9-13900K", "AMD Ryzen 9 7950X", "Intel i7-13700K", "AMD Ryzen 7 7700X", "Intel i5-13600K", "AMD Ryzen 5 7600X"]
        self.cpu_specs = {
            "Intel i9-13900K": {"Cores": 24, "Threads": 32, "Base Clock": "3.0 GHz", "Boost Clock": "5.8 GHz", "Cache": "36 MB", "TDP": "125 W"},
            "AMD Ryzen 9 7950X": {"Cores": 16, "Threads": 32, "Base Clock": "4.5 GHz", "Boost Clock": "5.7 GHz", "Cache": "80 MB", "TDP": "170 W"},
            "Intel i7-13700K": {"Cores": 16, "Threads": 24, "Base Clock": "3.4 GHz", "Boost Clock": "5.4 GHz", "Cache": "30 MB", "TDP": "125 W"},
            "AMD Ryzen 7 7700X": {"Cores": 8, "Threads": 16, "Base Clock": "4.5 GHz", "Boost Clock": "5.4 GHz", "Cache": "40 MB", "TDP": "105 W"},
            "Intel i5-13600K": {"Cores": 14, "Threads": 20, "Base Clock": "3.5 GHz", "Boost Clock": "5.1 GHz", "Cache": "24 MB", "TDP": "125 W"},
            "AMD Ryzen 5 7600X": {"Cores": 6, "Threads": 12, "Base Clock": "4.7 GHz", "Boost Clock": "5.3 GHz", "Cache": "38 MB", "TDP": "105 W"},
        }
        self.server_data = {
            "Intel i9-13900K": {"CPU Usage": "45%", "Memory": "16 GB", "Latency": "5 ms", "Disk I/O": "120 MB/s", "Network": "1 Gbps"},
            "AMD Ryzen 9 7950X": {"CPU Usage": "60%", "Memory": "32 GB", "Latency": "4 ms", "Disk I/O": "200 MB/s", "Network": "2 Gbps"},
            "Intel i7-13700K": {"CPU Usage": "35%", "Memory": "12 GB", "Latency": "6 ms", "Disk I/O": "100 MB/s", "Network": "800 Mbps"},
            "AMD Ryzen 7 7700X": {"CPU Usage": "50%", "Memory": "24 GB", "Latency": "3 ms", "Disk I/O": "150 MB/s", "Network": "1.5 Gbps"},
            "Intel i5-13600K": {"CPU Usage": "40%", "Memory": "8 GB", "Latency": "7 ms", "Disk I/O": "90 MB/s", "Network": "700 Mbps"},
            "AMD Ryzen 5 7600X": {"CPU Usage": "55%", "Memory": "16 GB", "Latency": "5 ms", "Disk I/O": "130 MB/s", "Network": "1 Gbps"},
        }
        self.virtualization_data = {
            "Intel i9-13900K": {"VM Count": "10", "vCPU Usage": "50%", "Memory Usage": "12 GB", "IOPS": "5000"},
            "AMD Ryzen 9 7950X": {"VM Count": "15", "vCPU Usage": "65%", "Memory Usage": "24 GB", "IOPS": "7000"},
            "Intel i7-13700K": {"VM Count": "8", "vCPU Usage": "40%", "Memory Usage": "10 GB", "IOPS": "4000"},
            "AMD Ryzen 7 7700X": {"VM Count": "12", "vCPU Usage": "55%", "Memory Usage": "18 GB", "IOPS": "6000"},
            "Intel i5-13600K": {"VM Count": "6", "vCPU Usage": "45%", "Memory Usage": "6 GB", "IOPS": "3000"},
            "AMD Ryzen 5 7600X": {"VM Count": "9", "vCPU Usage": "60%", "Memory Usage": "14 GB", "IOPS": "4500"},
        }

    def validate_login(self, username, password):
        return username in self.users and self.users[username] == password

    def get_cpu_specs(self, cpu_model):
        return self.cpu_specs.get(cpu_model, {})

    def get_server_data(self, cpu_model):
        return self.server_data.get(cpu_model, {})

    def get_virtualization_data(self, cpu_model):
        return self.virtualization_data.get(cpu_model, {})

    def update_server_data(self, cpu_model, key, value):
        if cpu_model in self.server_data:
            self.server_data[cpu_model][key] = value
views.py
python
from PySide6.QtWidgets import (QMainWindow, QWidget, QVBoxLayout, QHBoxLayout, QComboBox, 
                               QPushButton, QTableWidget, QTableWidgetItem, QLabel, 
                               QLineEdit, QFrame, QMessageBox, QSpacerItem, QSizePolicy, QStackedWidget)
from PySide6.QtCore import Qt, Signal, Slot
from PySide6.QtGui import QIcon

# å…¨å±€æ ·å¼
GLOBAL_STYLES = {
    "button_primary": "padding: 10px; background-color: #2196F3; color: white;",
    "button_action": "padding: 5px; background-color: #4CAF50; color: white;",
    "button_danger": "padding: 5px; background-color: #F44336; color: white;",
    "table": "border: 1px solid #ccc; padding: 5px;",
    "sidebar": "background-color: #f0f0f0; border-right: 1px solid #ccc;"
}

class LoginWidget(QWidget):
    login_signal = Signal(str, str)

    def __init__(self):
        super().__init__()
        layout = QVBoxLayout()
        layout.setSpacing(10)
        layout.setContentsMargins(20, 20, 20, 20)
        self.username_input = QLineEdit(self)
        self.username_input.setPlaceholderText("Username")
        self.password_input = QLineEdit(self)
        self.password_input.setPlaceholderText("Password")
        self.password_input.setEchoMode(QLineEdit.Password)
        self.login_btn = QPushButton("Login")
        self.login_btn.setStyleSheet(GLOBAL_STYLES["button_action"])
        layout.addWidget(self.username_input)
        layout.addWidget(self.password_input)
        layout.addWidget(self.login_btn)
        layout.addStretch()
        self.setLayout(layout)
        self.login_btn.clicked.connect(self.emit_login)

    @Slot()
    def emit_login(self):
        self.login_signal.emit(self.username_input.text(), self.password_input.text())

class MainWindow(QMainWindow):
    def __init__(self, username):
        super().__init__()
        self.setWindowTitle("Information Query System")
        self.resize(1200, 800)
        self.username = username
        self.init_ui()

    def init_ui(self):
        title_bar = QWidget()
        title_layout = QHBoxLayout()
        title_bar.setFixedHeight(60)
        title_bar.setStyleSheet("background-color: #2E2E2E; color: white; padding: 5px;")
        logo_label = QLabel("Logo")
        user_label = QLabel(f"User: {self.username}")
        self.logout_btn = QPushButton("Logout")
        self.logout_btn.setStyleSheet(GLOBAL_STYLES["button_danger"])
        title_layout.addWidget(logo_label)
        title_layout.addStretch()
        title_layout.addWidget(user_label)
        title_layout.addWidget(self.logout_btn)
        title_bar.setLayout(title_layout)

        main_widget = QWidget()
        main_layout = QHBoxLayout()
        main_layout.setContentsMargins(10, 10, 10, 10)
        main_layout.setSpacing(10)

        self.sidebar = QFrame()
        self.sidebar.setFixedWidth(200)
        self.sidebar.setStyleSheet(GLOBAL_STYLES["sidebar"])
        sidebar_layout = QVBoxLayout()
        sidebar_layout.setAlignment(Qt.AlignCenter)

        self.cpu_btn = QPushButton("CPU Specs")
        self.cpu_btn.setIcon(QIcon("cpu_icon.png"))
        self.cpu_btn.setIconSize(Qt.QSize(24, 24))
        self.server_btn = QPushButton("Server Data")
        self.virtual_btn = QPushButton("Virtualization Perf")
        self.clear_cache_btn = QPushButton("Clear Cache")  # æ–°å¢æ¸…ç†ç¼“å­˜æŒ‰é’®
        for btn in [self.cpu_btn, self.server_btn, self.virtual_btn]:
            btn.setStyleSheet(GLOBAL_STYLES["button_primary"] + " margin: 5px; text-align: left;")
        self.clear_cache_btn.setStyleSheet(GLOBAL_STYLES["button_danger"] + " margin: 5px;")
        
        self.toggle_btn = QPushButton("<<")
        self.toggle_btn.setStyleSheet(GLOBAL_STYLES["button_primary"] + " border: none;")
        self.toggle_btn.setFixedWidth(20)
        toggle_layout = QHBoxLayout()
        toggle_layout.addStretch()
        toggle_layout.addWidget(self.toggle_btn)

        sidebar_layout.addSpacerItem(QSpacerItem(20, 40, QSizePolicy.Minimum, QSizePolicy.Expanding))
        sidebar_layout.addWidget(self.cpu_btn)
        sidebar_layout.addWidget(self.server_btn)
        sidebar_layout.addWidget(self.virtual_btn)
        sidebar_layout.addWidget(self.clear_cache_btn)
        sidebar_layout.addSpacerItem(QSpacerItem(20, 20, QSizePolicy.Minimum, QSizePolicy.Fixed))
        sidebar_layout.addLayout(toggle_layout)
        sidebar_layout.addSpacerItem(QSpacerItem(20, 40, QSizePolicy.Minimum, QSizePolicy.Expanding))
        self.sidebar.setLayout(sidebar_layout)

        self.content_stack = QStackedWidget()

        main_layout.addWidget(self.sidebar)
        main_layout.addWidget(self.content_stack)
        main_widget.setLayout(main_layout)

        central_layout = QVBoxLayout()
        central_layout.addWidget(title_bar)
        central_layout.addWidget(main_widget)
        central_widget = QWidget()
        central_widget.setLayout(central_layout)
        self.setCentralWidget(central_widget)

    def toggle_sidebar(self):
        if self.sidebar.width() > 50:
            self.sidebar.setFixedWidth(50)
            self.toggle_btn.setText(">>")
        else:
            self.sidebar.setFixedWidth(200)
            self.toggle_btn.setText("<<")

class CPUSpecsWidget(QWidget):
    query_signal = Signal(str)

    def __init__(self, model):
        super().__init__()
        self.model = model
        self.init_ui()

    def init_ui(self):
        layout = QHBoxLayout()
        layout.setSpacing(10)
        layout.setContentsMargins(10, 10, 10, 10)

        left_widget = QWidget()
        self.left_layout = QVBoxLayout()
        self.left_layout.setSpacing(5)
        self.combos = []
        for _ in range(6):
            self.add_combo()
        self.add_btn = QPushButton("+")
        self.remove_btn = QPushButton("-")
        for btn in [self.add_btn, self.remove_btn]:
            btn.setStyleSheet(GLOBAL_STYLES["button_action"])
        self.left_layout.addWidget(self.add_btn)
        self.left_layout.addWidget(self.remove_btn)
        self.left_layout.addStretch()
        left_widget.setLayout(self.left_layout)

        self.table = QTableWidget()
        self.table.setColumnCount(2)
        self.table.setHorizontalHeaderLabels(["Property", "Value"])
        self.table.setStyleSheet(GLOBAL_STYLES["table"])

        layout.addWidget(left_widget)
        layout.addWidget(self.table, stretch=1)
        self.setLayout(layout)

        self.add_btn.clicked.connect(self.add_combo)
        self.remove_btn.clicked.connect(self.remove_combo)

    def add_combo(self):
        combo = QComboBox()
        combo.addItems(self.model.cpu_models)
        combo.currentTextChanged.connect(lambda text: self.query_signal.emit(text))
        self.combos.append(combo)
        self.left_layout.insertWidget(self.left_layout.count() - 3, combo)

    def remove_combo(self):
        if len(self.combos) > 1:
            combo = self.combos.pop()
            combo.deleteLater()
            self.table.clearContents()

    def update_table(self, cpu_model):
        specs = self.model.get_cpu_specs(cpu_model)
        self.table.setRowCount(len(specs))
        for i, (key, value) in enumerate(specs.items()):
            self.table.setItem(i, 0, QTableWidgetItem(key))
            self.table.setItem(i, 1, QTableWidgetItem(str(value)))
        self.table.resizeColumnsToContents()

class ServerDataWidget(QWidget):
    query_signal = Signal()
    clear_signal = Signal()
    modify_signal = Signal(str, int, str, str)

    def __init__(self, model):
        super().__init__()
        self.model = model
        self.init_ui()

    def init_ui(self):
        layout = QHBoxLayout()
        layout.setSpacing(10)
        layout.setContentsMargins(10, 10, 10, 10)

        left_widget = QWidget()
        left_layout = QVBoxLayout()
        left_layout.setSpacing(5)
        self.cpu_combo = QComboBox()
        self.cpu_combo.addItems(self.model.cpu_models)
        self.extra_combo = QComboBox()
        self.extra_combo.addItems(["Option1", "Option2"])
        self.query_btn = QPushButton("Query")
        self.clear_btn = QPushButton("Clear")
        for btn in [self.query_btn, self.clear_btn]:
            btn.setStyleSheet(GLOBAL_STYLES["button_action"])
        left_layout.addWidget(self.cpu_combo)
        left_layout.addWidget(self.extra_combo)
        left_layout.addWidget(self.query_btn)
        left_layout.addWidget(self.clear_btn)
        left_layout.addStretch()
        left_widget.setLayout(left_layout)

        self.table = QTableWidget()
        self.table.setColumnCount(4)
        self.table.setHorizontalHeaderLabels(["Property", "Value", "Modify", "Link"])
        self.table.setStyleSheet(GLOBAL_STYLES["table"])

        layout.addWidget(left_widget)
        layout.addWidget(self.table, stretch=1)
        self.setLayout(layout)

    def update_table(self):
        cpu_model = self.cpu_combo.currentText()
        data = self.model.get_server_data(cpu_model)
        self.table.setRowCount(len(data))
        modify_values = {}
        for row in range(self.table.rowCount()):
            combo = self.table.cellWidget(row, 2)
            if combo:
                modify_values[row] = combo.currentText()

        for i, (key, value) in enumerate(data.items()):
            self.table.setItem(i, 0, QTableWidgetItem(key))
            self.table.setItem(i, 1, QTableWidgetItem(value))
            combo = QComboBox()
            combo.addItems(["Low", "Medium", "High"])
            combo.setCurrentText(modify_values.get(i, "Medium"))
            combo.currentTextChanged.connect(lambda text, r=i, k=key: self.modify_signal.emit(cpu_model, r, k, text))
            self.table.setCellWidget(i, 2, combo)
            btn = QPushButton("Link")
            btn.clicked.connect(self.open_link)
            self.table.setCellWidget(i, 3, btn)
        self.table.resizeColumnsToContents()

    def open_link(self):
        from PySide6.QtGui import QDesktopServices, QUrl
        QDesktopServices.openUrl(QUrl("https://www.baidu.com"))
        print("Opening Baidu homepage")

    def clear_table(self):
        self.table.setRowCount(0)

class VirtualizationPerfWidget(QWidget):
    query_signal = Signal()
    clear_signal = Signal()

    def __init__(self, model):
        super().__init__()
        self.model = model
        self.init_ui()

    def init_ui(self):
        layout = QHBoxLayout()
        layout.setSpacing(10)
        layout.setContentsMargins(10, 10, 10, 10)

        left_widget = QWidget()
        left_layout = QVBoxLayout()
        left_layout.setSpacing(5)
        self.cpu_combo = QComboBox()
        self.cpu_combo.addItems(self.model.cpu_models)
        self.query_btn = QPushButton("Query")
        self.clear_btn = QPushButton("Clear")
        for btn in [self.query_btn, self.clear_btn]:
            btn.setStyleSheet(GLOBAL_STYLES["button_action"])
        left_layout.addWidget(self.cpu_combo)
        left_layout.addWidget(self.query_btn)
        left_layout.addWidget(self.clear_btn)
        left_layout.addStretch()
        left_widget.setLayout(left_layout)

        self.table = QTableWidget()
        self.table.setColumnCount(2)
        self.table.setHorizontalHeaderLabels(["Property", "Value"])
        self.table.setStyleSheet(GLOBAL_STYLES["table"])

        layout.addWidget(left_widget)
        layout.addWidget(self.table, stretch=1)
        self.setLayout(layout)

    def update_table(self):
        cpu_model = self.cpu_combo.currentText()
        data = self.model.get_virtualization_data(cpu_model)
        self.table.setRowCount(len(data))
        for i, (key, value) in enumerate(data.items()):
            self.table.setItem(i, 0, QTableWidgetItem(key))
            self.table.setItem(i, 1, QTableWidgetItem(value))
        self.table.resizeColumnsToContents()

    def clear_table(self):
        self.table.setRowCount(0)
controller.py
python
from PySide6.QtWidgets import QMessageBox
from PySide6.QtCore import Slot
from collections import OrderedDict
import gc  # åƒåœ¾å›æ”¶æ¨¡å—ï¼Œç¡®ä¿å†…å­˜é‡Šæ”¾

class PageManager:
    def __init__(self, main_window, model, max_cache_size=5):
        self.main_window = main_window
        self.model = model
        self.max_cache_size = max_cache_size
        self.pages = {}  # æ³¨å†Œä¿¡æ¯
        self.cache = OrderedDict()  # LRU ç¼“å­˜

    def register_page(self, name, widget_class, button):
        self.pages[name] = {"widget_class": widget_class, "button": button}
        button.clicked.connect(lambda: self.show_page(name))

    def show_page(self, name):
        if name not in self.pages:
            return

        if name in self.cache:
            self.cache.move_to_end(name)
            self.main_window.content_stack.setCurrentIndex(self.cache[name]["index"])
            print(f"Switched to cached page: {name}")
            return

        if len(self.cache) >= self.max_cache_size:
            self.remove_least_used_page()

        widget = self.pages[name]["widget_class"](self.model)
        index = self.main_window.content_stack.addWidget(widget)
        self.cache[name] = {"widget": widget, "index": index}
        self.connect_widget_signals(widget)
        self.main_window.content_stack.setCurrentIndex(index)
        print(f"Created and switched to new page: {name}")

    def remove_least_used_page(self):
        if self.cache:
            name, data = next(iter(self.cache.items()))
            self.destroy_page(name)

    def destroy_page(self, name):
        if name in self.cache:
            widget = self.cache[name]["widget"]
            index = self.cache[name]["index"]
            self.main_window.content_stack.removeWidget(widget)
            widget.deleteLater()
            del self.cache[name]
            gc.collect()  # å¼ºåˆ¶åƒåœ¾å›æ”¶ï¼Œç¡®ä¿å†…å­˜é‡Šæ”¾
            print(f"Destroyed page: {name}")

    def clear_all_pages(self):
        while self.cache:
            name = next(iter(self.cache))
            self.destroy_page(name)

    def connect_widget_signals(self, widget):
        if hasattr(widget, "query_signal"):
            widget.query_signal.connect(widget.update_table)
        if hasattr(widget, "clear_signal"):
            widget.clear_signal.connect(widget.clear_table)
        if hasattr(widget, "modify_signal"):
            widget.modify_signal.connect(lambda cpu, row, key, text: self.modify_server_data(widget, cpu, row, key, text))

    def modify_server_data(self, widget, cpu_model, row, key, text):
        self.model.update_server_data(cpu_model, key, f"{text} ({self.model.get_server_data(cpu_model)[key].split(' (')[0]})")
        widget.update_table()
        print(f"Row {row} modified: {key} = {self.model.get_server_data(cpu_model)[key]}")

class SystemController:
    def __init__(self, model, login_widget):
        self.model = model
        self.login_widget = login_widget
        self.main_window = None
        self.page_manager = None
        self.setup_connections()

    def setup_connections(self):
        self.login_widget.login_signal.connect(self.handle_login)
        if self.main_window:
            self.main_window.toggle_btn.clicked.connect(self.main_window.toggle_sidebar)
            self.main_window.logout_btn.clicked.connect(self.handle_logout)
            self.main_window.clear_cache_btn.clicked.connect(self.handle_clear_cache)  # æ–°å¢æ¸…ç†ç¼“å­˜è¿æ¥
            self.page_manager = PageManager(self.main_window, self.model, max_cache_size=5)
            self.page_manager.register_page("cpu_specs", CPUSpecsWidget, self.main_window.cpu_btn)
            self.page_manager.register_page("server_data", ServerDataWidget, self.main_window.server_btn)
            self.page_manager.register_page("virtualization_perf", VirtualizationPerfWidget, self.main_window.virtual_btn)

    @Slot(str, str)
    def handle_login(self, username, password):
        if self.model.validate_login(username, password):
            self.main_window = MainWindow(username)
            self.setup_connections()
            self.main_window.show()
            self.login_widget.close()
        else:
            QMessageBox.warning(self.login_widget, "Login Failed", "Invalid username or password")

    @Slot()
    def handle_logout(self):
        if self.page_manager:
            self.page_manager.clear_all_pages()
        self.main_window.close()
        self.login_widget = LoginWidget()
        self.setup_connections()
        self.login_widget.show()

    @Slot()
    def handle_clear_cache(self):
        if self.page_manager:
            self.page_manager.clear_all_pages()
            QMessageBox.information(self.main_window, "Cache Cleared", "All cached pages have been destroyed.")

from views import MainWindow, CPUSpecsWidget, ServerDataWidget, VirtualizationPerfWidget
main.py
python
from PySide6.QtWidgets import QApplication
from model import SystemModel
from views import LoginWidget, GLOBAL_STYLES
from controller import SystemController

if __name__ == "__main__":
    app = QApplication(sys.argv)
    app.setStyleSheet(f"QWidget {{ font-size: 14px; }} QPushButton {{ {GLOBAL_STYLES['button_primary']} }}")
    model = SystemModel()
    login_widget = LoginWidget()
    controller = SystemController(model, login_widget)
    login_widget.show()
    sys.exit(app.exec())
æ–°å¢çš„é¡µé¢é”€æ¯æœºåˆ¶ç‰¹ç‚¹
æ‡’åŠ è½½ï¼š
é¡µé¢ä»…åœ¨é¦–æ¬¡ç‚¹å‡»æ—¶åˆ›å»ºï¼Œæœªè®¿é—®çš„é¡µé¢ä¸å ç”¨å†…å­˜ã€‚
LRU ç¼“å­˜ï¼š
max_cache_size=5 é™åˆ¶ç¼“å­˜é¡µé¢æ•°ï¼Œè¶…å‡ºæ—¶ç§»é™¤æœ€æ—§é¡µé¢ã€‚
OrderedDict ç¡®ä¿ LRU ç­–ç•¥æŒ‰è®¿é—®é¡ºåºæ‰§è¡Œã€‚
æ‰‹åŠ¨é”€æ¯ï¼š
æ–°å¢ clear_cache_btn å’Œ handle_clear_cacheï¼Œå…è®¸ç”¨æˆ·æ‰‹åŠ¨æ¸…ç©ºæ‰€æœ‰ç¼“å­˜é¡µé¢ã€‚
destroy_page æ–¹æ³•æ”¯æŒé”€æ¯ç‰¹å®šé¡µé¢ï¼Œå¯æ‰©å±•ä¸ºå³é”®èœå•æˆ–é¡µé¢å†…æŒ‰é’®ã€‚
å†…å­˜é‡Šæ”¾ï¼š
ä½¿ç”¨ deleteLater() å¼‚æ­¥é”€æ¯é¡µé¢ï¼Œé¿å…é˜»å¡ UIã€‚
è°ƒç”¨ gc.collect() å¼ºåˆ¶æ¸…ç†æœªå¼•ç”¨çš„å¯¹è±¡ï¼Œç¡®ä¿å†…å­˜é‡Šæ”¾ã€‚
æµ‹è¯•æ­¥éª¤
ä¿å­˜ä»£ç åˆ°å¯¹åº”æ–‡ä»¶ï¼ˆmodel.pyã€views.pyã€controller.pyã€main.pyï¼‰ã€‚
ç¡®ä¿ cpu_icon.png å­˜åœ¨ï¼ˆæˆ–æ³¨é‡Šæ‰ç›¸å…³ä»£ç ï¼‰ã€‚
è¿è¡Œ main.pyï¼Œè¾“å…¥ admin å’Œ 123456 ç™»å½•ã€‚
æ£€æŸ¥ï¼š
åˆ‡æ¢é¡µé¢ï¼Œè§‚å¯Ÿå‘½ä»¤è¡Œè¾“å‡ºï¼Œç¡®è®¤é¡µé¢åˆ›å»ºå’Œç¼“å­˜è¡Œä¸ºã€‚
æ‰“å¼€å¤šä¸ªé¡µé¢åï¼ˆéœ€æ³¨å†Œæ›´å¤šé¡µé¢æµ‹è¯•ï¼‰ï¼Œç¡®è®¤è¶…è¿‡ 5 ä¸ªæ—¶æœ€æ—§é¡µé¢è¢«é”€æ¯ã€‚
ç‚¹å‡»â€œClear Cacheâ€æŒ‰é’®ï¼ŒéªŒè¯æ‰€æœ‰é¡µé¢æ˜¯å¦è¢«é”€æ¯å¹¶æ”¶åˆ°æç¤ºã€‚
é€€å‡ºç³»ç»Ÿï¼Œç¡®è®¤æ‰€æœ‰é¡µé¢è¢«æ¸…ç©ºã€‚
ç¤ºä¾‹è¾“å‡º
Created and switched to new page: cpu_specs
Created and switched to new page: server_data
Switched to cached page: cpu_specs
Created and switched to new page: virtualization_perf
Row 0 modified: CPU Usage = High (45%)
Destroyed page: cpu_specs  # å‡è®¾æ·»åŠ æ›´å¤šé¡µé¢è§¦å‘ LRU
Created and switched to new page: another_page
Destroyed page: server_data  # ç‚¹å‡» Clear Cache
Destroyed page: virtualization_perf
Destroyed page: another_page
æ³¨æ„äº‹é¡¹
æ‰©å±•æµ‹è¯•ï¼šå½“å‰ä»…æ³¨å†Œ 3 ä¸ªé¡µé¢ï¼Œéœ€æ·»åŠ æ›´å¤šé¡µé¢ï¼ˆå¦‚ 10 ä¸ªï¼‰æµ‹è¯• LRU å’Œæ‰‹åŠ¨é”€æ¯ã€‚
ç¤ºä¾‹æ·»åŠ é¡µé¢ï¼š
python
self.page_manager.register_page("page_4", SomeWidget, QPushButton("Page 4"))
å†…å­˜ç›‘æ§ï¼šå¯ä½¿ç”¨ psutil æˆ– tracemalloc æ£€æŸ¥å†…å­˜ä½¿ç”¨ï¼ŒéªŒè¯é”€æ¯æ•ˆæœã€‚
çŠ¶æ€ä¿ç•™ï¼šè‹¥éœ€ä¿ç•™é”€æ¯åçŠ¶æ€ï¼Œå¯åœ¨ model ä¸­ä¿å­˜ç”¨æˆ·æ•°æ®ï¼Œå¹¶åœ¨ update_table ä¸­æ¢å¤ã€‚
è¿›ä¸€æ­¥ä¼˜åŒ–å»ºè®®
é¡µé¢é€‰æ‹©é”€æ¯ï¼šä¸ºæ¯ä¸ªå¯¼èˆªæŒ‰é’®æ·»åŠ å³é”®èœå•ï¼Œå•ç‹¬é”€æ¯ç‰¹å®šé¡µé¢ã€‚
å†…å­˜é˜ˆå€¼è§¦å‘ï¼šæ£€æµ‹ç³»ç»Ÿå†…å­˜ä½¿ç”¨ï¼Œè‡ªåŠ¨é”€æ¯é¡µé¢ã€‚
é”€æ¯åŠ¨ç”»ï¼šåœ¨é¡µé¢é”€æ¯å‰æ·»åŠ æ·¡å‡ºæ•ˆæœï¼Œæå‡ç”¨æˆ·ä½“éªŒã€‚
å¦‚æœéœ€è¦å®ç°è¿™äº›å»ºè®®æˆ–è°ƒæ•´ max_cache_sizeï¼Œè¯·å‘Šè¯‰æˆ‘ï¼



import sys
from PySide6.QtWidgets import (QApplication, QMainWindow, QWidget, QVBoxLayout, QHBoxLayout,
                               QComboBox, QPushButton, QTableWidget, QTableWidgetItem,
                               QLabel, QLineEdit, QFrame, QMessageBox, QSpacerItem, QSizePolicy)
from PySide6.QtCore import Qt, Signal, Slot, QUrl, QSize
from PySide6.QtGui import QIcon, QPixmap
from PySide6.QtGui import QDesktopServices

# æ¨¡æ‹Ÿæ•°æ®
CPU_MODELS = ["Intel i9-13900K", "AMD Ryzen 9 7950X", "Intel i7-13700K", "AMD Ryzen 7 7700X", "Intel i5-13600K",
              "AMD Ryzen 5 7600X"]
CPU_SPECS = {
    "Intel i9-13900K": {"Cores": 24, "Threads": 32, "Base Clock": "3.0 GHz", "Boost Clock": "5.8 GHz", "Cache": "36 MB",
                        "TDP": "125 W"},
    "AMD Ryzen 9 7950X": {"Cores": 16, "Threads": 32, "Base Clock": "4.5 GHz", "Boost Clock": "5.7 GHz",
                          "Cache": "80 MB", "TDP": "170 W"},
    "Intel i7-13700K": {"Cores": 16, "Threads": 24, "Base Clock": "3.4 GHz", "Boost Clock": "5.4 GHz", "Cache": "30 MB",
                        "TDP": "125 W"},
    "AMD Ryzen 7 7700X": {"Cores": 8, "Threads": 16, "Base Clock": "4.5 GHz", "Boost Clock": "5.4 GHz",
                          "Cache": "40 MB", "TDP": "105 W"},
    "Intel i5-13600K": {"Cores": 14, "Threads": 20, "Base Clock": "3.5 GHz", "Boost Clock": "5.1 GHz", "Cache": "24 MB",
                        "TDP": "125 W"},
    "AMD Ryzen 5 7600X": {"Cores": 6, "Threads": 12, "Base Clock": "4.7 GHz", "Boost Clock": "5.3 GHz",
                          "Cache": "38 MB", "TDP": "105 W"},
}
SERVER_DATA = {
    "Intel i9-13900K": {"CPU Usage": "45%", "Memory": "16 GB", "Latency": "5 ms", "Disk I/O": "120 MB/s",
                        "Network": "1 Gbps"},
    "AMD Ryzen 9 7950X": {"CPU Usage": "60%", "Memory": "32 GB", "Latency": "4 ms", "Disk I/O": "200 MB/s",
                          "Network": "2 Gbps"},
    "Intel i7-13700K": {"CPU Usage": "35%", "Memory": "12 GB", "Latency": "6 ms", "Disk I/O": "100 MB/s",
                        "Network": "800 Mbps"},
    "AMD Ryzen 7 7700X": {"CPU Usage": "50%", "Memory": "24 GB", "Latency": "3 ms", "Disk I/O": "150 MB/s",
                          "Network": "1.5 Gbps"},
    "Intel i5-13600K": {"CPU Usage": "40%", "Memory": "8 GB", "Latency": "7 ms", "Disk I/O": "90 MB/s",
                        "Network": "700 Mbps"},
    "AMD Ryzen 5 7600X": {"CPU Usage": "55%", "Memory": "16 GB", "Latency": "5 ms", "Disk I/O": "130 MB/s",
                          "Network": "1 Gbps"},
}


# æ¨¡å‹å±‚ (Model)
class SystemModel:
    def __init__(self):
        self.users = {"admin": "123456"}
        self.cpu_models = CPU_MODELS
        self.cpu_specs = CPU_SPECS
        self.server_data = SERVER_DATA

    def validate_login(self, username, password):
        return username in self.users and self.users[username] == password

    def get_cpu_specs(self, cpu_model):
        return self.cpu_specs.get(cpu_model, {})

    def get_server_data(self, cpu_model):
        return self.server_data.get(cpu_model, {})

    def update_server_data(self, cpu_model, key, value):
        if cpu_model in self.server_data:
            self.server_data[cpu_model][key] = value


# è§†å›¾å±‚ (View)
class LoginWidget(QWidget):
    login_signal = Signal(str, str)

    def __init__(self):
        super().__init__()
        layout = QVBoxLayout()
        layout.setSpacing(10)
        layout.setContentsMargins(20, 20, 20, 20)
        self.username_input = QLineEdit(self)
        self.username_input.setPlaceholderText("Username")
        self.password_input = QLineEdit(self)
        self.password_input.setPlaceholderText("Password")
        self.password_input.setEchoMode(QLineEdit.Password)
        self.login_btn = QPushButton("Login")
        self.login_btn.setStyleSheet("padding: 10px; background-color: #4CAF50; color: white;")
        layout.addWidget(self.username_input)
        layout.addWidget(self.password_input)
        layout.addWidget(self.login_btn)
        layout.addStretch()
        self.setLayout(layout)
        self.login_btn.clicked.connect(self.emit_login)

    @Slot()
    def emit_login(self):
        self.login_signal.emit(self.username_input.text(), self.password_input.text())


class MainWindow(QMainWindow):
    def __init__(self, username):
        super().__init__()
        self.setWindowTitle("Information Query System")
        self.resize(1200, 800)
        self.username = username
        self.init_ui()

    def init_ui(self):
        title_bar = QWidget()
        title_layout = QHBoxLayout()
        title_bar.setFixedHeight(60)
        title_bar.setStyleSheet("background-color: #2E2E2E; color: white; padding: 5px;")
        logo_label = QLabel("Logo")
        user_label = QLabel(f"User: {self.username}")
        self.logout_btn = QPushButton("Logout")
        self.logout_btn.setStyleSheet("background-color: #F44336; color: white; padding: 5px;")
        title_layout.addWidget(logo_label)
        title_layout.addStretch()
        title_layout.addWidget(user_label)
        title_layout.addWidget(self.logout_btn)
        title_bar.setLayout(title_layout)

        main_widget = QWidget()
        main_layout = QHBoxLayout()
        main_layout.setContentsMargins(10, 10, 10, 10)
        main_layout.setSpacing(10)

        self.sidebar = QFrame()
        self.sidebar.setFixedWidth(200)
        self.sidebar.setStyleSheet("background-color: #f0f0f0; border-right: 1px solid #ccc;")
        sidebar_layout = QVBoxLayout()
        sidebar_layout.setAlignment(Qt.AlignCenter)

        self.cpu_btn = QPushButton("CPU Specs")
        self.cpu_btn.setIcon(QIcon("cpu_icon.png"))  # è¯·æ›¿æ¢ä¸ºå®é™…å›¾æ ‡è·¯å¾„
        self.cpu_btn.setIconSize(QSize(24, 24))
        self.server_btn = QPushButton("Server Data")
        for btn in [self.cpu_btn, self.server_btn]:
            btn.setStyleSheet("padding: 10px; background-color: #2196F3; color: white; margin: 5px; text-align: left;")

        self.toggle_btn = QPushButton("<<")
        self.toggle_btn.setStyleSheet("padding: 5px; background-color: #2196F3; color: white; border: none;")
        self.toggle_btn.setFixedWidth(20)
        toggle_layout = QHBoxLayout()
        toggle_layout.addStretch()
        toggle_layout.addWidget(self.toggle_btn)

        sidebar_layout.addSpacerItem(QSpacerItem(20, 40, QSizePolicy.Minimum, QSizePolicy.Expanding))
        sidebar_layout.addWidget(self.cpu_btn)
        sidebar_layout.addWidget(self.server_btn)
        sidebar_layout.addSpacerItem(QSpacerItem(20, 20, QSizePolicy.Minimum, QSizePolicy.Fixed))  # ç•™å‡ºç¼ºå£
        sidebar_layout.addLayout(toggle_layout)
        sidebar_layout.addSpacerItem(QSpacerItem(20, 40, QSizePolicy.Minimum, QSizePolicy.Expanding))
        self.sidebar.setLayout(sidebar_layout)

        self.content_widget = QWidget()
        self.content_layout = QVBoxLayout()
        self.content_layout.setContentsMargins(10, 10, 10, 10)
        self.content_widget.setLayout(self.content_layout)

        main_layout.addWidget(self.sidebar)
        main_layout.addWidget(self.content_widget)
        main_widget.setLayout(main_layout)

        central_layout = QVBoxLayout()
        central_layout.addWidget(title_bar)
        central_layout.addWidget(main_widget)
        central_widget = QWidget()
        central_widget.setLayout(central_layout)
        self.setCentralWidget(central_widget)

    def toggle_sidebar(self):
        if self.sidebar.width() > 50:
            self.sidebar.setFixedWidth(50)
            self.toggle_btn.setText(">>")
        else:
            self.sidebar.setFixedWidth(200)
            self.toggle_btn.setText("<<")


class CPUSpecsWidget(QWidget):
    def __init__(self, model):
        super().__init__()
        self.model = model
        self.init_ui()

    def init_ui(self):
        layout = QHBoxLayout()
        layout.setSpacing(10)
        layout.setContentsMargins(10, 10, 10, 10)

        left_widget = QWidget()
        self.left_layout = QVBoxLayout()
        self.left_layout.setSpacing(5)
        self.combos = []
        for _ in range(6):
            self.add_combo()
        self.add_btn = QPushButton("+")
        self.remove_btn = QPushButton("-")
        for btn in [self.add_btn, self.remove_btn]:
            btn.setStyleSheet("padding: 5px; background-color: #4CAF50; color: white;")
        self.left_layout.addWidget(self.add_btn)
        self.left_layout.addWidget(self.remove_btn)
        self.left_layout.addStretch()
        left_widget.setLayout(self.left_layout)

        self.table = QTableWidget()
        self.table.setColumnCount(2)
        self.table.setHorizontalHeaderLabels(["Property", "Value"])
        self.table.setStyleSheet("border: 1px solid #ccc; padding: 5px;")

        layout.addWidget(left_widget)
        layout.addWidget(self.table, stretch=1)
        self.setLayout(layout)

        self.add_btn.clicked.connect(self.add_combo)
        self.remove_btn.clicked.connect(self.remove_combo)

    def add_combo(self):
        combo = QComboBox()
        combo.addItems(self.model.cpu_models)
        combo.currentTextChanged.connect(lambda text: self.update_table(text))
        self.combos.append(combo)
        self.left_layout.insertWidget(self.left_layout.count() - 3, combo)

    def remove_combo(self):
        if len(self.combos) > 1:
            combo = self.combos.pop()
            combo.deleteLater()
            self.table.clearContents()

    def update_table(self, cpu_model):
        specs = self.model.get_cpu_specs(cpu_model)
        self.table.setRowCount(len(specs))
        for i, (key, value) in enumerate(specs.items()):
            self.table.setItem(i, 0, QTableWidgetItem(key))
            self.table.setItem(i, 1, QTableWidgetItem(str(value)))
        self.table.resizeColumnsToContents()


class ServerDataWidget(QWidget):
    def __init__(self, model):
        super().__init__()
        self.model = model
        self.init_ui()

    def init_ui(self):
        layout = QHBoxLayout()
        layout.setSpacing(10)
        layout.setContentsMargins(10, 10, 10, 10)

        left_widget = QWidget()
        left_layout = QVBoxLayout()
        left_layout.setSpacing(5)
        self.cpu_combo = QComboBox()
        self.cpu_combo.addItems(self.model.cpu_models)
        self.extra_combo = QComboBox()
        self.extra_combo.addItems(["Option1", "Option2"])
        self.query_btn = QPushButton("Query")
        self.clear_btn = QPushButton("Clear")
        for btn in [self.query_btn, self.clear_btn]:
            btn.setStyleSheet("padding: 5px; background-color: #2196F3; color: white;")
        left_layout.addWidget(self.cpu_combo)
        left_layout.addWidget(self.extra_combo)
        left_layout.addWidget(self.query_btn)
        left_layout.addWidget(self.clear_btn)
        left_layout.addStretch()
        left_widget.setLayout(left_layout)

        self.table = QTableWidget()
        self.table.setColumnCount(4)
        self.table.setHorizontalHeaderLabels(["Property", "Value", "Modify", "Link"])
        self.table.setStyleSheet("border: 1px solid #ccc; padding: 5px;")

        layout.addWidget(left_widget)
        layout.addWidget(self.table, stretch=1)
        self.setLayout(layout)

        self.query_btn.clicked.connect(self.update_table)
        self.clear_btn.clicked.connect(self.clear_table)

    def update_table(self):
        cpu_model = self.cpu_combo.currentText()
        data = self.model.get_server_data(cpu_model)
        self.table.setRowCount(len(data))
        modify_values = {}
        # ä¿å­˜ç°æœ‰ä¸‹æ‹‰æ¡†çš„é€‰æ‹©çŠ¶æ€
        for row in range(self.table.rowCount()):
            combo = self.table.cellWidget(row, 2)
            if combo:
                modify_values[row] = combo.currentText()

        for i, (key, value) in enumerate(data.items()):
            self.table.setItem(i, 0, QTableWidgetItem(key))
            self.table.setItem(i, 1, QTableWidgetItem(value))
            combo = QComboBox()
            combo.addItems(["Low", "Medium", "High"])
            combo.setCurrentText(modify_values.get(i, "Medium"))  # æ¢å¤ä¹‹å‰çš„é€‰æ‹©
            combo.currentTextChanged.connect(lambda text, r=i, k=key: self.modify_data(cpu_model, r, k, text))
            self.table.setCellWidget(i, 2, combo)
            btn = QPushButton("Link")
            btn.clicked.connect(self.open_link)
            self.table.setCellWidget(i, 3, btn)
        self.table.resizeColumnsToContents()

    def modify_data(self, cpu_model, row, key, text):
        # æ›´æ–°æ¨¡å‹æ•°æ®
        self.model.update_server_data(cpu_model, key,
                                      f"{text} ({self.model.get_server_data(cpu_model)[key].split(' (')[0]})")
        # çºµå‘é‡æ–°æ¸²æŸ“æ•´ä¸ªè¡¨æ ¼
        self.update_table()
        print(f"Row {row} modified: {key} = {self.model.get_server_data(cpu_model)[key]}")

    def open_link(self):
        QDesktopServices.openUrl(QUrl("https://www.baidu.com"))
        print("Opening Baidu homepage")

    def clear_table(self):
        self.table.setRowCount(0)


# æ§åˆ¶å±‚ (Controller)
class SystemController:
    def __init__(self, model, login_widget):
        self.model = model
        self.login_widget = login_widget
        self.main_window = None
        self.setup_connections()

    def setup_connections(self):
        self.login_widget.login_signal.connect(self.handle_login)
        if self.main_window:
            self.main_window.cpu_btn.clicked.connect(self.show_cpu_specs)
            self.main_window.server_btn.clicked.connect(self.show_server_data)
            self.main_window.toggle_btn.clicked.connect(self.main_window.toggle_sidebar)
            self.main_window.logout_btn.clicked.connect(self.handle_logout)

    @Slot(str, str)
    def handle_login(self, username, password):
        if self.model.validate_login(username, password):
            self.main_window = MainWindow(username)
            self.setup_connections()
            self.main_window.show()
            self.login_widget.close()
        else:
            QMessageBox.warning(self.login_widget, "Login Failed", "Invalid username or password")

    @Slot()
    def handle_logout(self):
        self.main_window.close()
        self.login_widget = LoginWidget()
        self.setup_connections()
        self.login_widget.show()

    @Slot()
    def show_cpu_specs(self):
        for i in reversed(range(self.main_window.content_layout.count())):
            self.main_window.content_layout.itemAt(i).widget().setParent(None)
        cpu_widget = CPUSpecsWidget(self.model)
        self.main_window.content_layout.addWidget(cpu_widget)

    @Slot()
    def show_server_data(self):
        for i in reversed(range(self.main_window.content_layout.count())):
            self.main_window.content_layout.itemAt(i).widget().setParent(None)
        server_widget = ServerDataWidget(self.model)
        self.main_window.content_layout.addWidget(server_widget)


# ä¸»ç¨‹åº
if __name__ == "__main__":
    app = QApplication(sys.argv)
    app.setStyleSheet("QWidget { font-size: 14px; }")
    model = SystemModel()
    login_widget = LoginWidget()
    controller = SystemController(model, login_widget)
    login_widget.show()
    sys.exit(app.exec())



import sys
from PySide6.QtWidgets import (QApplication, QMainWindow, QWidget, QVBoxLayout, QHBoxLayout, 
                               QComboBox, QPushButton, QTableWidget, QTableWidgetItem, 
                               QLabel, QLineEdit, QFrame, QMessageBox, QSpacerItem, QSizePolicy)
from PySide6.QtCore import Qt, Signal, Slot, QUrl
from PySide6.QtGui import QIcon, QPixmap
from PySide6.QtWebEngineWidgets import QWebEngineView  # å¯é€‰ï¼Œç”¨äºå†…åµŒç½‘é¡µ
from PySide6.QtGui import QDesktopServices  # ç”¨äºæ‰“å¼€å¤–éƒ¨é“¾æ¥

# æ¨¡æ‹Ÿæ•°æ®ï¼ˆä¸°å¯Œæµ‹è¯•æ•°æ®ï¼‰
CPU_MODELS = ["Intel i9-13900K", "AMD Ryzen 9 7950X", "Intel i7-13700K", "AMD Ryzen 7 7700X", "Intel i5-13600K", "AMD Ryzen 5 7600X"]
CPU_SPECS = {
    "Intel i9-13900K": {"Cores": 24, "Threads": 32, "Base Clock": "3.0 GHz", "Boost Clock": "5.8 GHz", "Cache": "36 MB", "TDP": "125 W"},
    "AMD Ryzen 9 7950X": {"Cores": 16, "Threads": 32, "Base Clock": "4.5 GHz", "Boost Clock": "5.7 GHz", "Cache": "80 MB", "TDP": "170 W"},
    "Intel i7-13700K": {"Cores": 16, "Threads": 24, "Base Clock": "3.4 GHz", "Boost Clock": "5.4 GHz", "Cache": "30 MB", "TDP": "125 W"},
    "AMD Ryzen 7 7700X": {"Cores": 8, "Threads": 16, "Base Clock": "4.5 GHz", "Boost Clock": "5.4 GHz", "Cache": "40 MB", "TDP": "105 W"},
    "Intel i5-13600K": {"Cores": 14, "Threads": 20, "Base Clock": "3.5 GHz", "Boost Clock": "5.1 GHz", "Cache": "24 MB", "TDP": "125 W"},
    "AMD Ryzen 5 7600X": {"Cores": 6, "Threads": 12, "Base Clock": "4.7 GHz", "Boost Clock": "5.3 GHz", "Cache": "38 MB", "TDP": "105 W"},
}
SERVER_DATA = {
    "Intel i9-13900K": {"CPU Usage": "45%", "Memory": "16 GB", "Latency": "5 ms", "Disk I/O": "120 MB/s", "Network": "1 Gbps"},
    "AMD Ryzen 9 7950X": {"CPU Usage": "60%", "Memory": "32 GB", "Latency": "4 ms", "Disk I/O": "200 MB/s", "Network": "2 Gbps"},
    "Intel i7-13700K": {"CPU Usage": "35%", "Memory": "12 GB", "Latency": "6 ms", "Disk I/O": "100 MB/s", "Network": "800 Mbps"},
    "AMD Ryzen 7 7700X": {"CPU Usage": "50%", "Memory": "24 GB", "Latency": "3 ms", "Disk I/O": "150 MB/s", "Network": "1.5 Gbps"},
    "Intel i5-13600K": {"CPU Usage": "40%", "Memory": "8 GB", "Latency": "7 ms", "Disk I/O": "90 MB/s", "Network": "700 Mbps"},
    "AMD Ryzen 5 7600X": {"CPU Usage": "55%", "Memory": "16 GB", "Latency": "5 ms", "Disk I/O": "130 MB/s", "Network": "1 Gbps"},
}

# æ¨¡å‹å±‚ (Model)
class SystemModel:
    def __init__(self):
        self.users = {"admin": "123456"}
        self.cpu_models = CPU_MODELS
        self.cpu_specs = CPU_SPECS
        self.server_data = SERVER_DATA

    def validate_login(self, username, password):
        return username in self.users and self.users[username] == password

    def get_cpu_specs(self, cpu_model):
        return self.cpu_specs.get(cpu_model, {})

    def get_server_data(self, cpu_model):
        return self.server_data.get(cpu_model, {})

    def update_server_data(self, cpu_model, key, value):
        if cpu_model in self.server_data:
            self.server_data[cpu_model][key] = value

# è§†å›¾å±‚ (View)
class LoginWidget(QWidget):
    login_signal = Signal(str, str)

    def __init__(self):
        super().__init__()
        layout = QVBoxLayout()
        layout.setSpacing(10)
        layout.setContentsMargins(20, 20, 20, 20)
        self.username_input = QLineEdit(self)
        self.username_input.setPlaceholderText("Username")
        self.password_input = QLineEdit(self)
        self.password_input.setPlaceholderText("Password")
        self.password_input.setEchoMode(QLineEdit.Password)
        self.login_btn = QPushButton("Login")
        self.login_btn.setStyleSheet("padding: 10px; background-color: #4CAF50; color: white;")
        layout.addWidget(self.username_input)
        layout.addWidget(self.password_input)
        layout.addWidget(self.login_btn)
        layout.addStretch()
        self.setLayout(layout)
        self.login_btn.clicked.connect(self.emit_login)

    @Slot()
    def emit_login(self):
        self.login_signal.emit(self.username_input.text(), self.password_input.text())

class MainWindow(QMainWindow):
    def __init__(self, username):
        super().__init__()
        self.setWindowTitle("Information Query System")
        self.resize(1200, 800)
        self.username = username
        self.init_ui()

    def init_ui(self):
        title_bar = QWidget()
        title_layout = QHBoxLayout()
        title_bar.setFixedHeight(60)
        title_bar.setStyleSheet("background-color: #2E2E2E; color: white; padding: 5px;")
        logo_label = QLabel("Logo")
        user_label = QLabel(f"User: {self.username}")
        self.logout_btn = QPushButton("Logout")
        self.logout_btn.setStyleSheet("background-color: #F44336; color: white; padding: 5px;")
        title_layout.addWidget(logo_label)
        title_layout.addStretch()
        title_layout.addWidget(user_label)
        title_layout.addWidget(self.logout_btn)
        title_bar.setLayout(title_layout)

        main_widget = QWidget()
        main_layout = QHBoxLayout()
        main_layout.setContentsMargins(10, 10, 10, 10)
        main_layout.setSpacing(10)

        self.sidebar = QFrame()
        self.sidebar.setFixedWidth(200)
        self.sidebar.setStyleSheet("background-color: #f0f0f0; border-right: 1px solid #ccc;")
        sidebar_layout = QVBoxLayout()
        sidebar_layout.setAlignment(Qt.AlignCenter)

        self.cpu_btn = QPushButton("CPU Specs")
        self.cpu_btn.setIcon(QIcon("cpu_icon.png"))  # è¯·æ›¿æ¢ä¸ºå®é™…å›¾æ ‡è·¯å¾„
        self.cpu_btn.setIconSize(Qt.QSize(24, 24))
        self.server_btn = QPushButton("Server Data")
        for btn in [self.cpu_btn, self.server_btn]:
            btn.setStyleSheet("padding: 10px; background-color: #2196F3; color: white; margin: 5px; text-align: left;")
        
        self.toggle_btn = QPushButton("<<")
        self.toggle_btn.setStyleSheet("padding: 5px; background-color: #2196F3; color: white; border: none;")
        self.toggle_btn.setFixedWidth(20)
        toggle_layout = QHBoxLayout()
        toggle_layout.addStretch()
        toggle_layout.addWidget(self.toggle_btn)

        sidebar_layout.addSpacerItem(QSpacerItem(20, 40, QSizePolicy.Minimum, QSizePolicy.Expanding))
        sidebar_layout.addWidget(self.cpu_btn)
        sidebar_layout.addWidget(self.server_btn)
        sidebar_layout.addLayout(toggle_layout)
        sidebar_layout.addSpacerItem(QSpacerItem(20, 40, QSizePolicy.Minimum, QSizePolicy.Expanding))
        self.sidebar.setLayout(sidebar_layout)

        self.content_widget = QWidget()
        self.content_layout = QVBoxLayout()
        self.content_layout.setContentsMargins(10, 10, 10, 10)
        self.content_widget.setLayout(self.content_layout)

        main_layout.addWidget(self.sidebar)
        main_layout.addWidget(self.content_widget)
        main_widget.setLayout(main_layout)

        central_layout = QVBoxLayout()
        central_layout.addWidget(title_bar)
        central_layout.addWidget(main_widget)
        central_widget = QWidget()
        central_widget.setLayout(central_layout)
        self.setCentralWidget(central_widget)

    def toggle_sidebar(self):
        if self.sidebar.width() > 50:
            self.sidebar.setFixedWidth(50)
            self.toggle_btn.setText(">>")
        else:
            self.sidebar.setFixedWidth(200)
            self.toggle_btn.setText("<<")

class CPUSpecsWidget(QWidget):
    def __init__(self, model):
        super().__init__()
        self.model = model
        self.init_ui()

    def init_ui(self):
        layout = QHBoxLayout()
        layout.setSpacing(10)
        layout.setContentsMargins(10, 10, 10, 10)

        left_widget = QWidget()
        self.left_layout = QVBoxLayout()
        self.left_layout.setSpacing(5)
        self.combos = []
        for _ in range(6):
            self.add_combo()
        self.add_btn = QPushButton("+")
        self.remove_btn = QPushButton("-")
        for btn in [self.add_btn, self.remove_btn]:
            btn.setStyleSheet("padding: 5px; background-color: #4CAF50; color: white;")
        self.left_layout.addWidget(self.add_btn)
        self.left_layout.addWidget(self.remove_btn)
        self.left_layout.addStretch()
        left_widget.setLayout(self.left_layout)

        self.table = QTableWidget()
        self.table.setColumnCount(2)
        self.table.setHorizontalHeaderLabels(["Property", "Value"])
        self.table.setStyleSheet("border: 1px solid #ccc; padding: 5px;")

        layout.addWidget(left_widget)
        layout.addWidget(self.table, stretch=1)
        self.setLayout(layout)

        self.add_btn.clicked.connect(self.add_combo)
        self.remove_btn.clicked.connect(self.remove_combo)

    def add_combo(self):
        combo = QComboBox()
        combo.addItems(self.model.cpu_models)
        combo.currentTextChanged.connect(lambda text: self.update_table(text))
        self.combos.append(combo)
        self.left_layout.insertWidget(self.left_layout.count() - 3, combo)

    def remove_combo(self):
        if len(self.combos) > 1:
            combo = self.combos.pop()
            combo.deleteLater()
            self.table.clearContents()

    def update_table(self, cpu_model):
        specs = self.model.get_cpu_specs(cpu_model)
        self.table.setRowCount(len(specs))
        for i, (key, value) in enumerate(specs.items()):
            self.table.setItem(i, 0, QTableWidgetItem(key))
            self.table.setItem(i, 1, QTableWidgetItem(str(value)))
        self.table.resizeColumnsToContents()

class ServerDataWidget(QWidget):
    def __init__(self, model):
        super().__init__()
        self.model = model
        self.init_ui()

    def init_ui(self):
        layout = QHBoxLayout()
        layout.setSpacing(10)
        layout.setContentsMargins(10, 10, 10, 10)

        left_widget = QWidget()
        left_layout = QVBoxLayout()
        left_layout.setSpacing(5)
        self.cpu_combo = QComboBox()
        self.cpu_combo.addItems(self.model.cpu_models)
        self.extra_combo = QComboBox()
        self.extra_combo.addItems(["Option1", "Option2"])
        self.query_btn = QPushButton("Query")
        self.clear_btn = QPushButton("Clear")
        for btn in [self.query_btn, self.clear_btn]:
            btn.setStyleSheet("padding: 5px; background-color: #2196F3; color: white;")
        left_layout.addWidget(self.cpu_combo)
        left_layout.addWidget(self.extra_combo)
        left_layout.addWidget(self.query_btn)
        left_layout.addWidget(self.clear_btn)
        left_layout.addStretch()
        left_widget.setLayout(left_layout)

        self.table = QTableWidget()
        self.table.setColumnCount(4)
        self.table.setHorizontalHeaderLabels(["Property", "Value", "Modify", "Link"])
        self.table.setStyleSheet("border: 1px solid #ccc; padding: 5px;")

        layout.addWidget(left_widget)
        layout.addWidget(self.table, stretch=1)
        self.setLayout(layout)

        self.query_btn.clicked.connect(self.update_table)
        self.clear_btn.clicked.connect(self.clear_table)

    def update_table(self):
        cpu_model = self.cpu_combo.currentText()
        data = self.model.get_server_data(cpu_model)
        self.table.setRowCount(len(data))
        for i, (key, value) in enumerate(data.items()):
            self.table.setItem(i, 0, QTableWidgetItem(key))
            self.table.setItem(i, 1, QTableWidgetItem(value))
            combo = QComboBox()
            combo.addItems(["Low", "Medium", "High"])  # ä¿®æ”¹é€‰é¡¹æ›´è´´è¿‘å®é™…åœºæ™¯
            combo.setCurrentText("Medium")  # é»˜è®¤å€¼
            combo.currentTextChanged.connect(lambda text, r=i, k=key: self.modify_data(cpu_model, r, k, text))
            self.table.setCellWidget(i, 2, combo)
            btn = QPushButton("Link")
            btn.clicked.connect(self.open_link)
            self.table.setCellWidget(i, 3, btn)
        self.table.resizeColumnsToContents()

    def modify_data(self, cpu_model, row, key, text):
        # æ›´æ–°æ¨¡å‹æ•°æ®
        self.model.update_server_data(cpu_model, key, f"{text} ({self.model.get_server_data(cpu_model)[key]})")
        # é‡æ–°æ¸²æŸ“å½“å‰åˆ—ï¼ˆValue åˆ—ï¼‰
        updated_value = self.model.get_server_data(cpu_model)[key]
        self.table.setItem(row, 1, QTableWidgetItem(updated_value))
        print(f"Row {row} modified: {key} = {updated_value}")

    def open_link(self):
        # è·³è½¬åˆ°ç™¾åº¦å®˜ç½‘
        QDesktopServices.openUrl(QUrl("https://www.baidu.com"))
        print("Opening Baidu homepage")

    def clear_table(self):
        self.table.setRowCount(0)

# æ§åˆ¶å±‚ (Controller)
class SystemController:
    def __init__(self, model, login_widget):
        self.model = model
        self.login_widget = login_widget
        self.main_window = None
        self.setup_connections()

    def setup_connections(self):
        self.login_widget.login_signal.connect(self.handle_login)
        if self.main_window:
            self.main_window.cpu_btn.clicked.connect(self.show_cpu_specs)
            self.main_window.server_btn.clicked.connect(self.show_server_data)
            self.main_window.toggle_btn.clicked.connect(self.main_window.toggle_sidebar)
            self.main_window.logout_btn.clicked.connect(self.handle_logout)

    @Slot(str, str)
    def handle_login(self, username, password):
        if self.model.validate_login(username, password):
            self.main_window = MainWindow(username)
            self.setup_connections()
            self.main_window.show()
            self.login_widget.close()
        else:
            QMessageBox.warning(self.login_widget, "Login Failed", "Invalid username or password")

    @Slot()
    def handle_logout(self):
        self.main_window.close()
        self.login_widget = LoginWidget()
        self.setup_connections()
        self.login_widget.show()

    @Slot()
    def show_cpu_specs(self):
        for i in reversed(range(self.main_window.content_layout.count())):
            self.main_window.content_layout.itemAt(i).widget().setParent(None)
        cpu_widget = CPUSpecsWidget(self.model)
        self.main_window.content_layout.addWidget(cpu_widget)

    @Slot()
    def show_server_data(self):
        for i in reversed(range(self.main_window.content_layout.count())):
            self.main_window.content_layout.itemAt(i).widget().setParent(None)
        server_widget = ServerDataWidget(self.model)
        self.main_window.content_layout.addWidget(server_widget)

# ä¸»ç¨‹åº
if __name__ == "__main__":
    app = QApplication(sys.argv)
    app.setStyleSheet("QWidget { font-size: 14px; }")
    model = SystemModel()
    login_widget = LoginWidget()
    controller = SystemController(model, login_widget)
    login_widget.show()
    sys.exit(app.exec())




å¥½çš„ï¼Œæˆ‘ç°åœ¨éœ€è¦æ•´ç†ç”¨æˆ·ä¹‹å‰è®¨è®ºçš„æ‰€æœ‰åŠŸèƒ½ä»£ç ï¼Œå¹¶ç¡®ä¿å®ƒä»¬èƒ½å¤Ÿå®Œæ•´è¿è¡Œã€‚ç”¨æˆ·å¸Œæœ›æœ‰ä¸€ä¸ªå®Œæ•´çš„é¡¹ç›®ç»“æ„ï¼ŒåŒ…æ‹¬ç”¨æˆ·ç™»å½•ã€æœåŠ¡å™¨å’Œè™šæ‹Ÿæœºç®¡ç†ã€APIè°ƒç”¨ä»¥åŠä¾èµ–æ³¨å…¥ç­‰ã€‚æˆ‘éœ€è¦ä»”ç»†å›é¡¾ä¹‹å‰çš„å¯¹è¯ï¼Œæ•´åˆæ‰€æœ‰ä»£ç ï¼Œå¹¶ç¡®ä¿å„æ¨¡å—ä¹‹é—´çš„æ­£ç¡®å¼•ç”¨ã€‚

é¦–å…ˆï¼Œç”¨æˆ·æåˆ°äº†ä½¿ç”¨PySide6å®ç°ç•Œé¢ä¸ä¸šåŠ¡é€»è¾‘åˆ†ç¦»ï¼Œå¹¶é‡‡ç”¨ä¾èµ–æ³¨å…¥å®¹å™¨ç®¡ç†æœåŠ¡ã€‚éœ€è¦ç¡®è®¤å®¹å™¨æ¨¡å—æ˜¯å¦æ­£ç¡®æ³¨å†Œäº†æ‰€æœ‰æœåŠ¡ï¼Œæ¯”å¦‚AuthServiceã€APIClientã€SessionServiceç­‰ã€‚

æ¥ä¸‹æ¥ï¼Œç”¨æˆ·å¸Œæœ›æ–°å¢ç”¨æˆ·ç™»å½•ç•Œé¢ï¼Œåªæœ‰ç™»å½•æˆåŠŸåæ‰èƒ½è¿›å…¥ä¸»ç•Œé¢ã€‚éœ€è¦æ£€æŸ¥LoginDialogçš„å®ç°ï¼Œç¡®ä¿å…¶ä¸AuthServiceå’ŒSessionServiceçš„äº¤äº’æ­£ç¡®ï¼Œæ¯”å¦‚åœ¨ç™»å½•æˆåŠŸåå¯åŠ¨ä¼šè¯ï¼Œå¹¶å…³é—­å¯¹è¯æ¡†ã€‚

ç„¶åæ˜¯å…³äºæœåŠ¡å™¨å’Œè™šæ‹Ÿæœºç®¡ç†çš„éƒ¨åˆ†ï¼Œç‰¹åˆ«æ˜¯é€šè¿‡ç¬¬ä¸‰æ–¹APIè°ƒç”¨è¿›è¡Œæ“ä½œï¼Œå¹¶æºå¸¦ç”¨æˆ·è®¤è¯ä¿¡æ¯ã€‚éœ€è¦ç¡®è®¤APIClientæ˜¯å¦æ­£ç¡®å¤„ç†äº†è®¤è¯å¤´ï¼Œæ¯”å¦‚åœ¨è¯·æ±‚ä¸­æ·»åŠ Bearer Tokenã€‚æ­¤å¤–ï¼ŒæœåŠ¡å™¨ç®¡ç†æ¨¡å—ï¼ˆServerManagerï¼‰æ˜¯å¦æ­£ç¡®ä½¿ç”¨APIClientå‘é€è¯·æ±‚ï¼Œå¹¶å¤„ç†å“åº”ã€‚

å¦å¤–ï¼Œç”¨æˆ·æåˆ°äº†åŠ å¯†æœåŠ¡ï¼ˆCryptoServiceï¼‰ç”¨äºå®‰å…¨å­˜å‚¨æ•æ„Ÿä¿¡æ¯ï¼Œæ¯”å¦‚é…ç½®ä¸­çš„APIå¯†é’¥ã€‚éœ€è¦ç¡®ä¿é…ç½®ç®¡ç†æ¨¡å—ï¼ˆConfigServiceï¼‰èƒ½å¤Ÿä½¿ç”¨åŠ å¯†æœåŠ¡è¿›è¡Œæ•°æ®çš„åŠ å¯†å’Œè§£å¯†ï¼Œç‰¹åˆ«æ˜¯åœ¨ä¿å­˜å’ŒåŠ è½½ç”¨æˆ·å‡­æ®æ—¶ã€‚

è¿˜éœ€è¦è€ƒè™‘çº¿ç¨‹ç®¡ç†å’Œå¼‚æ­¥æ“ä½œï¼Œæ¯”å¦‚ä½¿ç”¨QThreadæˆ–çº¿ç¨‹æ± å¤„ç†é•¿æ—¶é—´è¿è¡Œçš„ä»»åŠ¡ï¼Œé¿å…é˜»å¡ä¸»ç•Œé¢ã€‚éœ€è¦æ£€æŸ¥Workerç±»å’ŒThreadPoolServiceçš„å®ç°ï¼Œç¡®ä¿ä»»åŠ¡èƒ½å¤Ÿæ­£ç¡®æäº¤å’Œå–æ¶ˆï¼Œå¹¶åœ¨ä»»åŠ¡å®Œæˆæˆ–å¤±è´¥æ—¶å‘å‡ºç›¸åº”ä¿¡å·ã€‚

ç•Œé¢éƒ¨åˆ†ï¼Œä¸»çª—å£ï¼ˆMainWindowï¼‰éœ€è¦æ­£ç¡®åŠ è½½å„ä¸ªæ¨¡å—çš„UIç»„ä»¶ï¼Œæ¯”å¦‚æœåŠ¡å™¨ç®¡ç†é¢æ¿ï¼ˆServerPanelï¼‰å’Œè™šæ‹Ÿæœºç®¡ç†é¢æ¿ï¼ˆVMPanelï¼‰ï¼Œå¹¶é€šè¿‡å¯¼èˆªæ§åˆ¶å™¨ï¼ˆNavigationControllerï¼‰è¿›è¡Œæ¨¡å—åˆ‡æ¢ã€‚éœ€è¦ç¡®è®¤è¿™äº›UIç»„ä»¶æ˜¯å¦æ­£ç¡®åœ°ä¸å¯¹åº”çš„ä¸šåŠ¡é€»è¾‘æ¨¡å—ï¼ˆå¦‚ServerManagerã€VMManagerï¼‰è¿›è¡Œäº¤äº’ï¼Œå¹¶é€šè¿‡ä¿¡å·æ§½æœºåˆ¶æ›´æ–°ç•Œé¢çŠ¶æ€ã€‚

åœ¨æ•´åˆæ‰€æœ‰æ¨¡å—æ—¶ï¼Œéœ€è¦æ³¨æ„æ¨¡å—ä¹‹é—´çš„ä¾èµ–å…³ç³»ï¼Œç¡®ä¿å®¹å™¨åœ¨å¯åŠ¨æ—¶æ­£ç¡®åˆå§‹åŒ–æ‰€æœ‰æœåŠ¡ï¼Œå¹¶æŒ‰éœ€æ³¨å…¥åˆ°å„ä¸ªç»„ä»¶ä¸­ã€‚ä¾‹å¦‚ï¼ŒAPIClientä¾èµ–äºSessionServiceæ¥è·å–è®¿é—®ä»¤ç‰Œï¼Œè€ŒSessionServiceåœ¨ç”¨æˆ·ç™»å½•æˆåŠŸååˆå§‹åŒ–ã€‚

æ­¤å¤–ï¼Œé”™è¯¯å¤„ç†å’Œæ—¥å¿—è®°å½•ä¹Ÿæ˜¯å…³é”®éƒ¨åˆ†ã€‚éœ€è¦ç¡®ä¿æ‰€æœ‰æœåŠ¡ï¼ˆå¦‚APIClientï¼‰åœ¨å‘ç”Ÿé”™è¯¯æ—¶èƒ½å¤Ÿé€šè¿‡ç»Ÿä¸€çš„æ—¥å¿—æœåŠ¡ï¼ˆLogServiceï¼‰è®°å½•é”™è¯¯ä¿¡æ¯ï¼Œå¹¶åœ¨ç•Œé¢ä¸Šæ˜¾ç¤ºå‹å¥½çš„é”™è¯¯æç¤ºã€‚ä¾‹å¦‚ï¼Œå½“APIè¿”å›è®¤è¯é”™è¯¯æ—¶ï¼Œè‡ªåŠ¨æ³¨é”€ç”¨æˆ·å¹¶è·³è½¬å›ç™»å½•ç•Œé¢ã€‚

æœ€åï¼Œéœ€è¦éªŒè¯æ•´ä¸ªé¡¹ç›®çš„ç»“æ„æ˜¯å¦åˆç†ï¼Œæ‰€æœ‰æ–‡ä»¶å’Œç›®å½•æ˜¯å¦æŒ‰ç…§çº¦å®šç»„ç»‡ï¼Œæ¯”å¦‚coreã€uiç­‰ç›®å½•çš„ç»“æ„ï¼Œä»¥åŠå„æ¨¡å—çš„å¯¼å…¥è·¯å¾„æ˜¯å¦æ­£ç¡®ã€‚è¿˜éœ€è¦æä¾›requirements.txtæ–‡ä»¶ï¼Œåˆ—å‡ºæ‰€æœ‰ä¾èµ–åº“ï¼Œæ–¹ä¾¿ç”¨æˆ·å®‰è£…ç¯å¢ƒã€‚

åœ¨æµ‹è¯•è¿è¡Œæ—¶ï¼Œå¯èƒ½ä¼šé‡åˆ°æ¨¡å—å¯¼å…¥é”™è¯¯ã€ä¾èµ–æ³¨å…¥å®¹å™¨æœªæ­£ç¡®æ³¨å†ŒæœåŠ¡ã€ä¿¡å·æ§½æœªæ­£ç¡®è¿æ¥ç­‰é—®é¢˜ã€‚éœ€è¦é€æ­¥è°ƒè¯•ï¼Œç¡®ä¿æ¯ä¸ªç»„ä»¶åœ¨åˆå§‹åŒ–æ—¶èƒ½å¤Ÿè·å–æ‰€éœ€çš„ä¾èµ–ï¼Œå¹¶ä¸”ç”¨æˆ·äº¤äº’æ“ä½œèƒ½å¤Ÿæ­£ç¡®è§¦å‘ä¸šåŠ¡é€»è¾‘å’Œç•Œé¢æ›´æ–°ã€‚

æ€»ç»“æ¥è¯´ï¼Œéœ€è¦ç³»ç»Ÿæ€§åœ°æ•´åˆæ‰€æœ‰è®¨è®ºè¿‡çš„åŠŸèƒ½æ¨¡å—ï¼Œç¡®ä¿å®ƒä»¬ååŒå·¥ä½œï¼ŒåŒæ—¶ä¿æŒä»£ç çš„æ¨¡å—åŒ–å’Œå¯æ‰©å±•æ€§ã€‚è¿™åŒ…æ‹¬æ­£ç¡®å®ç°ä¾èµ–æ³¨å…¥ã€ä¿¡å·æ§½é€šä¿¡ã€å¼‚æ­¥å¤„ç†ã€é”™è¯¯å¤„ç†å’Œå®‰å…¨æªæ–½ï¼Œæœ€ç»ˆæä¾›ä¸€ä¸ªå®Œæ•´ä¸”å¯è¿è¡Œçš„é¡¹ç›®ä»£ç ã€‚


ä»¥ä¸‹æ˜¯å®Œæ•´çš„å¯è¿è¡Œä»£ç ï¼ŒåŒ…å«æ‰€æœ‰è®¨è®ºåŠŸèƒ½ï¼š

 é¡¹ç›®ç»“æ„
server_manager/
â”œâ”€â”€ main.py
â”œâ”€â”€ core/
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ container.py
â”‚   â”œâ”€â”€ services/
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ auth.py
â”‚   â”‚   â”œâ”€â”€ api_client.py
â”‚   â”‚   â”œâ”€â”€ session.py
â”‚   â”‚   â”œâ”€â”€ crypto.py
â”‚   â”‚   â”œâ”€â”€ config.py
â”‚   â”‚   â””â”€â”€ logging.py
â”‚   â””â”€â”€ modules/
â”‚       â”œâ”€â”€ server/
â”‚       â”‚   â”œâ”€â”€ __init__.py
â”‚       â”‚   â””â”€â”€ manager.py
â”œâ”€â”€ ui/
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ main_window.py
â”‚   â”œâ”€â”€ auth/
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â””â”€â”€ login_dialog.py
â”‚   â””â”€â”€ modules/
â”‚       â”œâ”€â”€ server/
â”‚       â”‚   â””â”€â”€ panel.py
â”‚       â””â”€â”€ widgets.py
â””â”€â”€ requirements.txt

 1. core/container.py
python
class DIContainer:
    _instance = None
    
    def __init__(self):
        self._services = {}
        self._factories = {}
        
    def register_service(self, name: str, factory: callable, singleton=True):
        self._factoriesname = (factory, singleton)
        
    def get_service(self, name: str):
        if name not in self._services:
            factory, singleton = self._factoriesname
            instance = factory()
            if singleton:
                self._servicesname = instance
            return instance
        return self._servicesname
    
    def shutdown(self):
        self._services.clear()

container = DIContainer()

 2. core/services/auth.py
python
from PySide6.QtCore import QObject, Signal
import hashlib

class AuthService(QObject):
    login_success = Signal(dict)
    login_failed = Signal(str)

    def authenticate(self, username: str, password: str):
         æ¨¡æ‹Ÿç”¨æˆ·æ•°æ®åº“
        users = {
            "admin": hashlib.sha256(b"admin123").hexdigest()
        }
        hashed_pw = hashlib.sha256(password.encode()).hexdigest()
        
        if username in users and usersusername == hashed_pw:
            self.login_success.emit({
                "username": username,
                "token": "dummy_token",
                "roles": "admin"
            })
        else:
            self.login_failed.emit("è®¤è¯å¤±è´¥: ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯")

 3. core/services/api_client.py
python
from PySide6.QtCore import QObject, Signal
from PySide6.QtNetwork import QNetworkAccessManager, QNetworkRequest

class APIClient(QObject):
    api_error = Signal(str, int)
    
    def __init__(self):
        super().__init__()
        self.nam = QNetworkAccessManager()
        self.base_url = "https://api.example.com"
        
    def get(self, endpoint: str):
        request = QNetworkRequest(f"{self.base_url}/{endpoint}")
        reply = self.nam.get(request)
        reply.errorOccurred.connect(lambda: self._handle_error(reply))
        return reply
        
    def _handle_error(self, reply):
        self.api_error.emit(reply.errorString(), reply.error())

 4. core/services/session.py
python
from PySide6.QtCore import QObject

class SessionService(QObject):
    def __init__(self):
        super().__init__()
        self.current_user = None
        self.token = None
        
    def start(self, user_data: dict):
        self.current_user = user_data
        self.token = user_data.get('token')
        
    def end(self):
        self.current_user = None
        self.token = None

 5. ui/auth/login_dialog.py
python
from PySide6.QtWidgets import QDialog, QFormLayout, QLineEdit, QPushButton
from core.container import container

class LoginDialog(QDialog):
    def __init__(self):
        super().__init__()
        self.auth = container.get_service('auth')
        self._init_ui()
        self._connect_signals()
        
    def _init_ui(self):
        self.setWindowTitle("ç³»ç»Ÿç™»å½•")
        layout = QFormLayout()
        
        self.username = QLineEdit()
        self.password = QLineEdit()
        self.password.setEchoMode(QLineEdit.Password)
        self.btn_login = QPushButton("ç™»å½•")
        
        layout.addRow("ç”¨æˆ·å:", self.username)
        layout.addRow("å¯†ç :", self.password)
        layout.addRow(self.btn_login)
        
        self.setLayout(layout)
        
    def _connect_signals(self):
        self.btn_login.clicked.connect(self._on_login)
        self.auth.login_success.connect(self.accept)
        self.auth.login_failed.connect(self._show_error)
        
    def _on_login(self):
        username = self.username.text()
        password = self.password.text()
        self.auth.authenticate(username, password)
        
    def _show_error(self, msg):
        self.password.clear()
        self.btn_login.setText(f"ç™»å½•å¤±è´¥: {msg}")

 6. ui/main_window.py
python
from PySide6.QtWidgets import QMainWindow, QTabWidget
from core.container import container

class MainWindow(QMainWindow):
    def __init__(self):
        super().__init__()
        self.session = container.get_service('session')
        self._init_ui()
        
    def _init_ui(self):
        self.setWindowTitle("æœåŠ¡ç®¡ç†æ§åˆ¶å°")
        self.tabs = QTabWidget()
        
         æ·»åŠ æ¨¡å—é¡µé¢
        from ui.modules.server.panel import ServerPanel
        self.tabs.addTab(ServerPanel(), "æœåŠ¡å™¨ç®¡ç†")
        
        self.setCentralWidget(self.tabs)
        self.statusBar().showMessage("å°±ç»ª")

 7. ui/modules/server/panel.py
python
from PySide6.QtWidgets import QWidget, QVBoxLayout, QPushButton
from core.container import container

class ServerPanel(QWidget):
    def __init__(self):
        super().__init__()
        self.api = container.get_service('api_client')
        self._init_ui()
        
    def _init_ui(self):
        layout = QVBoxLayout()
        self.btn_refresh = QPushButton("åˆ·æ–°æœåŠ¡å™¨åˆ—è¡¨")
        self.btn_refresh.clicked.connect(self._refresh)
        layout.addWidget(self.btn_refresh)
        self.setLayout(layout)
        
    def _refresh(self):
        reply = self.api.get("servers")
        reply.finished.connect(self._handle_response)
        
    def _handle_response(self):
        if reply.error():
            print("Error:", reply.errorString())
        else:
            print("Response:", reply.readAll().data().decode())

 8. main.py
python
import sys
from PySide6.QtWidgets import QApplication
from core.container import container
from core.services import auth, api_client, session
from ui.main_window import MainWindow
from ui.auth.login_dialog import LoginDialog

def bootstrap():
    container.register_service('auth', auth.AuthService)
    container.register_service('api_client', api_client.APIClient)
    container.register_service('session', session.SessionService)

def main():
    app = QApplication(sys.argv)
    bootstrap()
    
     æ˜¾ç¤ºç™»å½•çª—å£
    login_dialog = LoginDialog()
    if login_dialog.exec() != QDialog.Accepted:
        sys.exit()
        
     æ˜¾ç¤ºä¸»çª—å£
    window = MainWindow()
    window.show()
    
    sys.exit(app.exec())

if __name__ == "__main__":
    main()

 requirements.txt
PySide6>=6.4.0
requests>=2.28.0
cryptography>=38.0.0

 è¿è¡Œæ•ˆæœè¯´æ˜

text
ç³»ç»Ÿå¯åŠ¨ åˆå§‹åŒ–ä¾èµ–å®¹å™¨...
æœåŠ¡æ³¨å†Œ è®¤è¯æœåŠ¡å·²åŠ è½½
æœåŠ¡æ³¨å†Œ APIå®¢æˆ·ç«¯å·²å°±ç»ª

ç”¨æˆ·ç•Œé¢ æ˜¾ç¤ºç™»å½•å¯¹è¯æ¡†
> ç”¨æˆ·åè¾“å…¥: admin
> å¯†ç è¾“å…¥: ****

è®¤è¯æœåŠ¡ å¼€å§‹éªŒè¯å‡­æ®...
è®¤è¯æˆåŠŸ ç”¨æˆ· admin ç™»å½•æˆåŠŸ
ä¼šè¯æœåŠ¡ åˆ›å»ºæ–°ä¼šè¯ä»¤ç‰Œ

ä¸»ç•Œé¢ åŠ è½½æ§åˆ¶å°ç•Œé¢
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æœåŠ¡ç®¡ç†æ§åˆ¶å°               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ æœåŠ¡å™¨ç®¡ç†                  â”‚
â”‚   > åˆ·æ–°æœåŠ¡å™¨åˆ—è¡¨            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

APIè¯·æ±‚ GET https://api.example.com/servers
å“åº”æ¥æ”¶ çŠ¶æ€ç  200
æ•°æ®å¤„ç† å‘ç°3å°æœåŠ¡å™¨
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ID          â”‚ çŠ¶æ€          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ srv-001     â”‚ è¿è¡Œä¸­        â”‚
â”‚ srv-002     â”‚ ç»´æŠ¤ä¸­        â”‚
â”‚ srv-003     â”‚ å·²åœæ­¢        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

 è¿è¡Œè¯´æ˜

1. å®‰è£…ä¾èµ–
bash
pip install -r requirements.txt

2. è¿è¡Œç¨‹åº
bash
python main.py

3. æµ‹è¯•è´¦å·
ç”¨æˆ·å: admin
å¯†ç : admin123

4. æ“ä½œæµç¨‹
- ç™»å½•æˆåŠŸåè¿›å…¥ä¸»ç•Œé¢
- ç‚¹å‡»"åˆ·æ–°æœåŠ¡å™¨åˆ—è¡¨"æŒ‰é’®æ¨¡æ‹ŸAPIè°ƒç”¨
- è§‚å¯Ÿæ§åˆ¶å°è¾“å‡ºå’Œç•Œé¢å“åº”

è¯¥å®ç°åŒ…å«ä»¥ä¸‹æ ¸å¿ƒåŠŸèƒ½ï¼š
1. åˆ†å±‚æ¶æ„è®¾è®¡ï¼ˆç•Œé¢/æ ¸å¿ƒ/æœåŠ¡ï¼‰
2. ä¾èµ–æ³¨å…¥å®¹å™¨ç®¡ç†
3. ç”¨æˆ·è®¤è¯ä¸ä¼šè¯ç®¡ç†
4. APIå®¢æˆ·ç«¯åŸºç¡€å®ç°
5. æ¨¡å—åŒ–ç•Œé¢ç»„ä»¶

å¯æ ¹æ®å®é™…éœ€æ±‚ç»§ç»­æ‰©å±•ï¼š
1. æ·»åŠ çœŸå®çš„APIè¯·æ±‚å¤„ç†
2. å®ç°æœåŠ¡å™¨çŠ¶æ€å¯è§†åŒ–
3. å¢åŠ æƒé™æ§åˆ¶ç³»ç»Ÿ
4. å®Œå–„é”™è¯¯å¤„ç†æœºåˆ¶





import sys
from PySide6.QtWidgets import (
    QApplication, QMainWindow, QWidget, QVBoxLayout, QHBoxLayout,
    QLabel, QTableView, QMenu, QPushButton,
    QCheckBox, QWidgetAction, QScrollArea, QHeaderView, QSizePolicy
)
from PySide6.QtGui import (
    QStandardItemModel, QStandardItem, QColor, QFont, QCursor, QPalette, QAction
)
from PySide6.QtCore import Qt, QSize

# é¢„å®šä¹‰ç”µè„‘é…ç½®æ± 
computers_pool = {
    "Dell XPS 13": {"å“ç‰Œ": "Dell", "CPU": "Intel i7-12700", "å†…å­˜": "16GB", "ç¡¬ç›˜": "512GB SSD", "æ˜¾å¡": "Intel Iris Xe", "ä»·æ ¼": "12000"},
    "HP Spectre x360": {"å“ç‰Œ": "HP", "CPU": "Intel i5-12350", "å†…å­˜": "8GB", "ç¡¬ç›˜": "256GB SSD", "æ˜¾å¡": "Intel UHD", "ä»·æ ¼": "9000"},
    "Lenovo ThinkPad X1": {"å“ç‰Œ": "Lenovo", "CPU": "AMD Ryzen 7", "å†…å­˜": "32GB", "ç¡¬ç›˜": "1TB SSD", "æ˜¾å¡": "AMD Radeon", "ä»·æ ¼": "15000"},
    "Dell Inspiron 15": {"å“ç‰Œ": "Dell", "CPU": "Intel i3-11150", "å†…å­˜": "8GB", "ç¡¬ç›˜": "1TB HDD", "æ˜¾å¡": "Intel UHD", "ä»·æ ¼": "6000"}
}

# å¯é€‰å‚æ•°ï¼ˆä¿æŒé¡ºåºï¼‰
options_order = ["å“ç‰Œ", "CPU", "å†…å­˜", "ç¡¬ç›˜", "æ˜¾å¡"]
options = {
    "å“ç‰Œ": sorted(set(comp["å“ç‰Œ"] for comp in computers_pool.values())),
    "CPU": sorted(set(comp["CPU"] for comp in computers_pool.values())),
    "å†…å­˜": ["8GB", "16GB", "32GB"],
    "ç¡¬ç›˜": ["256GB SSD", "512GB SSD", "1TB SSD", "1TB HDD"],
    "æ˜¾å¡": ["Intel UHD", "Intel Iris Xe", "AMD Radeon"]
}

class MultiSelectMenu(QMenu):
    def __init__(self, items, selected_items, callback, parent=None):
        super().__init__(parent)
        self.selected_items = selected_items.copy() if selected_items else []
        self.callback = callback
        self.setMinimumWidth(200)
        self.checkboxes = {}
        for item in items:
            checkbox = QCheckBox(item)
            checkbox.setChecked(item in self.selected_items)
            self.checkboxes[item] = checkbox
            checkbox.stateChanged.connect(lambda state, i=item: self.toggle_item(state, i))
            widget_action = QWidgetAction(self)
            widget_action.setDefaultWidget(checkbox)
            self.addAction(widget_action)
        self.setStyleSheet("""
            QMenu { 
                background: #ffffff;
                border: 1px solid #ddd;
                border-radius: 6px;
                padding: 8px;
            }
            QCheckBox { 
                padding: 6px;
                font: 12px 'Microsoft YaHei';
            }
        """)

    def toggle_item(self, state, item):
        print(f"Before toggle - Item: {item}, State: {state}, Current selected_items: {self.selected_items}")
        if state == Qt.Checked:
            if item not in self.selected_items:
                self.selected_items.append(item)
        elif state == Qt.Unchecked:
            if item in self.selected_items:
                self.selected_items.remove(item)
        print(f"After toggle - Updated selected_items: {self.selected_items}")
        self.callback(self.selected_items)

class SingleSelectMenu(QMenu):
    def __init__(self, items, selected_items, callback, parent=None):
        super().__init__(parent)
        self.selected_items = selected_items.copy() if selected_items else []
        self.callback = callback
        self.setMinimumWidth(180)
        for item in items:
            action = QAction(item, self, checkable=True)
            action.setChecked(item in self.selected_items)
            action.triggered.connect(lambda checked, i=item: self.toggle_item(i, checked))
            self.addAction(action)
        self.setStyleSheet("""
            QMenu { 
                background: #ffffff;
                border: 1px solid #ddd;
                border-radius: 6px;
                padding: 6px;
            }
            QAction { 
                padding: 8px 16px;
                font: 12px 'Microsoft YaHei';
            }
        """)

    def toggle_item(self, item, checked):
        print(f"Toggle single item: {item}, checked: {checked}")
        if checked:
            self.selected_items = [item]
        else:
            self.selected_items.clear()
        for action in self.actions():
            action.setChecked(action.text() in self.selected_items)
        self.callback(self.selected_items if checked else [])

class FilterTag(QWidget):
    def __init__(self, param, values, parent=None):
        super().__init__(parent)
        self.setFixedHeight(32)
        self.setSizePolicy(QSizePolicy.Minimum, QSizePolicy.Fixed)
        self.setStyleSheet("""
            background: #2196F3;
            border-radius: 16px;
            padding: 0 8px;
        """)

        layout = QHBoxLayout(self)
        layout.setContentsMargins(0, 0, 0, 0)
        layout.setSpacing(8)

        self.label = QPushButton(f"{param}: {', '.join(values)}")
        self.label.setCursor(Qt.PointingHandCursor)
        self.label.setStyleSheet("""
            QPushButton { 
                border: none; 
                color: white;
                font: 12px 'Microsoft YaHei';
                padding: 0 4px;
            }
            QPushButton:hover { 
                color: #BBDEFB; 
            }
        """)

        self.close_btn = QPushButton("Ã—")
        self.close_btn.setStyleSheet("""
            QPushButton {
                font: bold 14px;
                color: #FFCDD2;
                padding: 0;
                min-width: 20px;
                max-width: 20px;
            }
            QPushButton:hover {
                color: #FF5252;
            }
        """)
        self.close_btn.setCursor(Qt.PointingHandCursor)
        self.close_btn.setFixedSize(20, 20)

        layout.addWidget(self.label)
        layout.addWidget(self.close_btn)

class ComparisonWindow(QMainWindow):
    def __init__(self):
        super().__init__()
        self.filters = {}
        self.init_ui()
        self.setMinimumSize(800, 600)

    def init_ui(self):
        self.setWindowTitle("ç”µè„‘é…ç½®å¯¹æ¯”å·¥å…·")
        self.setFont(QFont("Microsoft YaHei", 10))

        main_widget = QWidget()
        self.setCentralWidget(main_widget)
        main_layout = QVBoxLayout(main_widget)
        main_layout.setContentsMargins(12, 12, 12, 12)
        main_layout.setSpacing(12)

        # ç­›é€‰æ¡ä»¶å®¹å™¨
        scroll = QScrollArea()
        scroll.setWidgetResizable(True)
        scroll.setFixedHeight(60)
        scroll.setStyleSheet("""
            QScrollArea { 
                border: 2px solid #BBDEFB;
                border-radius: 8px;
                background: white;
            }
            QScrollArea > QWidget > QWidget { 
                background: transparent; 
            }
        """)

        self.filter_container = QWidget()
        self.filter_container.setCursor(Qt.PointingHandCursor)
        self.filter_layout = QHBoxLayout(self.filter_container)
        self.filter_layout.setContentsMargins(8, 8, 8, 8)
        self.filter_layout.setSpacing(8)

        self.placeholder = QLabel("ç‚¹å‡»é€‰æ‹©ç­›é€‰æ¡ä»¶")
        self.placeholder.setStyleSheet("""
            color: #90A4AE;
            font: 14px 'Microsoft YaHei';
            padding-left: 8px;
        """)
        self.filter_layout.addWidget(self.placeholder)

        # æ·»åŠ æ¸…ç©ºæŒ‰é’®
        self.clear_btn = QPushButton("æ¸…ç©º")
        self.clear_btn.setStyleSheet("""
            QPushButton {
                background: #FF5252;
                color: white;
                border-radius: 16px;
                padding: 4px 12px;
                font: 12px 'Microsoft YaHei';
            }
            QPushButton:hover {
                background: #FF1744;
            }
        """)
        self.clear_btn.setFixedHeight(32)
        self.clear_btn.setCursor(Qt.PointingHandCursor)
        self.clear_btn.clicked.connect(self.clear_filters)
        self.clear_btn.setVisible(False)  # åˆå§‹éšè—
        self.filter_layout.addWidget(self.clear_btn)

        self.filter_layout.addStretch(1)

        scroll.setWidget(self.filter_container)
        main_layout.addWidget(scroll)

        # å¯¹æ¯”è¡¨æ ¼
        self.model = QStandardItemModel()
        self.table_view = QTableView()
        self.table_view.setModel(self.model)
        self.table_view.horizontalHeader().setSectionResizeMode(QHeaderView.Stretch)
        self.table_view.verticalHeader().setVisible(False)
        self.table_view.setStyleSheet("""
            QTableView { 
                border: 1px solid #ddd; 
                border-radius: 6px;
                background: white;
            }
            QHeaderView::section { 
                background: #f5f5f5; 
                padding: 8px;
                border: none;
            }
        """)
        main_layout.addWidget(self.table_view)

        # äº‹ä»¶ç»‘å®š
        self.filter_container.mousePressEvent = self.show_filter_menu

    def show_filter_menu(self, event):
        menu = QMenu(self)
        menu.setFixedWidth(280)

        for param in options_order:
            action = QAction(f"? {param}", self)
            current_values = self.filters.get(param, [])
            print(f"Showing menu for {param}, current values: {current_values}")

            if param == "å“ç‰Œ":
                submenu = MultiSelectMenu(
                    options[param],
                    current_values,
                    lambda s, p=param: self.apply_filter(p, s)
                )
            else:
                submenu = SingleSelectMenu(
                    options[param],
                    current_values,
                    lambda s, p=param: self.apply_filter(p, s)
                )

            action.setMenu(submenu)
            menu.addAction(action)

        menu.exec(QCursor.pos())

    def apply_filter(self, param, selected):
        print(f"Applying filter: {param} = {selected}")

        if selected:
            if param == "å“ç‰Œ":
                self.filters[param] = selected
            else:
                self.filters[param] = selected[0] if selected else None
        elif param in self.filters:
            del self.filters[param]

        self.update_filter_tags()
        self.generate_comparison()

    def update_filter_tags(self):
        # æ¸…ç©ºæ‰€æœ‰æ—§æ ‡ç­¾ï¼ˆä¿ç•™å ä½ç¬¦ã€æ¸…ç©ºæŒ‰é’®å’Œæ‹‰ä¼¸é¡¹ï¼‰
        for i in reversed(range(self.filter_layout.count())):
            widget = self.filter_layout.itemAt(i).widget()
            if isinstance(widget, FilterTag):
                widget.deleteLater()

        # æŒ‰å›ºå®šé¡ºåºåˆ›å»ºæ–°æ ‡ç­¾
        for param in options_order:
            if param in self.filters:
                values = self.filters[param]
                if not isinstance(values, list):
                    values = [str(values)]
                values = [v for v in values if v]
                if values:
                    tag = FilterTag(param, values)
                    tag.close_btn.clicked.connect(lambda _, p=param: self.remove_filter(p))
                    tag.label.clicked.connect(lambda _, p=param: self.reselect_filter(p))
                    # æ’å…¥åˆ°æ¸…ç©ºæŒ‰é’®å‰ï¼ˆcount() - 2ï¼‰
                    self.filter_layout.insertWidget(self.filter_layout.count() - 2, tag)

        # æ›´æ–°å ä½ç¬¦å’Œæ¸…ç©ºæŒ‰é’®æ˜¾ç¤º
        has_filters = len(self.filters) > 0
        self.placeholder.setVisible(not has_filters)
        self.clear_btn.setVisible(has_filters)
        self.filter_container.updateGeometry()

    def reselect_filter(self, param):
        current_values = self.filters.get(param, [])
        print(f"Reselecting filter for {param}, current values: {current_values}")

        if param == "å“ç‰Œ":
            menu = MultiSelectMenu(options[param], current_values,
                                   lambda s: self.apply_filter(param, s))
        else:
            menu = SingleSelectMenu(options[param], current_values,
                                    lambda s: self.apply_filter(param, s))
        menu.exec(QCursor.pos())

    def remove_filter(self, param):
        if param in self.filters:
            del self.filters[param]
            self.update_filter_tags()
            self.generate_comparison()

    def clear_filters(self):
        self.filters.clear()
        self.update_filter_tags()
        self.generate_comparison()

    def generate_comparison(self):
        filtered = {}
        for name, attrs in computers_pool.items():
            match = True
            for param, values in self.filters.items():
                if isinstance(values, list):
                    if attrs[param] not in values:
                        match = False
                        break
                else:
                    if attrs[param] != values:
                        match = False
                        break
            if match:
                filtered[name] = attrs

        self.model.clear()
        if not filtered:
            return

        headers = ["å‚æ•°"] + list(filtered.keys())
        self.model.setHorizontalHeaderLabels(headers)

        attrs_order = ["å“ç‰Œ", "CPU", "å†…å­˜", "ç¡¬ç›˜", "æ˜¾å¡", "ä»·æ ¼"]
        for attr in attrs_order:
            row = [QStandardItem(attr)]
            row[0].setFont(QFont("Microsoft YaHei", 11, QFont.Bold))
            row[0].setForeground(QColor("#333333"))

            for comp in filtered.values():
                item = QStandardItem(comp[attr])
                item.setTextAlignment(Qt.AlignCenter)
                row.append(item)

            self.model.appendRow(row)

        self.highlight_differences()

    def highlight_differences(self):
        for row in range(self.model.rowCount()):
            values = [self.model.item(row, col).text() for col in range(1, self.model.columnCount())]
            if len(set(values)) > 1:
                for col in range(1, self.model.columnCount()):
                    self.model.item(row, col).setBackground(QColor("#fff3cd"))

if __name__ == "__main__":
    app = QApplication(sys.argv)
    app.setStyle("Fusion")
    window = ComparisonWindow()
    window.show()
    sys.exit(app.exec())






import sys
from PySide6.QtWidgets import (
    QApplication, QMainWindow, QWidget, QVBoxLayout, QHBoxLayout,
    QLabel, QTableView, QMenu, QPushButton,
    QCheckBox, QWidgetAction, QScrollArea, QHeaderView, QSizePolicy
)
from PySide6.QtGui import (
    QStandardItemModel, QStandardItem, QColor, QFont, QCursor, QPalette, QAction
)
from PySide6.QtCore import Qt, QSize

# é¢„å®šä¹‰ç”µè„‘é…ç½®æ± 
computers_pool = {
    "Dell XPS 13": {"å“ç‰Œ": "Dell", "CPU": "Intel i7-12700", "å†…å­˜": "16GB", "ç¡¬ç›˜": "512GB SSD", "æ˜¾å¡": "Intel Iris Xe", "ä»·æ ¼": "12000"},
    "HP Spectre x360": {"å“ç‰Œ": "HP", "CPU": "Intel i5-12350", "å†…å­˜": "8GB", "ç¡¬ç›˜": "256GB SSD", "æ˜¾å¡": "Intel UHD", "ä»·æ ¼": "9000"},
    "Lenovo ThinkPad X1": {"å“ç‰Œ": "Lenovo", "CPU": "AMD Ryzen 7", "å†…å­˜": "32GB", "ç¡¬ç›˜": "1TB SSD", "æ˜¾å¡": "AMD Radeon", "ä»·æ ¼": "15000"},
    "Dell Inspiron 15": {"å“ç‰Œ": "Dell", "CPU": "Intel i3-11150", "å†…å­˜": "8GB", "ç¡¬ç›˜": "1TB HDD", "æ˜¾å¡": "Intel UHD", "ä»·æ ¼": "6000"}
}

# å¯é€‰å‚æ•°ï¼ˆä¿æŒé¡ºåºï¼‰
options_order = ["å“ç‰Œ", "CPU", "å†…å­˜", "ç¡¬ç›˜", "æ˜¾å¡"]
options = {
    "å“ç‰Œ": sorted(set(comp["å“ç‰Œ"] for comp in computers_pool.values())),
    "CPU": sorted(set(comp["CPU"] for comp in computers_pool.values())),
    "å†…å­˜": ["8GB", "16GB", "32GB"],
    "ç¡¬ç›˜": ["256GB SSD", "512GB SSD", "1TB SSD", "1TB HDD"],
    "æ˜¾å¡": ["Intel UHD", "Intel Iris Xe", "AMD Radeon"]
}

class MultiSelectMenu(QMenu):
    def __init__(self, items, selected_items, callback, parent=None):
        super().__init__(parent)
        self.selected_items = selected_items.copy() if selected_items else []
        self.callback = callback
        self.setMinimumWidth(200)
        self.checkboxes = {}
        for item in items:
            checkbox = QCheckBox(item)
            checkbox.setChecked(item in self.selected_items)
            self.checkboxes[item] = checkbox
            # ç¡®ä¿ä¿¡å·æ­£ç¡®ç»‘å®š
            checkbox.stateChanged.connect(lambda state, i=item: self.toggle_item(state, i))
            widget_action = QWidgetAction(self)
            widget_action.setDefaultWidget(checkbox)
            self.addAction(widget_action)
        self.setStyleSheet("""
            QMenu { 
                background: #ffffff;
                border: 1px solid #ddd;
                border-radius: 6px;
                padding: 8px;
            }
            QCheckBox { 
                padding: 6px;
                font: 12px 'Microsoft YaHei';
            }
        """)

    def toggle_item(self, state, item):
        print(f"Before toggle - Item: {item}, State: {state}, Current selected_items: {self.selected_items}")
        if state == Qt.Checked:
            if item not in self.selected_items:
                self.selected_items.append(item)
        elif state == Qt.Unchecked:
            if item in self.selected_items:
                self.selected_items.remove(item)
        print(f"After toggle - Updated selected_items: {self.selected_items}")
        self.callback(self.selected_items[:])  # ä¼ é€’å‰¯æœ¬ä»¥é¿å…å¼•ç”¨é—®é¢˜

class SingleSelectMenu(QMenu):
    def __init__(self, items, selected_items, callback, parent=None):
        super().__init__(parent)
        self.selected_items = selected_items.copy() if selected_items else []
        self.callback = callback
        self.setMinimumWidth(180)
        for item in items:
            action = QAction(item, self, checkable=True)
            action.setChecked(item in self.selected_items)
            action.triggered.connect(lambda checked, i=item: self.toggle_item(i, checked))
            self.addAction(action)
        self.setStyleSheet("""
            QMenu { 
                background: #ffffff;
                border: 1px solid #ddd;
                border-radius: 6px;
                padding: 6px;
            }
            QAction { 
                padding: 8px 16px;
                font: 12px 'Microsoft YaHei';
            }
        """)

    def toggle_item(self, item, checked):
        print(f"Toggle single item: {item}, checked: {checked}")
        if checked:
            self.selected_items = [item]
        else:
            self.selected_items.clear()
        for action in self.actions():
            action.setChecked(action.text() in self.selected_items)
        self.callback(self.selected_items if checked else [])

class FilterTag(QWidget):
    def __init__(self, param, values, parent=None):
        super().__init__(parent)
        self.setFixedHeight(32)
        self.setSizePolicy(QSizePolicy.Minimum, QSizePolicy.Fixed)
        self.setStyleSheet("""
            background: #2196F3;
            border-radius: 16px;
            padding: 0 8px;
        """)

        layout = QHBoxLayout(self)
        layout.setContentsMargins(0, 0, 0, 0)
        layout.setSpacing(8)

        self.label = QPushButton(f"{param}: {', '.join(values)}")
        self.label.setCursor(Qt.PointingHandCursor)
        self.label.setStyleSheet("""
            QPushButton { 
                border: none; 
                color: white;
                font: 12px 'Microsoft YaHei';
                padding: 0 4px;
            }
            QPushButton:hover { 
                color: #BBDEFB; 
            }
        """)

        self.close_btn = QPushButton("Ã—")
        self.close_btn.setStyleSheet("""
            QPushButton {
                font: bold 14px;
                color: #FFCDD2;
                padding: 0;
                min-width: 20px;
                max-width: 20px;
            }
            QPushButton:hover {
                color: #FF5252;
            }
        """)
        self.close_btn.setCursor(Qt.PointingHandCursor)
        self.close_btn.setFixedSize(20, 20)

        layout.addWidget(self.label)
        layout.addWidget(self.close_btn)

class ComparisonWindow(QMainWindow):
    def __init__(self):
        super().__init__()
        self.filters = {}
        self.init_ui()
        self.setMinimumSize(800, 600)

    def init_ui(self):
        self.setWindowTitle("ç”µè„‘é…ç½®å¯¹æ¯”å·¥å…·")
        self.setFont(QFont("Microsoft YaHei", 10))

        main_widget = QWidget()
        self.setCentralWidget(main_widget)
        main_layout = QVBoxLayout(main_widget)
        main_layout.setContentsMargins(12, 12, 12, 12)
        main_layout.setSpacing(12)

        # ç­›é€‰æ¡ä»¶å®¹å™¨
        scroll = QScrollArea()
        scroll.setWidgetResizable(True)
        scroll.setFixedHeight(60)
        scroll.setStyleSheet("""
            QScrollArea { 
                border: 2px solid #BBDEFB;
                border-radius: 8px;
                background: white;
            }
            QScrollArea > QWidget > QWidget { 
                background: transparent; 
            }
        """)

        self.filter_container = QWidget()
        self.filter_container.setCursor(Qt.PointingHandCursor)
        self.filter_layout = QHBoxLayout(self.filter_container)
        self.filter_layout.setContentsMargins(8, 8, 8, 8)
        self.filter_layout.setSpacing(8)

        self.placeholder = QLabel("ç‚¹å‡»é€‰æ‹©ç­›é€‰æ¡ä»¶")
        self.placeholder.setStyleSheet("""
            color: #90A4AE;
            font: 14px 'Microsoft YaHei';
            padding-left: 8px;
        """)
        self.filter_layout.addWidget(self.placeholder)
        self.filter_layout.addStretch(1)

        scroll.setWidget(self.filter_container)
        main_layout.addWidget(scroll)

        # å¯¹æ¯”è¡¨æ ¼
        self.model = QStandardItemModel()
        self.table_view = QTableView()
        self.table_view.setModel(self.model)
        self.table_view.horizontalHeader().setSectionResizeMode(QHeaderView.Stretch)
        self.table_view.verticalHeader().setVisible(False)
        self.table_view.setStyleSheet("""
            QTableView { 
                border: 1px solid #ddd; 
                border-radius: 6px;
                background: white;
            }
            QHeaderView::section { 
                background: #f5f5f5; 
                padding: 8px;
                border: none;
            }
        """)
        main_layout.addWidget(self.table_view)

        # äº‹ä»¶ç»‘å®š
        self.filter_container.mousePressEvent = self.show_filter_menu

    def show_filter_menu(self, event):
        menu = QMenu(self)
        menu.setFixedWidth(280)

        for param in options_order:
            action = QAction(f"? {param}", self)
            current_values = self.filters.get(param, [])
            print(f"Current values for {param}: {current_values}")

            if param == "å“ç‰Œ":
                submenu = MultiSelectMenu(
                    options[param],
                    current_values,
                    lambda s, p=param: self.apply_filter(p, s)
                )
            else:
                submenu = SingleSelectMenu(
                    options[param],
                    current_values,
                    lambda s, p=param: self.apply_filter(p, s)
                )

            action.setMenu(submenu)
            menu.addAction(action)

        menu.exec(QCursor.pos())

    def apply_filter(self, param, selected):
        print(f"Applying filter: {param} = {selected}")

        if selected:
            if param == "å“ç‰Œ":
                self.filters[param] = selected
            else:
                self.filters[param] = selected[0] if selected else None
        elif param in self.filters:
            del self.filters[param]

        self.update_filter_tags()
        self.generate_comparison()

    def update_filter_tags(self):
        # æ¸…ç©ºæ‰€æœ‰æ—§æ ‡ç­¾ï¼ˆä¿ç•™å ä½ç¬¦å’Œæ‹‰ä¼¸é¡¹ï¼‰
        for i in reversed(range(self.filter_layout.count())):
            widget = self.filter_layout.itemAt(i).widget()
            if isinstance(widget, FilterTag):
                widget.deleteLater()

        # æŒ‰å›ºå®šé¡ºåºåˆ›å»ºæ–°æ ‡ç­¾
        for param in options_order:
            if param in self.filters:
                values = self.filters[param]
                if not isinstance(values, list):
                    values = [str(values)]
                values = [v for v in values if v]
                if values:
                    tag = FilterTag(param, values)
                    tag.close_btn.clicked.connect(lambda _, p=param: self.remove_filter(p))
                    tag.label.clicked.connect(lambda _, p=param: self.reselect_filter(p))
                    self.filter_layout.insertWidget(self.filter_layout.count() - 1, tag)  # åœ¨ stretch å‰æ’å…¥

        # æ›´æ–°å ä½ç¬¦æ˜¾ç¤º
        self.placeholder.setVisible(len(self.filters) == 0)
        self.filter_container.updateGeometry()

    def reselect_filter(self, param):
        current_values = self.filters.get(param, [])
        if param != "å“ç‰Œ" and isinstance(current_values, list) and len(current_values) > 0:
            current_values = current_values[0]

        if param == "å“ç‰Œ":
            menu = MultiSelectMenu(options[param], current_values,
                                   lambda s: self.apply_filter(param, s))
        else:
            menu = SingleSelectMenu(options[param], current_values,
                                    lambda s: self.apply_filter(param, s))
        menu.exec(QCursor.pos())

    def remove_filter(self, param):
        if param in self.filters:
            del self.filters[param]
            self.update_filter_tags()
            self.generate_comparison()

    def generate_comparison(self):
        filtered = {}
        for name, attrs in computers_pool.items():
            match = True
            for param, values in self.filters.items():
                if isinstance(values, list):
                    if attrs[param] not in values:
                        match = False
                        break
                else:
                    if attrs[param] != values:
                        match = False
                        break
            if match:
                filtered[name] = attrs

        self.model.clear()
        if not filtered:
            return

        headers = ["å‚æ•°"] + list(filtered.keys())
        self.model.setHorizontalHeaderLabels(headers)

        attrs_order = ["å“ç‰Œ", "CPU", "å†…å­˜", "ç¡¬ç›˜", "æ˜¾å¡", "ä»·æ ¼"]
        for attr in attrs_order:
            row = [QStandardItem(attr)]
            row[0].setFont(QFont("Microsoft YaHei", 11, QFont.Bold))
            row[0].setForeground(QColor("#333333"))

            for comp in filtered.values():
                item = QStandardItem(comp[attr])
                item.setTextAlignment(Qt.AlignCenter)
                row.append(item)

            self.model.appendRow(row)

        self.highlight_differences()

    def highlight_differences(self):
        for row in range(self.model.rowCount()):
            values = [self.model.item(row, col).text() for col in range(1, self.model.columnCount())]
            if len(set(values)) > 1:
                for col in range(1, self.model.columnCount()):
                    self.model.item(row, col).setBackground(QColor("#fff3cd"))

if __name__ == "__main__":
    app = QApplication(sys.argv)
    app.setStyle("Fusion")
    window = ComparisonWindow()
    window.show()
    sys.exit(app.exec())
å¤šé€‰å“ç‰Œæ—¶æ— æ³•æ˜¾ç¤ºï¼Œæ§åˆ¶å°è¾“å‡º
Before toggle - Item: Dell, State: 2, Current selected_items: []
After toggle - Updated selected_items: []
Applying filter: å“ç‰Œ = []
Before toggle - Item: HP, State: 2, Current selected_items: []
After toggle - Updated selected_items: []
Applying filter: å“ç‰Œ = []








import sys
from PySide6.QtWidgets import (
    QApplication, QMainWindow, QWidget, QVBoxLayout, QHBoxLayout,
    QLabel, QTableView, QMenu, QPushButton,
    QCheckBox, QWidgetAction, QScrollArea, QHeaderView, QSizePolicy
)
from PySide6.QtGui import (
    QStandardItemModel, QStandardItem, QColor, QFont, QCursor, QPalette, QAction
)
from PySide6.QtCore import Qt, QSize

# é¢„å®šä¹‰ç”µè„‘é…ç½®æ± 
computers_pool = {
    "Dell XPS 13": {"å“ç‰Œ": "Dell", "CPU": "Intel i7-12700", "å†…å­˜": "16GB", "ç¡¬ç›˜": "512GB SSD", "æ˜¾å¡": "Intel Iris Xe",
                    "ä»·æ ¼": "12000"},
    "HP Spectre x360": {"å“ç‰Œ": "HP", "CPU": "Intel i5-12350", "å†…å­˜": "8GB", "ç¡¬ç›˜": "256GB SSD", "æ˜¾å¡": "Intel UHD",
                        "ä»·æ ¼": "9000"},
    "Lenovo ThinkPad X1": {"å“ç‰Œ": "Lenovo", "CPU": "AMD Ryzen 7", "å†…å­˜": "32GB", "ç¡¬ç›˜": "1TB SSD", "æ˜¾å¡": "AMD Radeon",
                           "ä»·æ ¼": "15000"},
    "Dell Inspiron 15": {"å“ç‰Œ": "Dell", "CPU": "Intel i3-11150", "å†…å­˜": "8GB", "ç¡¬ç›˜": "1TB HDD", "æ˜¾å¡": "Intel UHD",
                         "ä»·æ ¼": "6000"}
}

# å¯é€‰å‚æ•°ï¼ˆä¿æŒé¡ºåºï¼‰
options_order = ["å“ç‰Œ", "CPU", "å†…å­˜", "ç¡¬ç›˜", "æ˜¾å¡"]
options = {
    "å“ç‰Œ": sorted(set(comp["å“ç‰Œ"] for comp in computers_pool.values())),
    "CPU": sorted(set(comp["CPU"] for comp in computers_pool.values())),
    "å†…å­˜": ["8GB", "16GB", "32GB"],
    "ç¡¬ç›˜": ["256GB SSD", "512GB SSD", "1TB SSD", "1TB HDD"],
    "æ˜¾å¡": ["Intel UHD", "Intel Iris Xe", "AMD Radeon"]
}


class MultiSelectMenu(QMenu):
    def __init__(self, items, selected_items, callback, parent=None):
        super().__init__(parent)
        self.selected_items = selected_items.copy()
        self.callback = callback
        self.setMinimumWidth(200)
        for item in items:
            checkbox = QCheckBox(item)
            checkbox.setChecked(item in self.selected_items)
            checkbox.stateChanged.connect(lambda state, i=item: self.toggle_item(i, state))
            widget_action = QWidgetAction(self)
            widget_action.setDefaultWidget(checkbox)
            self.addAction(widget_action)
        self.setStyleSheet("""
            QMenu { 
                background: #ffffff;
                border: 1px solid #ddd;
                border-radius: 6px;
                padding: 8px;
            }
            QCheckBox { 
                padding: 6px;
                font: 12px 'Microsoft YaHei';
            }
        """)

    def toggle_item(self, item, state):
        if state == Qt.Checked:
            if item not in self.selected_items:
                self.selected_items.append(item)
        else:
            if item in self.selected_items:
                self.selected_items.remove(item)
        self.callback(self.selected_items)


class SingleSelectMenu(QMenu):
    def __init__(self, items, selected_items, callback, parent=None):
        super().__init__(parent)
        self.selected_items = selected_items.copy()
        self.callback = callback
        self.setMinimumWidth(180)
        for item in items:
            action = QAction(item, self, checkable=True)
            action.setChecked(item in self.selected_items)
            action.triggered.connect(lambda checked, i=item: self.toggle_item(i, checked))
            self.addAction(action)
        self.setStyleSheet("""
            QMenu { 
                background: #ffffff;
                border: 1px solid #ddd;
                border-radius: 6px;
                padding: 6px;
            }
            QAction { 
                padding: 8px 16px;
                font: 12px 'Microsoft YaHei';
            }
        """)

    def toggle_item(self, item, checked):
        if checked:
            self.selected_items = [item]
        else:
            self.selected_items.clear()
        for action in self.actions():
            action.setChecked(action.text() in self.selected_items)
        self.callback(self.selected_items)


class FilterTag(QWidget):
    def __init__(self, param, values, parent=None):
        super().__init__(parent)
        self.setFixedHeight(32)
        self.setSizePolicy(QSizePolicy.Minimum, QSizePolicy.Fixed)
        self.setStyleSheet("""
            background: #2196F3;
            border-radius: 16px;
            padding: 0 8px;
        """)

        layout = QHBoxLayout(self)
        layout.setContentsMargins(0, 0, 0, 0)
        layout.setSpacing(8)

        self.label = QPushButton(f"{param}: {', '.join(values)}")
        self.label.setCursor(Qt.PointingHandCursor)
        self.label.setStyleSheet("""
            QPushButton { 
                border: none; 
                color: white;
                font: 12px 'Microsoft YaHei';
                padding: 0 4px;
            }
            QPushButton:hover { 
                color: #BBDEFB; 
            }
        """)

        self.close_btn = QPushButton("Ã—")
        self.close_btn.setStyleSheet("""
            QPushButton {
                font: bold 14px;
                color: #FFCDD2;
                padding: 0;
                min-width: 20px;
                max-width: 20px;
            }
            QPushButton:hover {
                color: #FF5252;
            }
        """)
        self.close_btn.setCursor(Qt.PointingHandCursor)
        self.close_btn.setFixedSize(20, 20)

        layout.addWidget(self.label)
        layout.addWidget(self.close_btn)


class ComparisonWindow(QMainWindow):
    def __init__(self):
        super().__init__()
        self.filters = {}
        self.init_ui()
        self.setMinimumSize(800, 600)

    def init_ui(self):
        self.setWindowTitle("ç”µè„‘é…ç½®å¯¹æ¯”å·¥å…·")
        self.setFont(QFont("Microsoft YaHei", 10))

        main_widget = QWidget()
        self.setCentralWidget(main_widget)
        main_layout = QVBoxLayout(main_widget)
        main_layout.setContentsMargins(12, 12, 12, 12)
        main_layout.setSpacing(12)

        # ç­›é€‰æ¡ä»¶å®¹å™¨
        scroll = QScrollArea()
        scroll.setWidgetResizable(True)
        scroll.setFixedHeight(60)
        scroll.setStyleSheet("""
            QScrollArea { 
                border: 2px solid #BBDEFB;
                border-radius: 8px;
                background: white;
            }
            QScrollArea > QWidget > QWidget { 
                background: transparent; 
            }
        """)

        self.filter_container = QWidget()
        self.filter_container.setCursor(Qt.PointingHandCursor)
        self.filter_layout = QHBoxLayout(self.filter_container)
        self.filter_layout.setContentsMargins(8, 8, 8, 8)
        self.filter_layout.setSpacing(8)

        self.placeholder = QLabel("ç‚¹å‡»é€‰æ‹©ç­›é€‰æ¡ä»¶")
        self.placeholder.setStyleSheet("""
            color: #90A4AE;
            font: 14px 'Microsoft YaHei';
            padding-left: 8px;
        """)
        self.filter_layout.addWidget(self.placeholder)
        self.filter_layout.addStretch(1)

        scroll.setWidget(self.filter_container)
        main_layout.addWidget(scroll)

        # å¯¹æ¯”è¡¨æ ¼
        self.model = QStandardItemModel()
        self.table_view = QTableView()
        self.table_view.setModel(self.model)
        self.table_view.horizontalHeader().setSectionResizeMode(QHeaderView.Stretch)
        self.table_view.verticalHeader().setVisible(False)
        self.table_view.setStyleSheet("""
            QTableView { 
                border: 1px solid #ddd; 
                border-radius: 6px;
                background: white;
            }
            QHeaderView::section { 
                background: #f5f5f5; 
                padding: 8px;
                border: none;
            }
        """)
        main_layout.addWidget(self.table_view)

        # äº‹ä»¶ç»‘å®š
        self.filter_container.mousePressEvent = self.show_filter_menu

    def show_filter_menu(self, event):
        menu = QMenu(self)
        menu.setFixedWidth(280)

        # ç›´æ¥æ˜¾ç¤ºæ‰€æœ‰ç­›é€‰å‚æ•°
        for param in options_order:
            action = QAction(f"â–¸ {param}", self)
            if param == "å“ç‰Œ":
                submenu = MultiSelectMenu(options[param], self.filters.get(param, []),
                                          lambda s, p=param: self.apply_filter(p, s))
            else:
                submenu = SingleSelectMenu(options[param], self.filters.get(param, []),
                                           lambda s, p=param: self.apply_filter(p, s))
            action.setMenu(submenu)
            menu.addAction(action)

        menu.exec(QCursor.pos())

    def apply_filter(self, param, selected):
        if selected:
            self.filters[param] = selected
        elif param in self.filters:
            del self.filters[param]
        self.update_filter_tags()
        self.generate_comparison()

    def update_filter_tags(self):
        # æ¸…ç©ºæ—§æ ‡ç­¾ï¼ˆä¿ç•™å ä½ç¬¦å’Œæ‹‰ä¼¸é¡¹ï¼‰
        while self.filter_layout.count() > 2:
            item = self.filter_layout.takeAt(0)
            if item.widget() and isinstance(item.widget(), FilterTag):
                item.widget().deleteLater()

        # æŒ‰é¡ºåºæ·»åŠ æ–°æ ‡ç­¾
        for param in options_order:
            if param in self.filters:
                values = self.filters[param]
                tag = FilterTag(param, values)
                tag.close_btn.clicked.connect(lambda _, p=param: self.remove_filter(p))
                tag.label.clicked.connect(lambda _, p=param: self.reselect_filter(p))
                self.filter_layout.insertWidget(0, tag)  # æ’å…¥åˆ°æœ€å·¦ä¾§

        # æ›´æ–°å ä½ç¬¦æ˜¾ç¤º
        self.placeholder.setVisible(len(self.filters) == 0)
        self.filter_container.updateGeometry()

    def reselect_filter(self, param):
        current_values = self.filters.get(param, [])
        if param == "å“ç‰Œ":
            menu = MultiSelectMenu(options[param], current_values,
                                   lambda s: self.apply_filter(param, s))
        else:
            menu = SingleSelectMenu(options[param], current_values,
                                    lambda s: self.apply_filter(param, s))
        menu.exec(QCursor.pos())

    def remove_filter(self, param):
        if param in self.filters:
            del self.filters[param]
            self.update_filter_tags()
            self.generate_comparison()

    def generate_comparison(self):
        filtered = {}
        for name, attrs in computers_pool.items():
            match = True
            for param, values in self.filters.items():
                if attrs[param] not in values:
                    match = False
                    break
            if match:
                filtered[name] = attrs

        self.model.clear()
        if not filtered:
            return

        headers = ["å‚æ•°"] + list(filtered.keys())
        self.model.setHorizontalHeaderLabels(headers)

        attrs_order = ["å“ç‰Œ", "CPU", "å†…å­˜", "ç¡¬ç›˜", "æ˜¾å¡", "ä»·æ ¼"]
        for attr in attrs_order:
            row = [QStandardItem(attr)]
            row[0].setFont(QFont("Microsoft YaHei", 11, QFont.Bold))
            row[0].setForeground(QColor("#333333"))

            for comp in filtered.values():
                item = QStandardItem(comp[attr])
                item.setTextAlignment(Qt.AlignCenter)
                row.append(item)

            self.model.appendRow(row)

        self.highlight_differences()

    def highlight_differences(self):
        for row in range(self.model.rowCount()):
            values = [self.model.item(row, col).text() for col in range(1, self.model.columnCount())]
            if len(set(values)) > 1:
                for col in range(1, self.model.columnCount()):
                    self.model.item(row, col).setBackground(QColor("#fff3cd"))
                    

if __name__ == "__main__":
    app = QApplication(sys.argv)
    app.setStyle("Fusion")
    window = ComparisonWindow()
    window.show()
    sys.exit(app.exec())














import sys
from PySide6.QtWidgets import (
    QApplication, QMainWindow, QWidget, QVBoxLayout, QHBoxLayout,
    QLabel, QTableView, QMenu, QPushButton,
    QCheckBox, QWidgetAction, QScrollArea, QHeaderView, QSizePolicy
)
from PySide6.QtGui import (
    QStandardItemModel, QStandardItem, QColor, QFont, QCursor, QPalette, QAction
)
from PySide6.QtCore import Qt, QSize
from functools import partial

# é¢„å®šä¹‰ç”µè„‘é…ç½®æ± 
computers_pool = {
    "Dell XPS 13": {"å“ç‰Œ": "Dell", "CPU": "Intel i7-12700", "å†…å­˜": "16GB", "ç¡¬ç›˜": "512GB SSD", "æ˜¾å¡": "Intel Iris Xe",
                    "ä»·æ ¼": "12000"},
    "HP Spectre x360": {"å“ç‰Œ": "HP", "CPU": "Intel i5-12350", "å†…å­˜": "8GB", "ç¡¬ç›˜": "256GB SSD", "æ˜¾å¡": "Intel UHD",
                        "ä»·æ ¼": "9000"},
    "Lenovo ThinkPad X1": {"å“ç‰Œ": "Lenovo", "CPU": "AMD Ryzen 7", "å†…å­˜": "32GB", "ç¡¬ç›˜": "1TB SSD", "æ˜¾å¡": "AMD Radeon",
                           "ä»·æ ¼": "15000"},
    "Dell Inspiron 15": {"å“ç‰Œ": "Dell", "CPU": "Intel i3-11150", "å†…å­˜": "8GB", "ç¡¬ç›˜": "1TB HDD", "æ˜¾å¡": "Intel UHD",
                         "ä»·æ ¼": "6000"}
}

# å¯é€‰å‚æ•°ï¼ˆä¿æŒé¡ºåºï¼‰
options_order = ["å“ç‰Œ", "CPU", "å†…å­˜", "ç¡¬ç›˜", "æ˜¾å¡"]
options = {
    "å“ç‰Œ": sorted(set(comp["å“ç‰Œ"] for comp in computers_pool.values())),
    "CPU": sorted(set(comp["CPU"] for comp in computers_pool.values())),
    "å†…å­˜": ["8GB", "16GB", "32GB"],
    "ç¡¬ç›˜": ["256GB SSD", "512GB SSD", "1TB SSD", "1TB HDD"],
    "æ˜¾å¡": ["Intel UHD", "Intel Iris Xe", "AMD Radeon"]
}


class MultiSelectMenu(QMenu):
    def __init__(self, items, selected_items, callback, parent=None):
        super().__init__(parent)
        self.selected_items = selected_items.copy() if selected_items else []
        self.callback = callback
        self.setMinimumWidth(200)
        self.checkboxes = {}

        for item in items:
            checkbox = QCheckBox(item)
            checkbox.setChecked(item in self.selected_items)
            self.checkboxes[item] = checkbox
            # æ”¹ä¸ºä½¿ç”¨ clicked ä¿¡å·å’Œ isChecked() æ–¹æ³•
            checkbox.clicked.connect(lambda checked=False, i=item: self.toggle_item(i))  # è¿™é‡Œä¿®æ”¹
            widget_action = QWidgetAction(self)
            widget_action.setDefaultWidget(checkbox)
            self.addAction(widget_action)

    def toggle_item(self, item):
        checkbox = self.checkboxes[item]
        if checkbox.isChecked():
            if item not in self.selected_items:
                self.selected_items.append(item)
        else:
            if item in self.selected_items:
                self.selected_items.remove(item)
        print(f"Updated selected_items: {self.selected_items}")
        self.callback(self.selected_items.copy())  # ç¡®ä¿ä¼ é€’å‰¯æœ¬


class SingleSelectMenu(QMenu):
    def __init__(self, items, selected_items, callback, parent=None):
        super().__init__(parent)
        self.selected_items = selected_items.copy()
        self.callback = callback
        self.setMinimumWidth(180)
        for item in items:
            action = QAction(item, self, checkable=True)
            action.setChecked(item in self.selected_items)
            action.triggered.connect(partial(self.toggle_item, item))
            self.addAction(action)
        self.setStyleSheet("""
            QMenu { 
                background: #ffffff;
                border: 1px solid #ddd;
                border-radius: 6px;
                padding: 6px;
            }
            QAction { 
                padding: 8px 16px;
                font: 12px 'Microsoft YaHei';
            }
        """)

    def toggle_item(self, item, checked):
        if checked:
            self.selected_items = [item]
        else:
            self.selected_items.clear()
        self.callback(self.selected_items.copy())


class FilterTag(QWidget):
    def __init__(self, param, values, parent=None):
        super().__init__(parent)
        self.setFixedHeight(32)
        self.setSizePolicy(QSizePolicy.Minimum, QSizePolicy.Fixed)
        self.setStyleSheet("""
            background: #2196F3;
            border-radius: 16px;
            padding: 0 8px;
        """)

        layout = QHBoxLayout(self)
        layout.setContentsMargins(0, 0, 0, 0)
        layout.setSpacing(8)

        self.label = QPushButton(f"{param}: {', '.join(values)}")
        self.label.setCursor(Qt.PointingHandCursor)
        self.label.setStyleSheet("""
            QPushButton { 
                border: none; 
                color: white;
                font: 12px 'Microsoft YaHei';
                padding: 0 4px;
            }
            QPushButton:hover { 
                color: #BBDEFB; 
            }
        """)

        self.close_btn = QPushButton("Ã—")
        self.close_btn.setStyleSheet("""
            QPushButton {
                font: bold 14px;
                color: #FFCDD2;
                padding: 0;
                min-width: 20px;
                max-width: 20px;
            }
            QPushButton:hover {
                color: #FF5252;
            }
        """)
        self.close_btn.setCursor(Qt.PointingHandCursor)
        self.close_btn.setFixedSize(20, 20)

        layout.addWidget(self.label)
        layout.addWidget(self.close_btn)


class ComparisonWindow(QMainWindow):
    def __init__(self):
        super().__init__()
        self.filters = {}
        self.init_ui()
        self.setMinimumSize(800, 600)

    def init_ui(self):
        self.setWindowTitle("ç”µè„‘é…ç½®å¯¹æ¯”å·¥å…·")
        self.setFont(QFont("Microsoft YaHei", 10))

        main_widget = QWidget()
        self.setCentralWidget(main_widget)
        main_layout = QVBoxLayout(main_widget)
        main_layout.setContentsMargins(12, 12, 12, 12)
        main_layout.setSpacing(12)

        # ç­›é€‰æ¡ä»¶å®¹å™¨
        scroll = QScrollArea()
        scroll.setWidgetResizable(True)
        scroll.setFixedHeight(60)
        scroll.setStyleSheet("""
            QScrollArea { 
                border: 2px solid #BBDEFB;
                border-radius: 8px;
                background: white;
            }
            QScrollArea > QWidget > QWidget { 
                background: transparent; 
            }
        """)

        self.filter_container = QWidget()
        self.filter_container.setCursor(Qt.PointingHandCursor)
        self.filter_layout = QHBoxLayout(self.filter_container)
        self.filter_layout.setContentsMargins(8, 8, 8, 8)
        self.filter_layout.setSpacing(8)

        self.placeholder = QLabel("ç‚¹å‡»é€‰æ‹©ç­›é€‰æ¡ä»¶")
        self.placeholder.setStyleSheet("""
            color: #90A4AE;
            font: 14px 'Microsoft YaHei';
            padding-left: 8px;
        """)
        self.filter_layout.addWidget(self.placeholder)
        self.filter_layout.addStretch(1)

        scroll.setWidget(self.filter_container)
        main_layout.addWidget(scroll)

        # å¯¹æ¯”è¡¨æ ¼
        self.model = QStandardItemModel()
        self.table_view = QTableView()
        self.table_view.setModel(self.model)
        self.table_view.horizontalHeader().setSectionResizeMode(QHeaderView.Stretch)
        self.table_view.verticalHeader().setVisible(False)
        self.table_view.setStyleSheet("""
            QTableView { 
                border: 1px solid #ddd; 
                border-radius: 6px;
                background: white;
            }
            QHeaderView::section { 
                background: #f5f5f5; 
                padding: 8px;
                border: none;
            }
        """)
        main_layout.addWidget(self.table_view)

        # äº‹ä»¶ç»‘å®š
        self.filter_container.mousePressEvent = self.show_filter_menu

    def show_filter_menu(self, event):
        menu = QMenu(self)
        menu.setFixedWidth(280)

        for param in options_order:
            action = QAction(f"â–¸ {param}", self)
            current_values = self.filters.get(param, [])

            # ä½¿ç”¨partialè§£å†³é—­åŒ…é—®é¢˜
            callback = partial(self.apply_filter, param)

            if param == "å“ç‰Œ":
                submenu = MultiSelectMenu(
                    options[param],
                    current_values,
                    callback
                )
            else:
                submenu = SingleSelectMenu(
                    options[param],
                    current_values,
                    callback
                )

            action.setMenu(submenu)
            menu.addAction(action)

        menu.exec(QCursor.pos())

    def apply_filter(self, param, selected):
        print(f"Applying filter: {param} = {selected}")

        # ç¡®ä¿å“ç‰Œå‚æ•°æ€»æ˜¯å­˜å‚¨åˆ—è¡¨å½¢å¼
        if param == "å“ç‰Œ":
            self.filters[param] = selected.copy() if selected else []
        else:
            # å…¶ä»–å‚æ•°ä¿æŒå•é€‰é€»è¾‘
            self.filters[param] = selected[0] if selected else None

        self.update_filter_tags()
        self.generate_comparison()

    def update_filter_tags(self):
        # ä¿®æ”¹æ ‡ç­¾åˆ›å»ºé€»è¾‘ç¡®ä¿æ˜¾ç¤ºå“ç‰Œå¤šé€‰å€¼
        for param in options_order:
            if param in self.filters:
                values = self.filters[param]
                if param == "å“ç‰Œ":
                    display_values = values  # ç›´æ¥æ˜¾ç¤ºåˆ—è¡¨
                else:
                    display_values = [values] if values else []

                if display_values:
                    tag = FilterTag(param, display_values)

                    tag = FilterTag(param, display_values)
                    tag.close_btn.clicked.connect(partial(self.remove_filter, param))
                    tag.label.clicked.connect(partial(self.reselect_filter, param))
                    self.filter_layout.insertWidget(0, tag)

        # æ›´æ–°å ä½ç¬¦çŠ¶æ€
        self.placeholder.setVisible(len(self.filters) == 0)
        self.filter_container.updateGeometry()

    def reselect_filter(self, param):
        current_values = self.filters.get(param, [])
        callback = partial(self.apply_filter, param)

        if param == "å“ç‰Œ":
            menu = MultiSelectMenu(options[param], current_values, callback)
        else:
            menu = SingleSelectMenu(options[param], current_values, callback)
        menu.exec(QCursor.pos())

    def remove_filter(self, param):
        if param in self.filters:
            del self.filters[param]
            self.update_filter_tags()
            self.generate_comparison()

    def generate_comparison(self):
        filtered = {}
        for name, attrs in computers_pool.items():
            match = True
            for param, values in self.filters.items():
                if isinstance(values, list):
                    if attrs[param] not in values:
                        match = False
                        break
                else:
                    if attrs[param] != values:
                        match = False
                        break
            if match:
                filtered[name] = attrs

        self.model.clear()
        if not filtered:
            return

        headers = ["å‚æ•°"] + list(filtered.keys())
        self.model.setHorizontalHeaderLabels(headers)

        attrs_order = ["å“ç‰Œ", "CPU", "å†…å­˜", "ç¡¬ç›˜", "æ˜¾å¡", "ä»·æ ¼"]
        for attr in attrs_order:
            row = [QStandardItem(attr)]
            row[0].setFont(QFont("Microsoft YaHei", 11, QFont.Bold))
            row[0].setForeground(QColor("#333333"))

            for comp in filtered.values():
                item = QStandardItem(comp[attr])
                item.setTextAlignment(Qt.AlignCenter)
                row.append(item)

            self.model.appendRow(row)

        self.highlight_differences()

    def highlight_differences(self):
        for row in range(self.model.rowCount()):
            values = [self.model.item(row, col).text() for col in range(1, self.model.columnCount())]
            if len(set(values)) > 1:
                for col in range(1, self.model.columnCount()):
                    self.model.item(row, col).setBackground(QColor("#fff3cd"))


if __name__ == "__main__":
    app = QApplication(sys.argv)
    app.setStyle("Fusion")
    window = ComparisonWindow()
    window.show()
    sys.exit(app.exec())
